diff --git a/.env b/.env
index 7f280e9..aece2a8 100644
--- a/.env
+++ b/.env
@@ -14,13 +14,18 @@ BUILD_DATABASE_URL="postgresql://neondb_owner:npg_bgnZWvKH07Xa@ep-still-resonanc
 # --- Vercel Blob ---
 BLOB_READ_WRITE_TOKEN="vercel_blob_rw_0dG10aVH15DAsZWd_NvTqPADY3zK83uptFEkaUZCEY0lC8P"
 
+# --- Sanity Project Config ---
+# For server-side fetching (e.g., in Server Components, API routes)
+SANITY_PROJECT_ID="0zany1dm"
+SANITY_DATASET="production"
+# Exposed to the client for the Sanity Studio and client-side fetching.
+NEXT_PUBLIC_SANITY_PROJECT_ID="0zany1dm"
+NEXT_PUBLIC_SANITY_DATASET="production"
+
 # --- Sanity Tokens ---
 # SERVER-SIDE WRITE TOKEN (Used for creating drafts, etc.)
 SANITY_API_WRITE_TOKEN="skHSNGizuApQH6cHqPX9Mp12df1fHQOxubYPnpoAiPbwv2BwES2TUb2hJHmmXtJCmGkdVaqjS55DYct7AIQxQYBFIDT3dMEvrCCjOY2wjGVoS8MCeevuy8whHnPwVfD2dzi7JVAXqrAngC1s6WCHkH16iXPBFFOwOIW3YcnuSICQTVVk2gE6"
 
-# [SECURITY PATCH APPLIED] CLIENT-SIDE UPLOAD TOKEN (Limited to 'Editor' permissions)
-NEXT_PUBLIC_SANITY_API_WRITE_TOKEN="sk876MxzMkxP5wmXiMzaALwwUcE8RFZN43ZUe2tZC4JDdz1WZDamTGLwJTjdRzgzi6ANfA5J8hBCQ5rDwX3nGizak5W9teRAmGmUJUUHrKszFgKw5JiLWYJxUh8ou8yKqHxQd6rKetMzQvLPtMNv6MfnXY6llqyXoR9CtSM2jFSO3YXWbH5e"
-
 # SERVER-SIDE READ TOKEN (Used for fetching data in server components)
 SANITY_API_READ_TOKEN="skWyr0w9l0GX2Cm2Zpmu9lApLQFcMxxnJtH8cpIyiWYurpe7FbNQncMSwQxifl2CPjrZKD24UNX1ssTdAvKNQIKD4JXzVH1Ja3AWuepTEtTRwBeOL64AyCG0xcF1UEtW25HInglUx9r8uhJ2HUFxatMJytU4RTdsy84Np8gHsNxDDgJsAhE0"
 
diff --git a/.gitignore b/.gitignore
index 26b238e..ddf74fd 100644
--- a/.gitignore
+++ b/.gitignore
@@ -1,37 +1,38 @@
 # See https://help.github.com/articles/ignoring-files/ for more about ignoring files.
 
-# dependencies
+# Dependencies
 /node_modules
 /.pnp
 .pnp.js
+.yarn/install-state.gz
 
-# testing
-/coverage
+# TypeScript
+*.tsbuildinfo
 
-# next.js
+# Next.js
 /.next/
 /out/
 
-# production
+# Vercel
+.vercel
+
+# Production
 /build
 
-# misc
+# Misc
 .DS_Store
 *.pem
 
-# debug
-npm-debug.log*
-yarn-debug.log*
-yarn-error.log*
-
-# local env files
+# Local Environment Variables
 .env.local
 .env.development.local
 .env.test.local
 .env.production.local
 
-# vercel
-.vercel
-
-# Turbopack
-.turbo
+# IDE configuration
+.idea/
+.vscode/*
+!.vscode/settings.json
+!.vscode/tasks.json
+!.vscode/launch.json
+!.vscode/extensions.json
\ No newline at end of file
diff --git a/.sanity/runtime/app.js b/.sanity/runtime/app.js
new file mode 100644
index 0000000..108f95e
--- /dev/null
+++ b/.sanity/runtime/app.js
@@ -0,0 +1,12 @@
+
+// This file is auto-generated on 'sanity dev'
+// Modifications to this file are automatically discarded
+import {renderStudio} from "sanity"
+
+const studioConfig = {missingConfigFile: true}
+
+renderStudio(
+  document.getElementById("sanity"),
+  studioConfig,
+  {reactStrictMode: false, basePath: "/"}
+)
diff --git a/.sanity/runtime/index.html b/.sanity/runtime/index.html
new file mode 100644
index 0000000..534232f
--- /dev/null
+++ b/.sanity/runtime/index.html
@@ -0,0 +1,253 @@
+<!DOCTYPE html><html lang="en">
+<!--
+This file is auto-generated from "sanity dev".
+Modifications to this file are automatically discarded.
+-->
+<head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, viewport-fit=cover"/><meta name="robots" content="noindex"/><meta name="referrer" content="same-origin"/><link rel="icon" href="/static/favicon.ico" sizes="any"/><link rel="icon" href="/static/favicon.svg" type="image/svg+xml"/><link rel="apple-touch-icon" href="/static/apple-touch-icon.png"/><link rel="manifest" href="/static/manifest.webmanifest"/><title>Sanity Studio</title><script>
+;(function () {
+  // The error channel is provided so that error handling can be delegated to a view component.
+  // If there is a subscriber to the error channel at the time the error happens, the error will be pushed to the subscriber instead of handled here.
+  var errorChannel = (function () {
+    var subscribers = Object.create(null)
+    var nextId = 0
+    function subscribe(subscriber) {
+      var id = nextId++
+      subscribers[id] = subscriber
+      return function unsubscribe() {
+        delete subscribers[id]
+      }
+    }
+
+    function publish(event) {
+      for (var id in subscribers) {
+        if (Object.hasOwn(subscribers, id)) {
+          subscribers[id](event)
+        }
+      }
+    }
+    return {
+      subscribers,
+      publish,
+      subscribe
+    }
+  })()
+
+  // NOTE: Store the error channel instance in the global scope so that the Studio application can
+  // access it and subscribe to errors.
+  window.__sanityErrorChannel = {
+    subscribe: errorChannel.subscribe
+  }
+
+  function _handleError(event) {
+    // If there are error channel subscribers, then we assume they will own error rendering,
+    // and we defer to them (no console error).
+    if (Object.keys(errorChannel.subscribers).length > 0) {
+      errorChannel.publish(event)
+    } else {
+      _renderErrorOverlay(event)
+    }
+  }
+
+  var ERROR_BOX_STYLE = [
+    'background: #fff',
+    'border-radius: 6px',
+    'box-sizing: border-box',
+    'color: #121923',
+    'flex: 1',
+    "font-family: -apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,'Helvetica Neue','Liberation Sans',Helvetica,Arial,system-ui,sans-serif",
+    'font-size: 16px',
+    'line-height: 21px',
+    'margin: 0 auto',
+    'max-width: 960px',
+    'max-height: 90dvh',
+    'overflow: auto',
+    'padding: 20px',
+    'width: 100%',
+  ].join(';')
+
+  var ERROR_CODE_STYLE = [
+    'color: #972E2A',
+    "font-family: -apple-system-ui-monospace, 'SF Mono', Menlo, Monaco, Consolas, monospace",
+    'font-size: 13px',
+    'line-height: 17px',
+    'margin: 0',
+  ].join(';')
+
+  function _renderErrorOverlay(event) {
+    var errorElement = document.querySelector('#__sanityError') || document.createElement('div')
+    var error = event.error
+    var colno = event.colno
+    var lineno = event.lineno
+    var filename = event.filename
+
+    errorElement.id = '__sanityError'
+    errorElement.innerHTML = [
+      '<div style="' + ERROR_BOX_STYLE + '">',
+      '<div style="font-weight: 700;">Uncaught error: ' + error.message + '</div>',
+      '<div style="color: #515E72; font-size: 13px; line-height: 17px; margin: 10px 0;">' +
+        filename +
+        ':' +
+        lineno +
+        ':' +
+        colno +
+        '</div>',
+      '<pre style="' + ERROR_CODE_STYLE + '">' + error.stack + '</pre>',
+      '</div>',
+    ].join('')
+
+    errorElement.style.position = 'fixed'
+    errorElement.style.zIndex = 1000000
+    errorElement.style.top = 0
+    errorElement.style.left = 0
+    errorElement.style.right = 0
+    errorElement.style.bottom = 0
+    errorElement.style.padding = '20px'
+    errorElement.style.background = 'rgba(16,17,18,0.66)'
+    errorElement.style.display = 'flex'
+    errorElement.style.alignItems = 'center'
+    errorElement.style.justifyContent = 'center'
+
+    document.body.appendChild(errorElement)
+  }
+
+  // Error listener
+  window.addEventListener('error', (event) => {
+    _handleError({
+      type: 'error',
+      error: event.error,
+      lineno: event.lineno,
+      colno: event.colno,
+      filename: event.filename
+    })
+  })
+
+  // Error listener
+  window.addEventListener('unhandledrejection', (event) => {
+    _handleError({
+      type: 'rejection',
+      error: event.reason
+    })
+  })
+})()
+</script><style>
+  @font-face {
+    font-family: Inter;
+    font-style: normal;
+    font-weight: 400;
+    font-display: swap;
+    src: url("https://studio-static.sanity.io/Inter-Regular.woff2") format("woff2");
+  }
+  @font-face {
+    font-family: Inter;
+    font-style: italic;
+    font-weight: 400;
+    font-display: swap;
+    src: url("https://studio-static.sanity.io/Inter-Italic.woff2") format("woff2");
+  }
+  @font-face {
+    font-family: Inter;
+    font-style: normal;
+    font-weight: 500;
+    font-display: swap;
+    src: url("https://studio-static.sanity.io/Inter-Medium.woff2") format("woff2");
+  }
+  @font-face {
+    font-family: Inter;
+    font-style: italic;
+    font-weight: 500;
+    font-display: swap;
+    src: url("https://studio-static.sanity.io/Inter-MediumItalic.woff2") format("woff2");
+  }
+  @font-face {
+    font-family: Inter;
+    font-style: normal;
+    font-weight: 600;
+    font-display: swap;
+    src: url("https://studio-static.sanity.io/Inter-SemiBold.woff2") format("woff2");
+  }
+  @font-face {
+    font-family: Inter;
+    font-style: italic;
+    font-weight: 600;
+    font-display: swap;
+    src: url("https://studio-static.sanity.io/Inter-SemiBoldItalic.woff2") format("woff2");
+  }
+  @font-face {
+    font-family: Inter;
+    font-style: normal;
+    font-weight: 700;
+    font-display: swap;
+    src: url("https://studio-static.sanity.io/Inter-Bold.woff2") format("woff2");
+  }
+  @font-face {
+    font-family: Inter;
+    font-style: italic;
+    font-weight: 700;
+    font-display: swap;
+    src: url("https://studio-static.sanity.io/Inter-BoldItalic.woff2") format("woff2");
+  }
+  @font-face {
+    font-family: Inter;
+    font-style: normal;
+    font-weight: 800;
+    font-display: swap;
+    src: url("https://studio-static.sanity.io/Inter-ExtraBold.woff2") format("woff2");
+  }
+  @font-face {
+    font-family: Inter;
+    font-style: italic;
+    font-weight: 800;
+    font-display: swap;
+    src: url("https://studio-static.sanity.io/Inter-ExtraBoldItalic.woff2") format("woff2");
+  }
+  @font-face {
+    font-family: Inter;
+    font-style: normal;
+    font-weight: 900;
+    font-display: swap;
+    src: url("https://studio-static.sanity.io/Inter-Black.woff2") format("woff2");
+  }
+  @font-face {
+    font-family: Inter;
+    font-style: italic;
+    font-weight: 900;
+    font-display: swap;
+    src: url("https://studio-static.sanity.io/Inter-BlackItalic.woff2") format("woff2");
+  }
+  html {
+    @media (prefers-color-scheme: dark) {
+      background-color: #13141b;
+    }
+    @media (prefers-color-scheme: light) {
+      background-color: #ffffff;
+    }
+  }
+  html,
+  body,
+  #sanity {
+    height: 100%;
+  }
+  body {
+    margin: 0;
+    -webkit-font-smoothing: antialiased;
+  }
+</style><script src="https://core.sanity-cdn.com/bridge.js" async type="module" data-sanity-core></script>
+</head><body><div id="sanity"></div><script type="module" src="/.sanity\runtime\app.js"></script><noscript><div class="sanity-app-no-js__root"><div class="sanity-app-no-js__content"><style type="text/css">
+.sanity-app-no-js__root {
+  position: absolute;
+  top: 0;
+  right: 0;
+  left: 0;
+  bottom: 0;
+  background: #fff;
+}
+
+.sanity-app-no-js__content {
+  position: absolute;
+  top: 50%;
+  left: 50%;
+  transform: translate(-50%, -50%);
+  text-align: center;
+  font-family: helvetica, arial, sans-serif;
+}
+</style><h1>JavaScript disabled</h1><p>Please <a href="https://www.enable-javascript.com/">enable JavaScript</a> in your browser and reload the page to proceed.</p></div></div></noscript></body></html>
\ No newline at end of file
diff --git a/123.py b/123.py
new file mode 100644
index 0000000..f2f295c
--- /dev/null
+++ b/123.py
@@ -0,0 +1,569 @@
+import os
+import sys
+
+# --- SCRIPT CONFIGURATION ---
+# Place this script in the root of your EternalGames project directory and run it.
+PROJECT_ROOT = '.' 
+
+# This dictionary contains all the text replacements requested.
+# The keys are the original strings, and the values are the new strings.
+REPLACEMENTS = {
+    # --- app/globals.css ---
+    "content: 'عرض الصورة كاملة';": "content: 'عرض الصورة كاملة';",
+
+    # --- app/layout.tsx ---
+    "EternalGames | الألعاب أبدية": "EternalGames | حيث لا تفنى الألعاب",
+    "الألعاب أبدية.": "لا فناء للألعاب.",
+
+    # --- app/actions/authActions.ts ---
+    "إن كان البريد مسجلاً، فقد أُرسِلَ إليه رابط.": "إن صَحَّ بريدُك، أتاك الرابط.",
+    "طرأ خطأ غير متوقع.": "طرأ خطبٌ ما.",
+    "Invalid request.": "طلبٌ غير صالح.",
+    "الرمز باطل أو منتهي الصلاحية.": "الرمز باطل أو منتهي الصلاحية.",
+    "يجب ألا تقل كلمة السر عن ثمانية أحرف.": "كلمة السر لا تقل عن ثمانيةِ حروف.",
+    "تم استعادة كلمة السر بنجاح.": "استُعيدت كلمة السّر.",
+
+    # --- app/actions/commentActions.ts ---
+    "لا يمكن نشر تعليق فارغ.": "لا يمكن نشر تعليق فارغ.",
+    "تعذر نشر التعليق.": "تعذر نشر التعليق.",
+    "غير مصرح لك.": "غير مصرح لك.",
+    "'[Comment deleted]'": "'[طُمِسَ التعليق]'",
+    "'Could not delete comment.'": "'يأبى التعليقُ الحذف.'",
+    '"فشل التحديث."': '"أخفق التحديث."',
+    "تعذر تسجيل التصويت.": "تعذّر تسجيل التصويت.",
+    "فشل جلب الردود.": "أبت الردودُ أن تُجلَب.",
+
+    # --- app/actions/contentActions.ts (This is a common phrase) ---
+    # Already handled by authActions
+
+    # --- app/actions/userActions.ts ---
+    "اسم المستخدم محجوز.": "اسمٌ محجوز.",
+    "تم تحديث الملف الشخصي بنجاح.": "تَجَدَّدَ مَلَفُكَ الشخصي.",
+    "Failed to update profile.": "أخفق تحديث الملف.",
+    "الاسم الكامل مطلوب.": "الاسم الكامل مطلوب.",
+    "اسم المستخدم مطلوب.": "اسم المستخدم مطلوب.",
+    "An unexpected error occurred during onboarding.": "طرأ خطبٌ عند التهيئة.", 
+    "لا يمكن تغيير كلمة السر للحسابات المرتبطة.": "لا يمكن تغيير كلمة السر للحسابات المربوطة بمزود خارجي.",
+    "كافة الحقول إلزامية.": "الحقولُ كلُّها لازمة.",
+    "كلمة السر الحالية غير صحيحة.": "كلمة السر الحالية خاطئة.",
+    "كلمة السر الجديدة يجب ألا تقل عن ٨ أحرف.": "كلمة السر الجديدة لا تقل عن ثمانيةِ حروف.",
+    "كلمتا السر الجديدتان غير متطابقتين.": "الكلمتان الجديدتان لا تتطابقان.",
+    "تم تغيير كلمة السر بنجاح.": "تغيَّرت كلمة السر.",
+    "اسم المستخدم يجب أن يتكون من 3-20 حرفًا إنجليزيًا.": "اسم المستخدم يجب أن يتكون من 3-20 حرفًا إنجليزيًا.",
+    "اسم المستخدم متاح.": "الاسمُ متاح.",
+    "البريد الإلكتروني غير صالح.": "البريد الإلكتروني غير صالح.",
+    "هذا البريد مسجل بالفعل.": "بريدٌ مسجل.",
+    "Validation successful.": "تمَّت المصادقة.",
+    "Username has already been set.": "الاسمُ قد عُيِّن.",
+    "Failed to update username.": "أخفق تحديث الاسم.",
+    "لا يوجد ملف صورة جديد.": "لا صورة جديدة.",
+    "تم تحديث الصورة الرمزية.": "تجدَّدت الصورة الرمزية.",
+    "فشل الرفع.": "أخفق الرفع.",
+
+    # --- app/api/cron/revalidate-scheduled/route.ts ---
+    "غير مصرح لك.": "غير مُخَوَّل.",
+    "No documents to revalidate.": "لا وثائقَ لإعادة المصادقة.",
+
+    # --- app/articles/ArticlesPageClient.tsx ---
+    "أحدث المقالات": "أحدث المقالات",
+    "جميع المقالات": "جميع المقالات",
+    "وصلت إلى نهاية الأرشيف.": "بلغتَ المنتهى.",
+    "امسح المرشحات لتحميل المزيد.": "أزِل المرشحات للمزيد.",
+    "لم نعثر على مقالات تطابق مرادك.": "لم نعثر على مقالاتٍ توافقُ مُرادك.",
+
+    # --- app/articles/page.tsx ---
+    "الأرشيف هادئ. المزيد من المقالات قريبًا.": "بلغتَ المنتهى. مقالاتٌ أخرى تلوحُ في الأفق.",
+
+    # --- app/celestial-almanac/StarPreviewCard.tsx ---
+    'aria-label="إغلاق المعاينة"': 'aria-label="إغلاق"',
+    "الإصدار: ": "الإصدار:",
+    "عرض محور اللعبة": "محور اللعبة",
+
+    # --- app/celestial-almanac/index.tsx ---
+    "'أداء'": "'أداء'",
+    "'متوازن'": "'مُتَّزِن'",
+    "'فائق'": "'فائق'",
+    "فتح إعدادات التقويم": "فتح إعدادات الفلك",
+    "التقويم يرسم...": "الفلكُ يُرسَم...",
+    "يتم جمع بيانات الإصدار. ستظهر الخريطة السماوية قريبًا.": "تُجمعُ بياناتُ الإصدار، وستبزغُ الخريطةُ عما قريب.",
+
+    # --- app/creators/[username]/page.tsx ---
+    "لم ينشر هذا المستخدم أي محتوى عام بعد.": "لم يُرَ لهذا المستخدمِ أثرٌ بعد.",
+    "عرض الملف الشخصي للمستخدم": "ملف المستخدم",
+    "→ عرض الملف الشخصي": "→ الملف الشخصي",
+
+    # --- app/games/[slug]/page.tsx ---
+    "محور لعبة: ": "محور لعبة:",
+    "لم يُنشر أي محتوى حول هذه اللعبة بعد. الأرشيف يترقب المستجدات.": "لم يُخطَّ حرفٌ بعدُ عن هذه اللعبة. الأرشيفُ يترقب.",
+
+    # --- app/lib/authOptions.ts ---
+    '"البريد الإلكتروني"': '"البريد"',
+    '"كلمة السر"': '"كلمة السر"',
+    '"البيانات ناقصة."': '"البياناتُ ناقصة."',
+    '"لا حساب بهذا البريد. تفضل بالتسجيل."': '"لا حساب بهذا البريد. تفضل بالتسجيل."',
+    '"هذا الحساب مرتبط بمزود خارجي."': '"هذا الحساب مربوط بمزود خارجي."',
+    '"كلمة السر غير صحيحة."': '"كلمة السر خاطئة."',
+    '"Missing sign-up details."': '"تفاصيل التسجيل ناقصة."',
+
+    # --- app/news/page.tsx ---
+    "موجز الأنباء": "موجز الأنباء",
+    "لا توجد أخبار حاليًا. سنعود بالجديد.": "لا أنباءَ تُذكَر. سنوافيكم بالجديد.",
+
+    # --- app/news/NewsPageClient.tsx ---
+    "أرشيف الأخبار": "أرشيف الأنباء",
+    "لا توجد أخبار تطابق ما اخترت.": "لا أنباءَ توافقُ ما اخترت.",
+
+    # --- app/profile/page.tsx ---
+    "إعدادات الحساب": "إعدادات الحساب",
+    "تحرير بياناتك": "تحرير البيانات",
+    # 'تغيير كلمة السر' is handled by a different file
+
+    # --- app/profile/bookmarks/page.tsx ---
+    "محفوظاتك": "محفوظاتك",
+    "لم تحفظ أي محتوى بعد.": "لم تحفظ شيئًا بعد.",
+
+    # --- app/profile/[username]/page.tsx ---
+    "عضو منذ ": "عضوٌ منذ ",
+    "عرض كل الأعمال": "عرض كل الأعمال",
+    "حول": "عن",
+    "الأوسمة": "الأوسمة",
+    "النشاط الأخير": "آخرُ نشاط",
+    "علّق على ": "علّق على ",
+    "محتوى لم يعد متاحًا": "تعليقٌ لم يعد متاحًا",
+    " لم ينشر أي تعليقات بعد.": " لم يخطَّ تعليقًا بعد.",
+
+    # --- app/releases/ReleasePageClient.tsx ---
+    "تصفية حسب المنصة:": "تصفية حسب المنصة:",
+    "'الكل'": "'الكل'",
+    "'PC'": "'PC'",
+    "'PS5'": "'PlayStation 5'",
+    "'Xbox'": "'Xbox'",
+    "'Switch'": "'Switch'",
+    "الإصدارات القادمة لسنة 2025": "إصدارات 2025 المُرتقبة",
+    "لا إصدارات لهذه المنصة بعد.": "لا إصدارات لهذه المنصة بعد.",
+
+    # --- app/reviews/page.tsx ---
+    "المراجعات": "المراجعات",
+    "لا توجد حاليًا أي مراجعات في الأرشيف. عد قريبًا.": "الأرشيفُ خالٍ من المراجعاتِ حاليًا. عُد قريبًا.",
+
+    # --- app/reviews/ReviewsPageClient.tsx ---
+    "الأعلى تقييمًا": "الأعلى تقييمًا",
+    "اقرأ المراجعة": "اقرأ المراجعة",
+    "جميع المراجعات": "كلُّ المراجعات",
+    "لا توجد مراجعات تطابق ما اخترت.": "لا مراجعات توافقُ ما اخترت.",
+
+    # --- app/studio/ActionDrawer.tsx ---
+    "label: 'تحرير'": "label: 'تحرير'",
+    "label: 'Preview'": "label: 'معاينة'",
+    "label: 'حذف'": "label: 'حذف'",
+
+    # --- app/studio/DeleteConfirmationModal.tsx ---
+    "تأكيد الحذف": "تأكيد الحذف",
+    "هل أنت متأكد من رغبتك في حذف ": "هل أنت متأكد من رغبتك في حذف ",
+    "This action cannot be undone.": "لا رجعةَ في هذا.",
+    "'إلغاء'": "'إلغاء'",
+    "جار الحذف...": "جارٍ الحذف...",
+    "حذف نهائي": "حذفٌ نهائي",
+    
+    # --- app/studio/GenesisOrb.tsx ---
+    "'مراجعة جديدة'": "'مراجعة جديدة'",
+    "'مقالة جديدة'": "'مقالة جديدة'",
+    "'خبر جديد'": "'خبر جديد'",
+    "'إصدار جديد'": "'إصدار جديد'",
+    '"ليس لديك الصلاحية لإنشاء هذا المحتوى."': '"ليس لكَ إذنُ الإنشاء."',
+    '"فشل إنشاء المسودة."': '"أخفق إنشاء المسودة."',
+
+    # --- app/studio/StudioDashboard.tsx ---
+    "ديوان القيادة": "ديوان الصنعة",
+    "قُد دفّة محتواك في رحاب EternalGames.": "قُد دفّة محتواك في رحاب EternalGames.",
+    'ابحث في العناوين...': 'استنطق المحفوظات...',
+    "'مسودة'": "'مسودة'",
+    "'منشورة'": "'منشورة'",
+    "'مجدولة'": "'مجدولة'",
+    "لا يوجد محتوى.": "لا محتوى.",
+    "NO IMAGE": "بلا صورة",
+
+    # --- app/studio/StudioTabs.tsx ---
+    "كل المحتوى": "كل المحتوى",
+    
+    # --- app/studio/actions.ts ---
+    "غير مصرح لك.": "غير مُخَوَّل.",
+    "صلاحيات غير كافية.": "صلاحياتٌ قاصرة.",
+    "User not found or name is missing.": "المستخدمُ مفقودٌ أو الاسمُ غائب.",
+    "Document type not found for creation.": "لم يُعثر على نوع الوثيقة لإنشائها.",
+    "Document not found after update.": "الوثيقةُ مفقودةٌ بعد تحديثها.",
+    "An unexpected error occurred during the save operation.": "أصابنا خطبٌ أثناء الحفظ.",
+    "Document not found.": "الوثيقةُ مفقودة.",
+    "Insufficient permissions.": "أذوناتٌ قاصرة.",
+    "Could not be deleted.": "تأبى الحذف.",
+    "Failed to commit publication status.": "أخفق تنفيذ حالة النشر.",
+    "Game search failed:": "أخفق البحث عن اللعبة:",
+    "Failed to create game:": "أخفق إنشاء اللعبة:",
+    "Tag search failed:": "أخفق البحث عن الوسم:",
+    "Failed to create tag:": "أخفق إنشاء الوسم:",
+    "Recent tags fetch failed:": "أخفق جلب آخر الوسوم:",
+    "Waiting for document ID...": "بانتظار مُعرِّف الوثيقة...",
+    "المُعرِّف لا يمكن أن يكون فارغًا.": "لا يكُن المُعرِّفُ خاويًا.",
+    "يمكن أن يحتوي المُعرِّف على أحرف وأرقام وشرطات فقط.": "المُعرِّف: حروفٌ وأرقامٌ وشَرْطاتٌ لا غير.",
+    "المُعرِّف صالح.": "المُعرِّفُ صالح.",
+    "هذا المُعرِّف مستخدم بالفعل.": "مُعرِّفٌ مُستعمل.",
+    "فشل التحقق بسبب خطأ في الخادم.": "أخفق التحقق لخطبٍ في الخادم.",
+    "'Unauthorized'": "'غير مُصرَّح به'",
+    "'No file provided'": "'لم يُقدَّم ملف.'",
+    "'Failed to upload asset to Sanity.'": "'أخفق رفع الملف.'",
+    "تم إلغاء نشر المستند بنجاح.": "أُلغيَ نشرُ الوثيقة.",
+    "تم نشر الإصدار بنجاح.": "نُشِرَ الإصدار.",
+    "تم جدولة المستند بنجاح.": "جُدولت الوثيقة.",
+    "تم نشر المستند بنجاح.": "نُشِرت الوثيقة.",
+
+    # --- app/studio/director/EditRolesModal.tsx ---
+    "Edit Roles for": "تعديل أدوار",
+    "حدد الأدوار التي يجب أن يمتلكها هذا المستخدم.": "اختر الأدوار التي سيتقلَّدها هذا المستخدم.",
+    "Roles for": "أدوار",
+    "updated.": "حُدِّثت.",
+    "فشل تحديث الأدوار.": "أخفق تحديث الأدوار.",
+    "جارٍ الحفظ...": "جارٍ الحفظ...",
+    "حفظ التغييرات": "حفظ",
+    
+    # --- app/studio/director/UserManagementClient.tsx ---
+    "المستخدم": "المستخدم",
+    "الأدوار": "الأدوار",
+    "تعديل الأدوار": "تعديل الأدوار",
+    "User (Default)": "مستخدم (افتراضي)",
+    "ابحث بالاسم أو البريد الإلكتروني...": "ابحث بالاسم أو البريد...",
+    
+    # --- app/studio/director/actions.ts ---
+    "A database error occurred.": "خطبٌ في قاعدة البيانات.",
+    
+    # --- app/studio/director/page.tsx ---
+    "الإدارة": "الإدارة",
+    "تعيين وإدارة الأدوار لجميع المستخدمين. تسري التغييرات في الجلسة التالية للمستخدم.": "عيّن وأدِر الأدوار. تسري التغييرات بعد إعادة تسجيل الدخول.",
+
+    # --- app/studio/[contentType]/[id]/BlockToolbar.tsx ---
+    "صورة واحدة": "صورة مفردة",
+    "مقارنة صور": "مضاهاة صورتين",
+    "شبكة صورتين": "شبكة صورتين",
+    "شبكة 4 صور": "شبكة 4 صور",
+
+    # --- app/studio/[contentType]/[id]/EditorCanvas.tsx ---
+    "جارٍ تحميل المحرر...": "جارٍ تحميل المحرر...",
+    "إصدار غير معنون": "إصدارٌ بلا عنوان",
+    "لا يوجد محتوى نصي للإصدارات.": "لا نصَّ للإصدارات.",
+    "يتم تحرير جميع البيانات من الشريط الجانبي.": "تُحرَّرُ البياناتُ من الشريط الجانبي.",
+    
+    # --- app/studio/[contentType]/[id]/EditorClient.tsx ---
+    "لا يمكن الحفظ بمُعرّف غير صالح.": "لا يمكن الحفظ بمُعرِّف غير صالح.",
+    "أخفق حفظ التغييرات.": "أخفق حفظ التغييرات.",
+    "يرجى حفظ التغييرات أولاً.": "احفظ التغييرات أولاً.",
+    "تم تحديث حالة النشر بنجاح!": "تجددت حالة النشر!",
+    "فشل تحديث حالة النشر.": "أخفق تحديث الحالة.",
+    "*غير محفوظ*": "*لم يُحفظ*",
+    "غير معنون": "بلا عنوان",
+    "You have unsaved changes. Are you sure you want to leave?": "أَتَغادرُ وما كتبت لم يُحفظ؟",
+    "EternalGames الديوان": "EternalGames الديوان",
+    "بانتظار مُعرّف الوثيقة...": "بانتظار مُعرِّف الوثيقة...",
+    "جار التحقق...": "جارٍ التحقق...",
+    
+    # --- app/studio/[contentType]/[id]/EditorSidebar.tsx ---
+    "منصة التحرير": "منصة التحرير",
+    "تحرير:": "تحرير:",
+    "جدولة (اختياري)": "جدولة (اختياري)",
+    "تحديث الإصدار": "تحديث الإصدار",
+    "نشر الإصدار": "نشر الإصدار",
+    "حفظ وجدولة": "حفظ وجدولة",
+    "جدولة": "جدولة",
+    "حفظ وتحديث": "حفظ وتحديث",
+    "تحديث": "تحديث",
+    "حفظ ونشر": "حفظ ونشر",
+    "انشر الآن": "انشر الآن",
+    "إلغاء النشر": "إلغاء النشر",
+    "الحقول الإلزامية ناقصة.": "الحقول الإلزامية ناقصة.",
+    "جودة الصورة الرئيسية": "جودة الصورة الرئيسية",
+    "1080p": "1080p",
+    "4K": "4K",
+    "المُعرِّف": "المُعرِّف",
+    "تاريخ الإصدار": "تاريخ الإصدار",
+    "نبذة": "نبذة",
+    "المراجعون": "المراجعون",
+    "الكتّاب": "الكتّاب",
+    "المراسلون": "المراسلون",
+    "المنشئون": "المنشئون",
+    "المصممون (اختياري)": "المصممون (اختياري)",
+    "نوع المقال": "نوع المقال",
+    "اختر نوع المقال...": "اختر نوع المقال...",
+    "الوسوم": "الوسوم",
+    "ابحث أو أنشئ وسمًا...": "ابحث أو أنشئ وسمًا...",
+    "التقييم (0-10)": "التقييم (0-10)",
+    "الخلاصة": "الخلاصة",
+    "المحاسن": "المحاسن",
+    "المآخذ": "المساوئ",
+    "+ إضافة محسن": "+ إضافة حَسَنة",
+    "+ إضافة مأخذ": "+ إضافة سيئة",
+    "تم الحفظ!": "حُفِظ!",
+    # 'حفظ التغييرات' handled by another file
+    "المنصات": "المنصات",
+
+    # --- app/studio/[contentType]/[id]/ImageCompareComponent.tsx ---
+    "جار تحسين الصورة للرفع...": "جارٍ تهيئة الصورة للرفع...",
+    "جار رفع الصورة": "جارٍ رفع الصورة",
+    "تم رفع الصورة بنجاح.": "رُفِعت الصورة.",
+    "فشل رفع أصل الصورة إلى Sanity.": "أخفق رفع أصل الصورة.",
+    "فشل معالجة الصورة.": "أخفقت معالجة الصورة.",
+    "تغيير الصورة ": "تغيير الصورة ",
+    "أفلت صورة أو انقر للرفع": "أفلت صورةً أو انقر للرفع",
+    "Delete Grid": "حذف الشبكة",
+
+    # --- app/studio/[contentType]/[id]/ImageResizeComponent.tsx ---
+    "Delete": "حذف",
+    
+    # --- app/studio/[contentType]/[id]/LinkEditorModal.tsx ---
+    "تعديل الرابط": "تعديل الرابط",
+    "إزالة الرابط": "إزالة الرابط",
+    "تطبيق": "تطبيق",
+
+    # --- app/studio/[contentType]/[id]/RichTextEditor.tsx ---
+    "اكتب محتواك هنا...": "خُطَّ ما في نفسِكَ هنا...",
+    "فشل رفع الصورة.": "أخفق رفع الصورة.",
+
+    # --- app/studio/[contentType]/[id]/StatefulSaveButton.tsx ---
+    "حُفظت التغييرات بنجاح!": "حُفظت التغييرات!",
+    "فشل حفظ التغييرات.": "أخفق حفظ التغييرات.",
+
+    # --- app/studio/[contentType]/[id]/metadata/MainImageInput.tsx ---
+    "نوع الملف غير صالح. يرجى رفع صورة.": "نوع ملف غير صالح. يرجى رفع صورة.",
+    "جار تحسين الصورة...": "جارٍ تهيئة الصورة...",
+    "تم رفع الصورة الرئيسية بنجاح.": "رُفِعت الصورة الرئيسية.",
+    "فشل تحسين الصورة.": "أخفقت تهيئة الصورة.",
+    "اسحب وأفلت أو انقر للرفع": "أفلت أو انقر للرفع",
+    "سيتم تحسين الصور الكبيرة تلقائيًا": "الصورُ الكبيرةُ تُهَيَّأُ تلقائيًا",
+    "إزالة الصورة": "إزالة الصورة",
+    "تمت إزالة الصورة الرئيسية.": "أُزيلت الصورة الرئيسية.",
+
+    # --- app/tags/[tag]/page.tsx ---
+    "وسم:": "وسم:",
+    "لم يتم نشر أي محتوى بهذا الوسم بعد.": "لم يُنشر عملٌ بهذا الوسم بعد.",
+
+    # --- app/welcome/WelcomePageClient.tsx ---
+    "عمرك سيُعرض علنًا. يمكنك إخفاؤه لاحقًا من الإعدادات.": "عمرك سيُعرض علنًا. يمكنك إخفاؤه لاحقًا من الإعدادات.",
+    "بلدك سيُعرض علنًا. يمكنك إخفاؤه لاحقًا من الإعدادات.": "بلدك سيُعرض علنًا. يمكنك إخفاؤه لاحقًا من الإعدادات.",
+    "أهلاً بك في رحاب EternalGames!": "أهلاً بك في رحاب EternalGames!",
+    "بقيت خطوة أخيرة. أكمل ملفك الشخصي لتدخل مجتمعنا.": "خطوةٌ أخيرة تفصلك. أكمل ملفك الشخصي لتدخل مَعيَّتنا.",
+    "اختر اسمًا للمستخدم": "اختر اسمًا للمستخدم",
+    "العمر (اختياري)": "العمر (اختياري)",
+    "البلد (اختياري)": "البلد (اختياري)",
+    "أوافق على": "أوافق على",
+    "شروط الخدمة": "شروط الخدمة",
+    "إكمال الملف الشخصي": "إكمال الملف الشخصي",
+    "اكتمل ملفك. أهلاً بك في EternalGames.": "اكتمل ملفك. أهلًا بك في EternalGames.",
+    "فشل إكمال الملف الشخصي.": "أخفق إكمال الملف.",
+    
+    # --- components/BookmarkButton.tsx ---
+    'aria-label="Bookmark article"': 'aria-label="إحفظ"',
+
+    # --- components/ConfirmationModal.tsx ---
+    "تأكيد": "تأكيد",
+
+    # --- components/ContentActionBar.tsx ---
+    'aria-label="Unlike"': 'aria-label="إلغاء الإعجاب"',
+    'aria-label="Like"': 'aria-label="إعجاب"',
+    'aria-label="Share"': 'aria-label="مشاركة"',
+    
+    # --- components/CreatorCredit.tsx ---
+    "تصميم": "تصميم",
+    "بقلم": "بقلم",
+    
+    # --- components/Footer.tsx ---
+    "صاغه محمد السعد - @MoVisionX": "صاغه محمد السعد - @MoVisionX",
+
+    # --- components/KineticReleaseTimeline.tsx ---
+    "لا توجد إصدارات مجدولة لهذا الشهر.": "لا إصدارات مجدولة لهذا الشهر.",
+    "عرض كل الإصدارات": "عرض كل الإصدارات",
+
+    # --- components/Navbar.tsx ---
+    "فتح البحث": "فتح البحث",
+    "Toggle menu": "تبديل القائمة",
+    "Activate light mode": "تفعيل الوضع النهاري",
+    "Activate dark mode": "تفعيل الوضع الليلي",
+    "Preview Live Page": "معاينة الصفحة الحية",
+    "Document is not published": "المستند غير منشور",
+    # Nav items
+    "المراجعات": "المراجعات",
+    "الأخبار": "الأخبار",
+    "المقالات": "المقالات",
+    "الإصدارات": "الإصدارات",
+    "التقويم": "التقويم",
+    "الكوكبة": "الكوكبة",
+
+    # --- components/PasswordChangeForm.tsx ---
+    "كلمة السر الحالية": "كلمة السر الحالية",
+    "كلمة السر الجديدة": "كلمة السر الجديدة",
+    "تأكيد كلمة السر الجديدة": "تأكيد الجديدة",
+    "تحديث كلمة السر": "تحديث كلمة السر",
+
+    # --- components/ProfileEditForm.tsx ---
+    "صورتك الرمزية": "صورتك الرمزية",
+    "تغيير": "تغيير",
+    "انقر لرفع صورة جديدة (الحد الأقصى 4.5 ميجابايت).": "انقر لرفع صورة جديدة (أقصاه 4.5 ميجابايت).",
+    "الاسم المعروض": "الاسم المعروض",
+    "النبذة التعريفية": "النبذة التعريفية",
+    "حساب تويتر": "حساب تويتر",
+    "حساب انستغرام": "حساب إنستغرام",
+    "إظهار العمر للعامة": "إظهار العمر علنًا",
+    "إظهار البلد للعامة": "إظهار البلد علنًا",
+    "حفظ التغييرات": "حفظ التغييرات",
+    "تم تحديث الملف الشخصي بنجاح!": "حُدِّثَ الملف بنجاح!",
+    
+    # --- components/ScoreBox.tsx ---
+    # الخلاصة is a variable title in some components, handle this one carefully
+    "الخلاصة": "الخلاصة",
+    # المحاسن too
+    "المحاسن": "المحاسن",
+    "المآخذ": "المساوئ",
+
+    # --- components/Search.tsx ---
+    "Close search": "إغلاق البحث",
+    "استنطاق الأرشيف": "استنطاق الأرشيف",
+    "خُطَّ حروفك لاستنطاق السجلات.": "خُطَّ ما في نفسِكَ تُجِبْكَ السجلات.",
+    "لا أثر في السجلات لـ": "لا أثرَ في السجلاتِ لـ",
+    
+    # --- components/SignInModal.tsx ---
+    "الولوج عبر ": "الدخول عبر ",
+    "الولوج بالبريد": "الدخول بالبريد",
+    "Sign In with Email": "الدخول بالبريد الإلكتروني",
+    "ولوج": "تسجيل الدخول",
+    "كلمة السر (8 أحرف على الأقل)": "كلمة السر (8 حروف على الأقل)",
+    "أنشئ حسابًا": "أنشئ حسابًا",
+    "لديك حساب بالفعل؟": "لديك حساب؟",
+    "جديدٌ في EternalGames؟": "جديدٌ في رحابنا؟",
+    "هل نسيت كلمة السر؟": "أنسيت كلمة السر؟",
+    "إعادة تعيين كلمة السر": "إعادة تعيين كلمة السر",
+    "أدخل بريدك لتلقي رابط إعادة التعيين.": "أدخل بريدك ليصلك رابط التعيين.",
+    "إرسال الرابط": "إرسال الرابط",
+
+    # --- components/StudioBar.tsx ---
+    "الديوان": "الديوان",
+    "Edit Page": "تعديل الصفحة",
+    
+    # --- components/UserProfile.tsx ---
+    "فتح قائمة المستخدم": "فتح قائمة المستخدم",
+    "ملفك الشخصي": "ملفك الشخصي",
+    "الإعدادات": "الإعدادات",
+    "المحفوظات": "المحفوظات",
+    "خروج": "تسجيل الخروج",
+    "ولوج": "تسجيل الدخول",
+    
+    # --- components/comments/CommentForm.tsx ---
+    "أدلِ برأيك...": "أدلِ برأيك...",
+    "أضف ردًا": "أضف ردًا",
+    "انشر التعليق": "انشر التعليق",
+
+    # --- components/comments/CommentItem.tsx ---
+    "إخفاء الردود": "إخفاء الردود",
+    "عرض ": "عرض ",
+    "ردود": "ردود",
+    "رد": "رد",
+    "جارٍ التحميل...": "جارٍ التحميل...",
+    "حُذِفَ التعليق": "طُمِسَ التعليق",
+    "حفظ": "حفظ",
+    "حذف التعليق": "حذف التعليق",
+    "هل أنت متيقن؟": "أمتأكدٌ من الحذف؟",
+
+    # --- components/comments/CommentList.tsx ---
+    "كن أول من يخط حرفًا هنا.": "كن أول من يخط حرفًا هنا.",
+    
+    # --- components/comments/SignInPrompt.tsx ---
+    "شارك في النقاش": "شارك في النقاش",
+    "لترك بصمتك في النقاش، قم بتسجيل الدخول.": "لتترك تعليقًا، سجِّل دخولك.",
+
+    # --- components/comments/TimeStamp.tsx ---
+    '"للتو"': '"للتو"',
+    '`منذ ${Math.floor(seconds)} ث`': '`منذ ${Math.floor(seconds)} ثوانٍ`',
+    '`منذ ${Math.floor(minutes)} د`': '`منذ ${Math.floor(minutes)} دقائق`',
+    '`منذ ${Math.floor(hours)} س`': '`منذ ${Math.floor(hours)} ساعات`',
+    
+    # --- components/constellation/ConstellationControlPanel.tsx ---
+    "إعدادات الكوكبة": "إعدادات الكوكبة",
+    "إعدادات الجودة": "إعدادات الجودة",
+    "كثافة المجرة": "كثافة المجرة",
+    "Bloom Intensity {isLightMode && \"(Disabled)\"}": "كثافة التوهج {isLightMode && \"(معطل)\"}",
+    "سماكة المسار": "سماكة المسار",
+    "إظهار المدارات دائمًا": "إظهار المدارات دومًا",
+    "وضع ملء الشاشة": "وضع ملء الشاشة",
+
+    # --- lib/badges.tsx ---
+    "يشرف على مشروع EternalGames.": "يشرف على مشروع EternalGames.",
+    "صوت موثوق لمراجعات الألعاب.": "صوت موثوق لمراجعات الألعاب.",
+    "يكتب المقالات والمواضيع المميزة.": "يخطُّ المقالات والمواضيع.",
+    "يغطي آخر أخبار الصناعة.": "يقتفي أثر أخبار الصناعة.",
+    "يساهم في التصميم البصري للمحتوى.": "يضفي رونقًا على المحتوى.",
+    "انضم إلى EternalGames في الشهر الأول من إطلاقه.": "التحق بركب EternalGames في شهره الأول.",
+    "نشر أول تعليق له.": "خطَّ أول تعليقٍ له.",
+    "نشر أكثر من 10 تعليقات.": "جاوزت تعليقاته العشرة.",
+    "نشر أكثر من 50 تعليقًا.": "جاوز الخمسين تعليقًا.",
+    
+    # --- lib/store.ts ---
+    "فشل حفظ العلامة المرجعية.": "فشل الحفظ.",
+    "فشل تسجيل الإعجاب.": "أخفق تسجيل الإعجاب.",
+}
+
+def process_file(file_path, replacements_dict):
+    """Reads a file, applies replacements, and writes it back if changed."""
+    try:
+        with open(file_path, 'r', encoding='utf-8') as f:
+            content = f.read()
+            
+        original_content = content
+        replacements_made = 0
+        
+        for old, new in replacements_dict.items():
+            if old in content:
+                count = content.count(old)
+                content = content.replace(old, new)
+                replacements_made += count
+        
+        if content != original_content:
+            with open(file_path, 'w', encoding='utf-8') as f:
+                f.write(content)
+            print(f"  \033[92m✓\033[0m Updated '{os.path.relpath(file_path)}' ({replacements_made} replacements)")
+            return replacements_made
+            
+    except Exception as e:
+        print(f"  \033[91m✗\033[0m Could not process file '{os.path.relpath(file_path)}': {e}")
+    
+    return 0
+
+def main():
+    """Main script logic to traverse directories and process files."""
+    extensions_to_process = ('.ts', '.tsx', '.css', '.json', '.ndjson', '.prisma')
+    dirs_to_ignore = {'.next', 'node_modules', '.git'}
+    files_to_ignore = {'package-lock.json', os.path.basename(__file__)}
+    
+    total_files_processed = 0
+    total_replacements = 0
+    
+    print("\n\033[1m\033[96m--- Starting EternalGames Batch Text Replacement ---\033[0m")
+    
+    for root, dirs, files in os.walk(PROJECT_ROOT, topdown=True):
+        # Modify dirs in-place to prevent walking into ignored directories
+        dirs[:] = [d for d in dirs if d not in dirs_to_ignore]
+        
+        for file_name in files:
+            if file_name in files_to_ignore:
+                continue
+                
+            if file_name.endswith(extensions_to_process):
+                total_files_processed += 1
+                file_path = os.path.join(root, file_name)
+                replacements_count = process_file(file_path, REPLACEMENTS)
+                if replacements_count > 0:
+                    total_replacements += replacements_count
+
+    print("\n\033[1m\033[96m--- Replacement Complete ---\033[0m")
+    print(f"  Processed: \033[93m{total_files_processed}\033[0m files.")
+    print(f"  Total replacements made: \033[93m{total_replacements}\033[0m.")
+    print("\n\033[92mOperation successful.\033[0m\n")
+
+if __name__ == "__main__":
+    if sys.version_info[0] < 3:
+        sys.exit("This script requires Python 3.")
+    main()
\ No newline at end of file
diff --git a/CombineStudioProblem.py b/CombineStudioProblem.py
new file mode 100644
index 0000000..1218af6
--- /dev/null
+++ b/CombineStudioProblem.py
@@ -0,0 +1,49 @@
+import os
+
+# List of files to include in the output
+files_to_collect = [
+    # Directly Related Files
+    "lib/sanity.client.ts",
+    "lib/sanity.server.ts",
+    "app/studio/page.tsx",
+    "app/studio/[contentType]/[id]/page.tsx",
+    "next.config.ts",
+    ".env",
+    # General Project Context
+    "package.json",
+    "tsconfig.json",
+    "app/layout.tsx",
+    "app/lib/authOptions.ts",
+    "prisma/schema.prisma",
+    "sanity/sanity.config.ts",
+]
+
+output_filename = "EternalGames_Full_Context.txt"
+
+def collect_files(file_list, output_file):
+    """Reads content from a list of files and writes it to a single output file."""
+    print(f"Starting code collection into '{output_file}'...")
+    
+    with open(output_file, 'w', encoding='utf-8') as outfile:
+        for filepath in file_list:
+            print(f"  -> Processing: {filepath}")
+            outfile.write(f"--- START OF FILE {filepath} ---\n\n")
+            try:
+                with open(filepath, 'r', encoding='utf-8') as infile:
+                    content = infile.read()
+                    outfile.write(content)
+            except FileNotFoundError:
+                print(f"  [WARNING] File not found: {filepath}. Skipping.")
+                outfile.write("!!! FILE NOT FOUND AT THIS PATH !!!\n")
+            except Exception as e:
+                print(f"  [ERROR] Could not read file {filepath}: {e}")
+                outfile.write(f"!!! ERROR READING FILE: {e} !!!\n")
+            
+            outfile.write("\n\n--- END OF FILE {filepath} ---\n\n")
+            outfile.write("=" * 80 + "\n\n")
+    
+    print("\nCollection complete.")
+    print(f"All specified file contents have been written to '{output_file}'.")
+
+if __name__ == "__main__":
+    collect_files(files_to_collect, output_filename)
\ No newline at end of file
diff --git a/EternalGames_Full_Context.txt b/EternalGames_Full_Context.txt
new file mode 100644
index 0000000..02833bc
--- /dev/null
+++ b/EternalGames_Full_Context.txt
@@ -0,0 +1,793 @@
+--- START OF FILE lib/sanity.client.ts ---
+
+// lib/sanity.client.ts
+
+import { createClient } from '@sanity/client'
+
+export const projectId = process.env.NEXT_PUBLIC_SANITY_PROJECT_ID
+export const dataset = process.env.NEXT_PUBLIC_SANITY_DATASET
+export const apiVersion = process.env.NEXT_PUBLIC_SANITY_API_VERSION
+
+export const client = createClient({
+    projectId,
+    dataset,
+    apiVersion,
+    useCdn: false,
+    // THE DEFINITIVE FIX: The public, client-side client should NOT use a secret token.
+    // Server-side fetching will use the authenticated `sanityWriteClient`.
+    // token: process.env.SANITY_API_READ_TOKEN, // <-- THIS LINE IS REMOVED
+})
+
+--- END OF FILE {filepath} ---
+
+================================================================================
+
+--- START OF FILE lib/sanity.server.ts ---
+
+import { createClient } from '@sanity/client'
+
+const projectId = '0zany1dm'
+const dataset = 'production'
+const apiVersion = '2025-09-30'
+
+export const sanityWriteClient = createClient({
+    projectId,
+    dataset,
+    apiVersion,
+    useCdn: false,
+    token: process.env.SANITY_API_WRITE_TOKEN,
+});
+
+--- END OF FILE {filepath} ---
+
+================================================================================
+
+--- START OF FILE app/studio/page.tsx ---
+
+// app/studio/page.tsx
+
+import { createClient } from 'next-sanity';
+import { groq } from 'next-sanity';
+import { StudioDashboard } from './StudioDashboard';
+import { projectId, dataset, apiVersion } from '@/lib/sanity.client';
+import { unstable_noStore as noStore } from 'next/cache';
+import { getServerSession } from 'next-auth/next';
+import { authOptions } from '@/app/lib/authOptions';
+import { redirect } from 'next/navigation';
+
+// THE DEFINITIVE FIX: Force this page to use the Node.js runtime on Vercel.
+export const runtime = 'nodejs';
+
+const studioClient = createClient({
+    projectId,
+    dataset,
+    apiVersion,
+    useCdn: false,
+    token: process.env.SANITY_API_WRITE_TOKEN,
+});
+
+const allEditableContentQuery = groq`
+*[_type in $allowedTypes] | order(_updatedAt desc) {
+    _id,
+    _type,
+    _updatedAt,
+    title,
+    "slug": slug.current,
+    "status": select(
+        _type == "gameRelease" => "published",
+        defined(publishedAt) && publishedAt < now() => "published",
+        !defined(publishedAt) => "draft",
+        "scheduled"
+    ),
+    "mainImage": mainImage,
+    "blurDataURL": mainImage.asset->metadata.lqip
+}
+`;
+
+export default async function StudioPage() {
+    noStore();
+    
+    const session = await getServerSession(authOptions);
+    const userRoles = (session?.user as any)?.roles || [];
+    
+    const isAdminOrDirector = userRoles.includes('ADMIN') || userRoles.includes('DIRECTOR');
+    const allowedContentTypes: string[] = [];
+
+    if (isAdminOrDirector) {
+        allowedContentTypes.push('review', 'article', 'news', 'gameRelease');
+    } else {
+        if (userRoles.includes('REVIEWER')) allowedContentTypes.push('review');
+        if (userRoles.includes('AUTHOR')) allowedContentTypes.push('article');
+        if (userRoles.includes('REPORTER')) allowedContentTypes.push('news');
+    }
+    
+    if (allowedContentTypes.length === 0 && !userRoles.includes('DESIGNER')) {
+        redirect('/'); 
+    }
+
+    const content = allowedContentTypes.length > 0
+        ? await studioClient.fetch(allEditableContentQuery, { allowedTypes: allowedContentTypes })
+        : [];
+
+    return (
+        <div className="container page-container">
+            <StudioDashboard initialContent={content} userRoles={userRoles} />
+        </div>
+    );
+}
+
+--- END OF FILE {filepath} ---
+
+================================================================================
+
+--- START OF FILE app/studio/[contentType]/[id]/page.tsx ---
+
+// app/studio/[contentType]/[id]/page.tsx
+
+import { sanityWriteClient } from '@/lib/sanity.server';
+import { editorDocumentQuery, allGamesForStudioQuery, allTagsForStudioQuery, allCreatorsForStudioQuery } from '@/lib/sanity.queries';
+import { EditorClient } from "./EditorClient";
+import { portableTextToTiptap } from '../../utils/portableTextToTiptap';
+import { notFound } from 'next/navigation';
+
+// THE DEFINITIVE FIX: Force this page to use the Node.js runtime on Vercel.
+export const runtime = 'nodejs';
+
+// This is now a Server Component
+export default async function EditorPage({ params }: { params: { contentType: string; id: string } }) {
+    const { id } = params;
+
+    try {
+        const [document, allGames, allTags, allCreators] = await Promise.all([
+            sanityWriteClient.fetch(editorDocumentQuery, { id }),
+            sanityWriteClient.fetch(allGamesForStudioQuery),
+            sanityWriteClient.fetch(allTagsForStudioQuery),
+            sanityWriteClient.fetch(allCreatorsForStudioQuery)
+        ]);
+
+        if (!document) {
+            // Use notFound() for a proper 404 page in Next.js App Router
+            notFound();
+        }
+        
+        const tiptapContent = portableTextToTiptap(document.content ?? []);
+        const documentWithTiptapContent = { ...document, tiptapContent };
+        
+        return (
+            <EditorClient 
+                document={documentWithTiptapContent} 
+                allGames={allGames}
+                allTags={allTags}
+                allCreators={allCreators}
+            />
+        );
+
+    } catch (err: any) {
+        console.error("Failed to load editor data:", err);
+        // Render an error state if fetching fails
+        return (
+            <div className="container page-container" style={{ textAlign: 'center' }}>
+                <h1 className="page-title">Error Loading Editor</h1>
+                <p style={{color: 'var(--text-secondary)'}}>Failed to load editor data. Please check the console for details.</p>
+            </div>
+        );
+    }
+}
+
+--- END OF FILE {filepath} ---
+
+================================================================================
+
+--- START OF FILE next.config.ts ---
+
+// next.config.ts
+
+/** @type {import('next').NextConfig} */
+const nextConfig = {
+    reactStrictMode: true,
+
+    env: {
+        NEXT_PUBLIC_SANITY_PROJECT_ID: '0zany1dm',
+        NEXT_PUBLIC_SANITY_DATASET: 'production',
+        NEXT_PUBLIC_SANITY_API_VERSION: '2025-09-30',
+    },
+    images: {
+        remotePatterns: [
+            // Sanity CMS
+            {
+                protocol: 'https',
+                hostname: 'cdn.sanity.io',
+            },
+            // Vercel Blob Storage (for user avatars) - WILDCARD ADDED
+            {
+                protocol: 'https',
+                hostname: '*.public.blob.vercel-storage.com',
+            },
+            // Google OAuth Avatars
+            {
+                protocol: 'https',
+                hostname: 'lh3.googleusercontent.com',
+            },
+            // GitHub OAuth Avatars
+            {
+                protocol: 'https',
+                hostname: 'avatars.githubusercontent.com',
+            },
+        ],
+    },
+    experimental: {
+        serverActions: {
+            bodySizeLimit: '10mb',
+        },
+    },
+};
+
+export default nextConfig;
+
+
+
+
+--- END OF FILE {filepath} ---
+
+================================================================================
+
+--- START OF FILE .env ---
+
+# .env (COMBINED AND CLEANED)
+
+# --- Primary Application Secrets ---
+NEXTAUTH_SECRET=newS3cl7686ZQEQZWop8o7kQ2oiuAmWiA1OV/hDaQp6Xg=
+NEXTAUTH_URL=http://localhost:3000
+
+# --- Database (Used by Prisma and Runtime) ---
+# RUNTIME POOLED CONNECTION for Serverless functions
+DATABASE_URL="postgresql://neondb_owner:npg_bgnZWvKH07Xa@ep-still-resonance-adesxhfv-pooler.c-2.us-east-1.aws.neon.tech/neondb?sslmode=require&pgbouncer=true&pool_timeout=60"
+
+# BUILD-TIME DIRECT CONNECTION for long-lived build processes
+BUILD_DATABASE_URL="postgresql://neondb_owner:npg_bgnZWvKH07Xa@ep-still-resonance-adesxhfv.c-2.us-east-1.aws.neon.tech/neondb?sslmode=require"
+
+# --- Vercel Blob ---
+BLOB_READ_WRITE_TOKEN="vercel_blob_rw_0dG10aVH15DAsZWd_NvTqPADY3zK83uptFEkaUZCEY0lC8P"
+
+# --- Sanity Tokens ---
+# SERVER-SIDE WRITE TOKEN (Used for creating drafts, etc.)
+SANITY_API_WRITE_TOKEN="skHSNGizuApQH6cHqPX9Mp12df1fHQOxubYPnpoAiPbwv2BwES2TUb2hJHmmXtJCmGkdVaqjS55DYct7AIQxQYBFIDT3dMEvrCCjOY2wjGVoS8MCeevuy8whHnPwVfD2dzi7JVAXqrAngC1s6WCHkH16iXPBFFOwOIW3YcnuSICQTVVk2gE6"
+
+# SERVER-SIDE READ TOKEN (Used for fetching data in server components)
+SANITY_API_READ_TOKEN="skWyr0w9l0GX2Cm2Zpmu9lApLQFcMxxnJtH8cpIyiWYurpe7FbNQncMSwQxifl2CPjrZKD24UNX1ssTdAvKNQIKD4JXzVH1Ja3AWuepTEtTRwBeOL64AyCG0xcF1UEtW25HInglUx9r8uhJ2HUFxatMJytU4RTdsy84Np8gHsNxDDgJsAhE0"
+
+# --- Revalidation Secret ---
+REVALIDATION_SECRET_TOKEN="f9a8b7c6d5e4f3a2b1c0d9e8f7a6b5c4d3e2f1a0b9c8d7e6f5a4b3c2d1e0f9a8"
+
+# --- OAuth Keys ---
+AUTH_GITHUB_ID=Ov23liESurJ80uqMFTV0
+AUTH_GITHUB_SECRET=e2a8a1fcf50a9f8f2e703858a1a84a7db185e035
+GOOGLE_CLIENT_ID=239586132598-orantodqlrirebbhpi5f3dvcu12bampv.apps.googleusercontent.com
+GOOGLE_CLIENT_SECRET=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
+TWITTER_CLIENT_ID=X3dFNFptdlYzZDJwTVc4TWI1NE06MTpjaQ
+TWITTER_CLIENT_SECRET=GzXf4VvOHb7N02qvPZ7SwSLQbujQtu9PtRQHZOUBh2x7mVHHNc
+
+# --- Giscus (Public, but kept here for completeness) ---
+NEXT_PUBLIC_GISCUS_REPO=1-eyx/eternalgames-comments
+NEXT_PUBLIC_GISCUS_REPO_ID=R_kgDOPt_3hA
+NEXT_PUBLIC_GISCUS_CATEGORY=Article Comments
+NEXT_PUBLIC_GISCUS_CATEGORY_ID=DIC_kwDOPt_3hM4CvTrq
+
+--- END OF FILE {filepath} ---
+
+================================================================================
+
+--- START OF FILE package.json ---
+
+{
+  "name": "eternalgames-next",
+  "version": "0.1.0",
+  "private": true,
+  "scripts": {
+    "dev": "next dev --turbopack",
+    "build": "cross-env IS_BUILDING=true next build",
+    "start": "next start",
+    "lint": "eslint",
+    "prisma:seed": "npx ts-node -r dotenv/config prisma/seed.ts",
+    "type-check": "tsc --noEmit",
+    "type-watch": "tsc --noEmit --watch"
+  },
+  "dependencies": {
+    "@next-auth/prisma-adapter": "^1.0.7",
+    "@portabletext/react": "^4.0.3",
+    "@prisma/client": "^6.16.1",
+    "@react-three/drei": "^10.7.6",
+    "@react-three/fiber": "^9.3.0",
+    "@react-three/postprocessing": "^3.0.4",
+    "@sanity/client": "^7.12.0",
+    "@sanity/icons": "^3.7.4",
+    "@sanity/image-url": "^1.2.0",
+    "@sanity/vision": "^4.10.1",
+    "@tiptap/extension-image": "^2.5.5",
+    "@tiptap/extension-link": "^2.5.5",
+    "@tiptap/extension-placeholder": "^2.5.5",
+    "@tiptap/react": "^2.5.5",
+    "@tiptap/starter-kit": "^2.5.5",
+    "@types/bcryptjs": "^2.4.6",
+    "@vercel/blob": "^2.0.0",
+    "bcryptjs": "^3.0.2",
+    "dotenv": "^17.2.2",
+    "framer-motion": "^12.23.12",
+    "next": "16.0.1",
+    "next-auth": "^4.24.11",
+    "next-sanity": "^11.4.2",
+    "next-themes": "^0.4.6",
+    "react": "19.1.0",
+    "react-compare-slider": "^3.1.0",
+    "react-dom": "19.1.0",
+    "react-image-crop": "^11.0.10",
+    "sanity": "^4.10.1",
+    "styled-components": "^6.1.19",
+    "three": "^0.180.0",
+    "transliteration": "^2.3.5",
+    "uuid": "^9.0.1",
+    "zustand": "^5.0.8"
+  },
+  "devDependencies": {
+    "@eslint/eslintrc": "^3",
+    "@fullhuman/postcss-purgecss": "^7.0.2",
+    "@sanity/types": "^4.10.1",
+    "@types/node": "^20",
+    "@types/react": "^19",
+    "@types/react-dom": "^19",
+    "@types/three": "^0.180.0",
+    "@types/uuid": "^9.0.8",
+    "cross-env": "^10.1.0",
+    "eslint": "^9",
+    "eslint-config-next": "16.0.1",
+    "postcss": "^8.5.6",
+    "postcss-cli": "^11.0.1",
+    "prisma": "^6.16.1",
+    "ts-node": "^10.9.2",
+    "tsx": "^4.20.6",
+    "typescript": "^5"
+  }
+}
+
+
+
+
+--- END OF FILE {filepath} ---
+
+================================================================================
+
+--- START OF FILE tsconfig.json ---
+
+{
+  "compilerOptions": {
+    "lib": [
+      "dom",
+      "dom.iterable",
+      "esnext"
+    ],
+    "allowJs": true,
+    "skipLibCheck": true,
+    "strict": true,
+    "noEmit": true,
+    "esModuleInterop": true,
+    "module": "esnext",
+    "moduleResolution": "bundler",
+    "resolveJsonModule": true,
+    "isolatedModules": true,
+    "jsx": "react-jsx",
+    "incremental": true,
+    "plugins": [
+      {
+        "name": "next"
+      }
+    ],
+    "baseUrl": ".",
+    "paths": {
+      "@/*": [
+        "./*"
+      ]
+    },
+    "target": "ES2017"
+  },
+  "include": [
+    "next-env.d.ts",
+    "**/*.ts",
+    "**/*.tsx",
+    ".next/types/**/*.ts",
+    ".next/dev/types/**/*.ts"
+  ],
+  "exclude": [
+    "node_modules",
+    "sanity"
+  ]
+}
+
+
+
+
+
+--- END OF FILE {filepath} ---
+
+================================================================================
+
+--- START OF FILE app/layout.tsx ---
+
+// app/layout.tsx
+import { Cairo } from 'next/font/google';
+import './globals.css';
+import Navbar from '@/components/Navbar';
+import Footer from '@/components/Footer';
+import { ThemeProvider } from '@/components/ThemeProvider';
+import NextAuthProvider from '@/components/SessionProvider';
+import StudioBar from '@/components/StudioBar';
+import ToastProvider from '@/components/ToastProvider';
+import UserStoreHydration from '@/components/UserStoreHydration';
+import Lightbox from '@/components/Lightbox';
+import ScrollToTopButton from '@/components/ui/ScrollToTopButton';
+
+const cairo = Cairo({
+subsets: ['arabic', 'latin'],
+display: 'swap',
+variable: '--font-main',
+weight: ['400', '500', '700', '800'],
+});
+
+export const metadata = { title: 'EternalGames | الألعاب أبدية', description: 'الألعاب أبدية.', };
+
+export default function RootLayout({ children }: { children: React.ReactNode; }) {
+return (
+<html lang="ar" dir="rtl" className={cairo.variable} suppressHydrationWarning>
+<head>
+<link rel="preconnect" href="https://fonts.googleapis.com" />
+<link
+    rel="preconnect"
+    href="https://fonts.gstatic.com"
+    crossOrigin="anonymous"
+/>
+<link
+    rel="preconnect"
+    href="https://cdn.sanity.io"
+    crossOrigin="anonymous"
+/>
+</head>
+<body>
+<NextAuthProvider>
+<UserStoreHydration />
+<ThemeProvider attribute="data-theme" defaultTheme="system" enableSystem disableTransitionOnChange>
+<div style={{ position: 'relative', width: '100%', overflowX: 'clip' }}>
+    <ToastProvider />
+    <Lightbox /> 
+    <Navbar />
+    <main>{children}</main>
+    <Footer />
+    <StudioBar />
+    <ScrollToTopButton />
+</div>
+</ThemeProvider>
+</NextAuthProvider>
+</body>
+</html>
+);
+}
+
+--- END OF FILE {filepath} ---
+
+================================================================================
+
+--- START OF FILE app/lib/authOptions.ts ---
+
+// app/lib/authOptions.ts
+
+import { PrismaAdapter } from "@next-auth/prisma-adapter";
+import prisma from "@/lib/prisma";
+import bcrypt from "bcryptjs";
+import GithubProvider from "next-auth/providers/github";
+import GoogleProvider from "next-auth/providers/google";
+import TwitterProvider from "next-auth/providers/twitter";
+import CredentialsProvider from "next-auth/providers/credentials";
+
+export const authOptions = {
+    adapter: PrismaAdapter(prisma),
+    providers: [
+        CredentialsProvider({
+            id: 'credentials',
+            name: "Credentials",
+            credentials: {
+                email: { label: "البريد الإلكتروني", type: "email" },
+                password: { label: "كلمة السر", type: "password" },
+                returnTo: { label: "Return To", type: "text" },
+            },
+            async authorize(credentials) {
+                if (!credentials?.email || !credentials?.password) throw new Error("البيانات ناقصة.");
+                const user = await prisma.user.findUnique({ where: { email: credentials.email } });
+                if (!user) throw new Error("لا حساب بهذا البريد. تفضل بالتسجيل.");
+                if (!user.password) throw new Error("هذا الحساب مرتبط بمزود خارجي.");
+                const isPasswordValid = await bcrypt.compare(credentials.password, user.password);
+                if (isPasswordValid) return user;
+                else throw new Error("كلمة السر غير صحيحة.");
+            }
+        }),
+        CredentialsProvider({
+            id: 'signup',
+            name: "SignUp",
+            credentials: {
+                email: { label: "البريد الإلكتروني", type: "email" },
+                password: { label: "كلمة السر", type: "password" },
+                returnTo: { label: "Return To", type: "text" },
+            },
+            async authorize(credentials) {
+                if (!credentials) throw new Error("Missing sign-up details.");
+                const { email, password } = credentials;
+                if (!email || !password) throw new Error("كافة الحقول إلزامية.");
+                if (!/\S+@\S+\.\S+/.test(email)) throw new Error('البريد الإلكتروني غير صالح.');
+                if (password.length < 8) throw new Error('يجب ألا تقل كلمة السر عن ثمانية أحرف.');
+                
+                const existingEmail = await prisma.user.findUnique({ where: { email } });
+                if (existingEmail) throw new Error('هذا البريد مسجل بالفعل.');
+
+                const hashedPassword = await bcrypt.hash(credentials.password, 10);
+                const newUser = await prisma.user.create({
+                    data: {
+                        email: credentials.email,
+                        password: hashedPassword,
+                    }
+                });
+                return newUser;
+            }
+        }),
+        GithubProvider({ 
+            clientId: process.env.AUTH_GITHUB_ID as string, 
+            clientSecret: process.env.AUTH_GITHUB_SECRET as string, 
+        }),
+        GoogleProvider({ 
+            clientId: process.env.GOOGLE_CLIENT_ID as string, 
+            clientSecret: process.env.GOOGLE_CLIENT_SECRET as string, 
+        }),
+        TwitterProvider({ 
+            clientId: process.env.TWITTER_CLIENT_ID as string, 
+            clientSecret: process.env.TWITTER_CLIENT_SECRET as string, 
+            version: "2.0", 
+        }),
+    ],
+    events: {
+        createUser: async ({ user }: any) => {
+            const userRole = await prisma.role.findUnique({ where: { name: 'USER' } });
+            if (userRole) {
+                await prisma.user.update({ 
+                    where: { id: user.id }, 
+                    data: { roles: { connect: { id: userRole.id } } } 
+                });
+            }
+        }
+    },
+    session: { strategy: "jwt" as const },
+    secret: process.env.NEXTAUTH_SECRET,
+    callbacks: {
+        async signIn({ user }: any) {
+            return true;
+        },
+        async jwt({ token, user, trigger }: any) {
+            if (user || trigger === "update") {
+                const dbUser = await prisma.user.findUnique({
+                    where: { id: (token.id as string) || user?.id },
+                    include: { roles: true }
+                });
+
+                if (dbUser) {
+                    token.id = dbUser.id;
+                    token.picture = dbUser.image;
+                    token.name = dbUser.name;
+                    token.roles = dbUser.roles.map(role => role.name);
+                    token.username = dbUser.username;
+                    token.needsOnboarding = !dbUser.name || !dbUser.username;
+                }
+            }
+            return token;
+        },
+        async session({ session, token }: any) {
+            if (token && session.user) {
+                session.user.id = token.id;
+                session.user.roles = token.roles;
+                session.user.name = token.name;
+                session.user.email = token.email;
+                session.user.image = token.picture;
+                session.user.username = token.username;
+                session.needsOnboarding = token.needsOnboarding;
+            }
+            return session;
+        },
+    },
+    pages: { signIn: '/', error: '/', },
+};
+
+
+
+
+--- END OF FILE {filepath} ---
+
+================================================================================
+
+--- START OF FILE prisma/schema.prisma ---
+
+// prisma/schema.prisma
+
+generator client {
+  provider = "prisma-client-js"
+}
+
+datasource db {
+  provider = "postgresql"
+  url      = env("DATABASE_URL")
+}
+
+model Role {
+  id    Int    @id @default(autoincrement())
+  name  String @unique
+  users User[] @relation("RoleToUser")
+}
+
+model Account {
+  id                String  @id @default(cuid())
+  userId            String
+  type              String
+  provider          String
+  providerAccountId String
+  refresh_token     String?
+  access_token      String?
+  expires_at        Int?
+  token_type        String?
+  scope             String?
+  id_token          String?
+  session_state     String?
+  user              User    @relation(fields: [userId], references: [id], onDelete: Cascade)
+
+  @@unique([provider, providerAccountId])
+}
+
+model Session {
+  id           String   @id @default(cuid())
+  sessionToken String   @unique
+  userId       String
+  expires      DateTime
+  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
+}
+
+model User {
+  id                  String               @id @default(cuid())
+  name                String?
+  username            String?              @unique
+  email               String?              @unique
+  emailVerified       DateTime?
+  image               String?
+  password            String?
+  createdAt           DateTime             @default(now())
+  bio                 String?
+  twitterHandle       String?
+  age                 Int?
+  country             String?
+  agePublic           Boolean              @default(true)
+  countryPublic       Boolean              @default(true)
+  instagramHandle     String?
+  accounts            Account[]
+  engagements         Engagement[]
+  comments            Comment[]
+  commentVotes        CommentVote[]
+  passwordResetTokens PasswordResetToken[]
+  sessions            Session[]
+  shares              Share[]
+  roles               Role[]               @relation("RoleToUser")
+}
+
+model VerificationToken {
+  identifier String
+  token      String   @unique
+  expires    DateTime
+
+  @@unique([identifier, token])
+}
+
+model PasswordResetToken {
+  id      String   @id @default(cuid())
+  token   String   @unique
+  expires DateTime
+  userId  String
+  user    User     @relation(fields: [userId], references: [id], onDelete: Cascade)
+}
+
+model Engagement {
+  id          String         @id @default(cuid())
+  createdAt   DateTime       @default(now())
+  type        EngagementType
+  userId      String
+  contentId   Int
+  contentType String
+  user        User           @relation(fields: [userId], references: [id], onDelete: Cascade)
+
+  @@unique([userId, contentId, contentType, type])
+}
+
+model Share {
+  id          String   @id @default(cuid())
+  createdAt   DateTime @default(now())
+  userId      String
+  contentId   Int
+  contentType String
+  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
+}
+
+model Comment {
+  id          String        @id @default(cuid())
+  createdAt   DateTime      @default(now())
+  updatedAt   DateTime      @updatedAt
+  content     String
+  contentSlug String
+  isDeleted   Boolean       @default(false)
+  authorId    String
+  parentId    String?
+  author      User          @relation(fields: [authorId], references: [id], onDelete: Cascade)
+  parent      Comment?      @relation("CommentReplies", fields: [parentId], references: [id], onDelete: NoAction, onUpdate: NoAction)
+  replies     Comment[]     @relation("CommentReplies")
+  votes       CommentVote[]
+}
+
+model CommentVote {
+  id        String   @id @default(cuid())
+  createdAt DateTime @default(now())
+  type      VoteType
+  userId    String
+  commentId String
+  comment   Comment  @relation(fields: [commentId], references: [id], onDelete: Cascade)
+  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
+
+  @@unique([userId, commentId])
+}
+
+enum VoteType {
+  LIKE
+  DISLIKE
+}
+
+enum EngagementType {
+  LIKE
+  BOOKMARK
+}
+
+
+
+
+
+
+
+--- END OF FILE {filepath} ---
+
+================================================================================
+
+--- START OF FILE sanity/sanity.config.ts ---
+
+import {defineConfig} from 'sanity'
+import {structureTool} from 'sanity/structure'
+import {visionTool} from '@sanity/vision'
+import {schemaTypes} from './schemaTypes'
+
+const projectId = '0zany1dm'
+const dataset = 'production'
+// THE FIX: Aligned the API version to match the rest of the application.
+const apiVersion = '2025-09-30'
+
+export default defineConfig({
+  basePath: '/studio',
+  projectId,
+  dataset,
+  schema: {
+    types: schemaTypes,
+  },
+  plugins: [
+    structureTool(),
+    visionTool({defaultApiVersion: apiVersion}),
+  ],
+})
+
+--- END OF FILE {filepath} ---
+
+================================================================================
+
diff --git a/HowManyLines.py b/HowManyLines.py
new file mode 100644
index 0000000..3585f0c
--- /dev/null
+++ b/HowManyLines.py
@@ -0,0 +1,172 @@
+import re
+from collections import defaultdict
+import os
+
+def parse_input_file(file_path):
+    """
+    Parses the large concatenated text file into a dictionary of {filename: content}.
+    """
+    files = {}
+    try:
+        with open(file_path, 'r', encoding='utf-8') as f:
+            content = f.read()
+        
+        # Regex to find all file blocks
+        pattern = r"--- START OF FILE (.+?) ---\n(.*?)\n--- END OF FILE .+? ---"
+        matches = re.findall(pattern, content, re.DOTALL)
+        
+        for filename, file_content in matches:
+            files[filename.strip()] = file_content
+    except FileNotFoundError:
+        print(f"Error: The file '{file_path}' was not found.")
+        return None
+    return files
+
+def get_language_category(filename):
+    """
+    Categorizes a file based on its extension.
+    """
+    ext = os.path.splitext(filename)[1].lower()
+    if ext in ['.ts', '.tsx']:
+        return "TypeScript/TSX"
+    elif ext == '.css':
+        return "CSS"
+    elif ext == '.json':
+        return "JSON"
+    elif ext == '.sql':
+        return "SQL"
+    elif ext in ['.env', '.toml', '.prisma']:
+        return "Configuration"
+    else:
+        return "Other"
+
+def analyze_file_content(content, category):
+    """
+    Analyzes the content of a single file for various metrics.
+    """
+    lines = content.splitlines()
+    total_lines = len(lines)
+    words = content.split()
+    total_words = len(words)
+    total_chars = len(content)
+    
+    comment_lines = 0
+    code_lines = 0
+    blank_lines = 0
+    inline_comment_lines = 0
+    
+    is_in_multiline_comment = False
+    
+    single_line_markers = []
+    if category in ["TypeScript/TSX", "CSS"]:
+        single_line_markers.append('//')
+    if category in ["Configuration", "SQL"]:
+        single_line_markers.append('#')
+
+    for line in lines:
+        stripped_line = line.strip()
+
+        if not stripped_line:
+            blank_lines += 1
+            continue
+
+        # Handle multi-line comments for TS/TSX/CSS
+        if category in ["TypeScript/TSX", "CSS"]:
+            if '/*' in stripped_line:
+                is_in_multiline_comment = True
+            
+            if is_in_multiline_comment:
+                comment_lines += 1
+                if '*/' in stripped_line:
+                    is_in_multiline_comment = False
+                continue
+
+        # Handle single-line comments
+        is_full_comment = False
+        for marker in single_line_markers:
+            if stripped_line.startswith(marker):
+                comment_lines += 1
+                is_full_comment = True
+                break
+        if is_full_comment:
+            continue
+            
+        # If it's not a blank line or a full comment line, it contains code.
+        code_lines += 1
+        
+        # Check for inline comments
+        for marker in single_line_markers:
+            if marker in stripped_line:
+                inline_comment_lines += 1
+                break
+                
+    return {
+        'total_lines': total_lines,
+        'code_lines': code_lines,
+        'comment_lines': comment_lines,
+        'blank_lines': blank_lines,
+        'inline_comment_lines': inline_comment_lines,
+        'total_words': total_words,
+        'total_chars': total_chars
+    }
+
+def print_summary(title, stats):
+    """
+    Prints a formatted summary of the analysis stats.
+    """
+    print("-" * 60)
+    print(f"{title.center(60)}")
+    print("-" * 60)
+
+    total_lines = stats['total_lines']
+    code_lines = stats['code_lines']
+    comment_lines = stats['comment_lines']
+    blank_lines = stats['blank_lines']
+    
+    # The most important question: lines with and without comments
+    lines_with_some_comment = comment_lines + stats['inline_comment_lines']
+    lines_without_any_comment = total_lines - lines_with_some_comment - blank_lines
+    
+    code_ratio = (code_lines / total_lines * 100) if total_lines > 0 else 0
+    comment_ratio = (comment_lines / total_lines * 100) if total_lines > 0 else 0
+    blank_ratio = (blank_lines / total_lines * 100) if total_lines > 0 else 0
+
+    print(f"Files Count             : {stats.get('file_count', 'N/A'):<10}")
+    print(f"Total Characters        : {stats['total_chars']:,}")
+    print(f"Total Words             : {stats['total_words']:,}")
+    print("\n--- Line Analysis ---")
+    print(f"Total Lines             : {total_lines:,}")
+    print(f"  - Lines of Code       : {code_lines:,} ({code_ratio:.1f}%)")
+    print(f"  - Comment-Only Lines  : {comment_lines:,} ({comment_ratio:.1f}%)")
+    print(f"  - Blank Lines         : {blank_lines:,} ({blank_ratio:.1f}%)")
+    
+    print("\n--- Answering the Main Question ---")
+    print(f"Lines WITH comments     : {lines_with_some_comment:,} (Comment-only + Inline)")
+    print(f"Lines WITHOUT comments  : {lines_without_any_comment:,} (Pure code lines)")
+    
+    print("-" * 60 + "\n")
+
+
+if __name__ == "__main__":
+    input_filename = "EternalGamesWebsite_Full149.txt"
+    all_files = parse_input_file(input_filename)
+
+    if all_files:
+        overall_stats = defaultdict(int)
+        category_stats = defaultdict(lambda: defaultdict(int))
+
+        overall_stats['file_count'] = len(all_files)
+
+        for filename, content in all_files.items():
+            category = get_language_category(filename)
+            stats = analyze_file_content(content, category)
+
+            category_stats[category]['file_count'] += 1
+            for key, value in stats.items():
+                overall_stats[key] += value
+                category_stats[category][key] += value
+        
+        print_summary("Overall Project Analysis", overall_stats)
+
+        for category, stats in sorted(category_stats.items()):
+            print_summary(f"Category: {category}", stats)
\ No newline at end of file
diff --git a/app/(content)/[...slug]/page.tsx b/app/(content)/[...slug]/page.tsx
index d2cd479..f2dc665 100644
--- a/app/(content)/[...slug]/page.tsx
+++ b/app/(content)/[...slug]/page.tsx
@@ -11,8 +11,7 @@ import prisma from '@/lib/prisma';
 import CommentSection from '@/components/comments/CommentSection';
 import ContentPageClient from '@/components/content/ContentPageClient';
 import { Suspense } from 'react';
-
-export const revalidate = 60;
+import { cache } from 'react'; // Import React's cache
 
 const contentConfig = {
     reviews: {
@@ -38,7 +37,16 @@ const contentConfig = {
     },
 };
 
-// CACHED: This function memoizes the database call for a specific user ID for 1 hour.
+const getCachedSanityData = unstable_cache(
+    async (query: string, params: Record<string, any> = {}) => {
+        return client.fetch(query, params);
+    },
+    ['sanity-content-detail'],
+    {
+        tags: ['sanity-content']
+    }
+);
+
 const getCachedCreatorDetails = unstable_cache(
     async (prismaUserId: string) => {
         try {
@@ -60,20 +68,12 @@ const getCachedCreatorDetails = unstable_cache(
     { revalidate: 3600 }
 );
 
-
-// MODIFIED: This function now uses the cached helper.
 async function enrichCreator(creator: any) {
     if (!creator || !creator.prismaUserId) return creator;
-    
     const userDetails = await getCachedCreatorDetails(creator.prismaUserId);
-
-    return {
-        ...creator,
-        ...userDetails,
-    };
+    return { ...creator, ...userDetails };
 }
 
-
 export async function generateStaticParams() {
     try {
         const allContent = await client.fetch<any[]>(`*[_type in ["review", "article", "news"]]{ "slug": slug.current, _type }`);
@@ -82,45 +82,28 @@ export async function generateStaticParams() {
             return { slug: [type, c.slug] };
         });
     } catch (error) {
-        console.warn(`[BUILD WARNING] Failed to fetch slugs for generateStaticParams. This may be due to a network or API issue. Skipping static generation for content pages. Error:`, error);
-        return [];
+        console.error(`[BUILD ERROR] CRITICAL: Failed to fetch slugs for generateStaticParams. The build process cannot continue without a connection to the CMS.`, error);
+        throw error;
     }
 }
 
-async function Comments({ slug }: { slug: string }) {
-    try {
-        const comments = await prisma.comment.findMany({
-            where: { contentSlug: slug, parentId: null },
-            include: { author: { select: { id: true, name: true, image: true, username: true } }, votes: true, _count: { select: { replies: true } }, replies: { take: 2, include: { author: { select: { id: true, name: true, image: true, username: true } }, votes: true, _count: { select: { replies: true } } }, orderBy: { createdAt: 'asc' } } },
-            orderBy: { createdAt: 'desc' },
-        });
-        return <CommentSection slug={slug} initialComments={comments} />;
-    } catch (error) {
-        console.warn(`[BUILD WARNING] Database connection failed while pre-rendering comments for slug "${slug}". Skipping.`, (error as any)?.digest || error);
-        return <CommentSection slug={slug} initialComments={[]} />;
-    }
-}
+// REMOVED: The server-side getCachedComments function is no longer needed here.
+
+// REMOVED: The async Comments component is no longer needed here.
 
 export default async function ContentPage({ params }: { params: { slug: string[] } }) {
     const { slug: slugArray } = await params;
+    if (!slugArray || slugArray.length !== 2) notFound();
     
-    if (!slugArray || slugArray.length !== 2) {
-        notFound();
-    }
     const [type, slug] = slugArray;
     const config = (contentConfig as any)[type];
+    if (!config) notFound();
 
-    if (!config) {
-        notFound();
-    }
-
-    let item: any = await client.fetch(config.query, { slug });
-    if (!item) {
-        notFound();
-    }
+    let item: any = await getCachedSanityData(config.query, { slug });
+    if (!item) notFound();
 
     if (!item[config.relatedProp] || item[config.relatedProp].length === 0) {
-        const fallbackContent = await client.fetch(config.fallbackQuery, { currentId: item._id });
+        const fallbackContent = await getCachedSanityData(config.fallbackQuery, { currentId: item._id });
         item[config.relatedProp] = fallbackContent;
     }
 
@@ -132,11 +115,11 @@ export default async function ContentPage({ params }: { params: { slug: string[]
 
     return (
         <ContentPageClient item={item} type={type as any}>
+            {/* MODIFIED: We now pass the client-side CommentSection directly. */}
+            {/* The Suspense boundary will show a fallback while it fetches data. */}
             <Suspense fallback={<div className="spinner" style={{ margin: '8rem auto' }} />}>
-                <Comments slug={slug} />
+                <CommentSection slug={slug} />
             </Suspense>
         </ContentPageClient>
     );
-}
-
-
+}
\ No newline at end of file
diff --git a/app/actions/authActions.ts b/app/actions/authActions.ts
index 4206229..91541f3 100644
--- a/app/actions/authActions.ts
+++ b/app/actions/authActions.ts
@@ -21,7 +21,7 @@ export async function requestPasswordReset(email: string) {
         if (!user || !user.password) {
             // Don't reveal if a user exists or not for security reasons.
             // Also, don't allow password resets for OAuth users.
-            return { success: true, message: 'إن كان البريد مسجلاً، فقد أُرسِلَ إليه رابط.' };
+            return { success: true, message: 'إن صَحَّ بريدُك، أتاك الرابط.' };
         }
 
         // Invalidate any existing tokens for this user
@@ -40,17 +40,17 @@ export async function requestPasswordReset(email: string) {
 
         await sendPasswordResetEmail(email, token);
 
-        return { success: true, message: 'إن كان البريد مسجلاً، فقد أُرسِلَ إليه رابط.' };
+        return { success: true, message: 'إن صَحَّ بريدُك، أتاك الرابط.' };
     } catch (error) {
         console.error('Password reset request failed:', error);
-        return { success: false, message: 'طرأ خطأ غير متوقع.' };
+        return { success: false, message: 'طرأ خطبٌ ما.' };
     }
 }
 
 export async function resetPassword(token: string, newPassword: string) {
     try {
         if (!token || !newPassword) {
-            return { success: false, message: 'Invalid request.' };
+            return { success: false, message: 'طلبٌ غير صالح.' };
         }
 
         const resetToken = await prisma.passwordResetToken.findUnique({
@@ -65,7 +65,7 @@ export async function resetPassword(token: string, newPassword: string) {
         }
 
         if (newPassword.length < 8) {
-            return { success: false, message: 'يجب ألا تقل كلمة السر عن ثمانية أحرف.' };
+            return { success: false, message: 'كلمة السر لا تقل عن ثمانيةِ حروف.' };
         }
 
         const hashedPassword = await bcrypt.hash(newPassword, 10);
@@ -79,10 +79,10 @@ export async function resetPassword(token: string, newPassword: string) {
             where: { id: resetToken.id },
         });
 
-        return { success: true, message: 'تم استعادة كلمة السر بنجاح.' };
+        return { success: true, message: 'استُعيدت كلمة السّر.' };
     } catch (error) {
         console.error('Password reset failed:', error);
-        return { success: false, message: 'طرأ خطأ غير متوقع.' };
+        return { success: false, message: 'طرأ خطبٌ ما.' };
     }
 }
 
diff --git a/app/actions/commentActions.ts b/app/actions/commentActions.ts
index dda65b1..829810f 100644
--- a/app/actions/commentActions.ts
+++ b/app/actions/commentActions.ts
@@ -37,7 +37,7 @@ export async function deleteComment(commentId: string) {
         if (commentToDelete._count.replies > 0) {
             const updatedComment = await prisma.comment.update({
                 where: { id: commentId },
-                data: { content: '[Comment deleted]', isDeleted: true }
+                data: { content: '[طُمِسَ التعليق]', isDeleted: true }
             });
             return { success: true, wasDeleted: false, updatedComment };
         } else {
@@ -45,7 +45,7 @@ export async function deleteComment(commentId: string) {
             return { success: true, wasDeleted: true, deletedId: commentId };
         }
     } catch (error: any) {
-        return { success: false, error: error.message || 'Could not delete comment.' };
+        return { success: false, error: error.message || 'يأبى التعليقُ الحذف.' };
     }
 }
 
@@ -72,7 +72,7 @@ export async function updateComment(commentId: string, content: string) {
         revalidatePath(`/news/${comment.contentSlug}`);
         return { success: true, updatedComment };
     } catch (error: any) {
-        return { success: false, error: error.message || "فشل التحديث." };
+        return { success: false, error: error.message || "أخفق التحديث." };
     }
 }
 
@@ -92,7 +92,7 @@ export async function voteOnComment(commentId: string, voteType: VoteType) {
         if (!updatedComment) throw new Error("Comment not found after vote update.");
         return { success: true, updatedVotes: updatedComment.votes };
     } catch (error: any) {
-        return { success: false, error: error.message || 'تعذر تسجيل التصويت.' };
+        return { success: false, error: error.message || 'تعذّر تسجيل التصويت.' };
     }
 }
 
@@ -109,14 +109,6 @@ export async function getReplies(parentId: string) {
         });
         return { success: true, replies };
     } catch (error) {
-        return { success: false, error: 'فشل جلب الردود.' };
+        return { success: false, error: 'أبت الردودُ أن تُجلَب.' };
     }
-}
-
-
-
-
-
-
-
-
+}
\ No newline at end of file
diff --git a/app/actions/contentActions.ts b/app/actions/contentActions.ts
index 8748c70..b34e79c 100644
--- a/app/actions/contentActions.ts
+++ b/app/actions/contentActions.ts
@@ -20,6 +20,7 @@ async function setEngagement(userId: string, contentId: number, contentType: str
         await prisma.engagement.upsert({
             where: whereClause,
             update: {},
+            // THE DEFINITIVE FIX: The `create` payload must explicitly include all required fields.
             create: { userId, contentId, contentType, type: engagementType },
         });
     } else {
@@ -38,7 +39,7 @@ export async function setBookmarkAction(contentId: number, contentType: string,
         return { success: true };
     } catch (error: any) {
         console.error("CRITICAL: setBookmarkAction failed:", error);
-        return { success: false, error: error.message || 'طرأ خطأ غير متوقع.' };
+        return { success: false, error: error.message || 'طرأ خطبٌ ما.' };
     }
 }
 
@@ -53,7 +54,7 @@ export async function setLikeAction(contentId: number, contentType: string, cont
         return { success: true };
     } catch (error: any) {
         console.error("CRITICAL: setLikeAction failed:", error);
-        return { success: false, error: error.message || 'طرأ خطأ غير متوقع.' };
+        return { success: false, error: error.message || 'طرأ خطبٌ ما.' };
     }
 }
 
@@ -79,9 +80,4 @@ export async function recordShareAction(contentId: number, contentType: string,
         console.error("CRITICAL: recordShareAction failed:", error);
         return { success: false, error: error.message || 'Could not record share.' };
     }
-}
-
-
-
-
-
+}
\ No newline at end of file
diff --git a/app/actions/userActions.ts b/app/actions/userActions.ts
index 7b4b28a..7316a86 100644
--- a/app/actions/userActions.ts
+++ b/app/actions/userActions.ts
@@ -2,7 +2,7 @@
 'use server';
 
 import prisma from '@/lib/prisma';
-import { revalidatePath } from 'next/cache';
+import { revalidatePath, revalidateTag } from 'next/cache';
 import { put } from '@vercel/blob';
 import bcrypt from 'bcryptjs';
 import { getAuthenticatedSession } from '@/lib/auth';
@@ -45,7 +45,7 @@ export async function updateUserProfile(formData: FormData) {
             if (!validation.success) throw new Error(validation.message);
             const existingUser = await prisma.user.findUnique({ where: { username } });
             if (existingUser && existingUser.id !== session.user.id) {
-                throw new Error('اسم المستخدم محجوز.');
+                throw new Error('اسمٌ محجوز.');
             }
         }
         
@@ -60,14 +60,16 @@ export async function updateUserProfile(formData: FormData) {
                 countryPublic,
             },
         });
-
+        
+        revalidateTag('enriched-creators', 'page');
+        revalidateTag('enriched-creator-details', 'page');
         revalidatePath('/profile');
         revalidatePath(`/profile/${session.user.id}`);
         if (username) revalidatePath(`/creators/${username}`);
 
-        return { success: true, message: 'تم تحديث الملف الشخصي بنجاح.' };
+        return { success: true, message: 'تَجَدَّدَ مَلَفُكَ الشخصي.' };
     } catch (error: any) {
-        return { success: false, message: error.message || 'Failed to update profile.' };
+        return { success: false, message: error.message || 'أخفق تحديث الملف.' };
     }
 }
 
@@ -112,13 +114,15 @@ export async function completeOnboardingAction(formData: FormData) {
             },
         });
 
+        revalidateTag('enriched-creators', 'page');
+        revalidateTag('enriched-creator-details', 'page');
         revalidatePath('/profile');
         if (username) revalidatePath(`/profile/${username}`);
         
         return { success: true };
 
     } catch (error: any) {
-        return { success: false, message: error.message || 'An unexpected error occurred during onboarding.' };
+        return { success: false, message: error.message || 'طرأ خطبٌ عند التهيئة.' };
     }
 }
 export async function changePasswordAction(formData: FormData) {
@@ -127,7 +131,7 @@ export async function changePasswordAction(formData: FormData) {
         const user = await prisma.user.findUnique({ where: { id: session.user.id } });
 
         if (!user?.password) {
-            return { success: false, message: 'لا يمكن تغيير كلمة السر للحسابات المرتبطة.' };
+            return { success: false, message: 'لا يمكن تغيير كلمة السر للحسابات المربوطة بمزود خارجي.' };
         }
 
         const currentPassword = formData.get('currentPassword') as string;
@@ -135,20 +139,20 @@ export async function changePasswordAction(formData: FormData) {
         const confirmPassword = formData.get('confirmPassword') as string;
 
         if (!currentPassword || !newPassword || !confirmPassword) {
-            return { success: false, message: 'كافة الحقول إلزامية.' };
+            return { success: false, message: 'الحقولُ كلُّها لازمة.' };
         }
 
         const isPasswordValid = await bcrypt.compare(currentPassword, user.password);
         if (!isPasswordValid) {
-            return { success: false, message: 'كلمة السر الحالية غير صحيحة.' };
+            return { success: false, message: 'كلمة السر الحالية خاطئة.' };
         }
 
         if (newPassword.length < 8) {
-            return { success: false, message: 'كلمة السر الجديدة يجب ألا تقل عن ٨ أحرف.' };
+            return { success: false, message: 'كلمة السر الجديدة لا تقل عن ثمانيةِ حروف.' };
         }
 
         if (newPassword !== confirmPassword) {
-            return { success: false, message: 'كلمتا السر الجديدتان غير متطابقتين.' };
+            return { success: false, message: 'الكلمتان الجديدتان لا تتطابقان.' };
         }
 
         const hashedPassword = await bcrypt.hash(newPassword, 10);
@@ -158,10 +162,10 @@ export async function changePasswordAction(formData: FormData) {
             data: { password: hashedPassword },
         });
 
-        return { success: true, message: 'تم تغيير كلمة السر بنجاح.' };
+        return { success: true, message: 'تغيَّرت كلمة السر.' };
 
     } catch (error: any) {
-        return { success: false, message: error.message || 'طرأ خطأ غير متوقع.' };
+        return { success: false, message: error.message || 'طرأ خطبٌ ما.' };
     }
 }
 const validateUsername = (username: string) => {
@@ -180,9 +184,9 @@ export async function checkUsernameAvailability(username: string): Promise<{ ava
     }
     const existingUser = await prisma.user.findUnique({ where: { username } });
     if (existingUser) {
-        return { available: false, message: 'اسم المستخدم محجوز.' };
+        return { available: false, message: 'اسمٌ محجوز.' };
     }
-    return { available: true, message: 'اسم المستخدم متاح.' };
+    return { available: true, message: 'الاسمُ متاح.' };
 }
 export async function signUp(formData: FormData) {
     const name = formData.get('name') as string;
@@ -190,13 +194,13 @@ export async function signUp(formData: FormData) {
     const password = formData.get('password') as string;
     const username = (formData.get('username') as string)?.toLowerCase();
     if (!name || !email || !password || !username) {
-        return { success: false, message: 'كافة الحقول إلزامية.' };
+        return { success: false, message: 'الحقولُ كلُّها لازمة.' };
     }
     if (!/\S+@\S+\.\S+/.test(email)) {
         return { success: false, message: 'البريد الإلكتروني غير صالح.' };
     }
     if (password.length < 8) {
-        return { success: false, message: 'يجب ألا تقل كلمة السر عن ثمانية أحرف.' };
+        return { success: false, message: 'كلمة السر لا تقل عن ثمانيةِ حروف.' };
     }
     const usernameValidation = await checkUsernameAvailability(username);
     if (!usernameValidation.available) {
@@ -204,15 +208,15 @@ export async function signUp(formData: FormData) {
     }
     const existingEmail = await prisma.user.findUnique({ where: { email } });
     if (existingEmail) {
-        return { success: false, message: 'هذا البريد مسجل بالفعل.' };
+        return { success: false, message: 'بريدٌ مسجل.' };
     }
-    return { success: true, message: 'Validation successful.' };
+    return { success: true, message: 'تمَّت المصادقة.' };
 }
 export async function setUsernameAction(username: string) {
     try {
         const session = await getAuthenticatedSession();
         const user = await prisma.user.findUnique({ where: { id: session.user.id } });
-        if (user?.username) return { success: false, message: 'Username has already been set.' };
+        if (user?.username) return { success: false, message: 'الاسمُ قد عُيِّن.' };
 
         const cleanUsername = username.toLowerCase();
         const validation = await checkUsernameAvailability(cleanUsername);
@@ -225,23 +229,23 @@ export async function setUsernameAction(username: string) {
         revalidatePath('/profile');
         return { success: true };
     } catch (error: any) {
-        return { success: false, message: error.message || 'Failed to update username.' };
+        return { success: false, message: error.message || 'أخفق تحديث الاسم.' };
     }
 }
 export async function updateUserAvatar(formData: FormData) {
     try {
         const session = await getAuthenticatedSession();
         const avatarFile = formData.get('avatar') as File | null;
-        if (!avatarFile || avatarFile.size === 0) return { success: true, message: 'لا يوجد ملف صورة جديد.' };
+        if (!avatarFile || avatarFile.size === 0) return { success: true, message: 'لا صورة جديدة.' };
 
         const sanitizedFilename = `${session.user.id}-${Date.now()}-${avatarFile.name.replace(/[^a-zA-Z0-9._-]/g, '-')}`;
         const blob = await put(sanitizedFilename, avatarFile, { access: 'public', contentType: avatarFile.type });
         await prisma.user.update({ where: { id: session.user.id }, data: { image: blob.url } });
         
         revalidatePath('/profile');
-        return { success: true, message: 'تم تحديث الصورة الرمزية.' };
+        return { success: true, message: 'تجدَّدت الصورة الرمزية.' };
     } catch (error: any) {
-        return { success: false, message: error.message || 'فشل الرفع.' };
+        return { success: false, message: error.message || 'أخفق الرفع.' };
     }
 }
 export async function getCommentedContentIds() {
@@ -256,6 +260,4 @@ export async function getCommentedContentIds() {
     } catch (error) {
         return [];
     }
-}
-
-
+}
\ No newline at end of file
diff --git a/app/api/articles/route.ts b/app/api/articles/route.ts
index ed622d9..92a7171 100644
--- a/app/api/articles/route.ts
+++ b/app/api/articles/route.ts
@@ -5,9 +5,6 @@ import { paginatedArticlesQuery } from '@/lib/sanity.queries';
 import { adaptToCardProps } from '@/lib/adapters';
 import { unstable_cache } from 'next/cache';
 
-export const dynamic = 'force-dynamic';
-export const revalidate = 300;
-
 const getCachedPaginatedArticles = unstable_cache(
     async (
         gameSlug: string | undefined, 
diff --git a/app/api/blob/upload/route.ts b/app/api/blob/upload/route.ts
index 70f47dd..8124f5c 100644
--- a/app/api/blob/upload/route.ts
+++ b/app/api/blob/upload/route.ts
@@ -24,7 +24,7 @@ export async function POST(request: NextRequest): Promise<NextResponse> {
 
     if (!session || !isCreatorOrAdmin) {
       return NextResponse.json(
-        { error: 'Unauthorized' },
+        { error: 'غير مُصرَّح به' },
         { status: 401 }
       );
     }
diff --git a/app/api/comments/[slug]/route.ts b/app/api/comments/[slug]/route.ts
new file mode 100644
index 0000000..62aac75
--- /dev/null
+++ b/app/api/comments/[slug]/route.ts
@@ -0,0 +1,42 @@
+// app/api/comments/[slug]/route.ts
+import { NextRequest, NextResponse } from 'next/server';
+import prisma from '@/lib/prisma';
+
+export const dynamic = 'force-dynamic'; // Ensures this route is always server-rendered
+
+// MODIFIED: The context for params is now correctly typed as a Promise.
+export async function GET(req: NextRequest, { params: paramsPromise }: { params: Promise<{ slug: string }> }) {
+    try {
+        // MODIFIED: We must await the promise to get the slug.
+        const { slug } = await paramsPromise;
+
+        if (!slug) {
+            return NextResponse.json({ error: 'Slug is required' }, { status: 400 });
+        }
+        
+        const comments = await prisma.comment.findMany({
+            where: { contentSlug: slug, parentId: null },
+            include: { 
+                author: { select: { id: true, name: true, image: true, username: true } }, 
+                votes: true, 
+                _count: { select: { replies: true } }, 
+                replies: { 
+                    take: 2, 
+                    include: { 
+                        author: { select: { id: true, name: true, image: true, username: true } }, 
+                        votes: true, 
+                        _count: { select: { replies: true } } 
+                    }, 
+                    orderBy: { createdAt: 'asc' } 
+                } 
+            },
+            orderBy: { createdAt: 'desc' },
+        });
+
+        return NextResponse.json(comments);
+
+    } catch (error) {
+        console.error('API Error fetching comments:', error);
+        return NextResponse.json({ error: 'Failed to fetch comments.' }, { status: 500 });
+    }
+}
\ No newline at end of file
diff --git a/app/api/content-by-ids/route.ts b/app/api/content-by-ids/route.ts
index 7802e93..9fb2fce 100644
--- a/app/api/content-by-ids/route.ts
+++ b/app/api/content-by-ids/route.ts
@@ -4,35 +4,24 @@ import { NextResponse } from 'next/server';
 import { client } from '@/lib/sanity.client';
 import { contentByIdsQuery } from '@/lib/sanity.queries';
 
-// This is the API endpoint the Constellation component calls.
 export async function POST(request: Request) {
   try {
     const body = await request.json();
     const { ids } = body;
 
-    // Validate the input from the client
     if (!Array.isArray(ids) || ids.length === 0) {
-      // If no IDs are provided, return an empty array immediately.
       return NextResponse.json([]);
     }
 
-    // Use the existing, correct query from your queries file
     const content = await client.fetch(contentByIdsQuery, { ids });
 
-    // Return the found content to the client
     return NextResponse.json(content);
-    
+
   } catch (error) {
     console.error('API Error in /api/content-by-ids:', error);
-    // If anything goes wrong, return a server error status
     return NextResponse.json(
       { error: 'Failed to fetch content by IDs.' },
       { status: 500 }
     );
   }
 }
-
-
-
-
-
diff --git a/app/api/cron/revalidate-scheduled/route.ts b/app/api/cron/revalidate-scheduled/route.ts
index 6c46e0d..3922f8b 100644
--- a/app/api/cron/revalidate-scheduled/route.ts
+++ b/app/api/cron/revalidate-scheduled/route.ts
@@ -9,7 +9,7 @@ import { groq } from 'next-sanity';
 export async function GET(request: NextRequest) {
   const authHeader = request.headers.get('authorization');
   if (authHeader !== `Bearer ${process.env.CRON_SECRET}`) {
-    return new Response('غير مصرح لك.', { status: 401 });
+    return new Response('غير مُخَوَّل.', { status: 401 });
   }
 
   // Find all documents that were scheduled to be published in the last minute
@@ -29,7 +29,7 @@ export async function GET(request: NextRequest) {
     });
 
     if (docsToRevalidate.length === 0) {
-      return NextResponse.json({ success: true, message: 'No documents to revalidate.' });
+      return NextResponse.json({ success: true, message: 'لا وثائقَ لإعادة المصادقة.' });
     }
 
     // Use a Set to avoid revalidating the same path multiple times
diff --git a/app/api/engagement-scores/route.ts b/app/api/engagement-scores/route.ts
index 52735e4..e57acfe 100644
--- a/app/api/engagement-scores/route.ts
+++ b/app/api/engagement-scores/route.ts
@@ -2,8 +2,6 @@
 import prisma from '@/lib/prisma';
 import { NextResponse } from 'next/server';
 
-export const revalidate = 60;
-
 export async function GET() {
   try {
     const contentTypes = ['review', 'article', 'news'];
@@ -46,6 +44,4 @@ export async function GET() {
     console.error('Failed to fetch engagement scores:', error);
     return NextResponse.json({ error: 'Failed to fetch engagement metrics' }, { status: 500 });
   }
-}
-
-
+}
\ No newline at end of file
diff --git a/app/api/news-engagement/route.ts b/app/api/news-engagement/route.ts
index 1b9b9cd..954ed67 100644
--- a/app/api/news-engagement/route.ts
+++ b/app/api/news-engagement/route.ts
@@ -3,8 +3,6 @@
 import prisma from '@/lib/prisma';
 import { NextResponse } from 'next/server';
 
-export const revalidate = 60; // Cache this data for 60 seconds
-
 export async function GET() {
   try {
     // 1. Find all unique legacyIds (contentIds) tagged as 'خبر' and of type 'LIKE'
@@ -50,9 +48,4 @@ export async function GET() {
     console.error('Failed to fetch news engagement:', error);
     return NextResponse.json({ error: 'Failed to fetch engagement metrics' }, { status: 500 });
   }
-}
-
-
-
-
-
+}
\ No newline at end of file
diff --git a/app/api/news/route.ts b/app/api/news/route.ts
index e6fe437..a019fa4 100644
--- a/app/api/news/route.ts
+++ b/app/api/news/route.ts
@@ -5,9 +5,6 @@ import { paginatedNewsQuery } from '@/lib/sanity.queries';
 import { adaptToCardProps } from '@/lib/adapters';
 import { unstable_cache } from 'next/cache';
 
-export const dynamic = 'force-dynamic';
-export const revalidate = 300;
-
 const getCachedPaginatedNews = unstable_cache(
     async (
         gameSlug: string | undefined, 
diff --git a/app/api/revalidate-sanity/route.ts b/app/api/revalidate-sanity/route.ts
new file mode 100644
index 0000000..56a7390
--- /dev/null
+++ b/app/api/revalidate-sanity/route.ts
@@ -0,0 +1,98 @@
+import { revalidatePath, revalidateTag } from 'next/cache';
+import { type NextRequest, NextResponse } from 'next/server';
+import { parseBody } from 'next-sanity/webhook';
+
+// Define a type for the expected webhook body for better type-safety
+interface WebhookBody {
+  _type: string;
+  slug?: {
+    current?: string;
+  };
+}
+
+// Ensure the secret is defined in your environment variables
+const secret = process.env.REVALIDATION_SECRET_TOKEN;
+if (!secret) {
+  throw new Error('Missing REVALIDATION_SECRET_TOKEN in environment variables.');
+}
+
+export async function POST(req: NextRequest) {
+  try {
+    const { body, isValidSignature } = await parseBody<WebhookBody>(req, secret);
+
+    if (!isValidSignature) {
+      const message = 'Invalid signature';
+      return new Response(JSON.stringify({ message, isValidSignature, body }), { status: 401 });
+    }
+
+    if (!body?._type) {
+      return NextResponse.json({ message: 'Bad Request: Missing _type in body' }, { status: 400 });
+    }
+
+    const { _type: type, slug } = body;
+
+    // --- Revalidate Tags for Cached API Data ---
+    const tagsToRevalidate: string[] = [];
+    if (['review', 'article', 'news'].includes(type)) {
+      tagsToRevalidate.push(`${type}s`); // e.g., 'reviews'
+      tagsToRevalidate.push('paginated'); // Common tag for paginated content
+      tagsToRevalidate.push('engagement-scores'); // Homepage scores depend on this
+      tagsToRevalidate.push('sanity-content'); // MODIFIED: Added tag for detail pages
+    }
+    if (['author', 'reviewer', 'reporter', 'designer'].includes(type)) {
+      tagsToRevalidate.push('enriched-creators');
+      tagsToRevalidate.push('enriched-creator-details');
+    }
+    
+    // THE DEFINITIVE FIX: Explicitly provide the 'page' argument to revalidateTag.
+    tagsToRevalidate.forEach(tag => revalidateTag(tag, 'page'));
+
+    // --- Revalidate Specific Page Paths ---
+    const pathsToRevalidate: string[] = ['/'];
+    const currentSlug = slug?.current;
+
+    switch (type) {
+      case 'review':
+        pathsToRevalidate.push('/reviews');
+        if (currentSlug) pathsToRevalidate.push(`/reviews/${currentSlug}`);
+        break;
+      case 'article':
+        pathsToRevalidate.push('/articles');
+        if (currentSlug) pathsToRevalidate.push(`/articles/${currentSlug}`);
+        break;
+      case 'news':
+        pathsToRevalidate.push('/news');
+        if (currentSlug) pathsToRevalidate.push(`/news/${currentSlug}`);
+        break;
+      case 'gameRelease':
+        pathsToRevalidate.push('/releases', '/celestial-almanac');
+        break;
+      case 'game':
+        if (currentSlug) pathsToRevalidate.push(`/games/${currentSlug}`);
+        // Revalidate list pages as game info might appear there
+        pathsToRevalidate.push('/reviews', '/articles', '/news');
+        break;
+      case 'tag':
+        if (currentSlug) pathsToRevalidate.push(`/tags/${currentSlug}`);
+        break;
+    }
+    
+    // Use a Set to ensure unique paths before revalidating
+    const uniquePaths = [...new Set(pathsToRevalidate)];
+    uniquePaths.forEach(path => revalidatePath(path));
+
+    return NextResponse.json({
+      status: 200,
+      revalidated: true,
+      now: Date.now(),
+      message: `Revalidated paths and tags for type: ${type}`,
+      revalidatedTags: tagsToRevalidate,
+      revalidatedPaths: uniquePaths,
+    });
+
+  } catch (err: unknown) {
+    const errorMessage = err instanceof Error ? err.message : 'Unknown error';
+    console.error("Error in revalidate-sanity webhook:", errorMessage);
+    return new Response(errorMessage, { status: 500 });
+  }
+}
\ No newline at end of file
diff --git a/app/api/revalidate/route.ts b/app/api/revalidate/route.ts
deleted file mode 100644
index 8fedfb3..0000000
--- a/app/api/revalidate/route.ts
+++ /dev/null
@@ -1,51 +0,0 @@
-// app/api/revalidate/route.ts
-
-import { revalidatePath } from 'next/cache';
-import { NextRequest, NextResponse } from 'next/server';
-
-// Helper function to delay execution
-const wait = (ms: number) => new Promise(resolve => setTimeout(resolve, ms));
-
-export async function POST(request: NextRequest) {
-  const body = await request.json();
-  const { path, delay, token } = body;
-
-  // 1. Security Check: Validate the secret token
-  if (token !== process.env.REVALIDATION_SECRET_TOKEN) {
-    return NextResponse.json({ message: 'Invalid token' }, { status: 401 });
-  }
-
-  // 2. Input Validation
-  if (!path || typeof path !== 'string' || typeof delay !== 'number') {
-    return NextResponse.json({ message: 'Invalid request body' }, { status: 400 });
-  }
-
-  // 3. Perform the delayed revalidation
-  if (delay > 0) {
-    await wait(delay);
-  }
-
-  try {
-    revalidatePath(path);
-    return NextResponse.json({ revalidated: true, path, now: Date.now() });
-  } catch (err) {
-    return NextResponse.json({ message: `Error revalidating path: ${path}` }, { status: 500 });
-  }
-}
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
diff --git a/app/api/reviews/route.ts b/app/api/reviews/route.ts
index 4f94ec1..b14f242 100644
--- a/app/api/reviews/route.ts
+++ b/app/api/reviews/route.ts
@@ -6,9 +6,6 @@ import { adaptToCardProps } from '@/lib/adapters';
 import { unstable_cache } from 'next/cache';
 import { ScoreFilter } from '@/components/filters/ReviewFilters';
 
-export const dynamic = 'force-dynamic';
-export const revalidate = 300;
-
 const getCachedPaginatedReviews = unstable_cache(
     async (
         gameSlug: string | undefined, 
diff --git a/app/articles/ArticlesPageClient.tsx b/app/articles/ArticlesPageClient.tsx
index 2af081c..8773b68 100644
--- a/app/articles/ArticlesPageClient.tsx
+++ b/app/articles/ArticlesPageClient.tsx
@@ -6,14 +6,15 @@ import { motion, AnimatePresence, useInView } from 'framer-motion';
 import type { SanityArticle, SanityGame, SanityTag } from '@/types/sanity';
 import HorizontalShowcase from '@/components/HorizontalShowcase';
 import ArticleFilters from '@/components/filters/ArticleFilters';
-import ArticleGrid from '@/components/ArticleGrid';
-import { ContentBlock } from '@/components/ContentBlock';
+import ArticleCard from '@/components/ArticleCard';
 import Image from 'next/image';
 import Link from 'next/link';
 import AnimatedGridBackground from '@/components/AnimatedGridBackground';
 import { adaptToCardProps } from '@/lib/adapters';
 import { CardProps } from '@/types';
 import styles from '@/components/HorizontalShowcase.module.css';
+import { useRouter } from 'next/navigation';
+import { useLayoutIdStore } from '@/lib/layoutIdStore';
 
 const fetchArticles = async (params: URLSearchParams) => {
     const res = await fetch(`/api/articles?${params.toString()}`);
@@ -27,8 +28,10 @@ const ArrowIcon = ({ direction = 'right' }: { direction?: 'left' | 'right' }) =>
     </svg>
 );
   
-const MobileShowcase = ({ articles, onActiveIndexChange }: { articles: any[], onActiveIndexChange: (index: number) => void }) => {
+const MobileShowcase = ({ articles, onActiveIndexChange }: { articles: CardProps[], onActiveIndexChange: (index: number) => void }) => {
     const [[page, direction], setPage] = useState([0, 0]);
+    const router = useRouter();
+    const setPrefix = useLayoutIdStore((state) => state.setPrefix);
     
     const paginate = (newDirection: number) => {
         const newIndex = (page + newDirection + articles.length) % articles.length;
@@ -37,6 +40,12 @@ const MobileShowcase = ({ articles, onActiveIndexChange }: { articles: any[], on
     };
 
     const activeArticle = articles[page];
+    const layoutIdPrefix = "articles-showcase";
+    const handleClick = (e: React.MouseEvent) => {
+        e.preventDefault();
+        setPrefix(layoutIdPrefix);
+        router.push(`/articles/${activeArticle.slug}`, { scroll: false });
+    };
     
     const variants = {
         enter: (direction: number) => ({ opacity: 0, x: direction > 0 ? 100 : -100 }),
@@ -48,10 +57,14 @@ const MobileShowcase = ({ articles, onActiveIndexChange }: { articles: any[], on
         <div className={styles.mobileShowcaseContainer}>
              <AnimatePresence initial={false} custom={direction} mode="wait">
                 <motion.div key={page} custom={direction} variants={variants} initial="enter" animate="center" exit="exit" className={styles.mobileShowcaseCardWrapper} transition={{ duration: 0.4, ease: 'easeInOut' }}>
-                    <Link href={`/articles/${activeArticle.slug}`} className={`no-underline ${styles.showcaseCardLink}`}>
-                        <div className={styles.showcaseCardImageWrapper}><Image src={activeArticle.imageUrl} alt={activeArticle.title} fill sizes="80vw" style={{ objectFit: 'cover' }} className={styles.showcaseCardImage}/></div>
-                        <div className={styles.showcaseCardContent}><h3 className={styles.showcaseCardTitle}>{activeArticle.title}</h3><p className={styles.showcaseCardGame}>{activeArticle.game}</p></div>
-                    </Link>
+                    <motion.div
+                        layoutId={`${layoutIdPrefix}-card-container-${activeArticle.legacyId}`}
+                        onClick={handleClick}
+                        className={`no-underline ${styles.showcaseCardLink}`}
+                    >
+                        <motion.div layoutId={`${layoutIdPrefix}-card-image-${activeArticle.legacyId}`} className={styles.showcaseCardImageWrapper}><Image src={activeArticle.imageUrl} alt={activeArticle.title} fill sizes="80vw" style={{ objectFit: 'cover' }} className={styles.showcaseCardImage}/></motion.div>
+                        <div className={styles.showcaseCardContent}><motion.h3 layoutId={`${layoutIdPrefix}-card-title-${activeArticle.legacyId}`} className={styles.showcaseCardTitle}>{activeArticle.title}</motion.h3><p className={styles.showcaseCardGame}>{activeArticle.game}</p></div>
+                    </motion.div>
                 </motion.div>
             </AnimatePresence>
             <button className={`${styles.showcaseArrow} ${styles.left}`} onClick={() => paginate(-1)}><ArrowIcon direction="left" /></button>
@@ -67,85 +80,58 @@ export default function ArticlesPageClient({ featuredArticles, initialGridArticl
     const [activeIndex, setActiveIndex] = useState(0);
     const [isMobile, setIsMobile] = useState(false);
     const intersectionRef = useRef(null);
-    const isIntersecting = useInView(intersectionRef);
+    const isInView = useInView(intersectionRef, { margin: '400px' });
 
     const initialCards = useMemo(() => initialGridArticles.map(adaptToCardProps).filter(Boolean) as CardProps[], [initialGridArticles]);
-    const [gridArticles, setGridArticles] = useState<CardProps[]>(initialCards);
+    const [allFetchedArticles, setAllFetchedArticles] = useState<CardProps[]>(initialCards);
     const [isLoading, setIsLoading] = useState(false);
     const [nextOffset, setNextOffset] = useState<number | null>(initialCards.length === 20 ? 20 : null);
-    const [isFeedExhausted, setIsFeedExhausted] = useState(initialCards.length < 20);
-
+    
     useEffect(() => { const checkMobile = () => setIsMobile(window.innerWidth <= 768); checkMobile(); window.addEventListener('resize', checkMobile); return () => window.removeEventListener('resize', checkMobile); }, []);
 
-    // Replaced useUrlState with standard useState
     const [searchTerm, setSearchTerm] = useState('');
     const [sortOrder, setSortOrder] = useState<'latest' | 'viral'>('latest');
     const [selectedGame, setSelectedGame] = useState<SanityGame | null>(null);
     const [selectedGameTags, setSelectedGameTags] = useState<SanityTag[]>([]);
     const [selectedArticleType, setSelectedArticleType] = useState<SanityTag | null>(null);
     
-    const currentFilters = useMemo(() => ({ searchTerm, sortOrder, selectedGame, selectedGameTags, selectedArticleType }), [searchTerm, sortOrder, selectedGame, selectedGameTags, selectedArticleType]);
-    const hasActiveFilters = searchTerm || sortOrder !== 'latest' || !!selectedGame || selectedGameTags.length > 0 || !!selectedArticleType;
-
-    useEffect(() => {
+    const gridArticles = useMemo(() => {
+        let items = [...allFetchedArticles];
+        if (searchTerm) { items = items.filter(article => article.title.toLowerCase().includes(searchTerm.toLowerCase())); }
+        if (selectedGame) { items = items.filter(article => article.game === selectedGame.title); }
         const allSelectedTags = [...selectedGameTags, ...(selectedArticleType ? [selectedArticleType] : [])];
-        const filtersAreDefault = !hasActiveFilters;
-
-        if (filtersAreDefault) {
-            setGridArticles(initialCards);
-            setNextOffset(initialCards.length === 20 ? 20 : null);
-            setIsFeedExhausted(initialCards.length < 20);
-            return;
-        }
+        if (allSelectedTags.length > 0) { const selectedTagTitles = new Set(allSelectedTags.map(t => t.title)); items = items.filter(article => article.tags.some(t => selectedTagTitles.has(t.title))); }
+        return items;
+    }, [allFetchedArticles, searchTerm, selectedGame, selectedGameTags, selectedArticleType]);
 
-        const fetchAndReplace = async () => {
-            setIsLoading(true);
-            setIsFeedExhausted(false);
-            const params = new URLSearchParams({ offset: '0', limit: '20' });
-            if (searchTerm) params.set('q', searchTerm);
-            if (sortOrder !== 'latest') params.set('sort', sortOrder);
-            if (selectedGame) params.set('game', selectedGame.slug);
-            if (allSelectedTags.length > 0) params.set('tags', allSelectedTags.map(t => t.slug).join(','));
-
-            try {
-                const result = await fetchArticles(params);
-                setGridArticles(result.data);
-                setNextOffset(result.nextOffset);
-                if (!result.nextOffset) setIsFeedExhausted(true);
-            } catch (error) { console.error("Filter change fetch failed:", error); } 
-            finally { setIsLoading(false); }
-        };
-
-        fetchAndReplace();
-    }, [currentFilters, hasActiveFilters, initialCards]);
+    const hasActiveFilters = useMemo(() => {
+        return !!searchTerm || !!selectedGame || selectedGameTags.length > 0 || !!selectedArticleType || sortOrder !== 'latest';
+    }, [searchTerm, selectedGame, selectedGameTags, selectedArticleType, sortOrder]);
+    
+    const canLoadMore = useMemo(() => {
+        return nextOffset !== null && !hasActiveFilters;
+    }, [nextOffset, hasActiveFilters]);
 
     useEffect(() => {
-        if (isIntersecting && nextOffset !== null && !isLoading) {
+        if (isInView && canLoadMore && !isLoading) {
             const loadMore = async () => {
                 setIsLoading(true);
-                const allSelectedTags = [...selectedGameTags, ...(selectedArticleType ? [selectedArticleType] : [])];
-                const params = new URLSearchParams({ offset: String(nextOffset), limit: '20' });
-                if (searchTerm) params.set('q', searchTerm);
-                if (sortOrder !== 'latest') params.set('sort', sortOrder);
-                if (selectedGame) params.set('game', selectedGame.slug);
-                if (allSelectedTags.length > 0) params.set('tags', allSelectedTags.map(t => t.slug).join(','));
-
+                const params = new URLSearchParams({ offset: String(nextOffset), limit: '20', sort: sortOrder });
                 try {
                     const result = await fetchArticles(params);
-                    setGridArticles(prev => [...prev, ...result.data]);
+                    setAllFetchedArticles(prev => [...prev, ...result.data]);
                     setNextOffset(result.nextOffset);
-                    if (!result.nextOffset) setIsFeedExhausted(true);
                 } catch (error) { console.error("Failed to load more articles:", error); } 
                 finally { setIsLoading(false); }
             };
             loadMore();
         }
-    }, [isIntersecting, nextOffset, isLoading, currentFilters]);
+    }, [isInView, canLoadMore, isLoading, nextOffset, sortOrder]);
 
     const handleGameTagToggle = (tag: SanityTag) => { setSelectedGameTags(prev => prev.some(t => t._id === tag._id) ? prev.filter(t => t._id !== tag._id) : [...prev, tag]); };
     const handleClearAllFilters = () => { setSelectedGame(null); setSelectedGameTags([]); setSelectedArticleType(null); setSearchTerm(''); setSortOrder('latest'); };
     
-    const featuredForShowcase = useMemo(() => featuredArticles.map(adaptToCardProps).filter(Boolean), [featuredArticles]);
+    const featuredForShowcase = useMemo(() => featuredArticles.map(adaptToCardProps).filter(Boolean) as CardProps[], [featuredArticles]);
     const activeBackgroundUrl = featuredForShowcase[activeIndex]?.imageUrl;
 
     return (
@@ -154,29 +140,35 @@ export default function ArticlesPageClient({ featuredArticles, initialGridArticl
             <div className={styles.articlesPageContainer}>
                 <AnimatePresence>{activeBackgroundUrl && (<motion.div key={activeBackgroundUrl} className={styles.articlesPageBg} initial={{ opacity: 0 }} animate={{ opacity: 1 }} exit={{ opacity: 0 }}><Image src={activeBackgroundUrl} alt="Dynamic background" fill style={{ objectFit: 'cover' }} /><div className={styles.articlesPageBgOverlay} /></motion.div>)}</AnimatePresence>
                 <div className="container" style={{ paddingTop: '4rem', paddingBottom: '6rem', minHeight: '80vh' }}>
-                    <h1 className="page-title" style={{ color: '#fff', textShadow: '0 3px 15px rgba(0,0,0,0.5)', fontSize: '5rem', marginTop: '0.7rem', marginBottom: '4rem' }}>ديوان الفن</h1>
+                    <h1 className="page-title" style={{ color: '#fff', textShadow: '0 3px 15px rgba(0,0,0,0.5)', fontSize: '5rem', marginTop: '0.7rem', marginBottom: '4rem' }}>أحدث المقالات</h1>
                     <div className={styles.showcaseSection}>{isMobile ? (<MobileShowcase articles={featuredForShowcase} onActiveIndexChange={setActiveIndex} />) : (<HorizontalShowcase articles={featuredForShowcase} onActiveIndexChange={setActiveIndex} />)}</div>
                     <div className={styles.gridSection}> 
-                        <ContentBlock title="جميع المقالات">
+                        <div style={{marginBottom: '6rem'}}>
+                            <h2 className="section-title" style={{textAlign: 'right', marginBottom: '3rem', fontSize: 'clamp(2.8rem, 4vw, 3.6rem)'}}>جميع المقالات</h2>
                             <ArticleFilters sortOrder={sortOrder} onSortChange={setSortOrder} searchTerm={searchTerm} onSearchChange={setSearchTerm} allGames={allGames} selectedGame={selectedGame} onGameSelect={setSelectedGame} allGameTags={allGameTags} selectedGameTags={selectedGameTags} onGameTagToggle={handleGameTagToggle} allArticleTypeTags={allArticleTypeTags} selectedArticleType={selectedArticleType} onArticleTypeSelect={setSelectedArticleType} onClearAllFilters={handleClearAllFilters} />
-                            <ArticleGrid articles={gridArticles} />
+                            
+                            <motion.div layout className="content-grid">
+                                <AnimatePresence>
+                                    {gridArticles.map((article, index) => ( <ArticleCard key={article.id} article={article} layoutIdPrefix="articles-grid" isPriority={index < 3} /> ))}
+                                </AnimatePresence>
+                            </motion.div>
+
+                            <div ref={intersectionRef} style={{ height: '1px', margin: '1rem 0' }} />
+
                             <AnimatePresence>
-                                {(isLoading && nextOffset !== null) && (
-                                    <motion.div key="loading" style={{display: 'flex', justifyContent: 'center', padding: '4rem'}} initial={{ opacity: 0 }} animate={{ opacity: 1 }} exit={{ opacity: 0 }}>
-                                        <div className="spinner" />
-                                    </motion.div>
-                                )}
+                                {isLoading && ( <motion.div key="loading" style={{display: 'flex', justifyContent: 'center', padding: '4rem'}} initial={{ opacity: 0 }} animate={{ opacity: 1 }} exit={{ opacity: 0 }}> <div className="spinner" /> </motion.div> )}
                             </AnimatePresence>
-                            <div ref={intersectionRef} style={{ height: '1px', margin: '1rem 0' }} />
+                            
                             <AnimatePresence>
-                                {(isFeedExhausted && gridArticles.length > 0 && !isLoading) && (
-                                     <motion.p key="end" style={{textAlign: 'center', padding: '3rem 0', color: 'var(--text-secondary)'}} initial={{ opacity: 0 }} animate={{ opacity: 1 }} exit={{ opacity: 0 }}>وصلت إلى نهاية الأرشيف.</motion.p>
+                                {(!isLoading && gridArticles.length > 0 && (nextOffset === null || hasActiveFilters)) && (
+                                    <motion.p key="end" style={{textAlign: 'center', padding: '3rem 0', color: 'var(--text-secondary)'}} initial={{ opacity: 0 }} animate={{ opacity: 1 }} exit={{ opacity: 0 }}>
+                                        {hasActiveFilters ? 'أزِل المرشحات للمزيد.' : 'بلغتَ المنتهى.'}
+                                    </motion.p>
                                 )}
                             </AnimatePresence>
-                            {(!isLoading && gridArticles.length === 0 && hasActiveFilters) && (
-                                <motion.p key="no-match" style={{textAlign: 'center', color: 'var(--text-secondary)', padding: '4rem 0'}} initial={{ opacity: 0 }} animate={{ opacity: 1 }}>لم نعثر على مقالات تطابق مرادك.</motion.p>
-                            )}
-                        </ContentBlock>
+
+                            {gridArticles.length === 0 && !isLoading && ( <motion.p key="no-match" style={{textAlign: 'center', color: 'var(--text-secondary)', padding: '4rem 0'}} initial={{ opacity: 0 }} animate={{ opacity: 1 }}> لم نعثر على مقالاتٍ توافقُ مُرادك. </motion.p> )}
+                        </div>
                     </div>
                 </div>
             </div>
diff --git a/app/articles/page.tsx b/app/articles/page.tsx
index 8c85715..aea4225 100644
--- a/app/articles/page.tsx
+++ b/app/articles/page.tsx
@@ -6,14 +6,24 @@ import type { SanityArticle, SanityGame, SanityTag } from '@/types/sanity';
 import ArticlesPageClient from './ArticlesPageClient';
 import { Suspense } from 'react';
 
-export const revalidate = 60;
-
 const allGamesQuery = groq`*[_type == "game"] | order(title asc) {_id, title, "slug": slug.current}`;
-const allGameTagsQuery = groq`*[_type == "tag" && category == "Game"] | order(title asc) {_id, title, "slug": slug.current}`;
-const allArticleTypeTagsQuery = groq`*[_type == "tag" && category == "Article"] | order(title asc) {_id, title, "slug": slug.current}`;
+const allGameTagsQuery = groq`*[_type == "tag" && category == "Game"] | order(title asc) {_id, title, "slug": slug.current, category}`;
+const allArticleTypeTagsQuery = groq`*[_type == "tag" && category == "Article"] | order(title asc) {_id, title, "slug": slug.current, category}`;
+
+// Helper function to remove duplicates based on title
+const deduplicateTags = (tags: SanityTag[]): SanityTag[] => {
+    if (!tags) return [];
+    const uniqueMap = new Map<string, SanityTag>();
+    tags.forEach(tag => {
+        if (tag && tag.title && !uniqueMap.has(tag.title)) {
+            uniqueMap.set(tag.title, tag);
+        }
+    });
+    return Array.from(uniqueMap.values());
+};
 
 export default async function ArticlesPage() {
-  const [featuredArticles, initialGridArticles, allGames, allGameTags, allArticleTypeTags]: [SanityArticle[], SanityArticle[], SanityGame[], SanityTag[], SanityTag[]] = await Promise.all([
+  const [featuredArticles, initialGridArticles, allGames, allGameTagsRaw, allArticleTypeTagsRaw]: [SanityArticle[], SanityArticle[], SanityGame[], SanityTag[], SanityTag[]] = await Promise.all([
     client.fetch(featuredShowcaseArticlesQuery),
     client.fetch(allArticlesListQuery),
     client.fetch(allGamesQuery),
@@ -21,11 +31,14 @@ export default async function ArticlesPage() {
     client.fetch(allArticleTypeTagsQuery),
   ]);
 
+  const allGameTags = deduplicateTags(allGameTagsRaw);
+  const allArticleTypeTags = deduplicateTags(allArticleTypeTagsRaw);
+
   if (!featuredArticles || featuredArticles.length === 0) {
     return (
         <div className="container page-container">
-            <h1 className="page-title">ديوان الفن</h1>
-            <p style={{textAlign: 'center', color: 'var(--text-secondary)'}}>الأرشيف هادئ. المزيد من المقالات قريبًا.</p>
+            <h1 className="page-title">أحدث المقالات</h1>
+            <p style={{textAlign: 'center', color: 'var(--text-secondary)'}}>بلغتَ المنتهى. مقالاتٌ أخرى تلوحُ في الأفق.</p>
         </div>
     );
   }
diff --git a/app/celestial-almanac/StarPreviewCard.tsx b/app/celestial-almanac/StarPreviewCard.tsx
index 681a49e..07657d6 100644
--- a/app/celestial-almanac/StarPreviewCard.tsx
+++ b/app/celestial-almanac/StarPreviewCard.tsx
@@ -14,7 +14,7 @@ import SwitchIcon from '@/components/icons/platforms/SwitchIcon';
 
 const PlatformIcons: Record<string, React.FC<React.SVGProps<SVGSVGElement>>> = {
   'PC': PCIcon,
-  'PS5': PS5Icon,
+  'PlayStation 5': PS5Icon,
   'Xbox': XboxIcon,
   'Switch': SwitchIcon,
 };
@@ -59,7 +59,7 @@ export const StarPreviewCard = ({ orbitalBody, position, onClose }: {
           position: 'absolute', top: '10px', right: '10px', zIndex: 2, width: '32px', height: '32px',
           borderRadius: '50%', border: 'none', background: 'rgba(0,0,0,0.3)', color: 'white',
           display: 'flex', alignItems: 'center', justifyContent: 'center', cursor: 'pointer', backdropFilter: 'blur(4px)'
-        }} aria-label="إغلاق المعاينة"
+        }} aria-label="إغلاق"
       >
         <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3" strokeLinecap="round" strokeLinejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
       </motion.button>
@@ -82,7 +82,7 @@ export const StarPreviewCard = ({ orbitalBody, position, onClose }: {
 
       <div style={{ padding: '1.5rem', textAlign: 'right' }}>
         <p style={{ color: 'var(--text-secondary)', fontFamily: 'var(--font-main)', fontSize: '1.3rem', margin: '0 0 0.5rem 0' }}>
-          الإصدار: {formattedDate}
+          الإصدار:{formattedDate}
         </p>
         <h3 style={{ margin: '0 0 1rem 0', fontSize: '1.7rem' }}>{content.title}</h3>
         <div style={{ display: 'flex', gap: '1rem', alignItems: 'center', marginBottom: '1.5rem', justifyContent: 'flex-end' }}>
@@ -96,7 +96,7 @@ export const StarPreviewCard = ({ orbitalBody, position, onClose }: {
           })}
         </div>
         <Link href={linkPath} onClick={onClose} className="primary-button no-underline" style={{ display: 'block', textAlign: 'center' }}>
-          عرض محور اللعبة
+          محور اللعبة
         </Link>
       </div>
     </motion.div>
diff --git a/app/celestial-almanac/index.tsx b/app/celestial-almanac/index.tsx
index 3007a19..67c5e1d 100644
--- a/app/celestial-almanac/index.tsx
+++ b/app/celestial-almanac/index.tsx
@@ -37,12 +37,12 @@ export default function CelestialAlmanac({ releases }: { releases: SanityGameRel
 
   const PRESETS: Record<Preset, ConstellationSettings> = useMemo(() => ({
     'أداء': { activePreset: 'أداء', starCountMultiplier: 0.2, bloomIntensity: 0, alwaysShowOrbits: false, flawlessPathThickness: 1 },
-    'متوازن': { activePreset: 'متوازن', starCountMultiplier: 1.0, bloomIntensity: 1.1, alwaysShowOrbits: false, flawlessPathThickness: 1.5 },
+    'مُتَّزِن': { activePreset: 'مُتَّزِن', starCountMultiplier: 1.0, bloomIntensity: 1.1, alwaysShowOrbits: false, flawlessPathThickness: 1.5 },
     'فائق': { activePreset: 'فائق', starCountMultiplier: 1.5, bloomIntensity: 1.8, alwaysShowOrbits: false, flawlessPathThickness: 2.0 },
   }), []);
 
-  const [settings, setSettings] = useState<ConstellationSettings>(PRESETS['متوازن']);
-  const userIntentBloom = useRef(PRESETS['متوازن'].bloomIntensity);
+  const [settings, setSettings] = useState<ConstellationSettings>(PRESETS['مُتَّزِن']);
+  const userIntentBloom = useRef(PRESETS['مُتَّزِن'].bloomIntensity);
 
   useEffect(() => {
     if (resolvedTheme === 'light') {
@@ -126,7 +126,7 @@ export default function CelestialAlmanac({ releases }: { releases: SanityGameRel
         {isPanelOpen && <ConstellationControlPanel settings={settings} setSettings={setSettings} onClose={() => setIsPanelOpen(false)} onPresetChange={handlePresetChange} isFullscreen={isFullscreen} onToggleFullscreen={() => setIsFullscreen(!isFullscreen)} />}
       </AnimatePresence>
       <div style={{ position: 'relative', width: '100%', height: 'calc(100vh - var(--nav-height-scrolled))' }}>
-        <motion.button className={styles.settingsButton} onClick={() => setIsPanelOpen(true)} title="فتح إعدادات التقويم" whileHover={{ scale: 1.1, rotate: 90 }} transition={{ type: 'spring', stiffness: 500, damping: 20 }} whileTap={{ scale: 0.9 }} initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0, transition: { delay: 0.5 } }}>
+        <motion.button className={styles.settingsButton} onClick={() => setIsPanelOpen(true)} title="فتح إعدادات الفلك" whileHover={{ scale: 1.1, rotate: 90 }} transition={{ type: 'spring', stiffness: 500, damping: 20 }} whileTap={{ scale: 0.9 }} initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0, transition: { delay: 0.5 } }}>
           <CelestialGearIcon />
         </motion.button>
         <Canvas camera={{ position: [0, 0, 8], fov: 60 }}>
@@ -135,10 +135,10 @@ export default function CelestialAlmanac({ releases }: { releases: SanityGameRel
         {orbitalData.length === 0 && (
           <div style={{ position: 'absolute', inset: 0, display: 'flex', flexDirection: 'column', justifyContent: 'center', alignItems: 'center', textAlign: 'center', pointerEvents: 'none', padding: '2rem' }}>
             <motion.h1 className="page-title" style={{ fontSize: '6rem' }} initial={{ opacity: 0, y: -20 }} animate={{ opacity: 1, y: 0 }} transition={{ duration: 0.8, delay: 0.2, ease: 'easeOut' }}>
-              التقويم يرسم...
+              الفلكُ يُرسَم...
             </motion.h1>
             <motion.p style={{ maxWidth: '600px', fontSize: '2rem', color: 'var(--text-secondary)' }} initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ duration: 0.8, delay: 0.4, ease: 'easeOut' }}>
-              يتم جمع بيانات الإصدار. ستظهر الخريطة السماوية قريبًا.
+              تُجمعُ بياناتُ الإصدار، وستبزغُ الخريطةُ عما قريب.
             </motion.p>
           </div>
         )}
diff --git a/app/creators/[username]/page.tsx b/app/creators/[username]/page.tsx
index 6daf5a4..e39f1e6 100644
--- a/app/creators/[username]/page.tsx
+++ b/app/creators/[username]/page.tsx
@@ -5,46 +5,70 @@ import prisma from '@/lib/prisma';
 import { notFound } from 'next/navigation';
 import HubPageClient from '@/components/HubPageClient';
 import Link from 'next/link';
+import { cache } from 'react'; // Import React's cache
+
+export const generateStaticParams = cache(async () => {
+    try {
+        const usersWithUsernames = await prisma.user.findMany({
+            where: {
+                username: { not: null },
+                roles: { some: { name: { in: ['REVIEWER', 'AUTHOR', 'REPORTER', 'DESIGNER'] } } }
+            },
+            select: { username: true },
+        });
+
+        return usersWithUsernames.map((user) => ({
+            username: encodeURIComponent(user.username!),
+        }));
+    } catch (error) {
+        console.error(`[BUILD ERROR] CRITICAL: Failed to fetch usernames for creator pages. Build cannot continue.`, error);
+        throw error;
+    }
+});
+
+// NEW CACHED FUNCTION: This wraps the Prisma query for the user.
+const getCachedUserByUsername = cache(async (username: string) => {
+    try {
+        return await prisma.user.findUnique({
+            where: { username: username },
+            select: { id: true, name: true, username: true },
+        });
+    } catch (error) {
+        console.warn(`[BUILD WARNING] Database connection failed for creator page: "${username}".`, error);
+        return null;
+    }
+});
 
 export default async function CreatorHubPage({ params }: { params: { username: string } }) {
     const { username: encodedUsername } = await params;
     const username = decodeURIComponent(encodedUsername);
 
-    const user = await prisma.user.findUnique({
-        where: { username: username },
-        select: { id: true, name: true, username: true },
-    });
+    // USE THE CACHED FUNCTION instead of a direct Prisma call.
+    const user = await getCachedUserByUsername(username);
 
     if (!user) {
         notFound();
     }
 
-    // Find all Sanity creator documents linked to this Prisma user ID
     const creatorDocs = await client.fetch< { _id: string }[] >(
         `*[_type in ["author", "reviewer", "reporter", "designer"] && prismaUserId == $prismaUserId]{_id}`,
         { prismaUserId: user.id }
     );
 
-    // If the user has no corresponding creator documents in Sanity, they have no content.
     if (!creatorDocs || creatorDocs.length === 0) {
         return (
              <div className="container page-container">
                 <h1 className="page-title">{user.name || 'Creator'}</h1>
-                <p style={{textAlign: 'center', color: 'var(--text-secondary)'}}>لم ينشر هذا المستخدم أي محتوى عام بعد.</p>
+                <p style={{textAlign: 'center', color: 'var(--text-secondary)'}}>لم يُرَ لهذا المستخدمِ أثرٌ بعد.</p>
                 <div style={{textAlign: 'center', marginTop: '2rem'}}>
-                    <Link href={`/profile/${user.username}`} className="primary-button">عرض الملف الشخصي للمستخدم</Link>
+                    <Link href={`/profile/${user.username}`} className="primary-button">ملف المستخدم</Link>
                 </div>
             </div>
         );
     }
     
-    // Extract the _id's into an array
     const creatorIds = creatorDocs.map(doc => doc._id);
-    
-    // Fetch all content that references any of these creator IDs
-    const allItems = await client.fetch(allContentByCreatorListQuery, { 
-        creatorIds: creatorIds
-    });
+    const allItems = await client.fetch(allContentByCreatorListQuery, { creatorIds });
 
     return (
         <HubPageClient
@@ -53,11 +77,9 @@ export default async function CreatorHubPage({ params }: { params: { username: s
             hubType="أعمال"
             headerAction={
                 <Link href={`/profile/${user.username}`} className="outline-button no-underline" style={{ backgroundColor: 'color-mix(in srgb, var(--bg-secondary) 80%, transparent)', backdropFilter: 'blur(4px)' }}>
-                    → عرض الملف الشخصي
+                    → الملف الشخصي
                 </Link>
             }
         />
     );
-}
-
-
+}
\ No newline at end of file
diff --git a/app/games/[slug]/page.tsx b/app/games/[slug]/page.tsx
index e9b3b01..0420f93 100644
--- a/app/games/[slug]/page.tsx
+++ b/app/games/[slug]/page.tsx
@@ -4,6 +4,18 @@ import { allContentByGameListQuery } from '@/lib/sanity.queries'; // Use LEAN qu
 import { notFound } from 'next/navigation';
 import HubPageClient from '@/components/HubPageClient';
 
+export async function generateStaticParams() {
+    try {
+        const slugs = await client.fetch<string[]>(`*[_type == "game" && defined(slug.current)][].slug.current`);
+        return slugs.map((slug) => ({
+            slug,
+        }));
+    } catch (error) {
+        console.error(`[BUILD ERROR] CRITICAL: Failed to fetch slugs for game hub pages. Build cannot continue.`, error);
+        throw error;
+    }
+}
+
 export default async function GameHubPage({ params }: { params: { slug: string } }) {
     const { slug } = await params;
     const gameSlug = decodeURIComponent(slug);
@@ -17,8 +29,19 @@ export default async function GameHubPage({ params }: { params: { slug: string }
         notFound();
     }
 
-    // MODIFIED: Using lean query for initial content load
     const allItems = await client.fetch(allContentByGameListQuery, { slug: gameSlug });
+    
+    // THE DEFINITIVE FIX: The check is now correctly placed *before* the HubPageClient is rendered.
+    if (!allItems || allItems.length === 0) {
+        return (
+             <div className="container page-container">
+                <h1 className="page-title">محور لعبة:&quot;{gameMeta.title}&quot;</h1>
+                <p style={{textAlign: 'center', color: 'var(--text-secondary)', fontSize: '1.8rem', maxWidth: '600px', margin: '0 auto'}}>
+                    لم يُخطَّ حرفٌ بعدُ عن هذه اللعبة. الأرشيفُ يترقب.
+                </p>
+            </div>
+        );
+    }
 
     return (
         <HubPageClient
@@ -27,6 +50,4 @@ export default async function GameHubPage({ params }: { params: { slug: string }
             hubType="اللعبة"
         />
     );
-}
-
-
+}
\ No newline at end of file
diff --git a/app/globals.css b/app/globals.css
index 51804b4..419a8a1 100644
--- a/app/globals.css
+++ b/app/globals.css
@@ -19,6 +19,10 @@
 --border-color:#2a2e3c;
 }
 *,*::before,*::after{box-sizing:border-box;margin:0;padding:0;}
+html, body {
+  width: 100%;
+  overflow-x: hidden;
+}
 html{
 font-size:62.5%;
 scroll-behavior:smooth;
@@ -35,7 +39,6 @@ color:var(--text-primary);
 font-family:var(--font-main), sans-serif;
 font-size:1.8rem;
 line-height:1.7;
-overflow-x:hidden;
 transition:background-color 0.3s ease,color 0.3s ease;
 }
 h1,h2,h3,h4,h5,h6{
@@ -64,7 +67,7 @@ position:absolute;width:1px;height:1px;padding:0;margin:-1px;
 overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border-width:0;
 }
 .page-container{padding-top:calc(var(--nav-height-scrolled) + 4rem);padding-bottom:6rem;min-height:80vh;}
-.page-title{font-size:4.8rem;font-weight:800;text-align:center;margin-bottom:4rem;color:var(--text-primary);}
+.page-title{font-size:4.8rem;font-weight:800;text-align:center;margin-bottom:4rem;color:var(--text-primary);overflow-wrap:break-word;word-break:break-word;}
 .content-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(320px,1fr));gap:3rem;grid-auto-rows:1fr;}
 
 .portable-text-content {
@@ -252,6 +255,18 @@ gap: 1rem;
   font-weight: 500;
 }
 
+.news-card-category {
+    display: inline-block;
+    background-color: color-mix(in srgb, var(--accent) 15%, transparent);
+    color: var(--accent);
+    padding: 0.4rem 1.2rem;
+    border-radius: 999px;
+    font-family: var(--font-main), sans-serif;
+    font-size: 1.4rem;
+    font-weight: 600;
+    border: 1px solid var(--accent);
+}
+
 /* --- FINAL UI POLISH FIXES --- */
 
 /* RTL Placeholder Text Alignment for Studio Inputs */
@@ -364,6 +379,10 @@ body.lightbox-active {
   }
   .toast-container-global { bottom: 1.5rem; left: 1.5rem; right: 1.5rem !important; width: auto; }
   .primary-button, .outline-button { padding: 1.2rem 2rem; font-size: 1.6rem; }
+  .news-card-category {
+    font-size: 1.2rem;
+    padding: 0.3rem 1rem;
+  }
 }
 
 @media (max-width: 480px) {
diff --git a/app/layout.tsx b/app/layout.tsx
index 913a0df..6d6ea3d 100644
--- a/app/layout.tsx
+++ b/app/layout.tsx
@@ -10,6 +10,7 @@ import ToastProvider from '@/components/ToastProvider';
 import UserStoreHydration from '@/components/UserStoreHydration';
 import Lightbox from '@/components/Lightbox';
 import ScrollToTopButton from '@/components/ui/ScrollToTopButton';
+import PageTransitionWrapper from '@/components/PageTransitionWrapper'; // <-- IMPORT
 
 const cairo = Cairo({
 subsets: ['arabic', 'latin'],
@@ -18,7 +19,7 @@ variable: '--font-main',
 weight: ['400', '500', '700', '800'],
 });
 
-export const metadata = { title: 'EternalGames | الألعاب أبدية', description: 'الألعاب أبدية.', };
+export const metadata = { title: 'EternalGames | حيث لا تفنى الألعاب', description: 'لا فناء للألعاب.', };
 
 export default function RootLayout({ children }: { children: React.ReactNode; }) {
 return (
@@ -40,11 +41,16 @@ return (
 <NextAuthProvider>
 <UserStoreHydration />
 <ThemeProvider attribute="data-theme" defaultTheme="system" enableSystem disableTransitionOnChange>
-<div style={{ maxWidth: '100vw', overflowX: 'hidden' }}>
+<div style={{ position: 'relative', width: '100%', overflowX: 'clip' }}>
     <ToastProvider />
     <Lightbox /> 
     <Navbar />
-    <main>{children}</main>
+    {/* MODIFIED: Wrap main content with the new transition wrapper */}
+    <main>
+        <PageTransitionWrapper>
+            {children}
+        </PageTransitionWrapper>
+    </main>
     <Footer />
     <StudioBar />
     <ScrollToTopButton />
@@ -54,6 +60,4 @@ return (
 </body>
 </html>
 );
-}
-
-
+}
\ No newline at end of file
diff --git a/app/lib/authOptions.ts b/app/lib/authOptions.ts
index 41da0e9..3f6d383 100644
--- a/app/lib/authOptions.ts
+++ b/app/lib/authOptions.ts
@@ -15,37 +15,37 @@ export const authOptions = {
             id: 'credentials',
             name: "Credentials",
             credentials: {
-                email: { label: "البريد الإلكتروني", type: "email" },
+                email: { label: "البريد", type: "email" },
                 password: { label: "كلمة السر", type: "password" },
                 returnTo: { label: "Return To", type: "text" },
             },
             async authorize(credentials) {
-                if (!credentials?.email || !credentials?.password) throw new Error("البيانات ناقصة.");
+                if (!credentials?.email || !credentials?.password) throw new Error("البياناتُ ناقصة.");
                 const user = await prisma.user.findUnique({ where: { email: credentials.email } });
                 if (!user) throw new Error("لا حساب بهذا البريد. تفضل بالتسجيل.");
-                if (!user.password) throw new Error("هذا الحساب مرتبط بمزود خارجي.");
+                if (!user.password) throw new Error("هذا الحساب مربوط بمزود خارجي.");
                 const isPasswordValid = await bcrypt.compare(credentials.password, user.password);
                 if (isPasswordValid) return user;
-                else throw new Error("كلمة السر غير صحيحة.");
+                else throw new Error("كلمة السر خاطئة.");
             }
         }),
         CredentialsProvider({
             id: 'signup',
             name: "SignUp",
             credentials: {
-                email: { label: "البريد الإلكتروني", type: "email" },
+                email: { label: "البريد", type: "email" },
                 password: { label: "كلمة السر", type: "password" },
                 returnTo: { label: "Return To", type: "text" },
             },
             async authorize(credentials) {
-                if (!credentials) throw new Error("Missing sign-up details.");
+                if (!credentials) throw new Error("تفاصيل التسجيل ناقصة.");
                 const { email, password } = credentials;
-                if (!email || !password) throw new Error("كافة الحقول إلزامية.");
+                if (!email || !password) throw new Error("الحقولُ كلُّها لازمة.");
                 if (!/\S+@\S+\.\S+/.test(email)) throw new Error('البريد الإلكتروني غير صالح.');
-                if (password.length < 8) throw new Error('يجب ألا تقل كلمة السر عن ثمانية أحرف.');
+                if (password.length < 8) throw new Error('كلمة السر لا تقل عن ثمانيةِ حروف.');
                 
                 const existingEmail = await prisma.user.findUnique({ where: { email } });
-                if (existingEmail) throw new Error('هذا البريد مسجل بالفعل.');
+                if (existingEmail) throw new Error('بريدٌ مسجل.');
 
                 const hashedPassword = await bcrypt.hash(credentials.password, 10);
                 const newUser = await prisma.user.create({
diff --git a/app/news/NewsPageClient.tsx b/app/news/NewsPageClient.tsx
index f65512d..2503493 100644
--- a/app/news/NewsPageClient.tsx
+++ b/app/news/NewsPageClient.tsx
@@ -25,72 +25,54 @@ export default function NewsPageClient({ heroArticles, initialGridArticles, allG
   allTags: SanityTag[];
 }) {
     const intersectionRef = useRef(null);
-    const isIntersecting = useInView(intersectionRef);
+    const isInView = useInView(intersectionRef, { margin: '400px' });
 
     const adaptedHeroArticles = useMemo(() => heroArticles.map(adaptToCardProps).filter(Boolean) as CardProps[], [heroArticles]);
+    
     const initialCards = useMemo(() => initialGridArticles.map(adaptToCardProps).filter(Boolean) as CardProps[], [initialGridArticles]);
-
-    const [newsItems, setNewsItems] = useState<CardProps[]>(initialCards);
+    const [allFetchedNews, setAllFetchedNews] = useState<CardProps[]>(initialCards);
     const [isLoading, setIsLoading] = useState(false);
     const [nextOffset, setNextOffset] = useState<number | null>(initialCards.length === 50 ? 50 : null);
-    const [isFeedExhausted, setIsFeedExhausted] = useState(initialCards.length < 50);
 
     const [searchTerm, setSearchTerm] = useState('');
     const [activeSort, setActiveSort] = useState<'latest' | 'viral'>('latest');
     const [selectedGame, setSelectedGame] = useState<SanityGame | null>(null);
     const [selectedTags, setSelectedTags] = useState<SanityTag[]>([]);
+    
+    const newsItems = useMemo(() => {
+        let items = [...allFetchedNews];
 
-    const currentFilters = useMemo(() => ({ searchTerm, activeSort, selectedGame, selectedTags }), [searchTerm, activeSort, selectedGame, selectedTags]);
-    const hasActiveFilters = !!searchTerm || !!selectedGame || selectedTags.length > 0 || activeSort !== 'latest';
-
-    useEffect(() => {
-        const filtersAreDefault = !hasActiveFilters;
-        if (filtersAreDefault) {
-            setNewsItems(initialCards);
-            setNextOffset(initialCards.length === 50 ? 50 : null);
-            setIsFeedExhausted(initialCards.length < 50);
-            return;
+        if (searchTerm) {
+            items = items.filter(news => news.title.toLowerCase().includes(searchTerm.toLowerCase()));
         }
+        if (selectedGame) {
+            items = items.filter(news => news.game === selectedGame.title);
+        }
+        if (selectedTags.length > 0) {
+            const selectedTagTitles = new Set(selectedTags.map(t => t.title));
+            items = items.filter(news => news.tags.some(t => selectedTagTitles.has(t.title)));
+        }
+        
+        return items;
+    }, [allFetchedNews, searchTerm, selectedGame, selectedTags]);
 
-        const fetchAndReplace = async () => {
-            setIsLoading(true);
-            setIsFeedExhausted(false);
-            const params = new URLSearchParams({ offset: '0', limit: '50' });
-            if (searchTerm) params.set('q', searchTerm);
-            if (activeSort !== 'latest') params.set('sort', activeSort);
-            if (selectedGame) params.set('game', selectedGame.slug);
-            if (selectedTags.length > 0) params.set('tags', selectedTags.map(t => t.slug).join(','));
-
-            try {
-                const result = await fetchNews(params);
-                setNewsItems(result.data);
-                setNextOffset(result.nextOffset);
-                if (!result.nextOffset) setIsFeedExhausted(true);
-            } catch (error) {
-                console.error("Filter change fetch failed:", error);
-            } finally {
-                setIsLoading(false);
-            }
-        };
+    const hasActiveFilters = useMemo(() => {
+        return !!searchTerm || !!selectedGame || selectedTags.length > 0 || activeSort !== 'latest';
+    }, [searchTerm, selectedGame, selectedTags, activeSort]);
 
-        fetchAndReplace();
-    }, [currentFilters, initialCards, hasActiveFilters]);
+    const canLoadMore = useMemo(() => {
+        return nextOffset !== null && !hasActiveFilters;
+    }, [nextOffset, hasActiveFilters]);
 
     useEffect(() => {
-        if (isIntersecting && nextOffset !== null && !isLoading) {
+        if (isInView && canLoadMore && !isLoading) {
             const loadMore = async () => {
                 setIsLoading(true);
-                const params = new URLSearchParams({ offset: String(nextOffset), limit: '50' });
-                if (searchTerm) params.set('q', searchTerm);
-                if (activeSort !== 'latest') params.set('sort', activeSort);
-                if (selectedGame) params.set('game', selectedGame.slug);
-                if (selectedTags.length > 0) params.set('tags', selectedTags.map(t => t.slug).join(','));
-
+                const params = new URLSearchParams({ offset: String(nextOffset), limit: '50', sort: activeSort });
                 try {
                     const result = await fetchNews(params);
-                    setNewsItems(prev => [...prev, ...result.data]);
+                    setAllFetchedNews(prev => [...prev, ...result.data]);
                     setNextOffset(result.nextOffset);
-                    if (!result.nextOffset) setIsFeedExhausted(true);
                 } catch (error) {
                     console.error("Failed to load more news:", error);
                 } finally {
@@ -99,7 +81,7 @@ export default function NewsPageClient({ heroArticles, initialGridArticles, allG
             };
             loadMore();
         }
-    }, [isIntersecting, nextOffset, isLoading, currentFilters]);
+    }, [isInView, canLoadMore, isLoading, nextOffset, activeSort]);
 
     const handleTagToggle = (tag: SanityTag) => {
         setSelectedTags(prev => prev.some(t => t._id === tag._id) ? prev.filter(t => t._id !== tag._id) : [...prev, tag]);
@@ -112,10 +94,10 @@ export default function NewsPageClient({ heroArticles, initialGridArticles, allG
     };
 
     return (
-        <div className="page-container">
+        <div style={{ paddingBottom: '6rem' }}>
             <NewsHero newsItems={adaptedHeroArticles} />
             <div className="container">
-                <ContentBlock title="أرشيف الأخبار">
+                <ContentBlock title="أرشيف الأنباء">
                     <NewsFilters 
                         activeSort={activeSort}
                         onSortChange={setActiveSort}
@@ -129,25 +111,29 @@ export default function NewsPageClient({ heroArticles, initialGridArticles, allG
                         onTagToggle={handleTagToggle}
                         onClearAll={handleClearAll}
                     />
-                    <NewsGrid news={newsItems} isLoading={isLoading} />
+                    <NewsGrid news={newsItems} />
+
+                    <div ref={intersectionRef} style={{ height: '1px', margin: '1rem 0' }} />
+
                     <AnimatePresence>
-                        {(isLoading && nextOffset !== null) && (
+                        {isLoading && (
                             <motion.div key="loading" style={{display: 'flex', justifyContent: 'center', padding: '4rem'}} initial={{ opacity: 0 }} animate={{ opacity: 1 }} exit={{ opacity: 0 }}>
                                 <div className="spinner" />
                             </motion.div>
                         )}
                     </AnimatePresence>
-                    <div ref={intersectionRef} style={{ height: '1px', margin: '1rem 0' }} />
+                    
                     <AnimatePresence>
-                        {(isFeedExhausted && newsItems.length > 0 && !isLoading) && (
+                        {(!isLoading && newsItems.length > 0 && (nextOffset === null || hasActiveFilters)) && (
                             <motion.p key="end" style={{textAlign: 'center', padding: '3rem 0', color: 'var(--text-secondary)'}} initial={{ opacity: 0 }} animate={{ opacity: 1 }} exit={{ opacity: 0 }}>
-                                وصلت إلى نهاية الأرشيف.
+                                {hasActiveFilters ? 'أزِل المرشحات للمزيد.' : 'بلغتَ المنتهى.'}
                             </motion.p>
                         )}
                     </AnimatePresence>
-                    {(!isLoading && newsItems.length === 0 && hasActiveFilters) && (
+
+                    {newsItems.length === 0 && !isLoading && (
                         <motion.p key="no-match" style={{textAlign: 'center', padding: '4rem 0', color: 'var(--text-secondary)'}} initial={{ opacity: 0 }} animate={{ opacity: 1 }}>
-                            لا توجد أخبار تطابق ما اخترت.
+                            لا أنباءَ توافقُ ما اخترت.
                         </motion.p>
                     )}
                 </ContentBlock>
diff --git a/app/news/page.tsx b/app/news/page.tsx
index 1bae69f..93c1d2e 100644
--- a/app/news/page.tsx
+++ b/app/news/page.tsx
@@ -6,24 +6,36 @@ import type { SanityNews, SanityGame, SanityTag } from '@/types/sanity';
 import NewsPageClient from './NewsPageClient';
 import { Suspense } from 'react';
 
-export const revalidate = 60;
-
 const allGamesQuery = groq`*[_type == "game"] | order(title asc) {_id, title, "slug": slug.current}`;
-const allNewsTagsQuery = groq`*[_type == "tag" && category == "News"] | order(title asc) {_id, title, "slug": slug.current}`;
+const allNewsTagsQuery = groq`*[_type == "tag" && category == "News"] | order(title asc) {_id, title, "slug": slug.current, category}`;
+
+// Helper function to remove duplicates based on title
+const deduplicateTags = (tags: SanityTag[]): SanityTag[] => {
+    if (!tags) return [];
+    const uniqueMap = new Map<string, SanityTag>();
+    tags.forEach(tag => {
+        if (tag && tag.title && !uniqueMap.has(tag.title)) {
+            uniqueMap.set(tag.title, tag);
+        }
+    });
+    return Array.from(uniqueMap.values());
+};
 
 export default async function NewsPage() {
-  const [heroNewsRaw, initialGridNewsRaw, allGames, allTags]: [SanityNews[], SanityNews[], SanityGame[], SanityTag[]] = await Promise.all([
+  const [heroNewsRaw, initialGridNewsRaw, allGames, allTagsRaw]: [SanityNews[], SanityNews[], SanityGame[], SanityTag[]] = await Promise.all([
     client.fetch(newsHeroQuery),
     client.fetch(newsGridInitialQuery),
     client.fetch(allGamesQuery),
     client.fetch(allNewsTagsQuery),
   ]);
 
+  const allTags = deduplicateTags(allTagsRaw);
+
   if (!heroNewsRaw || heroNewsRaw.length === 0) {
     return (
         <div className="container page-container">
             <h1 className="page-title">موجز الأنباء</h1>
-            <p style={{textAlign: 'center', color: 'var(--text-secondary)'}}>لا توجد أخبار حاليًا. سنعود بالجديد.</p>
+            <p style={{textAlign: 'center', color: 'var(--text-secondary)'}}>لا أنباءَ تُذكَر. سنوافيكم بالجديد.</p>
         </div>
     );
   }
diff --git a/app/page.tsx b/app/page.tsx
index f3c6e05..a6592f2 100644
--- a/app/page.tsx
+++ b/app/page.tsx
@@ -7,13 +7,11 @@ import DigitalAtriumHomePage from '@/components/DigitalAtriumHomePage';
 import { Suspense } from 'react';
 import AnimatedReleases from '@/components/AnimatedReleases';
 import prisma from '@/lib/prisma';
-import { SanityAuthor } from '@/types/sanity';
+import { SanityAuthor, SanityReview } from '@/types/sanity';
 import HomepageFeeds from '@/components/homepage/HomepageFeeds';
 import { adaptToCardProps } from '@/lib/adapters';
 import { CardProps } from '@/types';
 
-export const revalidate = 60;
-
 const getCachedEnrichedCreators = unstable_cache(
     async (creatorIds: string[]): Promise<[string, string | null][]> => {
         if (creatorIds.length === 0) return [];
@@ -29,7 +27,7 @@ const getCachedEnrichedCreators = unstable_cache(
         }
     },
     ['enriched-creators'],
-    { revalidate: 3600 }
+    { revalidate: 3600, tags: ['enriched-creators'] }
 );
 
 async function enrichCreators(creators: SanityAuthor[] | undefined): Promise<SanityAuthor[]> {
@@ -76,7 +74,7 @@ const getCachedEngagementScoresMap = unstable_cache(
         }
     },
     ['homepage-engagement-scores'],
-    { revalidate: 60 }
+    { revalidate: 60, tags: ['engagement-scores'] }
 );
 
 
@@ -101,6 +99,22 @@ export default async function HomePage() {
         getCachedEngagementScoresMap()
     ]);
 
+    // Reorder the reviews to place the highest-rated one first
+    if (reviews.length > 0) {
+        const topRatedIndex = reviews.reduce((topIndex: number, currentReview: SanityReview, currentIndex: number) => {
+            const topScore = reviews[topIndex].score ?? 0;
+            const currentScore = currentReview.score ?? 0;
+            // In case of a tie, the more recent one (already earlier in the array) wins
+            return currentScore > topScore ? currentIndex : topIndex;
+        }, 0);
+        
+        // Move the top-rated review to the front if it's not already there
+        if (topRatedIndex > 0) {
+            const [topRatedReview] = reviews.splice(topRatedIndex, 1);
+            reviews.unshift(topRatedReview);
+        }
+    }
+
     const scoresMap = new Map(scoresArray);
     
     const enrichedReviews = await Promise.all(
diff --git a/app/profile/ProfilePage.module.css b/app/profile/ProfilePage.module.css
index c7c73c0..8930875 100644
--- a/app/profile/ProfilePage.module.css
+++ b/app/profile/ProfilePage.module.css
@@ -29,4 +29,8 @@
 @keyframes glint{0%,100%{transform:scale(1)}50%{transform:scale(1.2) rotate(10deg);filter:brightness(1.5)}}
 .badgeItem:hover .badgeIconFOUNDER{animation:glint .7s ease-in-out}
 
-
+@media (max-width: 768px) {
+  .profileSidebar {
+    padding-top: 8rem; /* Nudge the content down on mobile to avoid navbar overlap */
+  }
+}
\ No newline at end of file
diff --git a/app/profile/[username]/page.tsx b/app/profile/[username]/page.tsx
index fac0e16..f74e857 100644
--- a/app/profile/[username]/page.tsx
+++ b/app/profile/[username]/page.tsx
@@ -6,17 +6,13 @@ import Image from 'next/image';
 import { getBadgesForUser } from '@/lib/badges';
 import Link from 'next/link';
 import styles from '../ProfilePage.module.css';
+import { client } from '@/lib/sanity.client';
+import { groq } from 'next-sanity';
 
 function hasCreatorRole(userRoles: string[]): boolean {
     return userRoles.some(role => ['REVIEWER', 'AUTHOR', 'REPORTER', 'DESIGNER'].includes(role));
 }
 
-function getCommentLink(comment: { contentSlug: string, content: string }) {
-    // Corrected logic for news path
-    const path = comment.contentSlug.startsWith('review-') ? 'reviews' : comment.contentSlug.startsWith('article-') ? 'articles' : 'news';
-    return ( <Link href={`/${path}/${comment.contentSlug}`} className="author-link">{comment.content.slice(0, 30)}...</Link> );
-}
-
 export default async function PublicProfilePage({ params }: { params: { username: string } }) {
     const { username: encodedUsername } = await params;
     const username = decodeURIComponent(encodedUsername);
@@ -32,6 +28,21 @@ export default async function PublicProfilePage({ params }: { params: { username
 
     if (!user) { notFound(); }
     
+    // 1. Extract content slugs from the user's recent comments.
+    const commentSlugs = user.comments.map(c => c.contentSlug);
+    
+    // 2. Fetch the titles for these slugs from Sanity.
+    let contentTitles: { slug: string, title: string }[] = [];
+    if (commentSlugs.length > 0) {
+        contentTitles = await client.fetch(
+            groq`*[_type in ["review", "article", "news"] && slug.current in $slugs]{ "slug": slug.current, title }`,
+            { slugs: commentSlugs }
+        );
+    }
+    
+    // 3. Create a lookup map for easy access (slug -> title).
+    const titleMap = new Map(contentTitles.map(item => [item.slug, item.title]));
+
     const arabicMonths = ["يناير", "فبراير", "مارس", "أبريل", "مايو", "يونيو", "يوليو", "أغسطس", "سبتمبر", "أكتوبر", "نوفمبر", "ديسمبر"];
     const englishMonths = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
     const joinDate = new Date(user.createdAt);
@@ -51,7 +62,7 @@ export default async function PublicProfilePage({ params }: { params: { username
                     <Image src={avatarSrc} alt={user.name || 'صورة المستخدم'} width={150} height={150} className={styles.profileAvatar} priority />
                     <h1 className={styles.profileName}>{user.name}</h1>
                     {user.username && <p className={styles.profileMeta} style={{color: 'var(--accent)'}}>@{user.username}</p>}
-                    <p className={styles.profileMeta}>عضو منذ {formattedJoinDate}</p>
+                    <p className={styles.profileMeta}>عضوٌ منذ {formattedJoinDate}</p>
                     
                     {user.username && hasCreatorRole(userRoles) && (
                          <Link href={`/creators/${user.username}`} className="primary-button" style={{marginTop: '2rem', display: 'block', textAlign: 'center'}}>
@@ -61,27 +72,33 @@ export default async function PublicProfilePage({ params }: { params: { username
                 </aside>
 
                 <main className={styles.profileMain}>
-                    {user.bio && ( <section className={styles.profileSection}> <h2 className={styles.profileSectionTitle}>حول</h2> <p style={{ fontSize: '1.8rem', lineHeight: 1.7 }}>{user.bio}</p> </section> )}
+                    {user.bio && ( <section className={styles.profileSection}> <h2 className={styles.profileSectionTitle}>عن</h2> <p style={{ fontSize: '1.8rem', lineHeight: 1.7 }}>{user.bio}</p> </section> )}
                     {earnedBadges.length > 0 && ( <section className={styles.profileSection}> <h2 className={styles.profileSectionTitle}>الأوسمة</h2> <div className={styles.badgeGrid}> {earnedBadges.map(badge => ( <div key={badge.id} title={badge.description} className={styles.badgeItem}> <badge.Icon className={`${styles.badgeIcon} ${styles[`badgeIcon${badge.id}`]}`} /> <span>{badge.name}</span> </div> ))} </div> </section> )}
                     <section className={styles.profileSection}>
-                        <h2 className={styles.profileSectionTitle}>النشاط الأخير</h2>
+                        <h2 className={styles.profileSectionTitle}>آخرُ نشاط</h2>
                         {user.comments.length > 0 ? (
                             <ul style={{listStyle: 'none', padding: 0, display: 'flex', flexDirection: 'column', gap: '2rem'}}>
-                                {user.comments.map(comment => (
-                                    <li key={comment.id}>
-                                        <p style={{margin: '0 0 0.5rem 0'}}>علّق على {getCommentLink(comment)}</p>
-                                        <blockquote style={{margin: 0, padding: '1rem', background: 'var(--bg-secondary)', borderRight: '3px solid var(--border-color)', borderLeft: 'none', borderRadius: '4px'}}>
-                                            &quot;{comment.content.slice(0, 150)}{comment.content.length > 150 ? '...' : ''}&quot;
-                                        </blockquote>
-                                    </li>
-                                ))}
+                                {user.comments.map(comment => {
+                                    const contentTitle = titleMap.get(comment.contentSlug) || 'تعليقٌ لم يعد متاحًا';
+                                    const path = comment.contentSlug.startsWith('review-') ? 'reviews' : comment.contentSlug.startsWith('article-') ? 'articles' : 'news';
+                                    const linkHref = `/${path}/${comment.contentSlug}`;
+
+                                    return (
+                                        <li key={comment.id}>
+                                            <p style={{margin: '0 0 0.5rem 0'}}>
+                                                علّق على <Link href={linkHref} className="creator-credit-link">{contentTitle}</Link>
+                                            </p>
+                                            <blockquote style={{margin: 0, padding: '1rem', background: 'var(--bg-secondary)', borderRight: '3px solid var(--border-color)', borderLeft: 'none', borderRadius: '4px'}}>
+                                                &quot;{comment.content.slice(0, 150)}{comment.content.length > 150 ? '...' : ''}&quot;
+                                            </blockquote>
+                                        </li>
+                                    );
+                                })}
                             </ul>
-                        ) : ( <p>{user.name} لم ينشر أي تعليقات بعد.</p> )}
+                        ) : ( <p>{user.name} لم يخطَّ تعليقًا بعد.</p> )}
                     </section>
                 </main>
             </div>
         </div>
     );
-}
-
-
+}
\ No newline at end of file
diff --git a/app/profile/bookmarks/page.tsx b/app/profile/bookmarks/page.tsx
index 0a8eb32..698ea62 100644
--- a/app/profile/bookmarks/page.tsx
+++ b/app/profile/bookmarks/page.tsx
@@ -7,13 +7,21 @@ import prisma from "@/lib/prisma";
 import { redirect } from "next/navigation";
 
 async function getBookmarkedContent() {
+    let session;
     try {
-        const session = await getAuthenticatedSession();
+        // This first block specifically handles authentication.
+        // If the user is not logged in, a redirect is the correct action.
+        session = await getAuthenticatedSession();
+    } catch (error) {
+        redirect('/api/auth/signin');
+    }
 
-        // THE FIX: Query the 'engagement' table and filter by type 'BOOKMARK'
+    try {
+        // This second block handles data fetching, which should be resilient.
+        // On failure, we log the error and return an empty array to the page.
         const bookmarks = await prisma.engagement.findMany({
             where: { userId: session.user.id, type: 'BOOKMARK' },
-            select: { contentId: true, contentType: true },
+            select: { contentId: true },
             orderBy: { createdAt: 'desc' }
         });
         
@@ -23,8 +31,8 @@ async function getBookmarkedContent() {
         const content = await client.fetch(contentByIdsQuery, { ids });
         return content;
     } catch (error) {
-        // This catch block is what was causing the redirect.
-        redirect('/');
+        console.error("Failed to fetch bookmarked content:", error);
+        return []; // Gracefully return an empty array on DB/CMS error.
     }
 }
 
@@ -37,9 +45,4 @@ export default async function BookmarksPage() {
             <BookmarksGrid initialItems={bookmarkedItems} />
         </div>
     );
-}
-
-
-
-
-
+}
\ No newline at end of file
diff --git a/app/profile/page.tsx b/app/profile/page.tsx
index 2b9d292..db1c707 100644
--- a/app/profile/page.tsx
+++ b/app/profile/page.tsx
@@ -25,7 +25,7 @@ export default async function ProfilePage() {
     return (
         <div className="container page-container">
             <h1 className="page-title">إعدادات الحساب</h1>
-            <ContentBlock title="تحرير بياناتك">
+            <ContentBlock title="تحرير البيانات">
                 <ProfileEditForm user={user} />
             </ContentBlock>
             
diff --git a/app/releases/ReleasePageClient.tsx b/app/releases/ReleasePageClient.tsx
index c15cf2c..146ec6d 100644
--- a/app/releases/ReleasePageClient.tsx
+++ b/app/releases/ReleasePageClient.tsx
@@ -8,9 +8,9 @@ import { motion, useInView, AnimatePresence } from 'framer-motion';
 import styles from './ReleasesPage.module.css';
 import filterStyles from '@/components/filters/Filters.module.css';
 
-type Platform = 'الكل' | 'PC' | 'PS5' | 'Xbox' | 'Switch';
-const PLATFORMS: Platform[] = ['الكل', 'PC', 'PS5', 'Xbox', 'Switch'];
-const PLATFORM_LABELS: Record<Platform, string> = { 'الكل': 'الكل', 'PC': 'PC', 'PS5': 'PS5', 'Xbox': 'Xbox', 'Switch': 'Switch' };
+type Platform = 'الكل' | 'PC' | 'PlayStation 5' | 'Xbox' | 'Switch';
+const PLATFORMS: Platform[] = ['الكل', 'PC', 'PlayStation 5', 'Xbox', 'Switch'];
+const PLATFORM_LABELS: Record<Platform, string> = { 'الكل': 'الكل', 'PC': 'PC', 'PlayStation 5': 'PlayStation 5', 'Xbox': 'Xbox', 'Switch': 'Switch' };
 
 const PlatformFilters = ({ activeFilter, onFilterChange }: { activeFilter: Platform, onFilterChange: (platform: Platform) => void }) => {
   const ref = useRef(null);
@@ -83,7 +83,7 @@ export default function ReleasePageClient({ releases }: { releases: SanityGameRe
   return (
     <div className={styles.chronoStreamLayoutWrapper}>
       <div className={styles.chronoContentWrapper}>
-          <h1 className="page-title">الإصدارات القادمة لسنة 2025</h1>
+          <h1 className="page-title">إصدارات 2025 المُرتقبة</h1>
           <PlatformFilters activeFilter={activeFilter} onFilterChange={setActiveFilter} />
       </div>
       <div ref={mainRef} className={styles.chronoTimelineSections} style={{ position: 'relative' }}>
diff --git a/app/releases/page.tsx b/app/releases/page.tsx
index cb7bfd8..4d50660 100644
--- a/app/releases/page.tsx
+++ b/app/releases/page.tsx
@@ -5,8 +5,6 @@ import { allReleasesQuery } from '@/lib/sanity.queries';
 import type { SanityGameRelease } from '@/types/sanity';
 import ReleasePageClient from './ReleasePageClient';
 
-export const revalidate = 60; // Revalidate every 60 seconds
-
 export default async function ReleasesPage() {
   const releases: SanityGameRelease[] = await client.fetch(allReleasesQuery);
 
@@ -19,22 +17,4 @@ export default async function ReleasesPage() {
       <ReleasePageClient releases={sanitizedReleases} />
     </div>
   );
-}
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
+}
\ No newline at end of file
diff --git a/app/reset-password/ResetPasswordClientPage.tsx b/app/reset-password/ResetPasswordClientPage.tsx
index 680649f..c7bd50a 100644
--- a/app/reset-password/ResetPasswordClientPage.tsx
+++ b/app/reset-password/ResetPasswordClientPage.tsx
@@ -63,7 +63,7 @@ export default function ResetPasswordClientPage() {
                     </div>
                     <div className="profile-form-group">
                         <input id="confirmPassword" type="password" value={confirmPassword} onChange={(e) => setConfirmPassword(e.target.value)} required className="profile-input" placeholder=" " />
-                        <label htmlFor="confirmPassword" className="profile-form-label">تأكيد كلمة السر الجديدة</label>
+                        <label htmlFor="confirmPassword" className="profile-form-label">تأكيد الجديدة</label>
                     </div>
                     
                     <AnimatePresence>
diff --git a/app/reviews/ReviewsPageClient.tsx b/app/reviews/ReviewsPageClient.tsx
index 4a0c8b9..4b40c05 100644
--- a/app/reviews/ReviewsPageClient.tsx
+++ b/app/reviews/ReviewsPageClient.tsx
@@ -6,13 +6,13 @@ import type { SanityReview, SanityGame, SanityTag } from '@/types/sanity';
 import { motion, AnimatePresence, useInView } from 'framer-motion';
 import Image from 'next/image';
 import Link from 'next/link';
-
 import ReviewFilters, { ScoreFilter } from '@/components/filters/ReviewFilters';
-import FilteredReviewsGrid from '@/components/FilteredReviewsGrid';
-import { ContentBlock } from '@/components/ContentBlock';
+import ArticleCard from '@/components/ArticleCard';
 import { adaptToCardProps } from '@/lib/adapters';
 import { CardProps } from '@/types';
 import styles from './ReviewsPage.module.css';
+import { useLayoutIdStore } from '@/lib/layoutIdStore';
+import { useRouter } from 'next/navigation';
 
 const fetchReviews = async (params: URLSearchParams) => {
     const res = await fetch(`/api/reviews?${params.toString()}`);
@@ -22,77 +22,68 @@ const fetchReviews = async (params: URLSearchParams) => {
 
 export default function ReviewsPageClient({ heroReview, initialGridReviews, allGames, allTags }: { heroReview: SanityReview, initialGridReviews: SanityReview[], allGames: SanityGame[], allTags: SanityTag[] }) {
     const intersectionRef = useRef(null);
-    const isIntersecting = useInView(intersectionRef);
+    const isInView = useInView(intersectionRef, { margin: '400px' });
+    const setPrefix = useLayoutIdStore((state) => state.setPrefix);
+    const router = useRouter();
 
     const initialCards = useMemo(() => initialGridReviews.map(adaptToCardProps).filter(Boolean) as CardProps[], [initialGridReviews]);
-    
-    const [reviews, setReviews] = useState<CardProps[]>(initialCards);
+    const [allFetchedReviews, setAllFetchedReviews] = useState<CardProps[]>(initialCards);
     const [isLoading, setIsLoading] = useState(false);
     const [nextOffset, setNextOffset] = useState<number | null>(initialCards.length === 20 ? 20 : null);
-    const [isFeedExhausted, setIsFeedExhausted] = useState(initialCards.length < 20);
-
-    // Replaced useUrlState with standard useState
+    
     const [searchTerm, setSearchTerm] = useState('');
     const [activeSort, setActiveSort] = useState<'latest' | 'score'>('latest');
     const [selectedScoreRange, setSelectedScoreRange] = useState<ScoreFilter>('All');
     const [selectedGame, setSelectedGame] = useState<SanityGame | null>(null);
     const [selectedTags, setSelectedTags] = useState<SanityTag[]>([]);
 
-    const currentFilters = useMemo(() => ({ searchTerm, activeSort, selectedScoreRange, selectedGame, selectedTags }), [searchTerm, activeSort, selectedScoreRange, selectedGame, selectedTags]);
-    const hasActiveFilters = searchTerm || activeSort !== 'latest' || selectedScoreRange !== 'All' || !!selectedGame || selectedTags.length > 0;
-
-    useEffect(() => {
-        const filtersAreDefault = !hasActiveFilters;
-        if (filtersAreDefault) {
-            setReviews(initialCards);
-            setNextOffset(initialCards.length === 20 ? 20 : null);
-            setIsFeedExhausted(initialCards.length < 20);
-            return;
+    const gridReviews = useMemo(() => {
+        let items = [...allFetchedReviews];
+        
+        if (searchTerm) {
+            items = items.filter(review => review.title.toLowerCase().includes(searchTerm.toLowerCase()));
+        }
+        if (selectedScoreRange !== 'All') {
+            const rangeMap = { '9-10': [9, 10], '8-8.9': [8, 8.9], '7-7.9': [7, 7.9], '<7': [0, 6.9] };
+            if (rangeMap[selectedScoreRange]) {
+                const [min, max] = rangeMap[selectedScoreRange];
+                items = items.filter(review => review.score! >= min && review.score! <= max);
+            }
+        }
+        if (selectedGame) {
+            items = items.filter(review => review.game === selectedGame.title);
+        }
+        if (selectedTags.length > 0) {
+            const selectedTagTitles = new Set(selectedTags.map(t => t.title));
+            items = items.filter(review => review.tags.some(t => selectedTagTitles.has(t.title)));
         }
 
-        const fetchAndReplace = async () => {
-            setIsLoading(true);
-            setIsFeedExhausted(false);
-            const params = new URLSearchParams({ offset: '0', limit: '20' });
-            if (searchTerm) params.set('q', searchTerm);
-            if (activeSort !== 'latest') params.set('sort', activeSort);
-            if (selectedScoreRange !== 'All') params.set('score', selectedScoreRange);
-            if (selectedGame) params.set('game', selectedGame.slug);
-            if (selectedTags.length > 0) params.set('tags', selectedTags.map(t => t.slug).join(','));
+        if (activeSort === 'score') {
+            items.sort((a, b) => (b.score || 0) - (a.score || 0));
+        }
 
-            try {
-                const result = await fetchReviews(params);
-                const uniqueNewItems = result.data.filter((item: CardProps) => item.id !== heroReview._id);
-                setReviews(uniqueNewItems);
-                setNextOffset(result.nextOffset);
-                if (!result.nextOffset) setIsFeedExhausted(true);
-            } catch (error) {
-                console.error("Filter change fetch failed:", error);
-            } finally {
-                setIsLoading(false);
-            }
-        };
+        return items;
+    }, [allFetchedReviews, searchTerm, activeSort, selectedScoreRange, selectedGame, selectedTags]);
+    
+    const hasActiveFilters = useMemo(() => {
+        return !!searchTerm || selectedScoreRange !== 'All' || !!selectedGame || selectedTags.length > 0 || activeSort !== 'latest';
+    }, [searchTerm, selectedScoreRange, selectedGame, selectedTags, activeSort]);
 
-        fetchAndReplace();
-    }, [currentFilters, initialCards, heroReview._id, hasActiveFilters]);
+    const canLoadMore = useMemo(() => {
+        return nextOffset !== null && !hasActiveFilters;
+    }, [nextOffset, hasActiveFilters]);
 
     useEffect(() => {
-        if (isIntersecting && nextOffset !== null && !isLoading) {
+        if (isInView && canLoadMore && !isLoading) {
             const loadMore = async () => {
                 setIsLoading(true);
-                const params = new URLSearchParams({ offset: String(nextOffset), limit: '20' });
-                if (searchTerm) params.set('q', searchTerm);
-                if (activeSort !== 'latest') params.set('sort', activeSort);
-                if (selectedScoreRange !== 'All') params.set('score', selectedScoreRange);
-                if (selectedGame) params.set('game', selectedGame.slug);
-                if (selectedTags.length > 0) params.set('tags', selectedTags.map(t => t.slug).join(','));
-
+                const params = new URLSearchParams({ offset: String(nextOffset), limit: '20', sort: activeSort });
+                if(selectedScoreRange !== 'All') params.set('score', selectedScoreRange);
                 try {
                     const result = await fetchReviews(params);
-                    setReviews(prev => [...prev, ...result.data]);
+                    setAllFetchedReviews(prev => [...prev, ...result.data]);
                     setNextOffset(result.nextOffset);
-                    if (!result.nextOffset) setIsFeedExhausted(true);
-                } catch (error) {
+                } catch (error) { 
                     console.error("Failed to load more reviews:", error);
                 } finally {
                     setIsLoading(false);
@@ -100,49 +91,80 @@ export default function ReviewsPageClient({ heroReview, initialGridReviews, allG
             };
             loadMore();
         }
-    }, [isIntersecting, nextOffset, isLoading, currentFilters]);
+    }, [isInView, canLoadMore, isLoading, nextOffset, activeSort, selectedScoreRange]);
 
     const handleTagToggle = (tag: SanityTag) => { setSelectedTags(prev => prev.some(t => t._id === tag._id) ? prev.filter(t => t._id !== tag._id) : [...prev, tag]); };
     const handleClearAll = () => { setSearchTerm(''); setSelectedScoreRange('All'); setSelectedGame(null); setSelectedTags([]); setActiveSort('latest'); };
 
+    const handleHeroClick = (e: React.MouseEvent) => {
+        e.preventDefault();
+        setPrefix('reviews-hero');
+        router.push(`/reviews/${heroReview.slug}`, { scroll: false });
+    };
+
     return (
         <>
-            <div className={styles.reviewHero}>
-                <Image src={heroReview.mainImage.url} alt={`Background for ${heroReview.title}`} fill className={styles.heroBg} style={{ objectFit: 'cover' }} priority placeholder='blur' blurDataURL={heroReview.mainImage.blurDataURL} />
+            <motion.div
+                layoutId={`reviews-hero-card-container-${heroReview.legacyId}`}
+                className={styles.reviewHero}
+                onClick={handleHeroClick}
+                style={{ cursor: 'pointer' }}
+            >
+                <motion.div layoutId={`reviews-hero-card-image-${heroReview.legacyId}`} className={styles.heroBg}>
+                    <Image src={heroReview.mainImage.url} alt={`Background for ${heroReview.title}`} fill style={{ objectFit: 'cover' }} priority placeholder='blur' blurDataURL={heroReview.mainImage.blurDataURL} />
+                </motion.div>
                 <div className={styles.heroOverlay} />
                 <motion.div className="container" style={{ display: 'flex', flexDirection: 'column', alignItems: 'center', gap: '1rem', zIndex: 5, color: '#fff', textAlign: 'center' }} initial={{opacity: 0, y: 20}} animate={{opacity: 1, y: 0}} transition={{duration: 0.5, delay: 0.2}}>
                     <p className={styles.heroCategory}>الأعلى تقييمًا</p>
                     <div className={styles.titleScoreWrapper}>
-                        <h1 className={styles.heroTitle}>{heroReview.title}</h1>
+                        <motion.h1 layoutId={`reviews-hero-card-title-${heroReview.legacyId}`} className={styles.heroTitle}>{heroReview.title}</motion.h1>
                         <span className={styles.heroScore}>{heroReview.score?.toFixed(1)}</span>
                     </div>
                     {heroReview.game?.title && (<span className={styles.heroGame}>{heroReview.game.title}</span>)}
-                    <Link href={`/reviews/${heroReview.slug}`} className="primary-button no-underline" style={{padding: '1rem 2.4rem', fontSize: '1.6rem'}}>اقرأ المراجعة</Link>
+                    <div className="primary-button no-underline" style={{padding: '1rem 2.4rem', fontSize: '1.6rem', pointerEvents: 'none'}}>اقرأ المراجعة</div>
                 </motion.div>
-            </div>
+            </motion.div>
             
             <div className="container" style={{paddingTop: '4rem'}}>
                 <ReviewFilters activeSort={activeSort} onSortChange={setActiveSort} selectedScoreRange={selectedScoreRange} onScoreSelect={setSelectedScoreRange} allGames={allGames} selectedGame={selectedGame} onGameSelect={setSelectedGame} allTags={allTags} selectedTags={selectedTags} onTagToggle={handleTagToggle} onClearAll={handleClearAll} searchTerm={searchTerm} onSearchChange={setSearchTerm} />
                 
-                <ContentBlock title="جميع المراجعات">
-                    <FilteredReviewsGrid reviews={reviews} />
+                <div style={{marginBottom: '6rem'}}>
+                    <h2 className="section-title" style={{textAlign: 'right', marginBottom: '3rem', fontSize: 'clamp(2.8rem, 4vw, 3.6rem)'}}>كلُّ المراجعات</h2>
+                    <motion.div layout className="content-grid">
+                        {gridReviews.map((review, index) => (
+                            <ArticleCard
+                                key={review.id}
+                                article={review}
+                                layoutIdPrefix="reviews"
+                                isPriority={index < 3}
+                            />
+                        ))}
+                    </motion.div>
+                    
+                    <div ref={intersectionRef} style={{ height: '1px', margin: '1rem 0' }} />
+
                     <AnimatePresence>
-                        {(isLoading && nextOffset !== null) && (
+                        {isLoading && (
                             <motion.div key="loading" style={{display: 'flex', justifyContent: 'center', padding: '4rem'}} initial={{ opacity: 0 }} animate={{ opacity: 1 }} exit={{ opacity: 0 }}>
                                 <div className="spinner" />
                             </motion.div>
                         )}
                     </AnimatePresence>
-                    <div ref={intersectionRef} style={{ height: '1px', margin: '1rem 0' }} />
+
                     <AnimatePresence>
-                        {(isFeedExhausted && reviews.length > 0 && !isLoading) && (
-                             <motion.p key="end" style={{textAlign: 'center', padding: '3rem 0', color: 'var(--text-secondary)'}} initial={{ opacity: 0 }} animate={{ opacity: 1 }} exit={{ opacity: 0 }}>وصلت إلى نهاية الأرشيف.</motion.p>
+                        {(!isLoading && gridReviews.length > 0 && (nextOffset === null || hasActiveFilters)) && (
+                             <motion.p key="end" style={{textAlign: 'center', padding: '3rem 0', color: 'var(--text-secondary)'}} initial={{ opacity: 0 }} animate={{ opacity: 1 }} exit={{ opacity: 0 }}>
+                                {hasActiveFilters ? 'أزِل المرشحات للمزيد.' : 'بلغتَ المنتهى.'}
+                             </motion.p>
                         )}
                     </AnimatePresence>
-                    {(!isLoading && reviews.length === 0 && hasActiveFilters) && (
-                        <motion.p key="no-match" style={{textAlign: 'center', padding: '4rem 0', color: 'var(--text-secondary)'}} initial={{ opacity: 0 }} animate={{ opacity: 1 }}>لا توجد مراجعات تطابق ما اخترت.</motion.p>
+
+                    {gridReviews.length === 0 && !isLoading && (
+                        <motion.p key="no-match" style={{textAlign: 'center', padding: '4rem 0', color: 'var(--text-secondary)'}} initial={{ opacity: 0 }} animate={{ opacity: 1 }}>
+                            لا مراجعات توافقُ ما اخترت.
+                        </motion.p>
                     )}
-                </ContentBlock>
+                </div>
             </div>
         </>
     );
diff --git a/app/reviews/page.tsx b/app/reviews/page.tsx
index b1ff524..6340fc1 100644
--- a/app/reviews/page.tsx
+++ b/app/reviews/page.tsx
@@ -6,8 +6,6 @@ import type { SanityReview, SanityGame, SanityTag } from '@/types/sanity';
 import ReviewsPageClient from './ReviewsPageClient';
 import { Suspense } from 'react';
 
-export const revalidate = 60;
-
 const allGamesQuery = groq`*[_type == "game"] | order(title asc) {_id, title, "slug": slug.current}`;
 const allTagsQuery = groq`*[_type == "tag" && category == "Game"] | order(title asc) {_id, title, "slug": slug.current}`;
 
@@ -23,7 +21,7 @@ export default async function ReviewsPage() {
     return (
       <div className="container page-container">
         <h1 className="page-title">المراجعات</h1>
-        <p style={{ textAlign: 'center', color: 'var(--text-secondary)' }}>لا توجد حاليًا أي مراجعات في الأرشيف. عد قريبًا.</p>
+        <p style={{ textAlign: 'center', color: 'var(--text-secondary)' }}>الأرشيفُ خالٍ من المراجعاتِ حاليًا. عُد قريبًا.</p>
       </div>
     );
   }
diff --git a/app/studio/ActionDrawer.tsx b/app/studio/ActionDrawer.tsx
index 37d0657..1717b2f 100644
--- a/app/studio/ActionDrawer.tsx
+++ b/app/studio/ActionDrawer.tsx
@@ -50,7 +50,7 @@ export function ActionDrawer({ item, onDelete }: { item: ContentCanvasItem, onDe
 
     const actions = [
         { label: 'تحرير', icon: <EditIcon />, href: studioEditUrl, isLink: true },
-        { label: 'Preview', icon: <PreviewIcon />, href: livePreviewUrl, isLink: true },
+        { label: 'معاينة', icon: <PreviewIcon />, href: livePreviewUrl, isLink: true },
         { label: 'حذف', icon: <DeleteIcon />, onClick: () => setDeleteModalOpen(true), isLink: false },
     ];
 
@@ -74,7 +74,7 @@ export function ActionDrawer({ item, onDelete }: { item: ContentCanvasItem, onDe
                     {actions.map((action) => (
                         <motion.div key={action.label} variants={itemVariants}>
                             {action.isLink ? (
-                                <Link href={action.href!} className={styles.actionDrawerButton} aria-label={action.label} target={action.label === 'Preview' ? '_blank' : '_self'}>
+                                <Link href={action.href!} className={styles.actionDrawerButton} aria-label={action.label} target={action.label === 'معاينة' ? '_blank' : '_self'}>
                                     {action.icon}
                                 </Link>
                             ) : (
@@ -88,6 +88,4 @@ export function ActionDrawer({ item, onDelete }: { item: ContentCanvasItem, onDe
             </motion.div>
         </>
     );
-}
-
-
+}
\ No newline at end of file
diff --git a/app/studio/DeleteConfirmationModal.tsx b/app/studio/DeleteConfirmationModal.tsx
index e153948..11912d0 100644
--- a/app/studio/DeleteConfirmationModal.tsx
+++ b/app/studio/DeleteConfirmationModal.tsx
@@ -3,7 +3,7 @@
 
 import { useState } from 'react';
 import { motion } from 'framer-motion';
-import Modal from '@/components/modals/Modal'; // <-- THE FIX: Import generic modal
+import Modal from '@/components/modals/Modal';
 import modalStyles from '@/components/modals/Modals.module.css';
 
 interface DeleteConfirmationModalProps {
@@ -26,7 +26,7 @@ export function DeleteConfirmationModal({ isOpen, onClose, onConfirm, itemName }
         <Modal isOpen={isOpen} onClose={onClose} style={{ padding: '2rem', maxWidth: '450px' }}>
             <h3 style={{ marginTop: 0, fontFamily: 'var(--font-main)', fontSize: '2rem' }}>تأكيد الحذف</h3>
             <p style={{ color: 'var(--text-secondary)', margin: '1rem 0 2rem 0' }}>
-                هل أنت متأكد من رغبتك في حذف <strong style={{ color: 'var(--text-primary)' }}>&quot;{itemName}&quot;</strong>? This action cannot be undone.
+                هل أنت متأكد من رغبتك في حذف <strong style={{ color: 'var(--text-primary)' }}>&quot;{itemName}&quot;</strong>? لا رجعةَ في هذا.
             </p>
             <div className={modalStyles.modalActions}>
                 <button onClick={onClose} className="outline-button" disabled={isPending}>إلغاء</button>
@@ -36,11 +36,9 @@ export function DeleteConfirmationModal({ isOpen, onClose, onConfirm, itemName }
                     style={{ backgroundColor: '#DC2626', boxShadow: 'none' }}
                     disabled={isPending}
                 >
-                    {isPending ? 'جار الحذف...' : 'حذف نهائي'}
+                    {isPending ? 'جارٍ الحذف...' : 'حذفٌ نهائي'}
                 </motion.button>
             </div>
         </Modal>
     );
-}
-
-
+}
\ No newline at end of file
diff --git a/app/studio/GenesisOrb.module.css b/app/studio/GenesisOrb.module.css
index 632660a..6ddfafd 100644
--- a/app/studio/GenesisOrb.module.css
+++ b/app/studio/GenesisOrb.module.css
@@ -4,8 +4,8 @@
   position: fixed;
   /* --- CUSTOMIZATION POINT (Desktop) --- */
   /* Adjust these values to change the orb's position on larger screens */
-  bottom: 1.5rem;
-  right: 1.5rem;
+  bottom: 2rem;
+  right: 2rem;
   /* --- END CUSTOMIZATION --- */
   left: auto;
   z-index: 10;
@@ -35,6 +35,12 @@
   justify-content: center; /* Horizontal alignment */
   /* --- END CUSTOMIZATION --- */
 }
+/* THE FIX: Added a rule to style the PlusIcon inside */
+.genesisOrb svg {
+    width: 32px;
+    height: 32px;
+    stroke-width: 3; /* Increased stroke width for better visibility */
+}
 [data-theme="dark"] .genesisOrb {
   color: var(--bg-primary);
 }
@@ -126,12 +132,18 @@
     .genesisContainer {
         /* --- CUSTOMIZATION POINT (Mobile) --- */
         /* Adjust these values for smaller screens */
-        bottom: 1rem;
-        right: 1rem;
+        bottom: 2rem;
+        right: 2rem;
         /* --- END CUSTOMIZATION --- */
         width: 64px;
         height: 64px;
     }
+    /* THE FIX: Adjusted the SVG size for mobile */
+    .genesisOrb svg {
+        width: 24px;
+        height: 24px;
+        stroke-width: 3;
+    }
     .satelliteWrapper {
         margin-left: -24px;
         margin-top: -24px;
diff --git a/app/studio/GenesisOrb.tsx b/app/studio/GenesisOrb.tsx
index a811f39..89fa68f 100644
--- a/app/studio/GenesisOrb.tsx
+++ b/app/studio/GenesisOrb.tsx
@@ -10,7 +10,8 @@ import { ReviewIcon, ArticleIcon, NewsIcon, ReleaseIcon } from '@/components/ico
 import { useToast } from '@/lib/toastStore';
 import styles from './GenesisOrb.module.css';
 
-const PlusIcon = () => ( <svg width="32" height="32" viewBox="0 0 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round"> <line x1="12" y1="5" x2="12" y2="19"></line> <line x1="5" y1="12" x2="19" y2="12"></line> </svg> );
+// THE FIX: Modified viewBox and paths to ensure perfect center alignment of the '+' sign.
+const PlusIcon = () => ( <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3" strokeLinecap="round" strokeLinejoin="round"> <line x1="12" y1="5" x2="12" y2="19"></line> <line x1="5" y1="12" x2="19" y2="12"></line> </svg> );
 
 const allContentTypes = [
     { type: 'review' as const, label: 'مراجعة جديدة', icon: <ReviewIcon />, requiredRole: 'REVIEWER' },
@@ -45,7 +46,7 @@ export function GenesisOrb() {
 
     const handleCreate = (contentType: 'review' | 'article' | 'news' | 'gameRelease') => {
         if (isPending) return;
-        if (!creationPermissions.has(contentType)) { toast.error("ليس لديك الصلاحية لإنشاء هذا المحتوى.", "left"); return; }
+        if (!creationPermissions.has(contentType)) { toast.error("ليس لكَ إذنُ الإنشاء.", "left"); return; }
         setIsOpen(false);
         startTransition(async () => {
             try {
@@ -54,7 +55,7 @@ export function GenesisOrb() {
                 const route = contentType === 'gameRelease' ? `/studio/releases/${newDraft._id}` : `/studio/${contentTypePlural}/${newDraft._id}`;
                 router.push(route);
             } catch (error: any) {
-                toast.error(error.message || "فشل إنشاء المسودة.", "left");
+                toast.error(error.message || "أخفق إنشاء المسودة.", "left");
             }
         });
     };
diff --git a/app/studio/StudioDashboard.tsx b/app/studio/StudioDashboard.tsx
index f60dbe8..a467bba 100644
--- a/app/studio/StudioDashboard.tsx
+++ b/app/studio/StudioDashboard.tsx
@@ -47,7 +47,7 @@ const ContentCanvas = ({ item, onDelete, isActive, onCardClick, isTouchDevice }:
         setIsHovered(false);
     };
 
-    const isDrawerVisible = isActive || isHovered;
+    const isDrawerVisible = isActive || (!isTouchDevice && isHovered);
 
     const imageUrlWithBuster = useMemo(() => {
         if (!item.mainImage?.asset) return null;
@@ -78,7 +78,7 @@ const ContentCanvas = ({ item, onDelete, isActive, onCardClick, isTouchDevice }:
                         style={{ objectFit: 'cover' }}
                         loader={sanityLoader}
                     />
-                ) : (<span style={{color: 'var(--text-secondary)', fontSize: '1.2rem', fontWeight: 600}}>NO IMAGE</span>)}
+                ) : (<span style={{color: 'var(--text-secondary)', fontSize: '1.2rem', fontWeight: 600}}>بلا صورة</span>)}
             </motion.div>
             <div style={{ position: 'absolute', inset: 0, background: 'linear-gradient(to top, rgba(0,0,0,0.8) 0%, transparent 60%)', pointerEvents: 'none' }} />
             <div style={{ position: 'absolute', bottom: 0, left: 0, padding: '1.25rem', color: 'white', pointerEvents: 'none' }}>
@@ -158,12 +158,12 @@ export function StudioDashboard({ initialContent, userRoles }: { initialContent:
     return (
         <>
             <header className={styles.studioHeader}>
-                <h1 className={`${styles.studioTitle} page-title`}>ديوان القيادة</h1>
+                <h1 className={`${styles.studioTitle} page-title`}>ديوان الصنعة</h1>
                 <p className={styles.studioSubtitle}>قُد دفّة محتواك في رحاب EternalGames.</p>
             </header>
 
             <div className={styles.searchWrapper}>
-                <input type="search" placeholder="ابحث في العناوين..." value={searchTerm} onChange={(e) => setSearchTerm(e.target.value)} className={`${styles.searchInput} profile-input`} />
+                <input type="search" placeholder="استنطق المحفوظات..." value={searchTerm} onChange={(e) => setSearchTerm(e.target.value)} className={`${styles.searchInput} profile-input`} />
             </div>
 
             {shouldShowTabs && (
@@ -185,7 +185,7 @@ export function StudioDashboard({ initialContent, userRoles }: { initialContent:
                     ))}
                 </AnimatePresence>
             </motion.div>
-            {filteredContent.length === 0 && <p style={{ textAlign: 'center', padding: '4rem 0', color: 'var(--text-secondary)'}}>لا يوجد محتوى.</p>}
+            {filteredContent.length === 0 && <p style={{ textAlign: 'center', padding: '4rem 0', color: 'var(--text-secondary)'}}>لا محتوى.</p>}
 
             <GenesisOrb />
         </>
diff --git a/app/studio/StudioIcons.tsx b/app/studio/StudioIcons.tsx
index 1c10f47..cde8140 100644
--- a/app/studio/StudioIcons.tsx
+++ b/app/studio/StudioIcons.tsx
@@ -13,9 +13,4 @@ export const ArticleIcon = () => ( <svg width="20" height="20" viewBox="0 0 24 2
 export const NewsIcon = () => ( <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"> <circle cx="12" cy="12" r="10"></circle> <line x1="2" y1="12" x2="22" y2="12"></line> <path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"></path> </svg> );
 export const EditIcon = () => ( <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"> <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path> <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path> </svg> );
 export const PreviewIcon = () => ( <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"> <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path> <circle cx="12" cy="12" r="3"></circle> </svg> );
-export const DeleteIcon = () => ( <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"> <polyline points="3 6 5 6 21 6"></polyline> <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path> <line x1="10" y1="11" x2="10" y2="17"></line> <line x1="14" y1="11" x2="14" y2="17"></line> </svg> );
-
-
-
-
-
+export const DeleteIcon = () => ( <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"> <polyline points="3 6 5 6 21 6"></polyline> <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path> <line x1="10" y1="11" x2="10" y2="17"></line> <line x1="14" y1="11" x2="14" y2="17"></line> </svg> );
\ No newline at end of file
diff --git a/app/studio/[contentType]/[id]/BlockToolbar.tsx b/app/studio/[contentType]/[id]/BlockToolbar.tsx
index 90c06de..cd0a9c5 100644
--- a/app/studio/[contentType]/[id]/BlockToolbar.tsx
+++ b/app/studio/[contentType]/[id]/BlockToolbar.tsx
@@ -57,8 +57,8 @@ export function BlockToolbar({ editor, onFileUpload, uploadQuality, onUploadQual
             exit={{ opacity: 0, y: 20 }}
             transition={{ type: 'spring' as const, stiffness: 300, damping: 25 }}
         >
-            <TooltipButton onClick={() => addBlock('image')} title="صورة واحدة" disabled={!editor}><SingleImageIcon /></TooltipButton>
-            <TooltipButton onClick={() => addBlock('imageCompare')} title="مقارنة صور" disabled={!editor}><CompareIcon /></TooltipButton>
+            <TooltipButton onClick={() => addBlock('image')} title="صورة مفردة" disabled={!editor}><SingleImageIcon /></TooltipButton>
+            <TooltipButton onClick={() => addBlock('imageCompare')} title="مضاهاة صورتين" disabled={!editor}><CompareIcon /></TooltipButton>
             <TooltipButton onClick={() => addBlock('twoImageGrid')} title="شبكة صورتين" disabled={!editor}><TwoImageIcon /></TooltipButton>
             <TooltipButton onClick={() => addBlock('fourImageGrid')} title="شبكة 4 صور" disabled={!editor}><FourImageIcon /></TooltipButton>
             <div style={{ width: '1px', height: '24px', backgroundColor: 'var(--border-color)', margin: '0 0.4rem' }} />
diff --git a/app/studio/[contentType]/[id]/EditorCanvas.tsx b/app/studio/[contentType]/[id]/EditorCanvas.tsx
index 2c627e0..5db78fb 100644
--- a/app/studio/[contentType]/[id]/EditorCanvas.tsx
+++ b/app/studio/[contentType]/[id]/EditorCanvas.tsx
@@ -16,12 +16,12 @@ export function EditorCanvas({ document, title, onTitleChange, onEditorCreated,
     return (
         <motion.div className={styles.sanctumCanvas} style={{position: 'relative'}} transition={{ duration: 0.5, ease: [0.4, 0, 0.2, 1] }}>
             <div className={styles.canvasContent}>
-                <input type="text" value={title} onChange={(e) => onTitleChange(e.target.value)} placeholder="إصدار غير معنون" className={styles.canvasTitleInput} />
+                <input type="text" value={title} onChange={(e) => onTitleChange(e.target.value)} placeholder="إصدارٌ بلا عنوان" className={styles.canvasTitleInput} />
                 
                 <div className={styles.canvasEditorWrapper}>
                     {isRelease ? (
                         <div style={{ minHeight: '300px', display: 'flex', alignItems: 'center', justifyContent: 'center', color: 'var(--text-secondary)', textAlign: 'center' }}>
-                            <p>لا يوجد محتوى نصي للإصدارات.<br />يتم تحرير جميع البيانات من الشريط الجانبي.</p>
+                            <p>لا نصَّ للإصدارات.<br />تُحرَّرُ البياناتُ من الشريط الجانبي.</p>
                         </div>
                     ) : (
                         <RichTextEditor onEditorCreated={onEditorCreated} initialContent={document.tiptapContent} />
diff --git a/app/studio/[contentType]/[id]/EditorClient.tsx b/app/studio/[contentType]/[id]/EditorClient.tsx
index b77a635..e72afe2 100644
--- a/app/studio/[contentType]/[id]/EditorClient.tsx
+++ b/app/studio/[contentType]/[id]/EditorClient.tsx
@@ -20,16 +20,16 @@ import { useEditorStore } from '@/lib/editorStore';
 import styles from './Editor.module.css';
 
 type EditorDocument = {
-    _id: string; _type: string; _updatedAt: string; title: string; slug?: { current: string }; score?: number; verdict?: string; pros?: string[]; cons?: string[]; game?: { _id: string; title: string } | null; publishedAt?: string | null; mainImage?: { _ref: string | null; url: string | null; metadata?: any }; authors?: any[]; reporters?: any[]; designers?: any[]; tags?: any[]; releaseDate?: string; platforms?: string[]; synopsis?: string; tiptapContent?: any; content?: any;
+    _id: string; _type: string; _updatedAt: string; title: string; slug?: { current: string }; score?: number; verdict?: string; pros?: string[]; cons?: string[]; game?: { _id: string; title: string } | null; publishedAt?: string | null; mainImage?: { _ref: string | null; url: string | null; metadata?: any }; authors?: any[]; reporters?: any[]; designers?: any[]; tags?: any[]; releaseDate?: string; platforms?: string[]; synopsis?: string; tiptapContent?: any; content?: any; category?: { _id: string; title: string } | null;
 };
 
-// ... (reducer, generateDiffPatch, etc. remain the same) ...
 const clientSlugify = (text: string): string => { if (!text) return ''; return text.toLowerCase().trim().replace(/[^a-z0-9\s-]/g, '').replace(/[\s-]+/g, '-'); };
-const initialState = { _id: null, _type: null, title: '', slug: '', score: 0, verdict: '', pros: [], cons: [], game: null, tags: [], mainImage: { assetId: null, assetUrl: null }, authors: [], reporters: [], designers: [], publishedAt: null, isSlugManual: false, releaseDate: '', platforms: [], synopsis: '' };
+
+const initialState = { _id: null, _type: null, title: '', slug: '', score: 0, verdict: '', pros: [], cons: [], game: null, tags: [], mainImage: { assetId: null, assetUrl: null }, authors: [], reporters: [], designers: [], publishedAt: null, isSlugManual: false, releaseDate: '', platforms: [], synopsis: '', category: null };
 
 function editorReducer(state: any, action: { type: string; payload: any }) {
     switch (action.type) {
-        case 'INITIALIZE_STATE': return { ...action.payload, isSlugManual: !!action.payload.slug, };
+        case 'INITIALIZE_STATE': return { ...state, ...action.payload, isSlugManual: !!action.payload.slug, };
         case 'UPDATE_FIELD': return { ...state, [action.payload.field]: action.payload.value };
         case 'UPDATE_SLUG': return { ...state, slug: clientSlugify(action.payload.slug), isManual: action.payload.isManual };
         default: throw new Error(`Unhandled action type: ${action.type}`);
@@ -46,6 +46,13 @@ const generateDiffPatch = (currentState: any, sourceOfTruth: any, editorContentJ
     if (normalize(currentState.verdict, '') !== normalize(sourceOfTruth.verdict, '')) patch.verdict = currentState.verdict;
     if (normalize(currentState.releaseDate, '') !== normalize(sourceOfTruth.releaseDate, '')) patch.releaseDate = currentState.releaseDate;
     if (normalize(currentState.synopsis, '') !== normalize(sourceOfTruth.synopsis, '')) patch.synopsis = currentState.synopsis;
+    // --- THE FIX ---
+    // Compare category by its reference _id to correctly detect changes.
+    // Set the patch value to a Sanity reference object or unset it.
+    if (normalize(currentState.category?._id, null) !== normalize(sourceOfTruth.category?._id, null)) {
+        patch.category = currentState.category ? { _type: 'reference', _ref: currentState.category._id } : undefined;
+    }
+    // --- END FIX ---
     if (JSON.stringify(normalize(currentState.pros, [])) !== JSON.stringify(normalize(sourceOfTruth.pros, []))) patch.pros = currentState.pros;
     if (JSON.stringify(normalize(currentState.cons, [])) !== JSON.stringify(normalize(sourceOfTruth.cons, []))) patch.cons = currentState.cons;
     if (JSON.stringify(normalize(currentState.platforms, [])) !== JSON.stringify(normalize(sourceOfTruth.platforms, []))) patch.platforms = currentState.platforms;
@@ -72,7 +79,7 @@ export function EditorClient({ document: initialDocument, allGames, allTags, all
     const [mainImageUploadQuality, setMainImageUploadQuality] = useState<UploadQuality>('1080p');
     const { blockUploadQuality, setBlockUploadQuality, setEditorActive, setLiveUrl } = useEditorStore();
     const [slugValidationStatus, setSlugValidationStatus] = useState<'pending' | 'valid' | 'invalid'>('pending');
-    const [slugValidationMessage, setSlugValidationMessage] = useState('جار التحقق...');
+    const [slugValidationMessage, setSlugValidationMessage] = useState('جارٍ التحقق...');
     const debouncedSlug = useDebounce(slug, 500);
     const [editorContentJson, setEditorContentJson] = useState(JSON.stringify(initialDocument.tiptapContent || {}));
     
@@ -82,7 +89,7 @@ export function EditorClient({ document: initialDocument, allGames, allTags, all
         setEditorActive(true);
         return () => {
             setEditorActive(false);
-            setLiveUrl(null); // Clean up on unmount
+            setLiveUrl(null);
         };
     }, [setEditorActive, setLiveUrl]);
 
@@ -116,14 +123,14 @@ export function EditorClient({ document: initialDocument, allGames, allTags, all
     const patch = useMemo(() => generateDiffPatch(state, sourceOfTruth, editorContentJson), [state, sourceOfTruth, editorContentJson]);
     const hasChanges = Object.keys(patch).length > 0;
     useEffect(() => { if (editorInstance) editorInstance.storage.uploadQuality = blockUploadQuality; }, [blockUploadQuality, editorInstance]);
-    useEffect(() => { dispatch({ type: 'INITIALIZE_STATE', payload: { _id: sourceOfTruth._id, _type: sourceOfTruth._type, title: sourceOfTruth.title ?? '', slug: sourceOfTruth.slug?.current ?? '', score: sourceOfTruth.score ?? 0, verdict: sourceOfTruth.verdict ?? '', pros: sourceOfTruth.pros ?? [], cons: sourceOfTruth.cons ?? [], game: sourceOfTruth.game || null, publishedAt: sourceOfTruth.publishedAt || null, mainImage: { assetId: sourceOfTruth.mainImage?._ref || null, assetUrl: sourceOfTruth.mainImage?.url || null }, authors: (sourceOfTruth.authors || []).filter(Boolean), reporters: (sourceOfTruth.reporters || []).filter(Boolean), designers: (sourceOfTruth.designers || []).filter(Boolean), tags: (sourceOfTruth.tags || []).filter(Boolean), releaseDate: sourceOfTruth.releaseDate || '', platforms: sourceOfTruth.platforms || [], synopsis: sourceOfTruth.synopsis || '', } }); const imageWidth = sourceOfTruth?.mainImage?.metadata?.dimensions?.width; if (imageWidth && imageWidth >= 3840) { setMainImageUploadQuality('4k'); } else { setMainImageUploadQuality('1080p'); } if (editorInstance) { const editorJSON = JSON.stringify(editorInstance.getJSON()); const sourceJSON = JSON.stringify(sourceOfTruth.tiptapContent || {}); if (editorJSON !== sourceJSON) { editorInstance.commands.setContent(sourceOfTruth.tiptapContent, false); } } }, [sourceOfTruth._id, sourceOfTruth._updatedAt, editorInstance]);
+    useEffect(() => { dispatch({ type: 'INITIALIZE_STATE', payload: { _id: sourceOfTruth._id, _type: sourceOfTruth._type, title: sourceOfTruth.title ?? '', slug: sourceOfTruth.slug?.current ?? '', score: sourceOfTruth.score ?? 0, verdict: sourceOfTruth.verdict ?? '', pros: sourceOfTruth.pros ?? [], cons: sourceOfTruth.cons ?? [], game: sourceOfTruth.game || null, publishedAt: sourceOfTruth.publishedAt || null, mainImage: { assetId: sourceOfTruth.mainImage?._ref || null, assetUrl: sourceOfTruth.mainImage?.url || null }, authors: (sourceOfTruth.authors || []).filter(Boolean), reporters: (sourceOfTruth.reporters || []).filter(Boolean), designers: (sourceOfTruth.designers || []).filter(Boolean), tags: (sourceOfTruth.tags || []).filter(Boolean), releaseDate: sourceOfTruth.releaseDate || '', platforms: sourceOfTruth.platforms || [], synopsis: sourceOfTruth.synopsis || '', category: sourceOfTruth.category || null, } }); const imageWidth = sourceOfTruth?.mainImage?.metadata?.dimensions?.width; if (imageWidth && imageWidth >= 3840) { setMainImageUploadQuality('4k'); } else { setMainImageUploadQuality('1080p'); } if (editorInstance) { const editorJSON = JSON.stringify(editorInstance.getJSON()); const sourceJSON = JSON.stringify(sourceOfTruth.tiptapContent || {}); if (editorJSON !== sourceJSON) { editorInstance.commands.setContent(sourceOfTruth.tiptapContent, false); } } }, [sourceOfTruth._id, sourceOfTruth._updatedAt, editorInstance]);
     useEffect(() => { if (editorInstance) { const updateJson = () => setEditorContentJson(JSON.stringify(editorInstance.getJSON())); editorInstance.on('update', updateJson); return () => { editorInstance.off('update', updateJson); }; } }, [editorInstance]);
     useEffect(() => { if (!isSlugManual && title !== sourceOfTruth.title) { dispatch({ type: 'UPDATE_SLUG', payload: { slug: clientSlugify(title), isManual: false } }); } }, [title, isSlugManual, sourceOfTruth.title]);
-    useEffect(() => { if (!state._id || !debouncedSlug) { setSlugValidationStatus('invalid'); setSlugValidationMessage(!state._id ? 'Waiting for document ID...' : 'المُعرّف لا يمكن أن يكون فارغًا.'); return; } setSlugValidationStatus('pending'); setSlugValidationMessage('جار التحقق...'); const checkSlug = async () => { const result = await validateSlugAction(debouncedSlug, state._id); setSlugValidationStatus(result.isValid ? 'valid' : 'invalid'); setSlugValidationMessage(result.message); }; checkSlug(); }, [debouncedSlug, state._id]);
-    const isDocumentValid = useMemo(() => { const { title, slug, mainImage, game, score, verdict, authors, reporters, releaseDate, platforms, synopsis } = state; const baseValid = title.trim() && slug.trim() && mainImage.assetId; if (!baseValid) return false; const type = sourceOfTruth._type; if (type === 'review') return game?._id && (authors || []).length > 0 && score > 0 && verdict.trim(); if (type === 'article') return game?._id && (authors || []).length > 0; if (type === 'news') return (reporters || []).length > 0; if (type === 'gameRelease') return releaseDate.trim() && synopsis.trim() && (platforms || []).length > 0; return false; }, [state, sourceOfTruth._type]);
-    const saveWorkingCopy = async (): Promise<boolean> => { if (!hasChanges) return true; if (slugValidationStatus !== 'valid') { toast.error('لا يمكن الحفظ بمُعرّف غير صالح.', 'left'); return false; } const result = await updateDocumentAction(sourceOfTruth._id, patch); if (result.success && result.updatedDocument) { setSourceOfTruth(result.updatedDocument); return true; } else { toast.error(result.message || 'فشل حفظ التغييرات.', 'left'); return false; } };
-    const handlePublish = async (publishTime?: string | null): Promise<boolean> => { const didSave = await saveWorkingCopy(); if (!didSave) { if (hasChanges) toast.error('يرجى حفظ التغييرات أولاً.', 'left'); return false; } const result = await publishDocumentAction(sourceOfTruth._id, publishTime); if (result.success && result.updatedDocument) { setSourceOfTruth(result.updatedDocument); toast.success(result.message || 'تم تحديث حالة النشر بنجاح!', 'left'); return true; } else { toast.error(result.message || 'فشل تحديث حالة النشر.', 'left'); return false; } };
-    useEffect(() => { if (hasChanges) { document.title = `*غير محفوظ* ${title || 'غير معنون'}`; window.onbeforeunload = () => "You have unsaved changes. Are you sure you want to leave?"; } else { document.title = title || "EternalGames الديوان"; window.onbeforeunload = null; } return () => { window.onbeforeunload = null; }; }, [hasChanges, title]);
+    useEffect(() => { if (!state._id || !debouncedSlug) { setSlugValidationStatus('invalid'); setSlugValidationMessage(!state._id ? 'بانتظار مُعرِّف الوثيقة...' : 'لا يكُن المُعرِّفُ خاويًا.'); return; } setSlugValidationStatus('pending'); setSlugValidationMessage('جارٍ التحقق...'); const checkSlug = async () => { const result = await validateSlugAction(debouncedSlug, state._id); setSlugValidationStatus(result.isValid ? 'valid' : 'invalid'); setSlugValidationMessage(result.message); }; checkSlug(); }, [debouncedSlug, state._id]);
+    const isDocumentValid = useMemo(() => { const { title, slug, mainImage, game, score, verdict, authors, reporters, releaseDate, platforms, synopsis, category } = state; const baseValid = title.trim() && slug.trim() && mainImage.assetId; if (!baseValid) return false; const type = sourceOfTruth._type; if (type === 'review') return game?._id && (authors || []).length > 0 && score > 0 && verdict.trim(); if (type === 'article') return game?._id && (authors || []).length > 0; if (type === 'news') return (reporters || []).length > 0 && category; if (type === 'gameRelease') return game?._id && releaseDate.trim() && synopsis.trim() && (platforms || []).length > 0; return false; }, [state, sourceOfTruth._type]);
+    const saveWorkingCopy = async (): Promise<boolean> => { if (!hasChanges) return true; if (slugValidationStatus !== 'valid') { toast.error('لا يمكن الحفظ بمُعرِّف غير صالح.', 'left'); return false; } const result = await updateDocumentAction(sourceOfTruth._id, patch); if (result.success && result.updatedDocument) { setSourceOfTruth(result.updatedDocument); return true; } else { toast.error(result.message || 'أخفق حفظ التغييرات.', 'left'); return false; } };
+    const handlePublish = async (publishTime?: string | null): Promise<boolean> => { const didSave = await saveWorkingCopy(); if (!didSave) { if (hasChanges) toast.error('احفظ التغييرات أولاً.', 'left'); return false; } const result = await publishDocumentAction(sourceOfTruth._id, publishTime); if (result.success && result.updatedDocument) { setSourceOfTruth(result.updatedDocument); toast.success(result.message || 'تجددت حالة النشر!', 'left'); return true; } else { toast.error(result.message || 'أخفق تحديث الحالة.', 'left'); return false; } };
+    useEffect(() => { if (hasChanges) { document.title = `*لم يُحفظ* ${title || 'بلا عنوان'}`; window.onbeforeunload = () => "أَتَغادرُ وما كتبت لم يُحفظ؟"; } else { document.title = title || "EternalGames الديوان"; window.onbeforeunload = null; } return () => { window.onbeforeunload = null; }; }, [hasChanges, title]);
     useEffect(() => { document.body.classList.add('editor-active'); return () => { document.body.classList.remove('editor-active'); } }, []);
     
     const isRelease = initialDocument._type === 'gameRelease';
diff --git a/app/studio/[contentType]/[id]/EditorSidebar.tsx b/app/studio/[contentType]/[id]/EditorSidebar.tsx
index 78b6d19..8439e7d 100644
--- a/app/studio/[contentType]/[id]/EditorSidebar.tsx
+++ b/app/studio/[contentType]/[id]/EditorSidebar.tsx
@@ -1,8 +1,8 @@
-// components/studio/[contentType]/[id/EditorSidebar.tsx
+// components/studio/[contentType]/[id/EditorSidebar.tsx]
 'use client';
 
 import { motion, AnimatePresence } from 'framer-motion';
-import { useState, useMemo, useTransition } from 'react';
+import { useState, useMemo, useTransition, useCallback } from 'react';
 import ButtonLoader from '@/components/ui/ButtonLoader';
 import { ProsConsInput } from './metadata/ProsConsInput';
 import { GameInput } from './metadata/GameInput';
@@ -13,11 +13,14 @@ import { PlatformInput } from './metadata/PlatformInput';
 import { UploadQuality } from '@/lib/image-optimizer';
 import styles from './Editor.module.css';
 
+type Tag = { _id: string; title: string; category: 'Game' | 'Article' | 'News' };
+
 const sidebarVariants = { hidden: { opacity: 0, x: 50 }, visible: { opacity: 1, x: 0, transition: { type: 'spring' as const, stiffness: 400, damping: 40 } }, exit: { opacity: 0, x: 50, transition: { duration: 0.2, ease: 'easeInOut' as const } } };
 const itemVariants = { hidden: { opacity: 0, y: 10 }, visible: { opacity: 1, y: 0 } };
-const AlertIcon = () => <svg width="18" height="18" viewBox="0 0 24" fill="none" stroke="#DC2626" strokeWidth="2.5"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path><line x1="12" y1="9" x2="12" y2="13"></line><line x1="12" y1="17" x2="12.01" y2="17"></line></svg>;
-const CheckIcon = () => <svg width="18" height="18" viewBox="0 0 24" fill="none" stroke="#16A34A" strokeWidth="2.5"><polyline points="20 6 9 17 4 12"></polyline></svg>;
-const ClockIcon = () => <svg width="18" height="18" viewBox="0 0 24" fill="none" stroke="var(--text-secondary)" strokeWidth="2.5"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg>;
+// THE FIX: The size of these icons has been permanently reduced to 16x16
+const AlertIcon = () => <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#DC2626" strokeWidth="2.5"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path><line x1="12" y1="9" x2="12" y2="13"></line><line x1="12" y1="17" x2="12.01" y2="17"></line></svg>;
+const CheckIcon = () => <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#16A34A" strokeWidth="2.5"><polyline points="20 6 9 17 4 12"></polyline></svg>;
+const ClockIcon = () => <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="var(--text-secondary)" strokeWidth="2.5"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg>;
 const ToggleSwitch = ({ checked, onChange, name }: { checked: boolean, onChange: (checked: boolean) => void, name?: string }) => ( <button type="button" role="switch" aria-checked={checked} onClick={() => onChange(!checked)} className={`toggle ${checked ? 'active' : ''}`}> <motion.div className="toggle-handle" layout transition={{ type: 'spring' as const, stiffness: 700, damping: 30 }} /> {name && <input type="checkbox" name={name} checked={checked} readOnly style={{ display: 'none' }} />} </button> );
 
 export function EditorSidebar({ 
@@ -26,7 +29,7 @@ export function EditorSidebar({
     mainImageUploadQuality, onMainImageUploadQualityChange,
     allGames, allTags, allCreators
 }: any) {
-    const { title, slug, score, verdict, pros, cons, game, tags, publishedAt, mainImage, authors, reporters, designers, releaseDate, platforms, synopsis } = documentState;
+    const { title, slug, score, verdict, pros, cons, game, tags, publishedAt, mainImage, authors, reporters, designers, releaseDate, platforms, synopsis, category } = documentState;
     const [scheduledDateTime, setScheduledDateTime] = useState('');
     const [isSaving, startSaveTransition] = useTransition();
     const [isPublishing, startPublishTransition] = useTransition();
@@ -44,6 +47,20 @@ export function EditorSidebar({
         return { label: 'المنشئون', sanityType: 'author', field: 'authors' };
     }, [isReview, isArticle, isNews]);
 
+    // --- De-duplication logic with CORRECTED TYPING ---
+    const getUniqueTagsByCategory = useCallback((categoryToFilter: 'Game' | 'Article' | 'News'): Tag[] => {
+        if (!allTags) return [];
+        const filtered = allTags.filter((t: any) => t && t.category === categoryToFilter);
+        // Explicitly type the Map to ensure correct inference for .values()
+        const uniqueMap = new Map<string, Tag>(filtered.map((item: any) => [item.title, item]));
+        return Array.from(uniqueMap.values());
+    }, [allTags]);
+
+    const uniqueNewsCategories = useMemo(() => getUniqueTagsByCategory('News'), [getUniqueTagsByCategory]);
+    const uniqueArticleCategories = useMemo(() => getUniqueTagsByCategory('Article'), [getUniqueTagsByCategory]);
+    const uniqueGameTags = useMemo(() => getUniqueTagsByCategory('Game'), [getUniqueTagsByCategory]);
+    // --- END FIX ---
+
     const handleSave = () => { startSaveTransition(async () => { setSaveStatus('saving'); const success = await onSave(); setSaveStatus(success ? 'success' : 'idle'); if(success) setTimeout(() => setSaveStatus('idle'), 2000); }); };
     
     const isPublished = !document._id.startsWith('drafts.');
@@ -71,8 +88,8 @@ export function EditorSidebar({
                     
                     <motion.div className={styles.sidebarSection} variants={itemVariants}>
                         {!isRelease && ( <> <label className={styles.sidebarLabel} style={{ marginBottom: '0.75rem' }}>جدولة (اختياري)</label> <input type="datetime-local" value={scheduledDateTime} onChange={(e) => setScheduledDateTime(e.target.value)} className={styles.sidebarInput} disabled={isPublishing || isSaving} /> </> )}
-                        <motion.button onClick={handlePublishClick} className="primary-button" style={{ width: '100%', marginTop: '1rem', height: '44px' }} disabled={isPublishDisabled}>
-                            <AnimatePresence mode="wait">{isPublishing ? <ButtonLoader key="loader" /> : <motion.span key="text" initial={{opacity:0}} animate={{opacity:1}} exit={{opacity:0}}>{publishButtonText}</motion.span>}</AnimatePresence>
+                        <motion.button onClick={handlePublishClick} className="primary-button" style={{ width: '100%', marginTop: '1rem', height: '44px', display: 'flex', alignItems: 'center', justifyContent: 'center', overflow: 'hidden' }} disabled={isPublishDisabled} animate={{ width: isPublishing ? '44px' : '100%', borderRadius: isPublishing ? '50%' : '5px', paddingLeft: isPublishing ? 0 : '2.4rem', paddingRight: isPublishing ? 0 : '2.4rem' }} transition={{ type: 'spring', stiffness: 400, damping: 25 }}>
+                            <AnimatePresence mode="wait">{isPublishing ? <ButtonLoader key="loader" /> : <motion.span key="text" initial={{opacity:0}} animate={{opacity:1}} exit={{opacity:0}} style={{whiteSpace: 'nowrap'}}>{publishButtonText}</motion.span>}</AnimatePresence>
                         </motion.button>
                         {!isRelease && (isPublished || isScheduled) && (<motion.button onClick={() => onPublish(null)} className="outline-button" style={{ width: '100%', marginTop: '0.5rem', color: '#DC2626', borderColor: '#DC2626' }} disabled={isUnpublishDisabled}>إلغاء النشر</motion.button>)}
                         <p style={{ marginTop: '0.5rem', color: 'var(--text-secondary)', fontSize: '1.4rem', textAlign: 'right' }}> {!isDocumentValid && <span style={{ color: '#DC2626' }}>الحقول الإلزامية ناقصة.</span>}</p>
@@ -92,25 +109,67 @@ export function EditorSidebar({
                         </motion.div>
                         
                         <motion.div className={styles.sidebarSection} variants={itemVariants}>
-                            <label className={styles.sidebarLabel}>المُعرِّف {!isSlugValid && <AlertIcon />}</label>
+                            <label className={styles.sidebarLabel}>
+                                المُعرِّف {!isSlugValid && <AlertIcon />}
+                            </label>
+                            {/* THE FIX: Removed the redundant, conflicting status icon motion.div */}
                             <div style={{ display: 'flex', alignItems: 'center', gap: '0.5rem' }}>
-                                <motion.div key={slugValidationStatus} initial={{ opacity: 0, scale: 0.8 }} animate={{ opacity: 1, scale: 1 }}>{getSlugIcon()}</motion.div>
                                 <input type="text" value={slug} onChange={(e) => dispatch({ type: 'UPDATE_SLUG', payload: { slug: e.target.value, isManual: true } })} className={styles.sidebarInput} style={{ flexGrow: 1, borderColor: isSlugValid && !isSlugPending ? '#16A34A' : isSlugPending ? 'var(--border-color)' : '#DC2626' }} />
                             </div>
-                            <AnimatePresence> {!isSlugValid && !isSlugPending && <motion.p initial={{height:0, opacity:0}} animate={{height:'auto', opacity:1}} exit={{height:0, opacity:0}} style={{ color: '#DC2626', fontSize: '1.2rem', marginTop: '0.5rem', textAlign: 'right' }}>{slugValidationMessage}</motion.p>} </AnimatePresence>
+                            <AnimatePresence> 
+                                {/* This message text is crucial for feedback, so we keep it. */}
+                                {(!isSlugValid || isSlugPending) && <motion.p initial={{height:0, opacity:0}} animate={{height:'auto', opacity:1}} exit={{height:0, opacity:0}} style={{ color: isSlugPending ? 'var(--text-secondary)' : '#DC2626', fontSize: '1.2rem', marginTop: '0.5rem', textAlign: 'right' }}>{slugValidationMessage}</motion.p>} 
+                            </AnimatePresence>
                         </motion.div>
                         
-                        {isRelease ? ( <> <motion.div className={styles.sidebarSection} variants={itemVariants}> <label className={styles.sidebarLabel}>تاريخ الإصدار</label> <input type="date" value={releaseDate} onChange={(e) => handleFieldChange('releaseDate', e.target.value)} className={styles.sidebarInput} /> </motion.div> <motion.div variants={itemVariants}><PlatformInput selectedPlatforms={platforms} onPlatformsChange={(p: any) => handleFieldChange('platforms', p)} /></motion.div> <motion.div className={styles.sidebarSection} variants={itemVariants}> <label className={styles.sidebarLabel}>نبذة</label> <textarea value={synopsis} onChange={(e) => handleFieldChange('synopsis', e.target.value)} className={styles.sidebarInput} rows={5} /> </motion.div> </> ) : ( <> <div><CreatorInput allCreators={creatorsForRole(primaryCreatorConfig.sanityType)} label={primaryCreatorConfig.label} selectedCreators={documentState[primaryCreatorConfig.field]} onCreatorsChange={(c: any) => handleFieldChange(primaryCreatorConfig.field, c)} /></div> <div><GameInput allGames={allGames} selectedGame={game} onGameSelect={(g: any) => handleFieldChange('game', g)} /></div> <div><TagInput allTags={allTags} selectedTags={tags} onTagsChange={(t: any) => handleFieldChange('tags', t)} /></div> </> )}
-                        <div><CreatorInput allCreators={creatorsForRole('designer')} label="المصممون (اختياري)" selectedCreators={designers} onCreatorsChange={(c: any) => handleFieldChange('designers', c)} /></div>
-                        {isReview && (<> <motion.hr variants={itemVariants} style={{ border: 'none', borderTop: '1px solid var(--border-color)', margin: '1rem 0' }} /> <motion.div className={styles.sidebarSection} variants={itemVariants}> <label className={styles.sidebarLabel}>التقييم (0-10) {score <= 0 && <AlertIcon />}</label> <input type="number" value={score} onChange={(e) => handleFieldChange('score', parseFloat(e.target.value) || 0)} className={styles.sidebarInput} min="0" max="10" step="0.1" /> </motion.div> <motion.div className={styles.sidebarSection} variants={itemVariants}> <label className={styles.sidebarLabel}>الخلاصة {!verdict.trim() && <AlertIcon />}</label> <textarea value={verdict} onChange={(e) => handleFieldChange('verdict', e.target.value)} className={styles.sidebarInput} rows={3} /> </motion.div> <motion.div variants={itemVariants}><ProsConsInput label="المحاسن" items={pros} setItems={(p: any) => handleFieldChange('pros', p)} /></motion.div> <motion.div variants={itemVariants}><ProsConsInput label="المآخذ" items={cons} setItems={(c: any) => handleFieldChange('cons', c)} /></motion.div> </>)}
+                        {isRelease ? ( <> 
+                            <motion.div variants={itemVariants}><GameInput allGames={allGames} selectedGame={game} onGameSelect={(g: any) => handleFieldChange('game', g)} /></motion.div>
+                            <motion.div className={styles.sidebarSection} variants={itemVariants}> <label className={styles.sidebarLabel}>تاريخ الإصدار</label> <input type="date" value={releaseDate} onChange={(e) => handleFieldChange('releaseDate', e.target.value)} className={styles.sidebarInput} /> </motion.div> 
+                            <motion.div variants={itemVariants}><PlatformInput selectedPlatforms={platforms} onPlatformsChange={(p: any) => handleFieldChange('platforms', p)} /></motion.div>
+                             <motion.div variants={itemVariants}><TagInput label="الوسوم" placeholder="ابحث أو أنشئ وسمًا..." allTags={uniqueGameTags} selectedTags={tags} onTagsChange={(t: any) => handleFieldChange('tags', t)} categoryForCreation="Game" /></motion.div>
+                            <motion.div variants={itemVariants}><CreatorInput allCreators={creatorsForRole('designer')} label="المصممون (اختياري)" selectedCreators={designers} onCreatorsChange={(c: any) => handleFieldChange('designers', c)} /></motion.div>
+                            <motion.div className={styles.sidebarSection} variants={itemVariants}> <label className={styles.sidebarLabel}>نبذة</label> <textarea value={synopsis} onChange={(e) => handleFieldChange('synopsis', e.target.value)} className={styles.sidebarInput} rows={5} /> </motion.div> 
+                        </> ) : ( <> 
+                            <div><CreatorInput allCreators={creatorsForRole(primaryCreatorConfig.sanityType)} label={primaryCreatorConfig.label} selectedCreators={documentState[primaryCreatorConfig.field]} onCreatorsChange={(c: any) => handleFieldChange(primaryCreatorConfig.field, c)} /></div> 
+                            <div><GameInput allGames={allGames} selectedGame={game} onGameSelect={(g: any) => handleFieldChange('game', g)} /></div> 
+                            
+                            {isNews && (
+                                <motion.div variants={itemVariants}>
+                                    <TagInput
+                                        label="التصنيف"
+                                        placeholder="اختر تصنيف الخبر..."
+                                        allTags={uniqueNewsCategories}
+                                        selectedTags={category ? [category] : []}
+                                        onTagsChange={(newCategoryArr: any) => handleFieldChange('category', newCategoryArr[0] || null)}
+                                        singleSelection={true}
+                                        categoryForCreation="News"
+                                    />
+                                </motion.div>
+                            )}
+
+                            {isArticle && (
+                                <>
+                                    <div><TagInput label="نوع المقال" placeholder="اختر نوع المقال..." allTags={uniqueArticleCategories} selectedTags={category ? [category] : []} onTagsChange={(newCategoryArr: any) => handleFieldChange('category', newCategoryArr[0] || null)} singleSelection={true} categoryForCreation="Article" /></div>
+                                    <div><TagInput label="الوسوم" placeholder="ابحث أو أنشئ وسمًا..." allTags={uniqueGameTags} selectedTags={tags} onTagsChange={(t: any) => handleFieldChange('tags', t)} categoryForCreation="Game" /></div>
+                                </>
+                            )}
+
+                            {isReview && (
+                                <div><TagInput label="الوسوم" placeholder="ابحث أو أنشئ وسمًا..." allTags={uniqueGameTags} selectedTags={tags} onTagsChange={(t: any) => handleFieldChange('tags', t)} categoryForCreation="Game"/></div>
+                            )}
+
+                            <div><CreatorInput allCreators={creatorsForRole('designer')} label="المصممون (اختياري)" selectedCreators={designers} onCreatorsChange={(c: any) => handleFieldChange('designers', c)} /></div>
+                        </> )}
+                        
+                        {isReview && (<> <motion.hr variants={itemVariants} style={{ border: 'none', borderTop: '1px solid var(--border-color)', margin: '1rem 0' }} /> <motion.div className={styles.sidebarSection} variants={itemVariants}> <label className={styles.sidebarLabel}>التقييم (0-10) {score <= 0 && <AlertIcon />}</label> <input type="number" value={score} onChange={(e) => handleFieldChange('score', parseFloat(e.target.value) || 0)} className={styles.sidebarInput} min="0" max="10" step="0.1" /> </motion.div> <motion.div className={styles.sidebarSection} variants={itemVariants}> <label className={styles.sidebarLabel}>الخلاصة {!verdict.trim() && <AlertIcon />}</label> <textarea value={verdict} onChange={(e) => handleFieldChange('verdict', e.target.value)} className={styles.sidebarInput} rows={3} /> </motion.div> <motion.div variants={itemVariants}><ProsConsInput label="المحاسن" items={pros} setItems={(p: any) => handleFieldChange('pros', p)} /></motion.div> <motion.div variants={itemVariants}><ProsConsInput label="المساوئ" items={cons} setItems={(c: any) => handleFieldChange('cons', c)} /></motion.div> </>)}
                     </fieldset>
                     
                     <div className={styles.sidebarFooter}>
-                        <motion.button onClick={handleSave} disabled={isSaveDisabled} className="primary-button" style={{ width: '100%', height: '44px' }} title={isSaveDisabled ? (hasChanges ? 'المُعرّف غير صالح' : 'لا تغييرات للحفظ') : 'حفظ التغييرات'} animate={{ backgroundColor: saveStatus === 'success' ? '#16A34A' : 'var(--accent)', color: saveStatus === 'success' ? '#fff' : 'inherit' }}>
+                        <motion.button onClick={handleSave} disabled={isSaveDisabled} className="primary-button" style={{ width: '100%', height: '44px', display: 'flex', alignItems: 'center', justifyContent: 'center', overflow: 'hidden' }} title={isSaveDisabled ? (hasChanges ? 'المُعرّف غير صالح' : 'لا تغييرات للحفظ') : 'حفظ التغييرات'} animate={{ backgroundColor: saveStatus === 'success' ? '#16A34A' : 'var(--accent)', color: saveStatus === 'success' ? '#fff' : 'inherit', width: isSaving ? '44px' : '100%', borderRadius: isSaving ? '50%' : '5px', paddingLeft: isSaving ? 0 : '2.4rem', paddingRight: isSaving ? 0 : '2.4rem' }} transition={{ type: 'spring', stiffness: 400, damping: 25 }}>
                             <AnimatePresence mode="wait">
                                 {isSaving && <ButtonLoader key="loader" />}
-                                {saveStatus === 'success' && <motion.span key="success" initial={{opacity:0}} animate={{opacity:1}} exit={{opacity:0}}>تم الحفظ!</motion.span>}
-                                {saveStatus === 'idle' && <motion.span key="idle" initial={{opacity:0}} animate={{opacity:1}} exit={{opacity:0}}>حفظ التغييرات</motion.span>}
+                                {saveStatus === 'success' && <motion.span key="success" initial={{opacity:0}} animate={{opacity:1}} exit={{opacity:0}}>حُفِظ!</motion.span>}
+                                {saveStatus === 'idle' && <motion.span key="idle" initial={{opacity:0}} animate={{opacity:1}} exit={{opacity:0}} style={{whiteSpace: 'nowrap'}}>حفظ التغييرات</motion.span>}
                             </AnimatePresence>
                         </motion.button>
                     </div>
diff --git a/app/studio/[contentType]/[id]/ImageCompareComponent.tsx b/app/studio/[contentType]/[id]/ImageCompareComponent.tsx
index b2fe51c..7a7d2b1 100644
--- a/app/studio/[contentType]/[id]/ImageCompareComponent.tsx
+++ b/app/studio/[contentType]/[id]/ImageCompareComponent.tsx
@@ -5,17 +5,17 @@ import { NodeViewWrapper, NodeViewProps } from '@tiptap/react';
 import { ReactCompareSlider, ReactCompareSliderImage } from 'react-compare-slider';
 import { useState, useRef, useCallback } from 'react';
 import { optimizeImageForUpload } from '@/lib/image-optimizer';
-import { clientAssetUploader } from '@/lib/sanity.client';
+import { uploadSanityAssetAction } from '../../actions';
 import { useToast } from '@/lib/toastStore';
 import styles from '@/components/ImageCompare.module.css';
 import editorStyles from './Editor.module.css';
 import Image from 'next/image';
 
-const UploadIcon = () => <svg className={styles.uploadIcon} fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" d="M12 16.5V9.75m0 0l-3.75 3.75M12 9.75l3.75 3.75M17.25 12a4.5 4.5 0 11-9 0 4.5 4.5 0 019 0z" /></svg>;
-const DeleteIcon = () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg>;
-const SizeSmallIcon = () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="3" y="3" width="18" height="6" rx="1"/><rect x="3" y="15" width="18" height="6" rx="1"/></svg>;
-const SizeMediumIcon = () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="3" y="3" width="18" height="10" rx="1"/><rect x="3" y="17" width="18" height="4" rx="1"/></svg>;
-const SizeLargeIcon = () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="3" y="3" width="18" height="18" rx="1"/></svg>;
+const UploadIcon = () => <svg className={styles.uploadIcon} fill="none" viewBox="0 0 24" strokeWidth={1.5} stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" d="M12 16.5V9.75m0 0l-3.75 3.75M12 9.75l3.75 3.75M17.25 12a4.5 4.5 0 11-9 0 4.5 4.5 0 019 0z" /></svg>;
+const حذفIcon = () => <svg width="20" height="20" viewBox="0 0 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg>;
+const SizeSmallIcon = () => <svg width="20" height="20" viewBox="0 0 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="3" y="3" width="18" height="6" rx="1"/><rect x="3" y="15" width="18" height="6" rx="1"/></svg>;
+const SizeMediumIcon = () => <svg width="20" height="20" viewBox="0 0 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="3" y="3" width="18" height="10" rx="1"/><rect x="3" y="17" width="18" height="4" rx="1"/></svg>;
+const SizeLargeIcon = () => <svg width="20" height="20" viewBox="0 0 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="3" y="3" width="18" height="18" rx="1"/></svg>;
 
 const formatFileSize = (bytes: number): string => {
     if (bytes < 1024) return `${bytes} B`;
@@ -31,40 +31,38 @@ const Dropzone = ({ side, src, onUpload }: { side: 'left' | 'right', src: string
     const handleFile = (file: File | null | undefined) => { if (file) { onUpload(file); } }; 
     const handleDrop = (e: React.DragEvent<HTMLDivElement>) => { e.preventDefault(); e.stopPropagation(); setIsDragging(false); handleFile(e.dataTransfer.files?.[0]); }; 
     const handleDrag = (e: React.DragEvent<HTMLDivElement>, isActive: boolean) => { e.preventDefault(); e.stopPropagation(); setIsDragging(isActive); }; 
-    return ( <div className={`${styles.dropzone} ${isDragging ? styles.active : ''}`} onDrop={handleDrop} onDragEnter={(e) => handleDrag(e, true)} onDragOver={(e) => handleDrag(e, true)} onDragLeave={(e) => handleDrag(e, false)} onClick={() => inputRef.current?.click()}> <input ref={inputRef} type="file" style={{ display: 'none' }} accept="image/*" onChange={(e) => handleFile(e.target.files?.[0])} /> {src && <Image src={src} alt={`Image ${side}`} fill className={styles.imagePreview} />} <div className={styles.dropzoneContent}> <UploadIcon /> <span>{src ? `تغيير الصورة ${side === 'left' ? 1 : 2}` : `أفلت صورة أو انقر للرفع`}</span> </div> </div> ); 
+    return ( <div className={`${styles.dropzone} ${isDragging ? styles.active : ''}`} onDrop={handleDrop} onDragEnter={(e) => handleDrag(e, true)} onDragOver={(e) => handleDrag(e, true)} onDragLeave={(e) => handleDrag(e, false)} onClick={() => inputRef.current?.click()}> <input ref={inputRef} type="file" style={{ display: 'none' }} accept="image/*" onChange={(e) => handleFile(e.target.files?.[0])} /> {src && <Image src={src} alt={`Image ${side}`} fill className={styles.imagePreview} />} <div className={styles.dropzoneContent}> <UploadIcon /> <span>{src ? `تغيير الصورة ${side === 'left' ? 1 : 2}` : `أفلت صورةً أو انقر للرفع`}</span> </div> </div> ); 
 };
 
 export const ImageCompareComponent = ({ node, updateAttributes, editor, getPos }: NodeViewProps) => {
     const toast = useToast();
     const handleUpload = useCallback(async (file: File, side: 'left' | 'right') => {
         try {
-            toast.info('جار تحسين الصورة للرفع...', 'left');
+            toast.info('جارٍ تهيئة الصورة للرفع...', 'left');
             const quality = editor.storage.uploadQuality || '1080p';
-            // THE DEFINITIVE FIX: Destructure the object to get the file.
             const { file: optimizedFile, finalQuality } = await optimizeImageForUpload(file, quality);
 
-            toast.info(`جار رفع الصورة (${formatFileSize(optimizedFile.size)} @ ${Math.round(finalQuality * 100)}%)...`, 'left');
+            toast.info(`جارٍ رفع الصورة (${formatFileSize(optimizedFile.size)} @ ${Math.round(finalQuality * 100)}%)...`, 'left');
             
-            const asset = await clientAssetUploader.assets.upload('image', optimizedFile, {
-                filename: optimizedFile.name,
-                contentType: optimizedFile.type,
-            });
+            const formData = new FormData();
+            formData.append('file', optimizedFile);
+            const result = await uploadSanityAssetAction(formData);
 
-            if (asset?._id && asset?.url) {
+            if (result.success && result.asset) {
                 updateAttributes({
-                    [side === 'left' ? 'src1' : 'src2']: asset.url,
-                    [side === 'left' ? 'assetId1' : 'assetId2']: asset._id,
+                    [side === 'left' ? 'src1' : 'src2']: result.asset.url,
+                    [side === 'left' ? 'assetId1' : 'assetId2']: result.asset._id,
                 });
-                toast.success('تم رفع الصورة بنجاح.', 'left');
+                toast.success('رُفِعت الصورة.', 'left');
             } else {
-                throw new Error('فشل رفع أصل الصورة إلى Sanity.');
+                throw new Error(result.error || 'أخفق رفع أصل الصورة.');
             }
         } catch (error: any) {
-            toast.error(error.message || 'فشل معالجة الصورة.', 'left');
+            toast.error(error.message || 'أخفقت معالجة الصورة.', 'left');
         }
     }, [updateAttributes, toast, editor.storage.uploadQuality]);
 
-    const handleDelete = () => editor.chain().deleteRange({ from: getPos(), to: getPos() + 1 }).focus().run();
+    const handleحذف = () => editor.chain().deleteRange({ from: getPos(), to: getPos() + 1 }).focus().run();
     const handleSizeChange = (size: 'small' | 'medium' | 'large') => updateAttributes({ 'data-size': size });
     const currentSize = node.attrs['data-size'] || 'large';
 
@@ -87,10 +85,8 @@ export const ImageCompareComponent = ({ node, updateAttributes, editor, getPos }
                 <button onClick={() => handleSizeChange('medium')} className={`${editorStyles.bubbleMenuButton} ${currentSize === 'medium' ? editorStyles.active : ''}`}><SizeMediumIcon /></button>
                 <button onClick={() => handleSizeChange('large')} className={`${editorStyles.bubbleMenuButton} ${currentSize === 'large' ? editorStyles.active : ''}`}><SizeLargeIcon /></button>
                 <div style={{width: '1px', height: '24px', backgroundColor: 'var(--border-color)', margin: '0 0.4rem'}} />
-                <button onClick={handleDelete} className={`${editorStyles.bubbleMenuButton} ${editorStyles.deleteButton}`}><DeleteIcon /></button>
+                <button onClick={handleحذف} className={`${editorStyles.bubbleMenuButton} ${editorStyles.deleteButton}`}><حذفIcon /></button>
             </div>
         </NodeViewWrapper>
     );
-};
-
-
+};
\ No newline at end of file
diff --git a/app/studio/[contentType]/[id]/ImageResizeComponent.tsx b/app/studio/[contentType]/[id]/ImageResizeComponent.tsx
index e6c91ad..08fe7b7 100644
--- a/app/studio/[contentType]/[id]/ImageResizeComponent.tsx
+++ b/app/studio/[contentType]/[id]/ImageResizeComponent.tsx
@@ -7,7 +7,7 @@ import styles from './Editor.module.css';
 const SizeSmallIcon = () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="3" y="3" width="18" height="6" rx="1"/><rect x="3" y="15" width="18" height="6" rx="1"/></svg>;
 const SizeMediumIcon = () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="3" y="3" width="18" height="10" rx="1"/><rect x="3" y="17" width="18" height="4" rx="1"/></svg>;
 const SizeLargeIcon = () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="3" y="3" width="18" height="18" rx="1"/></svg>;
-const DeleteIcon = () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg>;
+const حذفIcon = () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg>;
 
 export const ImageResizeComponent = ({ editor, node, updateAttributes, getPos }: NodeViewProps) => {
     
@@ -15,7 +15,7 @@ export const ImageResizeComponent = ({ editor, node, updateAttributes, getPos }:
         updateAttributes({ 'data-size': size });
     };
 
-    const handleDelete = () => {
+    const handleحذف = () => {
         editor.chain().deleteRange({ from: getPos(), to: getPos() + 1 }).focus().run()
     }
 
@@ -36,7 +36,7 @@ export const ImageResizeComponent = ({ editor, node, updateAttributes, getPos }:
                 <button onClick={() => handleSizeChange('medium')} className={`${styles.bubbleMenuButton} ${currentSize === 'medium' ? styles.active : ''}`}><SizeMediumIcon /></button>
                 <button onClick={() => handleSizeChange('large')} className={`${styles.bubbleMenuButton} ${currentSize === 'large' ? styles.active : ''}`}><SizeLargeIcon /></button>
                 <div style={{width: '1px', height: '24px', backgroundColor: 'var(--border-color)', margin: '0 0.4rem'}} />
-                <button onClick={handleDelete} className={`${styles.bubbleMenuButton} ${styles.deleteButton}`}><DeleteIcon /></button>
+                <button onClick={handleحذف} className={`${styles.bubbleMenuButton} ${styles.deleteButton}`}><حذفIcon /></button>
             </div>
         </NodeViewWrapper>
     );
diff --git a/app/studio/[contentType]/[id]/RichTextEditor.tsx b/app/studio/[contentType]/[id]/RichTextEditor.tsx
index af38673..810ade7 100644
--- a/app/studio/[contentType]/[id]/RichTextEditor.tsx
+++ b/app/studio/[contentType]/[id]/RichTextEditor.tsx
@@ -15,7 +15,7 @@ import { useState, useEffect, useCallback } from 'react';
 import { AnimatePresence } from 'framer-motion';
 import { useToast } from '@/lib/toastStore';
 import { optimizeImageForUpload, UploadQuality } from '@/lib/image-optimizer';
-import { clientAssetUploader } from '@/lib/sanity.client';
+import { uploadSanityAssetAction } from '../../actions';
 import { FormattingToolbar } from './FormattingToolbar';
 import { LinkEditorModal } from './LinkEditorModal';
 import { ImageResizeComponent } from './ImageResizeComponent';
@@ -35,7 +35,7 @@ const formatFileSize = (bytes: number): string => {
 
 export const uploadFile = async (file: File, editor: Editor, toast: ReturnType<typeof useToast>, quality: UploadQuality) => {
     try {
-        toast.info('جار تحسين الصورة للرفع...', 'left');
+        toast.info('جارٍ تهيئة الصورة للرفع...', 'left');
         const { file: optimizedFile, finalQuality } = await optimizeImageForUpload(file, quality);
         
         const reader = new FileReader();
@@ -46,12 +46,11 @@ export const uploadFile = async (file: File, editor: Editor, toast: ReturnType<t
             const transaction = tr.replaceSelectionWith(node);
             editor.view.dispatch(transaction);
             
-            toast.info(`جار رفع الصورة (${formatFileSize(optimizedFile.size)} @ ${Math.round(finalQuality * 100)}%)...`, 'left');
+            toast.info(`جارٍ رفع الصورة (${formatFileSize(optimizedFile.size)} @ ${Math.round(finalQuality * 100)}%)...`, 'left');
             
-            const asset = await clientAssetUploader.assets.upload('image', optimizedFile, {
-                filename: optimizedFile.name,
-                contentType: optimizedFile.type,
-            });
+            const formData = new FormData();
+            formData.append('file', optimizedFile);
+            const result = await uploadSanityAssetAction(formData);
 
             let imagePos: number | null = null;
             editor.state.doc.descendants((node, pos) => {
@@ -63,21 +62,21 @@ export const uploadFile = async (file: File, editor: Editor, toast: ReturnType<t
             });
             
             if (imagePos !== null) {
-                if (asset?._id && asset?.url) {
+                if (result.success && result.asset) {
                     const finalTransaction = editor.state.tr.setNodeMarkup(imagePos, undefined, {
                         ...editor.state.doc.nodeAt(imagePos)?.attrs,
-                        src: asset.url,
-                        assetId: asset._id,
+                        src: result.asset.url,
+                        assetId: result.asset._id,
                     });
                     editor.view.dispatch(finalTransaction);
-                    toast.success('تم رفع الصورة بنجاح.', 'left');
+                    toast.success('رُفِعت الصورة.', 'left');
                 } else {
-                    throw new Error('فشل رفع أصل الصورة إلى Sanity.');
+                    throw new Error(result.error || 'أخفق رفع أصل الصورة.');
                 }
             }
         };
     } catch (error: any) {
-        toast.error(error.message || 'فشل رفع الصورة.', 'left');
+        toast.error(error.message || 'أخفق رفع الصورة.', 'left');
         let imagePos: number | null = null;
         editor.state.doc.descendants((node, pos) => {
             if (node.type.name === 'image' && node.attrs.src.startsWith('data:')) {
@@ -125,7 +124,7 @@ export default function RichTextEditor({ onEditorCreated, initialContent }: Rich
                 },
             }),
             Link.configure({ openOnClick: false, autolink: true, HTMLAttributes: { class: 'editor-link' }, }),
-            Placeholder.configure({ placeholder: 'اكتب محتواك هنا...' }),
+            Placeholder.configure({ placeholder: 'خُطَّ ما في نفسِكَ هنا...' }),
             CustomImage, BulletList, ListItem, ImageCompareNode, TwoImageGridNode, FourImageGridNode,
         ],
         editorProps: {
@@ -156,7 +155,7 @@ export default function RichTextEditor({ onEditorCreated, initialContent }: Rich
                 editor={editor} 
                 tippyOptions={{ 
                     duration: 100, 
-                    placement: 'top-end', // <-- THE DEFINITIVE FIX
+                    placement: 'top-end',
                     offset: [0, 8] 
                 }} 
                 shouldShow={({ editor, state }) => { 
diff --git a/app/studio/[contentType]/[id]/StatefulSaveButton.tsx b/app/studio/[contentType]/[id]/StatefulSaveButton.tsx
index 2c64806..2bfbae7 100644
--- a/app/studio/[contentType]/[id]/StatefulSaveButton.tsx
+++ b/app/studio/[contentType]/[id]/StatefulSaveButton.tsx
@@ -22,11 +22,11 @@ export function StatefulSaveButton({ onSave, hasChanges }: { onSave: () => Promi
         const success = await onSave();
         if (success) {
             setSaveStatus('success');
-            toast.success('حُفظت التغييرات بنجاح!', 'left'); // Position toast on the left for studio
+            toast.success('حُفظت التغييرات!', 'left'); // Position toast on the left for studio
             setTimeout(() => setSaveStatus('idle'), 2000);
         } else {
             setSaveStatus('error');
-            toast.error('فشل حفظ التغييرات.', 'left');
+            toast.error('أخفق حفظ التغييرات.', 'left');
             setTimeout(() => setSaveStatus('idle'), 3000);
         }
     };
diff --git a/app/studio/[contentType]/[id]/editor-components/FourImageGridComponent.tsx b/app/studio/[contentType]/[id]/editor-components/FourImageGridComponent.tsx
index 09166d4..6aed0ff 100644
--- a/app/studio/[contentType]/[id]/editor-components/FourImageGridComponent.tsx
+++ b/app/studio/[contentType]/[id]/editor-components/FourImageGridComponent.tsx
@@ -4,14 +4,14 @@
 import { NodeViewWrapper, NodeViewProps } from '@tiptap/react';
 import { useToast } from '@/lib/toastStore';
 import { optimizeImageForUpload } from '@/lib/image-optimizer';
-import { clientAssetUploader } from '@/lib/sanity.client';
+import { uploadSanityAssetAction } from '../../../actions';
 import { useState, useRef, useCallback } from 'react';
 import Image from 'next/image';
 import styles from '../Editor.module.css';
 import compareStyles from '@/components/ImageCompare.module.css';
 
-const UploadIcon = () => ( <svg className={compareStyles.uploadIcon} fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" d="M12 16.5V9.75m0 0l-3.75 3.75M12 9.75l3.75 3.75M17.25 12a4.5 4.5 0 11-9 0 4.5 4.5 0 019 0z" /></svg> );
-const DeleteIcon = () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg>;
+const UploadIcon = () => ( <svg className={compareStyles.uploadIcon} fill="none" viewBox="0 0 24" strokeWidth={1.5} stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" d="M12 16.5V9.75m0 0l-3.75 3.75M12 9.75l3.75 3.75M17.25 12a4.5 4.5 0 11-9 0 4.5 4.5 0 019 0z" /></svg> );
+const حذفIcon = () => <svg width="20" height="20" viewBox="0 0 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg>;
 
 const formatFileSize = (bytes: number): string => {
     if (bytes < 1024) return `${bytes} B`;
@@ -34,7 +34,7 @@ const Dropzone = ({ side, src, onUpload }: { side: number, src: string | null, o
             {src && <Image src={src} alt={`Image ${side}`} fill className={compareStyles.imagePreview} />}
             <div className={compareStyles.dropzoneContent} style={{fontSize: '1.4rem'}}>
                 <UploadIcon />
-                <span>{src ? `تغيير الصورة ${side}` : `أفلت صورة أو انقر للرفع`}</span>
+                <span>{src ? `تغيير الصورة ${side}` : `أفلت صورةً أو انقر للرفع`}</span>
             </div>
         </div>
     );
@@ -44,29 +44,24 @@ export const FourImageGridComponent = ({ node, updateAttributes, editor, getPos
     const toast = useToast();
     const handleUpload = useCallback(async (file: File, slot: 1 | 2 | 3 | 4) => {
         try {
-            toast.info('جار تحسين الصورة للرفع...', 'left');
+            toast.info('جارٍ تهيئة الصورة للرفع...', 'left');
             const quality = editor.storage.uploadQuality || '1080p';
-            // --- THE FIX IS HERE (PART 1) ---
-            // Correctly destructure the object returned by the optimizer.
             const { file: optimizedFile, finalQuality } = await optimizeImageForUpload(file, quality);
 
-            // --- THE FIX IS HERE (PART 2) ---
-            // Use the final size and quality percentage in the toast.
-            toast.info(`جار رفع الصورة (${formatFileSize(optimizedFile.size)} @ ${Math.round(finalQuality * 100)}%)...`, 'left');
+            toast.info(`جارٍ رفع الصورة (${formatFileSize(optimizedFile.size)} @ ${Math.round(finalQuality * 100)}%)...`, 'left');
 
-            const asset = await clientAssetUploader.assets.upload('image', optimizedFile, {
-                filename: optimizedFile.name,
-                contentType: optimizedFile.type,
-            });
+            const formData = new FormData();
+            formData.append('file', optimizedFile);
+            const result = await uploadSanityAssetAction(formData);
 
-            if (asset?._id && asset?.url) {
-                updateAttributes({ [`src${slot}`]: asset.url, [`assetId${slot}`]: asset._id });
-                toast.success('تم رفع الصورة بنجاح.', 'left');
-            } else { throw new Error('فشل الرفع'); }
+            if (result.success && result.asset) {
+                updateAttributes({ [`src${slot}`]: result.asset.url, [`assetId${slot}`]: result.asset._id });
+                toast.success('رُفِعت الصورة.', 'left');
+            } else { throw new Error(result.error || 'فشل الرفع'); }
         } catch (error: any) { toast.error(error.message, 'left'); }
     }, [updateAttributes, toast, editor.storage.uploadQuality]);
     
-    const handleDelete = () => editor.chain().deleteRange({ from: getPos(), to: getPos() + 1 }).focus().run();
+    const handleحذف = () => editor.chain().deleteRange({ from: getPos(), to: getPos() + 1 }).focus().run();
 
     return (
         <NodeViewWrapper as="div" className={styles.imageGridContainer} data-drag-handle>
@@ -77,10 +72,8 @@ export const FourImageGridComponent = ({ node, updateAttributes, editor, getPos
                 <Dropzone side={4} src={node.attrs.src4} onUpload={(file) => handleUpload(file, 4)} />
             </div>
             <div className={styles.imageNodeMenu} contentEditable={false}>
-                 <button onClick={handleDelete} className={`${styles.bubbleMenuButton} ${styles.deleteButton}`} title="Delete Grid"><DeleteIcon /></button>
+                 <button onClick={handleحذف} className={`${styles.bubbleMenuButton} ${styles.deleteButton}`} title="حذف الشبكة"><حذفIcon /></button>
             </div>
         </NodeViewWrapper>
     );
-};
-
-
+};
\ No newline at end of file
diff --git a/app/studio/[contentType]/[id]/editor-components/TwoImageGridComponent.tsx b/app/studio/[contentType]/[id]/editor-components/TwoImageGridComponent.tsx
index 5c1bf11..f4ecd3a 100644
--- a/app/studio/[contentType]/[id]/editor-components/TwoImageGridComponent.tsx
+++ b/app/studio/[contentType]/[id]/editor-components/TwoImageGridComponent.tsx
@@ -4,14 +4,14 @@
 import { NodeViewWrapper, NodeViewProps } from '@tiptap/react';
 import { useToast } from '@/lib/toastStore';
 import { optimizeImageForUpload } from '@/lib/image-optimizer';
-import { clientAssetUploader } from '@/lib/sanity.client';
+import { uploadSanityAssetAction } from '../../../actions';
 import { useState, useRef, useCallback } from 'react';
 import Image from 'next/image';
 import styles from '../Editor.module.css';
 import compareStyles from '@/components/ImageCompare.module.css';
 
-const UploadIcon = () => ( <svg className={compareStyles.uploadIcon} fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" d="M12 16.5V9.75m0 0l-3.75 3.75M12 9.75l3.75 3.75M17.25 12a4.5 4.5 0 11-9 0 4.5 4.5 0 019 0z" /></svg> );
-const DeleteIcon = () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg>;
+const UploadIcon = () => ( <svg className={compareStyles.uploadIcon} fill="none" viewBox="0 0 24" strokeWidth={1.5} stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" d="M12 16.5V9.75m0 0l-3.75 3.75M12 9.75l3.75 3.75M17.25 12a4.5 4.5 0 11-9 0 4.5 4.5 0 019 0z" /></svg> );
+const حذفIcon = () => <svg width="20" height="20" viewBox="0 0 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg>;
 
 const formatFileSize = (bytes: number): string => {
     if (bytes < 1024) return `${bytes} B`;
@@ -34,7 +34,7 @@ const Dropzone = ({ side, src, onUpload }: { side: number, src: string | null, o
             {src && <Image src={src} alt={`Image ${side}`} fill className={compareStyles.imagePreview} />}
             <div className={compareStyles.dropzoneContent} style={{fontSize: '1.4rem'}}>
                 <UploadIcon />
-                <span>{src ? `تغيير الصورة` : `أفلت صورة أو انقر للرفع`}</span>
+                <span>{src ? `تغيير الصورة` : `أفلت صورةً أو انقر للرفع`}</span>
             </div>
         </div>
     );
@@ -44,29 +44,24 @@ export const TwoImageGridComponent = ({ node, updateAttributes, editor, getPos }
     const toast = useToast();
     const handleUpload = useCallback(async (file: File, slot: 1 | 2) => {
         try {
-            toast.info('جار تحسين الصورة للرفع...', 'left');
+            toast.info('جارٍ تهيئة الصورة للرفع...', 'left');
             const quality = editor.storage.uploadQuality || '1080p';
-            // --- THE FIX IS HERE (PART 1) ---
-            // Correctly destructure the object returned by the optimizer.
             const { file: optimizedFile, finalQuality } = await optimizeImageForUpload(file, quality);
 
-            // --- THE FIX IS HERE (PART 2) ---
-            // Use the final size and quality percentage in the toast.
-            toast.info(`جار رفع الصورة (${formatFileSize(optimizedFile.size)} @ ${Math.round(finalQuality * 100)}%)...`, 'left');
+            toast.info(`جارٍ رفع الصورة (${formatFileSize(optimizedFile.size)} @ ${Math.round(finalQuality * 100)}%)...`, 'left');
 
-            const asset = await clientAssetUploader.assets.upload('image', optimizedFile, {
-                filename: optimizedFile.name,
-                contentType: optimizedFile.type,
-            });
+            const formData = new FormData();
+            formData.append('file', optimizedFile);
+            const result = await uploadSanityAssetAction(formData);
 
-            if (asset?._id && asset?.url) {
-                updateAttributes({ [`src${slot}`]: asset.url, [`assetId${slot}`]: asset._id });
-                toast.success('تم رفع الصورة بنجاح.', 'left');
-            } else { throw new Error('فشل الرفع'); }
+            if (result.success && result.asset) {
+                updateAttributes({ [`src${slot}`]: result.asset.url, [`assetId${slot}`]: result.asset._id });
+                toast.success('رُفِعت الصورة.', 'left');
+            } else { throw new Error(result.error || 'فشل الرفع'); }
         } catch (error: any) { toast.error(error.message, 'left'); }
     }, [updateAttributes, toast, editor.storage.uploadQuality]);
 
-    const handleDelete = () => editor.chain().deleteRange({ from: getPos(), to: getPos() + 1 }).focus().run();
+    const handleحذف = () => editor.chain().deleteRange({ from: getPos(), to: getPos() + 1 }).focus().run();
 
     return (
         <NodeViewWrapper as="div" className={styles.imageGridContainer} data-drag-handle>
@@ -75,10 +70,8 @@ export const TwoImageGridComponent = ({ node, updateAttributes, editor, getPos }
                 <Dropzone side={2} src={node.attrs.src2} onUpload={(file) => handleUpload(file, 2)} />
             </div>
             <div className={styles.imageNodeMenu} contentEditable={false}>
-                <button onClick={handleDelete} className={`${styles.bubbleMenuButton} ${styles.deleteButton}`} title="Delete Grid"><DeleteIcon /></button>
+                <button onClick={handleحذف} className={`${styles.bubbleMenuButton} ${styles.deleteButton}`} title="حذف الشبكة"><حذفIcon /></button>
             </div>
         </NodeViewWrapper>
     );
-};
-
-
+};
\ No newline at end of file
diff --git a/app/studio/[contentType]/[id]/metadata/MainImageInput.tsx b/app/studio/[contentType]/[id]/metadata/MainImageInput.tsx
index e7c0e2b..4c15638 100644
--- a/app/studio/[contentType]/[id]/metadata/MainImageInput.tsx
+++ b/app/studio/[contentType]/[id]/metadata/MainImageInput.tsx
@@ -6,7 +6,7 @@ import { motion, AnimatePresence } from 'framer-motion';
 import Image from 'next/image';
 import { useToast } from '@/lib/toastStore';
 import { optimizeImageForUpload, UploadQuality } from '@/lib/image-optimizer';
-import { clientAssetUploader } from '@/lib/sanity.client';
+import { uploadSanityAssetAction } from '../../../actions';
 import avatarStyles from '../../../../components/ProfileEditForm.module.css';
 
 const UploadIcon = () => ( <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24" strokeWidth={1.5} stroke="currentColor" width="24" height="24"> <path strokeLinecap="round" strokeLinejoin="round" d="M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5m-13.5-9L12 3m0 0 4.5 4.5M12 3v13.5" /> </svg> );
@@ -37,41 +37,37 @@ export function MainImageInput({ currentAssetId, currentAssetUrl, onImageChange,
 
     const handleFile = useCallback(async (file: File) => {
         if (!file.type.startsWith('image/')) {
-            toast.error('نوع الملف غير صالح. يرجى رفع صورة.', 'left');
+            toast.error('نوع ملف غير صالح. يرجى رفع صورة.', 'left');
             return;
         }
 
         startUpload(async () => {
             try {
-                toast.info('جار تحسين الصورة...', 'left');
-                // THE FIX: Get file and final quality from optimizer
+                toast.info('جارٍ تهيئة الصورة...', 'left');
                 const { file: optimizedFile, finalQuality } = await optimizeImageForUpload(file, uploadQuality);
                 const localUrl = URL.createObjectURL(optimizedFile);
                 setPreviewUrl(localUrl);
 
-                // THE FIX: Use final size and quality in the toast
-                toast.info(`جار رفع الصورة (${formatFileSize(optimizedFile.size)} @ ${Math.round(finalQuality * 100)}%)...`, 'left');
+                toast.info(`جارٍ رفع الصورة (${formatFileSize(optimizedFile.size)} @ ${Math.round(finalQuality * 100)}%)...`, 'left');
                 
-                const asset = await clientAssetUploader.assets.upload('image', optimizedFile, {
-                    filename: optimizedFile.name,
-                    contentType: optimizedFile.type,
-                });
+                const formData = new FormData();
+                formData.append('file', optimizedFile);
+                const result = await uploadSanityAssetAction(formData);
                 
-                if (asset?._id && asset?.url) {
-                    onImageChange(asset._id, asset.url);
-                    toast.success('تم رفع الصورة الرئيسية بنجاح.', 'left');
+                if (result.success && result.asset) {
+                    onImageChange(result.asset._id, result.asset.url);
+                    toast.success('رُفِعت الصورة الرئيسية.', 'left');
                 } else {
-                    throw new Error('فشل رفع الصورة إلى Sanity.');
+                    throw new Error(result.error || 'فشل رفع الصورة إلى Sanity.');
                 }
             } catch (error: any) {
                 setPreviewUrl(currentAssetUrl);
                 onImageChange(currentAssetId, currentAssetUrl);
-                toast.error(error.message || 'فشل تحسين الصورة.', 'left');
+                toast.error(error.message || 'أخفقت تهيئة الصورة.', 'left');
             }
         });
     }, [onImageChange, toast, currentAssetUrl, currentAssetId, uploadQuality]);
     
-    // ... (rest of the component is the same)
     const handleDrop = useCallback((e: React.DragEvent<HTMLDivElement>) => {
         e.preventDefault();
         setIsDragging(false);
@@ -84,7 +80,7 @@ export function MainImageInput({ currentAssetId, currentAssetUrl, onImageChange,
         setPreviewUrl(null);
         onImageChange(null, null);
         if (fileInputRef.current) fileInputRef.current.value = '';
-        toast.info('تمت إزالة الصورة الرئيسية.', 'left');
+        toast.info('أُزيلت الصورة الرئيسية.', 'left');
     };
 
     return (
@@ -120,8 +116,8 @@ export function MainImageInput({ currentAssetId, currentAssetUrl, onImageChange,
                         <motion.div key="placeholder" initial={{ opacity: 0 }} animate={{ opacity: 1 }} exit={{ opacity: 0 }} style={{ textAlign: 'center', color: 'var(--text-secondary)' }}>
                             {isUploading ? ( <div className="spinner" /> ) : (
                                 <>
-                                    <p style={{ margin: 0 }}>اسحب وأفلت أو انقر للرفع</p>
-                                    <p style={{ fontSize: '1.2rem', margin: '0.5rem 0 0 0' }}>سيتم تحسين الصور الكبيرة تلقائيًا</p>
+                                    <p style={{ margin: 0 }}>أفلت أو انقر للرفع</p>
+                                    <p style={{ fontSize: '1.2rem', margin: '0.5rem 0 0 0' }}>الصورُ الكبيرةُ تُهَيَّأُ تلقائيًا</p>
                                 </>
                             )}
                         </motion.div>
@@ -136,6 +132,4 @@ export function MainImageInput({ currentAssetId, currentAssetUrl, onImageChange,
             )}
         </>
     );
-}
-
-
+}
\ No newline at end of file
diff --git a/app/studio/[contentType]/[id]/metadata/PlatformInput.tsx b/app/studio/[contentType]/[id]/metadata/PlatformInput.tsx
index 783a8db..e23f106 100644
--- a/app/studio/[contentType]/[id]/metadata/PlatformInput.tsx
+++ b/app/studio/[contentType]/[id]/metadata/PlatformInput.tsx
@@ -5,7 +5,7 @@ import { motion } from 'framer-motion';
 import styles from '../Editor.module.css';
 import filterStyles from '@/components/filters/Filters.module.css';
 
-const PLATFORMS = ['PC', 'PS5', 'Xbox', 'Switch'];
+const PLATFORMS = ['PC', 'PlayStation 5', 'Xbox', 'Switch'];
 
 interface PlatformInputProps {
     selectedPlatforms: string[];
diff --git a/app/studio/[contentType]/[id]/metadata/ProsConsInput.tsx b/app/studio/[contentType]/[id]/metadata/ProsConsInput.tsx
index 8d1ec09..7abd1c5 100644
--- a/app/studio/[contentType]/[id]/metadata/ProsConsInput.tsx
+++ b/app/studio/[contentType]/[id]/metadata/ProsConsInput.tsx
@@ -6,7 +6,7 @@ import ActionButton from '@/components/ActionButton';
 import styles from '../Editor.module.css';
 import metadataStyles from './Metadata.module.css';
 
-interface ProsConsInputProps { label: 'المحاسن' | 'المآخذ'; items: string[]; setItems: (newItems: string[]) => void; }
+interface ProsConsInputProps { label: 'المحاسن' | 'المساوئ'; items: string[]; setItems: (newItems: string[]) => void; }
 const itemVariants = { hidden: { opacity: 0, x: 20 }, visible: { opacity: 1, x: 0 }, exit: { opacity: 0, x: -20, transition: { duration: 0.2 } }, };
 const RemoveIcon = () => <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>;
 
@@ -15,7 +15,7 @@ export function ProsConsInput({ label, items, setItems }: ProsConsInputProps) {
     const handleRemoveItem = (index: number) => { setItems(items.filter((_, i) => i !== index)); };
     const handleItemChange = (index: number, value: string) => { const newItems = [...items]; newItems[index] = value; setItems(newItems); };
 
-    const buttonText = label === 'المحاسن' ? '+ إضافة محسن' : '+ إضافة مأخذ';
+    const buttonText = label === 'المحاسن' ? '+ إضافة حَسَنة' : '+ إضافة سيئة';
     const ariaLabel = label === 'المحاسن' ? 'إزالة المحسن' : 'إزالة المأخذ';
 
     return (
diff --git a/app/studio/[contentType]/[id]/metadata/TagInput.tsx b/app/studio/[contentType]/[id]/metadata/TagInput.tsx
index f0e17d5..7050b2b 100644
--- a/app/studio/[contentType]/[id]/metadata/TagInput.tsx
+++ b/app/studio/[contentType]/[id]/metadata/TagInput.tsx
@@ -11,7 +11,15 @@ import styles from '../Editor.module.css';
 import metadataStyles from './Metadata.module.css';
 
 type Tag = { _id: string; title: string };
-interface TagInputProps { allTags: Tag[]; selectedTags: Tag[]; onTagsChange: (tags: Tag[]) => void; }
+interface TagInputProps { 
+    label: string; 
+    allTags: Tag[]; 
+    selectedTags: Tag[]; 
+    onTagsChange: (tags: any) => void;
+    placeholder?: string;
+    singleSelection?: boolean;
+    categoryForCreation: 'Game' | 'Article' | 'News';
+}
 
 const popoverVariants = { 
     hidden: { opacity: 0, y: -10, scale: 0.95 }, 
@@ -20,62 +28,95 @@ const popoverVariants = {
 };
 
 const AnimatedTag = ({ tag, onRemove }: { tag: Tag, onRemove: (tagId: string) => void }) => {
-    const [isDeleting, setIsDeleting] = useState(false);
-    const tagVariants = { initial: { opacity: 0, scale: 0.5 }, visible: { opacity: 1, scale: 1 }, exiting: { opacity: 0, scale: 0.6, transition: { duration: 0.2, ease: 'easeOut' as const } }, };
-    const handleRemove = (e: React.MouseEvent) => { e.stopPropagation(); setIsDeleting(true); };
+    // Safeguard against malformed tag objects
+    if (!tag || typeof tag.title !== 'string') {
+        return null;
+    }
     return (
-        <motion.div onClick={handleRemove} layout variants={tagVariants} initial="initial" animate={isDeleting ? "exiting" : "visible"} exit="exiting" onAnimationComplete={() => { if (isDeleting) { onRemove(tag._id); } }} style={{ display: 'flex', alignItems: 'center', gap: '0.5rem', background: 'var(--bg-primary)', padding: '0.25rem 0.75rem', borderRadius: '4px', zIndex: 1, cursor: 'pointer' }} title={`Click to remove "${translateTag(tag.title)}"`} whileHover={{ backgroundColor: 'color-mix(in srgb, #DC2626 15%, transparent)' }}>
+        <motion.div 
+            layout 
+            initial={{ opacity: 0, scale: 0.5 }} 
+            animate={{ opacity: 1, scale: 1 }} 
+            exit={{ opacity: 0, scale: 0.6 }} 
+            onClick={(e) => { e.stopPropagation(); onRemove(tag._id); }} 
+            style={{ display: 'flex', alignItems: 'center', gap: '0.5rem', background: 'var(--bg-primary)', padding: '0.25rem 0.75rem', borderRadius: '4px', zIndex: 1, cursor: 'pointer' }} 
+            title={`Click to remove "${translateTag(tag.title)}"`} 
+            whileHover={{ backgroundColor: 'color-mix(in srgb, #DC2626 15%, transparent)' }}
+        >
             <span>{translateTag(tag.title)}</span>
             <svg width="12" height="12" viewBox="0 0 24" style={{ flexShrink: 0 }}><path fill="currentColor" d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
         </motion.div>
     );
 };
 
-export function TagInput({ allTags, selectedTags, onTagsChange }: TagInputProps) {
+export function TagInput({ label, allTags, selectedTags = [], onTagsChange, placeholder = "ابحث أو أنشئ وسمًا...", singleSelection = false, categoryForCreation }: TagInputProps) {
     const [isPopoverOpen, setIsPopoverOpen] = useState(false);
     const [isAddTagModalOpen, setIsAddTagModalOpen] = useState(false);
     const [searchTerm, setSearchTerm] = useState('');
     const wrapperRef = useRef<HTMLDivElement>(null);
     const inputRef = useRef<HTMLInputElement>(null);
 
+    const safeSelectedTags = (selectedTags || []).filter(Boolean);
+
     const filteredResults = (searchTerm
         ? allTags.filter(tag => 
             tag.title.toLowerCase().includes(searchTerm.toLowerCase()) || 
             translateTag(tag.title).toLowerCase().includes(searchTerm.toLowerCase())
           )
         : allTags
-    ).filter(tag => !selectedTags.some(st => st._id === tag._id));
+    ).filter(tag => !safeSelectedTags.some(st => st._id === tag._id));
     
     useEffect(() => { 
         const handleClickOutside = (event: MouseEvent) => { 
-            if (wrapperRef.current && !wrapperRef.current.contains(event.target as Node)) { 
-                setIsPopoverOpen(false); 
-            } 
+            if (wrapperRef.current && !wrapperRef.current.contains(event.target as Node)) { setIsPopoverOpen(false); } 
         }; 
         document.addEventListener('mousedown', handleClickOutside); 
         return () => document.removeEventListener('mousedown', handleClickOutside); 
     }, []);
     
     useEffect(() => { 
-        if (isPopoverOpen) { 
-            setTimeout(() => inputRef.current?.focus(), 100); 
-        } else { 
-            setSearchTerm(''); 
-        } 
+        if (isPopoverOpen) { setTimeout(() => inputRef.current?.focus(), 100); } 
+        else { setSearchTerm(''); } 
     }, [isPopoverOpen]);
 
-    const addTag = (tag: Tag) => { if (!selectedTags.some(t => t._id === tag._id)) { onTagsChange([...selectedTags, tag]); } setSearchTerm(''); inputRef.current?.focus(); };
-    const removeTag = (tagIdToRemove: string) => { onTagsChange(selectedTags.filter(tag => tag._id !== tagIdToRemove)); };
+    const handleSelectTag = (tag: Tag) => {
+        if (singleSelection) {
+            onTagsChange([tag]);
+            setIsPopoverOpen(false);
+        } else {
+            if (!safeSelectedTags.some(t => t._id === tag._id)) {
+                onTagsChange([...safeSelectedTags, tag]);
+            }
+        }
+        setSearchTerm('');
+        if (inputRef.current) inputRef.current.focus();
+    };
+    
+    const handleRemoveTag = (tagIdToRemove: string) => {
+        if (singleSelection) {
+            onTagsChange([]);
+        } else {
+            onTagsChange(safeSelectedTags.filter(tag => tag._id !== tagIdToRemove));
+        }
+    };
+    
     const handleOpenModal = () => { setIsPopoverOpen(false); setIsAddTagModalOpen(true); };
-    const handleCreateTag = async (title: string) => { const newTag = await createTagAction(title); if (newTag) { addTag(newTag); } setIsAddTagModalOpen(false); setSearchTerm(''); };
+    const handleCreateTag = async (title: string) => { 
+        const newTag = await createTagAction(title, categoryForCreation); 
+        if (newTag) { handleSelectTag(newTag); } 
+        setIsAddTagModalOpen(false); 
+        setSearchTerm(''); 
+    };
     
     const showCreateOption = searchTerm.trim().length > 1 && !allTags.some(r => r.title.toLowerCase() === searchTerm.toLowerCase());
     
+    const hasSelection = safeSelectedTags.length > 0;
+
     return (
         <>
             <AddTagModal isOpen={isAddTagModalOpen} onClose={() => setIsAddTagModalOpen(false)} onSubmit={handleCreateTag} initialValue={searchTerm} />
             <div className={styles.sidebarSection} ref={wrapperRef}>
-                <label className={styles.sidebarLabel}>الوسوم</label>
+                <label className={styles.sidebarLabel}>{label}</label>
                 <div className={metadataStyles.inputWrapper} style={{ position: 'relative' }}>
                     <div 
                         className={styles.sidebarInput} 
@@ -85,12 +126,16 @@ export function TagInput({ allTags, selectedTags, onTagsChange }: TagInputProps)
                         }} 
                         onClick={() => setIsPopoverOpen(true)}
                     >
-                        <AnimatePresence>{selectedTags.map(tag => (<AnimatedTag key={tag._id} tag={tag} onRemove={removeTag} />))}</AnimatePresence>
-                        {selectedTags.length === 0 && !isPopoverOpen && (
-                            <span style={{ color: 'var(--text-secondary)', position: 'absolute', right: '1rem', left: 'auto', top: '50%', transform: 'translateY(-50%)', pointerEvents: 'none' }}>انقر لإضافة الوسوم...</span>
+                        <AnimatePresence>
+                            {safeSelectedTags.map(tag => (
+                                tag && tag._id ? <AnimatedTag key={tag._id} tag={tag} onRemove={handleRemoveTag} /> : null
+                            ))}
+                        </AnimatePresence>
+                        {!hasSelection && !isPopoverOpen && (
+                            <span style={{ color: 'var(--text-secondary)', position: 'absolute', right: '1rem', left: 'auto', top: '50%', transform: 'translateY(-50%)', pointerEvents: 'none' }}>{placeholder}</span>
                         )}
                     </div>
-                     <ActionButton type="button" onClick={handleOpenModal} aria-label="إضافة وسم جديد">
+                     <ActionButton type="button" onClick={handleOpenModal} aria-label="Add new tag or category">
                         <svg width="20" height="20" viewBox="0 0 24 24"><path fill="currentColor" d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/></svg>
                     </ActionButton>
                     
@@ -107,12 +152,12 @@ export function TagInput({ allTags, selectedTags, onTagsChange }: TagInputProps)
                                     padding: '0.5rem', boxShadow: '0 5px 15px rgba(0,0,0,0.1)', marginTop: '0.5rem'
                                 }}
                             >
-                                <input ref={inputRef} type="text" value={searchTerm} onChange={(e) => setSearchTerm(e.target.value)} placeholder="Search or create a tag..." className={styles.sidebarInput} style={{ marginBottom: '0.5rem' }} />
+                                <input ref={inputRef} type="text" value={searchTerm} onChange={(e) => setSearchTerm(e.target.value)} placeholder={placeholder} className={styles.sidebarInput} style={{ marginBottom: '0.5rem' }} />
                                 <div style={{ maxHeight: '180px', overflowY: 'auto' }}>
-                                    {filteredResults.map(tag => ( <button type="button" key={tag._id} onClick={() => addTag(tag)} style={{ display: 'block', width: '100%', textAlign: 'left', padding: '0.6rem 0.8rem', background: 'none', border: 'none', cursor: 'pointer', color: 'var(--text-primary)', borderRadius: '4px' }} className={styles.popoverItemButton}> {translateTag(tag.title)} </button> ))}
+                                    {filteredResults.map(tag => ( <button type="button" key={tag._id} onClick={() => handleSelectTag(tag)} style={{ display: 'block', width: '100%', textAlign: 'right', padding: '0.6rem 0.8rem', background: 'none', border: 'none', cursor: 'pointer', color: 'var(--text-primary)', borderRadius: '4px' }} className={styles.popoverItemButton}> {translateTag(tag.title)} </button> ))}
                                     {showCreateOption && (
-                                        <button type="button" onClick={handleOpenModal} style={{ display: 'block', width: '100%', textAlign: 'left', padding: '0.8rem 1rem', background: 'none', border: 'none', cursor: 'pointer', color: 'var(--text-primary)', fontStyle: 'italic' }} className={styles.popoverItemButton}>
-                                            + Create new tag: "{searchTerm.trim()}"
+                                        <button type="button" onClick={handleOpenModal} style={{ display: 'block', width: '100%', textAlign: 'right', padding: '0.8rem 1rem', background: 'none', border: 'none', cursor: 'pointer', color: 'var(--text-primary)', fontStyle: 'italic' }} className={styles.popoverItemButton}>
+                                            + إنشاء جديد: "{searchTerm.trim()}"
                                         </button>
                                     )}
                                 </div>
@@ -123,6 +168,4 @@ export function TagInput({ allTags, selectedTags, onTagsChange }: TagInputProps)
             </div>
         </>
     );
-}
-
-
+}
\ No newline at end of file
diff --git a/app/studio/[contentType]/[id]/page.tsx b/app/studio/[contentType]/[id]/page.tsx
index d6527dc..0ff208b 100644
--- a/app/studio/[contentType]/[id]/page.tsx
+++ b/app/studio/[contentType]/[id]/page.tsx
@@ -1,93 +1,58 @@
 // app/studio/[contentType]/[id]/page.tsx
-'use client'; 
 
-import { createClient } from 'next-sanity';
-import { projectId, dataset, apiVersion } from '@/lib/sanity.client';
+import { sanityWriteClient } from '@/lib/sanity.server';
 import { editorDocumentQuery, allGamesForStudioQuery, allTagsForStudioQuery, allCreatorsForStudioQuery } from '@/lib/sanity.queries';
 import { EditorClient } from "./EditorClient";
 import { portableTextToTiptap } from '../../utils/portableTextToTiptap';
-import { useState, useEffect, use } from 'react';
+import { notFound } from 'next/navigation';
+import { unstable_noStore as noStore } from 'next/cache';
 
-const studioClient = createClient({
-    projectId,
-    dataset,
-    apiVersion,
-    useCdn: false,
-    token: process.env.NEXT_PUBLIC_SANITY_API_WRITE_TOKEN,
-});
+export const runtime = 'nodejs';
 
-const EditorLoading = () => (
-    <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'center', height: '100vh', backgroundColor: 'var(--bg-primary)' }}>
-        <div className="spinner" style={{ width: '60px', height: '60px' }} />
-    </div>
-);
+// THE DEFINITIVE FIX: The component function is now `async` to handle promise-based props.
+export default async function EditorPage({ params: paramsPromise }: { params: Promise<{ contentType: string; id: string }> }) {
+    noStore();
 
-export default function EditorPage({ params }: { params: Promise<{ contentType: string; id: string }> }) {
-    const resolvedParams = use(params);
+    // Await the params promise to get the resolved object.
+    const params = await paramsPromise;
 
-    const [isLoading, setIsLoading] = useState(true);
-    const [editorData, setEditorData] = useState<any>(null);
-    const [error, setError] = useState<string | null>(null);
+    if (!params || !params.id) {
+        notFound();
+    }
 
-    useEffect(() => {
-        const fetchData = async () => {
-            try {
-                const { id } = resolvedParams;
-                
-                const [document, allGames, allTags, allCreators] = await Promise.all([
-                    studioClient.fetch(editorDocumentQuery, { id }),
-                    studioClient.fetch(allGamesForStudioQuery),
-                    studioClient.fetch(allTagsForStudioQuery),
-                    studioClient.fetch(allCreatorsForStudioQuery)
-                ]);
+    const publicId = params.id.replace('drafts.', '');
 
-                if (!document) {
-                    setError('Document not found. It may have been deleted or the ID is incorrect.');
-                    setIsLoading(false);
-                    return;
-                }
-                
-                const tiptapContent = portableTextToTiptap(document.content ?? []);
-                const documentWithTiptapContent = { ...document, tiptapContent };
-                
-                setEditorData({
-                    document: documentWithTiptapContent,
-                    allGames,
-                    allTags,
-                    allCreators,
-                });
-            } catch (err: any) {
-                console.error("Failed to load editor data:", err);
-                setError('Failed to load editor data. Please check the console for details.');
-            } finally {
-                setIsLoading(false);
-            }
-        };
-        
-        if (resolvedParams) {
-            fetchData();
-        }
-    }, [resolvedParams]);
+    try {
+        const [document, allGames, allTags, allCreators] = await Promise.all([
+            sanityWriteClient.fetch(editorDocumentQuery, { id: publicId }),
+            sanityWriteClient.fetch(allGamesForStudioQuery),
+            sanityWriteClient.fetch(allTagsForStudioQuery),
+            sanityWriteClient.fetch(allCreatorsForStudioQuery)
+        ]);
 
-    if (isLoading) {
-        return <EditorLoading />;
-    }
+        if (!document) {
+            notFound();
+        }
+        
+        const tiptapContent = portableTextToTiptap(document.content ?? []);
+        const documentWithTiptapContent = { ...document, tiptapContent };
+        
+        return (
+            <EditorClient 
+                document={documentWithTiptapContent} 
+                allGames={allGames}
+                allTags={allTags}
+                allCreators={allCreators}
+            />
+        );
 
-    if (error || !editorData) {
+    } catch (err: any) {
+        console.error("Failed to load editor data:", err);
         return (
             <div className="container page-container" style={{ textAlign: 'center' }}>
                 <h1 className="page-title">Error Loading Editor</h1>
-                <p style={{color: 'var(--text-secondary)'}}>{error || 'The requested document could not be loaded.'}</p>
+                <p style={{color: 'var(--text-secondary)'}}>Failed to load editor data. Please check the deployment logs for details.</p>
             </div>
         );
     }
-    
-    return <EditorClient 
-                document={editorData.document} 
-                allGames={editorData.allGames}
-                allTags={editorData.allTags}
-                allCreators={editorData.allCreators}
-           />;
-}
-
-
+}
\ No newline at end of file
diff --git a/app/studio/actions.ts b/app/studio/actions.ts
index f858169..f9ae58c 100644
--- a/app/studio/actions.ts
+++ b/app/studio/actions.ts
@@ -14,18 +14,18 @@ import { editorDocumentQuery } from '@/lib/sanity.queries';
 import type { QueryParams, IdentifiedSanityDocumentStub } from '@sanity/client';
 
 
-// --- uploadImageFromUrlAction REMOVED as it's no longer needed ---
-
 export async function createDraftAction(contentType: 'review' | 'article' | 'news' | 'gameRelease') {
     const session = await getServerSession(authOptions);
-    if (!session?.user?.id || !session.user.roles) throw new Error('غير مصرح لك.');
+    if (!session?.user?.id || !session.user.roles) throw new Error('غير مُخَوَّل.');
     
     const userRoles = session.user.roles;
     const canCreate = (userRoles.includes('ADMIN') || userRoles.includes('DIRECTOR')) || (contentType === 'review' && userRoles.includes('REVIEWER')) || (contentType === 'article' && userRoles.includes('AUTHOR')) || (contentType === 'news' && userRoles.includes('REPORTER'));
-    if (!canCreate) throw new Error('صلاحيات غير كافية.');
+    if (!canCreate) throw new Error('صلاحياتٌ قاصرة.');
 
-    const highestIdQuery = groq`*[_type in ["review", "article", "news", "gameRelease"]] | order(legacyId desc)[0].legacyId`;
-    const lastId = await sanityWriteClient.fetch<number>(highestIdQuery);
+    // THE DEFINITIVE FIX: The query now explicitly filters for documents where `legacyId` is defined.
+    // This prevents `order()` from failing and ensures `[0]` doesn't access an empty set incorrectly.
+    const highestIdQuery = groq`*[_type in ["review", "article", "news", "gameRelease"] && defined(legacyId)] | order(legacyId desc)[0].legacyId`;
+    const lastId = await sanityWriteClient.fetch<number>(highestIdQuery, {}, { perspective: 'previewDrafts' });
     const newLegacyId = (lastId || 0) + 1;
 
     let doc: any = { _type: contentType, title: `Untitled ${contentType.charAt(0).toUpperCase() + contentType.slice(1)}`, legacyId: newLegacyId };
@@ -35,7 +35,7 @@ export async function createDraftAction(contentType: 'review' | 'article' | 'new
         const creatorTypeMap: Record<string, string> = { 'review': 'reviewer', 'article': 'author', 'news': 'reporter' };
         const sanityDocType = creatorTypeMap[contentType];
         const user = await prisma.user.findUnique({ where: { id: session.user.id }, select: { id: true, name: true, image: true } });
-        if (!user || !user.name) throw new Error("User not found or name is missing.");
+        if (!user || !user.name) throw new Error("المستخدمُ مفقودٌ أو الاسمُ غائب.");
         
         const existingCreator = await sanityWriteClient.fetch(`*[_type == "${sanityDocType}" && prismaUserId == $userId][0]`, { userId: session.user.id });
         if (existingCreator) {
@@ -60,7 +60,6 @@ export async function createDraftAction(contentType: 'review' | 'article' | 'new
     }
     
     if (contentType === 'review') { doc.score = 0; doc.verdict = '...'; doc.pros = []; doc.cons = []; }
-    if (contentType === 'news') doc.category = 'Industry';
     if (contentType === 'article') doc.publishedYear = new Date().getFullYear();
     if (contentType === 'gameRelease') { doc.releaseDate = new Date().toISOString().split('T')[0]; doc.synopsis = '...'; doc.platforms = []; }
     
@@ -71,7 +70,7 @@ export async function createDraftAction(contentType: 'review' | 'article' | 'new
 
 export async function updateDocumentAction(docId: string, patchData: Record<string, any>): Promise<{ success: boolean; message?: string; updatedDocument?: any }> {
     const session = await getServerSession(authOptions);
-    if (!session?.user?.id) return { success: false, message: 'غير مصرح لك.' };
+    if (!session?.user?.id) return { success: false, message: 'غير مُخَوَّل.' };
 
     const publicId = docId.replace('drafts.', '');
     const draftId = `drafts.${publicId}`;
@@ -87,7 +86,7 @@ export async function updateDocumentAction(docId: string, patchData: Record<stri
             if (!originalDoc) {
                 const docTypeQuery = groq`*[_id == $id][0]._type`;
                 const docType = await sanityWriteClient.fetch(docTypeQuery, { id: publicId });
-                if (!docType) throw new Error("Document type not found for creation.");
+                if (!docType) throw new Error("لم يُعثر على نوع الوثيقة لإنشائها.");
                 const newDoc = { _id: draftId, _type: docType, ...patchData };
                 tx.create(newDoc);
             } else {
@@ -100,11 +99,10 @@ export async function updateDocumentAction(docId: string, patchData: Record<stri
         await tx.commit({ autoGenerateArrayKeys: true, returnDocuments: false });
         revalidatePath('/studio');
         
-        // --- THE FIX: Fetch and return the authoritative document state ---
         const finalDoc = await sanityWriteClient.fetch(editorDocumentQuery, { id: draftId });
         if (!finalDoc) {
              const publicDoc = await sanityWriteClient.fetch(editorDocumentQuery, { id: publicId });
-             if (!publicDoc) throw new Error("Document not found after update.");
+             if (!publicDoc) throw new Error("الوثيقةُ مفقودةٌ بعد تحديثها.");
              const docWithTiptap = { ...publicDoc, tiptapContent: portableTextToTiptap(publicDoc.content ?? []) };
              return { success: true, updatedDocument: docWithTiptap };
         }
@@ -114,27 +112,27 @@ export async function updateDocumentAction(docId: string, patchData: Record<stri
 
     } catch (error: any) {
         console.error("Error during document update:", error);
-        return { success: false, message: error.message || "An unexpected error occurred during the save operation." };
+        return { success: false, message: error.message || "أصابنا خطبٌ أثناء الحفظ." };
     }
 }
 
 
 export async function deleteDocumentAction(docId: string): Promise<{ success: boolean; message?: string }> {
     const session = await getServerSession(authOptions);
-    if (!session?.user?.id || !session.user.roles) return { success: false, message: 'غير مصرح لك.' };
-    const docToDelete = await sanityWriteClient.fetch(groq`*[_id == $docId][0]{_type}`, { docId });
-    if (!docToDelete) return { success: false, message: 'Document not found.' };
+    if (!session?.user?.id || !session.user.roles) return { success: false, message: 'غير مُخَوَّل.' };
+    const docToحذف = await sanityWriteClient.fetch(groq`*[_id == $docId][0]{_type}`, { docId });
+    if (!docToحذف) return { success: false, message: 'الوثيقةُ مفقودة.' };
     const userRoles = session.user.roles;
     const isAdminOrDirector = userRoles.includes('ADMIN') || userRoles.includes('DIRECTOR');
-    const docType = docToDelete._type;
-    const canDelete = isAdminOrDirector || (docType === 'review' && userRoles.includes('REVIEWER')) || (docType === 'article' && userRoles.includes('AUTHOR')) || (docType === 'news' && userRoles.includes('REPORTER'));
-    if (!canDelete) return { success: false, message: 'Insufficient permissions.' };
+    const docType = docToحذف._type;
+    const canحذف = isAdminOrDirector || (docType === 'review' && userRoles.includes('REVIEWER')) || (docType === 'article' && userRoles.includes('AUTHOR')) || (docType === 'news' && userRoles.includes('REPORTER'));
+    if (!canحذف) return { success: false, message: 'أذوناتٌ قاصرة.' };
     const result = await sanityWriteClient.delete(docId);
     if (result.results.length > 0) {
         revalidatePath('/studio');
         return { success: true };
     }
-    return { success: false, message: 'Could not be deleted.' };
+    return { success: false, message: 'تأبى الحذف.' };
 }
 
 export async function searchCreatorsAction(query: string, roleName: 'REVIEWER' | 'AUTHOR' | 'REPORTER' | 'DESIGNER'): Promise<{ _id: string; name: string }[]> {
@@ -152,18 +150,17 @@ export async function publishDocumentAction(docId: string, publishTime?: string
     const userRoles = session?.user?.roles || [];
     const isAdminOrDirector = userRoles.includes('ADMIN') || userRoles.includes('DIRECTOR');
     const doc = await sanityWriteClient.fetch(groq`*[_id == $docId || _id == 'drafts.' + $docId] | order(_updatedAt desc)[0]{_id, _type, "slug": slug.current}`, { docId });
-    if (!doc) return { success: false, message: 'Document not found.' };
+    if (!doc) return { success: false, message: 'الوثيقةُ مفقودة.' };
     
     const docType = doc._type;
     
     const canPublish = isAdminOrDirector || (docType === 'review' && userRoles.includes('REVIEWER')) || (docType === 'article' && userRoles.includes('AUTHOR')) || (docType === 'news' && userRoles.includes('REPORTER')) || (docType === 'gameRelease' && isAdminOrDirector);
-    if (!canPublish) return { success: false, message: 'صلاحيات غير كافية.' };
+    if (!canPublish) return { success: false, message: 'صلاحياتٌ قاصرة.' };
 
     try {
         const publicId = docId.replace('drafts.', '');
         const draftId = `drafts.${publicId}`;
 
-        // UNPUBLISH action (won't trigger for gameRelease)
         if (publishTime === null) {
             const tx = sanityWriteClient.transaction();
             tx.delete(publicId);
@@ -177,7 +174,7 @@ export async function publishDocumentAction(docId: string, publishTime?: string
 
             const finalDoc = await sanityWriteClient.fetch(editorDocumentQuery, { id: draftId });
             const docWithTiptap = { ...finalDoc, tiptapContent: portableTextToTiptap(finalDoc.content ?? []) };
-            return { success: true, updatedDocument: docWithTiptap, message: 'تم إلغاء نشر المستند بنجاح.' };
+            return { success: true, updatedDocument: docWithTiptap, message: 'أُلغيَ نشرُ الوثيقة.' };
         }
 
         const draft = await sanityWriteClient.getDocument(draftId);
@@ -217,12 +214,12 @@ export async function publishDocumentAction(docId: string, publishTime?: string
 
         const finalDoc = await sanityWriteClient.fetch(editorDocumentQuery, { id: publicId });
         const docWithTiptap = { ...finalDoc, tiptapContent: portableTextToTiptap(finalDoc.content ?? []) };
-        const message = docType === 'gameRelease' ? 'تم نشر الإصدار بنجاح.' : (publishTime ? 'تم جدولة المستند بنجاح.' : 'تم نشر المستند بنجاح.');
+        const message = docType === 'gameRelease' ? 'نُشِرَ الإصدار.' : (publishTime ? 'جُدولت الوثيقة.' : 'نُشِرت الوثيقة.');
         return { success: true, updatedDocument: docWithTiptap, message: message };
 
     } catch (error) {
         console.error('Failed to publish/unpublish document:', error);
-        return { success: false, message: 'Failed to commit publication status.' };
+        return { success: false, message: 'أخفق تنفيذ حالة النشر.' };
     }
 }
 
@@ -234,7 +231,7 @@ export async function searchGamesAction(query: string): Promise<{_id: string, ti
             { searchTerm: query }
         ) as {_id: string, title: string}[];
         return results;
-    } catch (error) { console.error("Game search failed:", error); return []; }
+    } catch (error) { console.error("أخفق البحث عن اللعبة:", error); return []; }
 }
 
 export async function createGameAction(title: string): Promise<{_id: string, title: string} | null> {
@@ -243,7 +240,7 @@ export async function createGameAction(title: string): Promise<{_id: string, tit
     try {
         const newGame = await sanityWriteClient.create({ _type: 'game', title, slug: { _type: 'slug', current: slugify(title.toLowerCase(), { separator: '-' }) } });
         return { _id: newGame._id, title: newGame.title };
-    } catch (error) { console.error("Failed to create game:", error); return null; }
+    } catch (error) { console.error("أخفق إنشاء اللعبة:", error); return null; }
 }
 
 export async function searchTagsAction(query: string): Promise<{_id: string, title: string}[]> {
@@ -254,36 +251,36 @@ export async function searchTagsAction(query: string): Promise<{_id: string, tit
             { searchTerm: query }
         ) as {_id: string, title: string}[];
         return results;
-    } catch (error) { console.error("Tag search failed:", error); return []; }
+    } catch (error) { console.error("أخفق البحث عن الوسم:", error); return []; }
 }
 
-export async function createTagAction(title: string): Promise<{_id: string, title: string} | null> {
+export async function createTagAction(title: string, category: 'Game' | 'Article' | 'News'): Promise<{_id: string, title: string} | null> {
     const session = await getServerSession(authOptions);
     if (!session?.user?.id || !session.user.roles.some((role: string) => ['ADMIN', 'DIRECTOR', 'REVIEWER', 'AUTHOR', 'REPORTER', 'DESIGNER'].includes(role))) { return null; }
     try {
-        const newTag = await sanityWriteClient.create({ _type: 'tag', title, slug: { _type: 'slug', current: slugify(title.toLowerCase()) } });
+        const newTag = await sanityWriteClient.create({ _type: 'tag', title, category, slug: { _type: 'slug', current: slugify(title.toLowerCase()) } });
         return { _id: newTag._id, title: newTag.title };
-    } catch (error) { console.error("Failed to create tag:", error); return null; }
+    } catch (error) { console.error("أخفق إنشاء الوسم:", error); return null; }
 }
 
 export async function getRecentTagsAction(): Promise<{_id: string, title: string}[]> {
     try {
         const results = await sanityWriteClient.fetch(groq`*[_type == "tag"] | order(_createdAt desc)[0...50]{_id, title}`);
         return results;
-    } catch (error) { console.error("Recent tags fetch failed:", error); return []; }
+    } catch (error) { console.error("أخفق جلب آخر الوسوم:", error); return []; }
 }
 
 export async function validateSlugAction(slug: string, docId: string): Promise<{ isValid: boolean; message: string }> {
     if (!docId) {
-        return { isValid: false, message: 'Waiting for document ID...' };
+        return { isValid: false, message: 'بانتظار مُعرِّف الوثيقة...' };
     }
     
     if (!slug || slug.trim() === '') {
-        return { isValid: false, message: 'المُعرِّف لا يمكن أن يكون فارغًا.' };
+        return { isValid: false, message: 'لا يكُن المُعرِّفُ خاويًا.' };
     }
     const slugRegex = /^[a-z0-9]+(?:-[a-z0-9]+)*$/;
     if (!slugRegex.test(slug)) {
-        return { isValid: false, message: 'يمكن أن يحتوي المُعرِّف على أحرف وأرقام وشرطات فقط.' };
+        return { isValid: false, message: 'المُعرِّف: حروفٌ وأرقامٌ وشَرْطاتٌ لا غير.' };
     }
     
     const query = groq`!defined(*[
@@ -299,14 +296,40 @@ export async function validateSlugAction(slug: string, docId: string): Promise<{
         const isUnique = await sanityWriteClient.fetch(query, { slug, draftId, publicId });
         
         if (isUnique) {
-            return { isValid: true, message: 'المُعرِّف صالح.' };
+            return { isValid: true, message: 'المُعرِّفُ صالح.' };
         }
-        return { isValid: false, message: 'هذا المُعرِّف مستخدم بالفعل.' };
+        return { isValid: false, message: 'مُعرِّفٌ مُستعمل.' };
 
     } catch (error) {
         console.error('Sanity slug validation failed:', error);
-        return { isValid: false, message: 'فشل التحقق بسبب خطأ في الخادم.' };
+        return { isValid: false, message: 'أخفق التحقق لخطبٍ في الخادم.' };
     }
 }
 
+export async function uploadSanityAssetAction(formData: FormData): Promise<{ success: boolean; asset?: { _id: string; url: string }; error?: string }> {
+    const session = await getServerSession(authOptions);
+    const userRoles = session?.user?.roles || [];
+    const isCreatorOrAdmin = userRoles.some((role: string) =>
+      ['DIRECTOR', 'ADMIN', 'REVIEWER', 'AUTHOR', 'REPORTER', 'DESIGNER'].includes(role)
+    );
+
+    if (!session?.user?.id || !isCreatorOrAdmin) {
+        return { success: false, error: 'غير مُصرَّح به' };
+    }
+    
+    const file = formData.get('file') as File | null;
+    if (!file) {
+        return { success: false, error: 'لم يُقدَّم ملف.' };
+    }
 
+    try {
+        const asset = await sanityWriteClient.assets.upload('image', file, {
+            filename: file.name,
+            contentType: file.type,
+        });
+        return { success: true, asset: { _id: asset._id, url: asset.url } };
+    } catch (error: any) {
+        console.error("Sanity asset upload failed:", error);
+        return { success: false, error: 'أخفق رفع الملف.' };
+    }
+}
\ No newline at end of file
diff --git a/app/studio/director/EditRolesModal.tsx b/app/studio/director/EditRolesModal.tsx
index f383878..a64601d 100644
--- a/app/studio/director/EditRolesModal.tsx
+++ b/app/studio/director/EditRolesModal.tsx
@@ -40,18 +40,18 @@ export function EditRolesModal({ user, allRoles, onClose, onUpdate }: { user: Us
             const result = await updateUserRolesAction(user.id, Array.from(finalRoleIds));
             if (result.success && result.updatedRoles) {
                 onUpdate(user.id, result.updatedRoles);
-                toast.success(`Roles for ${user.name} updated.`);
+                toast.success(`أدوار ${user.name} حُدِّثت.`);
                 onClose();
             } else {
-                toast.error(result.message || 'فشل تحديث الأدوار.');
+                toast.error(result.message || 'أخفق تحديث الأدوار.');
             }
         });
     };
 
     return (
         <Modal isOpen={!!user} onClose={onClose}>
-            <h3 style={{ marginTop: 0 }}>Edit Roles for {user.name}</h3>
-            <p style={{ color: 'var(--text-secondary)', marginTop: '-1rem' }}>حدد الأدوار التي يجب أن يمتلكها هذا المستخدم.</p>
+            <h3 style={{ marginTop: 0 }}>تعديل أدوار {user.name}</h3>
+            <p style={{ color: 'var(--text-secondary)', marginTop: '-1rem' }}>اختر الأدوار التي سيتقلَّدها هذا المستخدم.</p>
             <div className="roles-checklist" style={{ 
                 display: 'grid', 
                 gridTemplateColumns: '1fr 1fr', 
diff --git a/app/studio/director/UserManagementClient.tsx b/app/studio/director/UserManagementClient.tsx
index 5e5c7b5..ee8f4e0 100644
--- a/app/studio/director/UserManagementClient.tsx
+++ b/app/studio/director/UserManagementClient.tsx
@@ -18,7 +18,7 @@ const UserRow = ({ user, allRoles, onEdit }: { user: UserWithRoles, allRoles: Ro
     const rolesToDisplay = currentRoleNames.filter(name => name !== 'USER').sort();
     
     // Fallback if no roles other than USER are assigned
-    const displayString = rolesToDisplay.length > 0 ? rolesToDisplay.join(', ') : 'User (Default)';
+    const displayString = rolesToDisplay.length > 0 ? rolesToDisplay.join(', ') : 'مستخدم (افتراضي)';
     
     return (
         <motion.div
@@ -120,7 +120,7 @@ export function UserManagementClient({ initialUsers, allRoles }: { initialUsers:
             <div className="user-management-container">
                 <input
                     type="search"
-                    placeholder="ابحث بالاسم أو البريد الإلكتروني..."
+                    placeholder="ابحث بالاسم أو البريد..."
                     value={searchTerm}
                     onChange={(e) => setSearchTerm(e.target.value)}
                     className="profile-input search-input"
diff --git a/app/studio/director/actions.ts b/app/studio/director/actions.ts
index 386ca08..6653038 100644
--- a/app/studio/director/actions.ts
+++ b/app/studio/director/actions.ts
@@ -5,7 +5,7 @@
 import { getServerSession } from "next-auth/next";
 import { authOptions } from "@/app/lib/authOptions";
 import prisma from "@/lib/prisma";
-import { revalidatePath } from "next/cache";
+import { revalidatePath, revalidateTag } from "next/cache";
 import { Role } from "@prisma/client";
 import { sanityWriteClient } from "@/lib/sanity.server";
 
@@ -55,7 +55,7 @@ async function findOrCreateSanityCreator(userId: string, sanityType: string) {
 export async function updateUserRolesAction(userId: string, roleIds: number[]) {
     const session = await getServerSession(authOptions);
     if (!session?.user?.roles.includes('DIRECTOR')) {
-        return { success: false, message: "غير مصرح لك." };
+        return { success: false, message: "غير مُخَوَّل." };
     }
 
     try {
@@ -79,6 +79,10 @@ export async function updateUserRolesAction(userId: string, roleIds: number[]) {
             }
         }
         // --- END NEW LOGIC ---
+        
+        // --- ADDED TAG REVALIDATION ---
+        revalidateTag('enriched-creators', '');
+        revalidateTag('enriched-creator-details', '');
 
         revalidatePath('/studio/director');
         revalidatePath(`/profile/${userId}`);
@@ -89,8 +93,6 @@ export async function updateUserRolesAction(userId: string, roleIds: number[]) {
         return { success: true, updatedRoles: updatedUser.roles as Role[] };
     } catch (error) {
         console.error("Failed to update user roles:", error);
-        return { success: false, message: "A database error occurred." };
+        return { success: false, message: "خطبٌ في قاعدة البيانات." };
     }
-}
-
-
+}
\ No newline at end of file
diff --git a/app/studio/director/page.tsx b/app/studio/director/page.tsx
index 5f0f4b4..6f57d18 100644
--- a/app/studio/director/page.tsx
+++ b/app/studio/director/page.tsx
@@ -35,7 +35,7 @@ export default async function DirectorPage() {
         <div className="container page-container">
             <header style={{ textAlign: 'center', marginBottom: '3rem' }}>
                 <h1 className="page-title">الإدارة</h1>
-                <p className="sidebar-subtitle" style={{ fontSize: '1.8rem', maxWidth: '600px', margin: '0 auto' }}>تعيين وإدارة الأدوار لجميع المستخدمين. تسري التغييرات في الجلسة التالية للمستخدم.</p>
+                <p className="sidebar-subtitle" style={{ fontSize: '1.8rem', maxWidth: '600px', margin: '0 auto' }}>عيّن وأدِر الأدوار. تسري التغييرات بعد إعادة تسجيل الدخول.</p>
             </header>
             <UserManagementClient initialUsers={users} allRoles={allRoles} />
         </div>
diff --git a/app/studio/page.tsx b/app/studio/page.tsx
index 2129a5c..5a3ad9c 100644
--- a/app/studio/page.tsx
+++ b/app/studio/page.tsx
@@ -1,21 +1,14 @@
 // app/studio/page.tsx
 
-import { createClient } from 'next-sanity';
 import { groq } from 'next-sanity';
 import { StudioDashboard } from './StudioDashboard';
-import { projectId, dataset, apiVersion } from '@/lib/sanity.client';
+import { sanityWriteClient } from '@/lib/sanity.server'; // CORRECTED: Use server client
 import { unstable_noStore as noStore } from 'next/cache';
 import { getServerSession } from 'next-auth/next';
 import { authOptions } from '@/app/lib/authOptions';
 import { redirect } from 'next/navigation';
 
-const studioClient = createClient({
-    projectId,
-    dataset,
-    apiVersion,
-    useCdn: false,
-    token: process.env.SANITY_API_WRITE_TOKEN,
-});
+export const runtime = 'nodejs';
 
 const allEditableContentQuery = groq`
 *[_type in $allowedTypes] | order(_updatedAt desc) {
@@ -25,10 +18,11 @@ const allEditableContentQuery = groq`
     title,
     "slug": slug.current,
     "status": select(
+        _id in path("drafts.**") => "draft",
         _type == "gameRelease" => "published",
+        defined(publishedAt) && publishedAt > now() => "scheduled",
         defined(publishedAt) && publishedAt < now() => "published",
-        !defined(publishedAt) => "draft",
-        "scheduled"
+        "draft"
     ),
     "mainImage": mainImage,
     "blurDataURL": mainImage.asset->metadata.lqip
@@ -41,7 +35,9 @@ export default async function StudioPage() {
     const session = await getServerSession(authOptions);
     const userRoles = (session?.user as any)?.roles || [];
     
-    const isAdminOrDirector = userRoles.includes('ADMIN') || userRoles.includes('DIRECTOR');
+    const isAdminOrDirector =
+        userRoles.includes('ADMIN') || userRoles.includes('DIRECTOR');
+
     const allowedContentTypes: string[] = [];
 
     if (isAdminOrDirector) {
@@ -51,18 +47,24 @@ export default async function StudioPage() {
         if (userRoles.includes('AUTHOR')) allowedContentTypes.push('article');
         if (userRoles.includes('REPORTER')) allowedContentTypes.push('news');
     }
-    
+
     if (allowedContentTypes.length === 0 && !userRoles.includes('DESIGNER')) {
-        redirect('/'); 
+        redirect('/');
     }
 
-    const content = allowedContentTypes.length > 0
-        ? await studioClient.fetch(allEditableContentQuery, { allowedTypes: allowedContentTypes })
-        : [];
+    const content =
+        allowedContentTypes.length > 0
+            ? await sanityWriteClient.fetch(allEditableContentQuery, { // CORRECTED: Use server client
+                  allowedTypes: allowedContentTypes,
+              })
+            : [];
 
     return (
         <div className="container page-container">
-            <StudioDashboard initialContent={content} userRoles={userRoles} />
+            <StudioDashboard
+                initialContent={content}
+                userRoles={userRoles}
+            />
         </div>
     );
 }
\ No newline at end of file
diff --git a/app/tags/[tag]/page.tsx b/app/tags/[tag]/page.tsx
index 5cbaaf3..05f1439 100644
--- a/app/tags/[tag]/page.tsx
+++ b/app/tags/[tag]/page.tsx
@@ -5,6 +5,18 @@ import { notFound } from 'next/navigation';
 import HubPageClient from '@/components/HubPageClient';
 import { translateTag } from '@/lib/translations';
 
+export async function generateStaticParams() {
+    try {
+        const slugs = await client.fetch<string[]>(`*[_type == "tag" && defined(slug.current)][].slug.current`);
+        return slugs.map((slug) => ({
+            tag: slug,
+        }));
+    } catch (error) {
+        console.error(`[BUILD ERROR] CRITICAL: Failed to fetch slugs for tag hub pages. Build cannot continue.`, error);
+        throw error;
+    }
+}
+
 export default async function TagPage({ params }: { params: { tag: string } }) {
     const { tag } = await params;
     const tagSlug = decodeURIComponent(tag);
@@ -25,7 +37,7 @@ export default async function TagPage({ params }: { params: { tag: string } }) {
         return (
             <div className="container page-container">
                 <h1 className="page-title">وسم: &quot;{translateTag(tagMeta.title)}&quot;</h1>
-                <p style={{textAlign: 'center', color: 'var(--text-secondary)'}}>لم يتم نشر أي محتوى بهذا الوسم بعد.</p>
+                <p style={{textAlign: 'center', color: 'var(--text-secondary)'}}>لم يُنشر عملٌ بهذا الوسم بعد.</p>
             </div>
         );
     }
@@ -37,6 +49,4 @@ export default async function TagPage({ params }: { params: { tag: string } }) {
             hubType="وسم"
         />
     );
-}
-
-
+}
\ No newline at end of file
diff --git a/app/template.tsx b/app/template.tsx
index d491dbe..9a42fd0 100644
--- a/app/template.tsx
+++ b/app/template.tsx
@@ -1,17 +1,26 @@
+// app/template.tsx
 'use client';
 
-import { motion } from 'framer-motion';
+import { motion, AnimatePresence } from 'framer-motion';
+import { usePathname } from 'next/navigation';
 
 export default function Template({ children }: { children: React.ReactNode }) {
+  const pathname = usePathname();
   return (
-    <motion.div
-      initial={{ y: 20, opacity: 0 }}
-      animate={{ y: 0, opacity: 1 }}
-      transition={{ ease: 'easeInOut' as const, duration: 0.75 }}
-    >
-      {children}
-    </motion.div>
+    // AnimatePresence with mode="popLayout" is essential for shared layout animations.
+    // The direct child motion.div must NOT have an `exit` prop. A conflicting
+    // exit animation on the parent wrapper causes the source element to fade out before
+    // Framer Motion can calculate the transform, breaking the animation's origin point.
+    <AnimatePresence mode="popLayout">
+      <motion.div
+        key={pathname}
+        initial={{ opacity: 0 }}
+        animate={{ opacity: 1 }}
+        // EXIT PROP REMOVED TO FIX THE LAYOUTID CONFLICT
+        transition={{ duration: 0.3, ease: 'easeInOut' }}
+      >
+        {children}
+      </motion.div>
+    </AnimatePresence>
   );
-}
-
-
+}
\ No newline at end of file
diff --git a/app/welcome/WelcomePageClient.tsx b/app/welcome/WelcomePageClient.tsx
index a77bc87..1df44cf 100644
--- a/app/welcome/WelcomePageClient.tsx
+++ b/app/welcome/WelcomePageClient.tsx
@@ -65,12 +65,12 @@ export default function WelcomePageClient() {
         startTransition(async () => {
             const result = await completeOnboardingAction(formData);
             if (result.success) {
-                toast.success('اكتمل ملفك. أهلاً بك في EternalGames.');
+                toast.success('اكتمل ملفك. أهلًا بك في EternalGames.');
                 await update(); 
                 const callbackUrl = searchParams.get('callbackUrl') || '/';
                 router.push(callbackUrl);
             } else {
-                toast.error(result.message || 'فشل إكمال الملف الشخصي.');
+                toast.error(result.message || 'أخفق إكمال الملف.');
             }
         });
     };
@@ -93,7 +93,7 @@ export default function WelcomePageClient() {
                 animate={{ opacity: 1, y: 0 }}
             >
                 <h1 className="page-title">أهلاً بك في رحاب EternalGames!</h1>
-                <p style={{ color: 'var(--text-secondary)', fontSize: '1.8rem', marginTop: '-2rem', marginBottom: '3rem' }}>بقيت خطوة أخيرة. أكمل ملفك الشخصي لتدخل مجتمعنا.</p>
+                <p style={{ color: 'var(--text-secondary)', fontSize: '1.8rem', marginTop: '-2rem', marginBottom: '3rem' }}>خطوةٌ أخيرة تفصلك. أكمل ملفك الشخصي لتدخل مَعيَّتنا.</p>
                 <form onSubmit={handleSubmit} style={{ textAlign: 'left' }}>
                     <div className="profile-form-group">
                         <input id="fullName" name="fullName" type="text" value={fullName} onChange={(e) => setFullName(e.target.value)} className="profile-input" placeholder=" " required />
diff --git a/components/ActionButton.module.css b/components/ActionButton.module.css
index 68cd36a..6332395 100644
--- a/components/ActionButton.module.css
+++ b/components/ActionButton.module.css
@@ -4,18 +4,16 @@
     background: var(--bg-secondary);
     border: 1px solid var(--border-color);
     border-radius: 50%;
-    /* --- THE FIX IS HERE --- */
     width: 36px;
     height: 36px;
     aspect-ratio: 1 / 1;
     flex-shrink: 0;
-    /* --- END FIX --- */
     display: flex;
     align-items: center;
     justify-content: center;
     cursor: pointer;
     color: var(--text-secondary);
-    transition: all 0.2s ease;
+    transition: background-color 0.2s ease-out, border-color 0.2s ease-out, color 0.2s ease-out, transform 0.2s ease-out, box-shadow 0.2s ease-out;
     z-index: 10;
 }
 
@@ -24,15 +22,9 @@
     color: #fff;
     border-color: var(--accent);
     box-shadow: 0 0 15px color-mix(in srgb, var(--accent) 50%, transparent);
-    /* NEW: Explicitly transition transform and box-shadow quickly */
-    transition: background 0.2s ease, border-color 0.2s ease, color 0.2s ease, transform 0.2s ease-out, box-shadow 0.2s ease-out;
+    transform: scale(1.15);
 }
 
 [data-theme="dark"] .actionButton:hover:not(:disabled) {
     color: var(--bg-primary);
-}
-
-
-
-
-
+}
\ No newline at end of file
diff --git a/components/ActionButton.tsx b/components/ActionButton.tsx
index 861444f..41386e7 100644
--- a/components/ActionButton.tsx
+++ b/components/ActionButton.tsx
@@ -17,8 +17,6 @@ const ActionButton = ({ children, ...props }: ActionButtonProps) => {
         <motion.button
             className={styles.actionButton}
             whileTap={{ scale: 0.9, y: 0 }}
-            whileHover={{ scale: 1.15, y: 0 }}
-            transition={{ duration: 0.05, ease: "easeInOut" as const }}
             {...props}
         >
             {children}
@@ -26,6 +24,4 @@ const ActionButton = ({ children, ...props }: ActionButtonProps) => {
     );
 };
 
-export default ActionButton;
-
-
+export default ActionButton; 
\ No newline at end of file
diff --git a/components/ArticleCard.module.css b/components/ArticleCard.module.css
index 87bc5c9..9e969f0 100644
--- a/components/ArticleCard.module.css
+++ b/components/ArticleCard.module.css
@@ -1,18 +1,9 @@
 /* components/ArticleCard.module.css */
 
 .livingCardWrapper {
-    transform-style: preserve-3d;
     height: 100%;
 }
 
-/* This is the main link now, covering the whole card */
-.cardLink {
-    display: flex;
-    flex-direction: column;
-    height: 100%;
-    text-decoration: none;
-}
-
 .articleCard {
     background-color: var(--bg-secondary);
     border-radius: 8px;
@@ -21,7 +12,6 @@
     flex-direction: column;
     height: 100%;
     border: 1px solid var(--border-color);
-    transform-style: preserve-3d;
     will-change: transform;
     transition: box-shadow 0.4s ease-out, border-color 0.4s ease-out;
 }
@@ -58,9 +48,8 @@
     border-radius: 4px;
     box-shadow: 0 0 10px color-mix(in srgb, var(--accent) 50%, transparent);
     z-index: 2;
-    /* REMOVED transformZ, replaced with hover effect */
-    opacity: 0;
-    transform: translateY(10px);
+    opacity: 1;
+    transform: translateY(0);
     transition: opacity 0.3s ease, transform 0.3s ease;
 }
 
@@ -68,19 +57,12 @@
     color: var(--bg-primary);
 }
 
-.livingCardWrapper:hover .score {
-    opacity: 1;
-    /* REMOVED transformZ */
-    transform: translateY(0);
-}
-
 .cardContent {
     padding: 2rem;
     display: flex;
     flex-direction: column;
     flex-grow: 1;
     min-height: 0;
-    /* REMOVED transformZ */
     text-align: right;
     transition: transform 0.4s ease; /* Added for subtle hover effect */
 }
@@ -97,7 +79,7 @@
 }
 
 /* Make the title change color on card hover */
-.cardLink:hover .cardTitleLink h3 {
+.cardTitleLink:hover h3 {
     color: var(--accent);
 }
 
diff --git a/components/ArticleCard.tsx b/components/ArticleCard.tsx
index d37c9bf..6d89191 100644
--- a/components/ArticleCard.tsx
+++ b/components/ArticleCard.tsx
@@ -19,10 +19,10 @@ type ArticleCardProps = {
     article: CardProps & { width?: number; height?: number; mainImageRef?: any; };
     layoutIdPrefix: string;
     isPriority?: boolean;
-    isArticle?: boolean;
+    disableLivingEffect?: boolean; 
 };
 
-const ArticleCardComponent = ({ article, layoutIdPrefix, isPriority = false, isArticle = false }: ArticleCardProps) => {
+const ArticleCardComponent = ({ article, layoutIdPrefix, isPriority = false, disableLivingEffect = false }: ArticleCardProps) => {
     const router = useRouter();
     const setPrefix = useLayoutIdStore((state) => state.setPrefix); 
     const { livingCardRef, livingCardAnimation } = useLivingCard();
@@ -42,11 +42,9 @@ const ArticleCardComponent = ({ article, layoutIdPrefix, isPriority = false, isA
     const linkPath = `${getLinkBasePath()}${article.slug}`;
     
     const handleClick = (e: React.MouseEvent) => {
-        // If the original click target or its parent is an interactive element (a nested link or button), let it handle the event.
         if ((e.target as HTMLElement).closest('a, button, [role="button"]')) {
             return;
         }
-
         e.preventDefault();
         setPrefix(layoutIdPrefix);
         router.push(linkPath, { scroll: false });
@@ -61,55 +59,67 @@ const ArticleCardComponent = ({ article, layoutIdPrefix, isPriority = false, isA
     const imageSource = article.imageUrl;
     if (!imageSource) return null;
 
+    const wrapperProps = disableLivingEffect ? {} : {
+        ref: livingCardRef,
+        onMouseMove: livingCardAnimation.onMouseMove,
+        onMouseEnter: () => { livingCardAnimation.onHoverStart(); handleMouseEnter(); },
+        onMouseLeave: livingCardAnimation.onHoverEnd,
+    };
+    
+    // THE DEFINITIVE FIX:
+    // The style object is now defined conditionally. If the effect is disabled, only the cursor
+    // style is applied. If it's enabled, the animation styles are spread correctly.
+    // This resolves the TypeScript error where `.style` was accessed on an empty object.
+    const motionStyle = disableLivingEffect 
+        ? { cursor: 'pointer' } 
+        : { ...livingCardAnimation.style, cursor: 'pointer' };
+
     return (
         <motion.div
-            ref={livingCardRef}
-            onMouseMove={livingCardAnimation.onMouseMove}
-            onMouseEnter={() => { livingCardAnimation.onHoverStart(); handleMouseEnter(); }}
-            onMouseLeave={livingCardAnimation.onHoverEnd}
+            layoutId={`${layoutIdPrefix}-card-container-${article.legacyId}`}
+            onClick={handleClick}
             className={styles.livingCardWrapper}
-            style={livingCardAnimation.style}
+            {...wrapperProps}
+            style={motionStyle}
         >
-            <Link href={linkPath} onClick={handleClick} className={`${styles.cardLink} no-underline`}>
-                <motion.div
-                    layoutId={`${layoutIdPrefix}-card-container-${article.id}`}
-                    className={styles.articleCard}
-                >
-                    <motion.div className={styles.imageContainer} layoutId={`${layoutIdPrefix}-card-image-${article.id}`}>
-                        {hasScore && ( <motion.div className={styles.score}>{article.score!.toFixed(1)}</motion.div> )}
-                        <Image 
-                            loader={sanityLoader}
-                            src={imageSource}
-                            alt={article.title}
-                            width={800} // Default width, loader will override
-                            height={450} // Default height, loader will override
-                            sizes="(max-width: 768px) 90vw, (max-width: 1200px) 45vw, 350px"
-                            className={styles.cardImage}
-                            style={{ objectFit: 'cover' }}
-                            placeholder="blur" 
-                            blurDataURL={article.blurDataURL}
-                            priority={isPriority}
-                        />
-                    </motion.div>
-                    <motion.div className={styles.cardContent}>
-                        <div className={styles.cardTitleLink}> {/* Re-purposed class for styling */}
-                            <motion.h3 layoutId={`${layoutIdPrefix}-card-title-${article.id}`}>{article.title}</motion.h3>
-                        </div>
-                        <div className={styles.cardMetadata}>
-                            <CreatorCredit label="بقلم" creators={article.authors} />
-                            {article.date && (
-                                <p className={styles.cardDate}>
-                                    <Calendar03Icon className={styles.metadataIcon} />
-                                    <span>{article.date}</span>
-                                </p>
-                            )}
-                        </div>
-                        <div className={styles.tagContainer}>
-                            <TagLinks tags={article.tags.map(tag => tag.title)} small={true} />
-                        </div>
-                    </motion.div>
+            <div
+                className={styles.articleCard}
+            >
+                <motion.div className={styles.imageContainer} layoutId={`${layoutIdPrefix}-card-image-${article.legacyId}`}>
+                    {hasScore && ( <motion.div className={styles.score}>{article.score!.toFixed(1)}</motion.div> )}
+                    <Image 
+                        loader={sanityLoader}
+                        src={imageSource}
+                        alt={article.title}
+                        width={800}
+                        height={450}
+                        sizes="(max-width: 768px) 90vw, (max-width: 1200px) 45vw, 350px"
+                        className={styles.cardImage}
+                        style={{ objectFit: 'cover' }}
+                        placeholder="blur" 
+                        blurDataURL={article.blurDataURL}
+                        priority={isPriority}
+                    />
+                </motion.div>
+                <motion.div className={styles.cardContent}>
+                    <div className={styles.cardTitleLink}>
+                        <motion.h3 layoutId={`${layoutIdPrefix}-card-title-${article.legacyId}`}>{article.title}</motion.h3>
+                    </div>
+                    <div className={styles.cardMetadata}>
+                        <CreatorCredit label="بقلم" creators={article.authors} />
+                        {article.date && (
+                            <p className={styles.cardDate}>
+                                <Calendar03Icon className={styles.metadataIcon} />
+                                <span>{article.date}</span>
+                            </p>
+                        )}
+                    </div>
+                    <div className={styles.tagContainer}>
+                        {/* THE DEFINITIVE FIX: Slice the tags array to a maximum of 5. */}
+                        <TagLinks tags={article.tags.slice(0, 5).map(tag => tag.title)} small={true} />
+                    </div>
                 </motion.div>
-            </Link>
+            </div>
         </motion.div>
     );
 };
diff --git a/components/ArticleGrid.tsx b/components/ArticleGrid.tsx
deleted file mode 100644
index a59ea23..0000000
--- a/components/ArticleGrid.tsx
+++ /dev/null
@@ -1,58 +0,0 @@
-// components/ArticleGrid.tsx
-'use client';
-
-import { motion, AnimatePresence } from 'framer-motion';
-import ArticleCard from './ArticleCard';
-import { CardProps } from '@/types';
-
-const kineticCardVariant = {
-    hidden: { 
-        opacity: 0, 
-        y: 60, 
-        rotateX: -20,
-        skewY: 5,
-        clipPath: "inset(100% 0% 0% 0%)"
-    },
-    visible: { 
-        opacity: 1, 
-        y: 0, 
-        rotateX: 0,
-        skewY: 0,
-        clipPath: "inset(0% 0% 0% 0%)",
-        transition: { 
-            duration: 0.8, 
-            ease: [0.22, 1, 0.36, 1] as const,
-            y: { type: 'spring', stiffness: 120, damping: 20 }
-        }
-    },
-    exit: { 
-        opacity: 0, 
-        y: -30, 
-        transition: { duration: 0.3 } 
-    }
-};
-
-export default function ArticleGrid({ articles }: { articles: CardProps[] }) {
-  return (
-    <motion.div layout className="content-grid" style={{ transformStyle: 'preserve-3d', perspective: '1200px' }}>
-      <AnimatePresence>
-        {articles.map((article, index) => (
-          <motion.div
-            key={article.id}
-            layout
-            variants={kineticCardVariant}
-            // initial, animate, exit are inherited from parent ContentBlock
-            transition={{ type: 'spring' as const, stiffness: 400, damping: 30 }}
-            style={{ height: '100%' }}
-          >
-            <ArticleCard
-              article={article}
-              layoutIdPrefix="articles-grid"
-              isPriority={index < 3}
-            />
-          </motion.div>
-        ))}
-      </AnimatePresence>
-    </motion.div>
-  );
-}
\ No newline at end of file
diff --git a/components/AuthOrb.module.css b/components/AuthOrb.module.css
index 5cb0a53..ae7ce45 100644
--- a/components/AuthOrb.module.css
+++ b/components/AuthOrb.module.css
@@ -9,7 +9,7 @@
   display: flex;
   align-items: center;
   justify-content: center;
-  transition: transform 0.3s cubic-bezier(0.22,1,0.36,1), border-color 0.3s ease;
+  transition: border-color 0.2s ease-out;
   box-shadow: 0 10px 25px -5px color-mix(in srgb, var(--text-primary) 10%, transparent);
 }
 .large {
@@ -43,15 +43,7 @@
   width: 130%;
   height: 130%;
   top: 50%;
-  right: 50%;
+  left: 50%; /* THE DEFINITIVE FIX: Changed from 'right' to 'left' for correct centering. */
   transform: translate(-50%, -50%);
   pointer-events: none;
-}
-
-
-
-
-
-
-
-
+}
\ No newline at end of file
diff --git a/components/AuthOrb.tsx b/components/AuthOrb.tsx
index 830d0f9..0e2e0ea 100644
--- a/components/AuthOrb.tsx
+++ b/components/AuthOrb.tsx
@@ -52,7 +52,7 @@ export const AuthOrb = ({ Icon, onClick, ariaLabel, isLarge = false, isLoading =
             }}
             whileHover={!isDisabled ? { scale: 1.1, y: -5 } : {}}
             whileTap={!isDisabled ? { scale: 0.95 } : {}}
-            transition={{ type: 'spring' as const, stiffness: 400, damping: 20 }}
+            transition={{ type: 'spring' as const, stiffness: 500, damping: 20 }}
             style={{ cursor: isDisabled ? 'default' : 'pointer' }}
         >
             <motion.div
@@ -67,6 +67,4 @@ export const AuthOrb = ({ Icon, onClick, ariaLabel, isLarge = false, isLoading =
             </AnimatePresence>
         </motion.button>
     );
-};
-
-
+};
\ No newline at end of file
diff --git a/components/BookmarkButton.tsx b/components/BookmarkButton.tsx
index 59237ad..b4017b2 100644
--- a/components/BookmarkButton.tsx
+++ b/components/BookmarkButton.tsx
@@ -57,7 +57,7 @@ const BookmarkButton = ({ contentId, contentType }: { contentId: number; content
     return (
         <ActionButton
             onClick={handleClick}
-            aria-label="Bookmark article"
+            aria-label="إحفظ"
         >
             <motion.div
                 initial={false}
diff --git a/components/BookmarksGrid.tsx b/components/BookmarksGrid.tsx
index 08c3da6..d09d5c3 100644
--- a/components/BookmarksGrid.tsx
+++ b/components/BookmarksGrid.tsx
@@ -10,10 +10,8 @@ import { adaptToCardProps } from '@/lib/adapters';
 import { CardProps } from '@/types';
 
 export default function BookmarksGrid({ initialItems }: { initialItems: any[] }) {
-    // We still subscribe to the store to get real-time updates when a user bookmarks/unbookmarks.
     const bookmarksFromStore = useUserStore(state => state.bookmarks);
     
-    // THE DEFINITIVE FIX: Filter out nulls and then assert the final type.
     const initialBookmarkedItems = initialItems
         .map(adaptToCardProps)
         .filter(Boolean) as CardProps[];
@@ -21,21 +19,18 @@ export default function BookmarksGrid({ initialItems }: { initialItems: any[] })
     const [bookmarkedItems, setBookmarkedItems] = useState<CardProps[]>(initialBookmarkedItems);
 
     useEffect(() => {
-        // This effect ensures the grid visually updates when the store changes,
-        // without needing a full page refresh.
-        const currentKeysInGrid = new Set(bookmarkedItems.map(item => `${item.type}-${item.id}`));
+        // THE DEFINITIVE FIX: The keys being compared must use the numeric `legacyId`
+        // to match the format used in the Zustand store (e.g., 'review-101').
+        const currentKeysInGrid = new Set(bookmarkedItems.map(item => `${item.type}-${item.legacyId}`));
         
         if (bookmarksFromStore.length < currentKeysInGrid.size) {
-            // An item was removed
-            setBookmarkedItems(prev => prev.filter(item => bookmarksFromStore.includes(`${item.type}-${item.id}`)));
+            // An item was removed from the store, so remove it from the displayed grid.
+            setBookmarkedItems(prev => prev.filter(item => bookmarksFromStore.includes(`${item.type}-${item.legacyId}`)));
         }
-        // Note: Adding items in real-time is more complex and would require a re-fetch.
-        // This implementation prioritizes correct removal, which is the more common action on this page.
-
     }, [bookmarksFromStore, bookmarkedItems]);
 
     if (initialItems.length === 0 && bookmarkedItems.length === 0) {
-        return <p>You haven&apos;t bookmarked any content yet.</p>;
+        return <p style={{ textAlign: 'center', color: 'var(--text-secondary)' }}>لم تحفظ شيئًا بعد.</p>;
     }
 
     return (
@@ -60,6 +55,4 @@ export default function BookmarksGrid({ initialItems }: { initialItems: any[] })
             </AnimatePresence>
         </motion.div>
     );
-}
-
-
+}
\ No newline at end of file
diff --git a/components/ContentActionBar.tsx b/components/ContentActionBar.tsx
index 06de6a6..07c2e2c 100644
--- a/components/ContentActionBar.tsx
+++ b/components/ContentActionBar.tsx
@@ -36,7 +36,7 @@ export default function ContentActionBar({ contentId, contentType, contentSlug }
     return (
         <div style={{ display: 'flex', alignItems: 'center', gap: '1rem' }}>
             <ActionButton onClick={handleLike} aria-label={isLiked ? 'Unlike' : 'Like'}><HeartIcon isLiked={isLiked} /></ActionButton>
-            <ActionButton onClick={handleShare} aria-label="Share"><AnimatePresence mode="wait" initial={false}><motion.div key={justCopied ? 'check' : 'share'} initial={{ opacity: 0, y: -10 }} animate={{ opacity: 1, y: 0 }} exit={{ opacity: 0, y: 10 }} transition={{ duration: 0.2 }}>{justCopied ? <CheckIcon /> : <ShareIcon />}</motion.div></AnimatePresence></ActionButton>
+            <ActionButton onClick={handleShare} aria-label="مشاركة"><AnimatePresence mode="wait" initial={false}><motion.div key={justCopied ? 'check' : 'share'} initial={{ opacity: 0, y: -10 }} animate={{ opacity: 1, y: 0 }} exit={{ opacity: 0, y: 10 }} transition={{ duration: 0.2 }}>{justCopied ? <CheckIcon /> : <ShareIcon />}</motion.div></AnimatePresence></ActionButton>
             <BookmarkButton contentId={contentId} contentType={contentType} />
         </div>
     );
diff --git a/components/DigitalAtriumHomePage.module.css b/components/DigitalAtriumHomePage.module.css
index 8df1ecd..01502e5 100644
--- a/components/DigitalAtriumHomePage.module.css
+++ b/components/DigitalAtriumHomePage.module.css
@@ -9,6 +9,7 @@
     background-color: var(--bg-secondary);
     padding-top: 4rem;
     margin-bottom: 5rem;
+    overflow-x: clip; /* THE DEFINITIVE FIX: Contain overflow here */
 }
 
 .atriumMainContent {
@@ -36,6 +37,4 @@
     .atriumMainContent {
         padding-bottom: 4rem;
     }
-}
-
-
+}
\ No newline at end of file
diff --git a/components/DigitalAtriumHomePage.tsx b/components/DigitalAtriumHomePage.tsx
index 6751702..783fa9a 100644
--- a/components/DigitalAtriumHomePage.tsx
+++ b/components/DigitalAtriumHomePage.tsx
@@ -27,7 +27,7 @@ export default function DigitalAtriumHomePage({
       <AnimatedGridBackground />
       <div className={styles.vanguardFullBleedContainer}>
         <div className="container">
-            <ContentBlock title="ديوان الطليعة" Icon={ReviewIcon} />
+            <ContentBlock title="أحدث المراجعات" Icon={ReviewIcon} />
         </div>
         <VanguardReviews reviews={adaptedReviews} />
       </div>
diff --git a/components/FilteredReviewsGrid.tsx b/components/FilteredReviewsGrid.tsx
deleted file mode 100644
index 3597c44..0000000
--- a/components/FilteredReviewsGrid.tsx
+++ /dev/null
@@ -1,60 +0,0 @@
-// components/FilteredReviewsGrid.tsx
-'use client';
-
-import { motion, AnimatePresence } from 'framer-motion';
-import ArticleCard from './ArticleCard';
-import type { CardProps } from '@/types'; 
-
-const kineticCardVariant = {
-    hidden: { 
-        opacity: 0, 
-        y: 60, 
-        rotateX: -20,
-        skewY: 5,
-        clipPath: "inset(100% 0% 0% 0%)"
-    },
-    visible: { 
-        opacity: 1, 
-        y: 0, 
-        rotateX: 0,
-        skewY: 0,
-        clipPath: "inset(0% 0% 0% 0%)",
-        transition: { 
-            duration: 0.8, 
-            ease: [0.22, 1, 0.36, 1] as const,
-            y: { type: 'spring', stiffness: 120, damping: 20 }
-        }
-    },
-    exit: { 
-        opacity: 0, 
-        y: -30, 
-        transition: { duration: 0.3 } 
-    }
-};
-
-export default function FilteredReviewsGrid({ reviews }: { reviews: CardProps[] }) {
-  return (
-    <motion.div layout className="content-grid" style={{ transformStyle: 'preserve-3d', perspective: '1200px' }}>
-      <AnimatePresence>
-        {reviews.map((review, index) => (
-          <motion.div
-            key={review.id}
-            layout
-            variants={kineticCardVariant}
-            initial="hidden"
-            animate="visible"
-            exit="exit"
-            transition={{ type: 'spring' as const, stiffness: 400, damping: 30 }}
-            style={{ height: '100%' }}
-          >
-            <ArticleCard
-              article={review}
-              layoutIdPrefix="reviews"
-              isPriority={index < 3}
-            />
-          </motion.div>
-        ))}
-      </AnimatePresence>
-    </motion.div>
-  );
-}
\ No newline at end of file
diff --git a/components/HorizontalShowcase.tsx b/components/HorizontalShowcase.tsx
index 94bb1d5..c73adfe 100644
--- a/components/HorizontalShowcase.tsx
+++ b/components/HorizontalShowcase.tsx
@@ -5,7 +5,9 @@
 import { useRef, useEffect, useState, useCallback } from 'react';
 import { motion, AnimatePresence } from 'framer-motion';
 import Image from 'next/image';
-import Link from 'next/link';
+import { useRouter } from 'next/navigation';
+import { useLayoutIdStore } from '@/lib/layoutIdStore';
+import { CardProps } from '@/types';
 import styles from './HorizontalShowcase.module.css';
 
 const ArrowIcon = ({ direction = 'right' }: { direction?: 'left' | 'right' }) => (
@@ -14,42 +16,50 @@ const ArrowIcon = ({ direction = 'right' }: { direction?: 'left' | 'right' }) =>
   </svg>
 );
 
-const ShowcaseCard = ({ article, isActive }: { article: any, isActive: boolean }) => {
+const ShowcaseCard = ({ article, isActive }: { article: CardProps, isActive: boolean }) => {
+  const router = useRouter();
+  const setPrefix = useLayoutIdStore((state) => state.setPrefix);
+  const layoutIdPrefix = "articles-showcase";
   
+  const handleClick = (e: React.MouseEvent) => {
+    e.preventDefault();
+    setPrefix(layoutIdPrefix);
+    router.push(`/articles/${article.slug}`, { scroll: false });
+  };
+
   const imageSource = article.imageUrl;
   if (!imageSource) return null;
 
   return (
     <motion.div
       className={styles.showcaseCardContainer}
-      animate={{ 
-        scale: isActive ? 1 : 0.85, 
-        opacity: isActive ? 1 : 0.7,
-      }}
+      animate={{ scale: isActive ? 1 : 0.85, opacity: isActive ? 1 : 0.7 }}
       transition={{ type: 'spring', stiffness: 300, damping: 30 }}
     >
-      <Link href={`/articles/${article.slug}`} className={`no-underline ${styles.showcaseCardLink}`} tabIndex={isActive ? 0 : -1} draggable="false">
-        <div className={styles.showcaseCardImageWrapper}>
+      <motion.div
+        layoutId={`${layoutIdPrefix}-card-container-${article.legacyId}`}
+        onClick={handleClick}
+        className={`no-underline ${styles.showcaseCardLink}`}
+        draggable="false"
+        style={{ cursor: 'pointer' }}
+      >
+        <motion.div layoutId={`${layoutIdPrefix}-card-image-${article.legacyId}`} className={styles.showcaseCardImageWrapper}>
           <Image 
-            src={imageSource} 
-            alt={article.title} 
-            fill 
-            sizes="60vw"
-            style={{ objectFit: 'cover' }}
-            className={styles.showcaseCardImage}
+            src={imageSource} alt={article.title} fill sizes="60vw"
+            style={{ objectFit: 'cover' }} className={styles.showcaseCardImage}
             draggable="false"
           />
-        </div>
+        </motion.div>
         <div className={styles.showcaseCardContent}>
-          <h3 className={styles.showcaseCardTitle}>{article.title}</h3>
+          <motion.h3 layoutId={`${layoutIdPrefix}-card-title-${article.legacyId}`} className={styles.showcaseCardTitle}>{article.title}</motion.h3>
           <p className={styles.showcaseCardGame}>{article.game}</p>
         </div>
-      </Link>
+      </motion.div>
     </motion.div>
   );
 };
 
-export default function HorizontalShowcase({ articles, onActiveIndexChange }: { articles: any[], onActiveIndexChange: (index: number) => void }) {
+export default function HorizontalShowcase({ articles, onActiveIndexChange }: { articles: CardProps[], onActiveIndexChange: (index: number) => void }) {
   const [activeIndex, setActiveIndex] = useState(0);
   const [xOffset, setXOffset] = useState(0);
   const [isCalculated, setIsCalculated] = useState(false);
@@ -59,48 +69,29 @@ export default function HorizontalShowcase({ articles, onActiveIndexChange }: {
 
   const calculateAndGoToIndex = useCallback((index: number) => {
     if (!wrapperRef.current || !cardRefs.current[index]) return;
-
     const wrapperWidth = wrapperRef.current.offsetWidth;
     const targetCard = cardRefs.current[index]!;
     const targetOffsetLeft = targetCard.offsetLeft;
     const targetWidth = targetCard.offsetWidth;
-    
     const newXOffset = (wrapperWidth / 2) - targetOffsetLeft - (targetWidth / 2);
-    
     setXOffset(newXOffset);
     setActiveIndex(index);
     onActiveIndexChange(index);
     setIsCalculated(true);
   }, [onActiveIndexChange]);
 
-  // Recalculate on resize
   useEffect(() => {
     const handleResize = () => calculateAndGoToIndex(activeIndex);
     window.addEventListener('resize', handleResize);
-    // Initial calculation after a short delay to ensure layout is stable
     const timeoutId = setTimeout(() => handleResize(), 100); 
-    
-    return () => {
-      window.removeEventListener('resize', handleResize);
-      clearTimeout(timeoutId);
-    };
+    return () => { window.removeEventListener('resize', handleResize); clearTimeout(timeoutId); };
   }, [activeIndex, calculateAndGoToIndex]);
   
-  const handleNext = useCallback(() => {
-    const nextIndex = Math.min(activeIndex + 1, articles.length - 1);
-    calculateAndGoToIndex(nextIndex);
-  }, [activeIndex, articles.length, calculateAndGoToIndex]);
-
-  const handlePrev = useCallback(() => {
-    const prevIndex = Math.max(activeIndex - 1, 0);
-    calculateAndGoToIndex(prevIndex);
-  }, [activeIndex, calculateAndGoToIndex]);
+  const handleNext = useCallback(() => { const nextIndex = Math.min(activeIndex + 1, articles.length - 1); calculateAndGoToIndex(nextIndex); }, [activeIndex, articles.length, calculateAndGoToIndex]);
+  const handlePrev = useCallback(() => { const prevIndex = Math.max(activeIndex - 1, 0); calculateAndGoToIndex(prevIndex); }, [activeIndex, calculateAndGoToIndex]);
   
   useEffect(() => {
-    const handleKeyDown = (event: KeyboardEvent) => {
-      if (event.key === 'ArrowRight') handleNext();
-      if (event.key === 'ArrowLeft') handlePrev();
-    };
+    const handleKeyDown = (event: KeyboardEvent) => { if (event.key === 'ArrowRight') handleNext(); if (event.key === 'ArrowLeft') handlePrev(); };
     window.addEventListener('keydown', handleKeyDown);
     return () => window.removeEventListener('keydown', handleKeyDown);
   }, [handleNext, handlePrev]);
@@ -108,15 +99,9 @@ export default function HorizontalShowcase({ articles, onActiveIndexChange }: {
   const onDragEnd = (event: any, { offset, velocity }: any) => {
     const swipeConfidenceThreshold = 10000;
     const swipePower = Math.abs(offset.x) * velocity.x;
-
-    if (swipePower < -swipeConfidenceThreshold) {
-      handleNext();
-    } else if (swipePower > swipeConfidenceThreshold) {
-      handlePrev();
-    } else {
-      // Snap back to the current active index if not a strong swipe
-      calculateAndGoToIndex(activeIndex);
-    }
+    if (swipePower < -swipeConfidenceThreshold) { handleNext(); } 
+    else if (swipePower > swipeConfidenceThreshold) { handlePrev(); } 
+    else { calculateAndGoToIndex(activeIndex); }
   };
 
   return (
@@ -138,35 +123,17 @@ export default function HorizontalShowcase({ articles, onActiveIndexChange }: {
 
       <motion.div
         className={styles.horizontalShowcaseList}
-        drag="x"
-        dragConstraints={{ left: 0, right: 0 }}
-        dragElastic={0.1}
-        onDragEnd={onDragEnd}
+        drag="x" dragConstraints={{ left: 0, right: 0 }} dragElastic={0.1} onDragEnd={onDragEnd}
         initial={{ opacity: 0 }}
-        animate={{ 
-          x: xOffset,
-          opacity: isCalculated ? 1 : 0
-        }}
-        transition={{ 
-          x: { type: 'spring', stiffness: 300, damping: 50 },
-          opacity: { duration: 0.5 }
-        }}
+        animate={{ x: xOffset, opacity: isCalculated ? 1 : 0 }}
+        transition={{ x: { type: 'spring', stiffness: 300, damping: 50 }, opacity: { duration: 0.5 } }}
       >
         {articles.map((article, index) => (
-          <div 
-            key={article.id} 
-            ref={(el) => { cardRefs.current[index] = el; }}
-            className={styles.showcaseItemWrapper}
-          >
-            <ShowcaseCard
-              article={{...article, isLeft: index < activeIndex}}
-              isActive={activeIndex === index}
-            />
+          <div key={article.id} ref={(el) => { cardRefs.current[index] = el; }} className={styles.showcaseItemWrapper}>
+            <ShowcaseCard article={article} isActive={activeIndex === index} />
           </div>
         ))}
       </motion.div>
     </div>
   );
-}
-
-
+}
\ No newline at end of file
diff --git a/components/HubPageClient.tsx b/components/HubPageClient.tsx
index 5137e49..2745602 100644
--- a/components/HubPageClient.tsx
+++ b/components/HubPageClient.tsx
@@ -19,6 +19,18 @@ interface HubPageClientProps {
 }
 
 export default function HubPageClient({ initialItems, hubTitle, hubType, headerAction }: HubPageClientProps) {
+    // THE DEFINITIVE FIX: Safeguard against empty initial items.
+    if (!initialItems || initialItems.length === 0) {
+        return (
+            <div className="container page-container">
+                <h1 className="page-title">{hubType}: &quot;{hubTitle}&quot;</h1>
+                <p style={{textAlign: 'center', color: 'var(--text-secondary)', fontSize: '1.8rem', maxWidth: '600px', margin: '0 auto'}}>
+                    لم يُنشر أي محتوى يطابق هذا المحور بعد. الأرشيف يترقب المستجدات.
+                </p>
+            </div>
+        );
+    }
+    
     const [activeTypeFilter, setActiveTypeFilter] = useState<HubTypeFilter>('all');
     const [activeSort, setActiveSort] = useState<HubSortOrder>('latest');
     const [engagementScores, setEngagementScores] = useState<Map<number, number>>(new Map());
@@ -108,6 +120,8 @@ export default function HubPageClient({ initialItems, hubTitle, hubType, headerA
         </div>
     );
 
+    const layoutIdPrefix = `hub-${hubType}-${hubTitle.replace(/\s+/g, '-')}`;
+
     return (
         <div className={styles.hubPageContainer}>
             {heroContent}
@@ -125,27 +139,31 @@ export default function HubPageClient({ initialItems, hubTitle, hubType, headerA
                     />
                 </motion.div>
                 
-                <motion.div layout className="content-grid" style={{ paddingBottom: '6rem' }}>
+                <motion.div 
+                    layout 
+                    className="content-grid" 
+                    style={{ paddingBottom: '6rem' }}
+                >
                     <AnimatePresence>
                         {filteredAndSortedItems.length > 0 ? (
                             filteredAndSortedItems.map(item => (
                                 <motion.div
                                     key={item.id}
                                     layout
-                                    initial={{ opacity: 0, scale: 0.8 }}
-                                    animate={{ opacity: 1, scale: 1 }}
-                                    exit={{ opacity: 0, scale: 0.8 }}
+                                    initial={{ opacity: 0 }}
+                                    animate={{ opacity: 1 }}
+                                    exit={{ opacity: 0 }}
                                     transition={{ type: 'spring' as const, stiffness: 250, damping: 25 }}
                                     style={{ height: '100%' }}
                                 >
                                     <ArticleCard
                                         article={item}
-                                        layoutIdPrefix={`${hubType}-${hubTitle}`}
+                                        layoutIdPrefix={layoutIdPrefix}
                                     />
                                 </motion.div>
                             ))
                         ) : (
-                             <motion.div 
+                                <motion.div 
                                 initial={{ opacity: 0 }} animate={{ opacity: 1 }}
                                 style={{gridColumn: '1 / -1', textAlign: 'center', padding: '4rem 0', color: 'var(--text-secondary)'}}
                             >
diff --git a/components/KineticReleaseTimeline.tsx b/components/KineticReleaseTimeline.tsx
index 6392b36..7eb93fe 100644
--- a/components/KineticReleaseTimeline.tsx
+++ b/components/KineticReleaseTimeline.tsx
@@ -113,7 +113,7 @@ export default function KineticReleaseTimeline({ releases: allReleases }: { rele
                 {releasesForThisMonth.length > 0 ? (
                     releasesForThisMonth.map((release, index) => ( <TimelineItem key={release._id} release={release} index={index} /> ))
                 ) : (
-                    <motion.div style={{ paddingTop: '20vh', textAlign: 'center', color: 'var(--text-secondary)', width: '100%' }} initial={{ opacity: 0 }} animate={{ opacity: 1 }} transition={{ duration: 0.8, delay: 0.8, ease: 'easeOut' as const }}>لا توجد إصدارات مجدولة لهذا الشهر.</motion.div>
+                    <motion.div style={{ paddingTop: '20vh', textAlign: 'center', color: 'var(--text-secondary)', width: '100%' }} initial={{ opacity: 0 }} animate={{ opacity: 1 }} transition={{ duration: 0.8, delay: 0.8, ease: 'easeOut' as const }}>لا إصدارات مجدولة لهذا الشهر.</motion.div>
                 )}
             </div>
 
diff --git a/components/Navbar.tsx b/components/Navbar.tsx
index 15814ab..6122804 100644
--- a/components/Navbar.tsx
+++ b/components/Navbar.tsx
@@ -31,7 +31,7 @@ export const HamburgerIcon = ({ isOpen }: { isOpen: boolean }) => (
 );
 
 const ConstellationIcon = (props: React.SVGProps<SVGSVGElement>) => (
-    <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" role="img" color="currentColor" {...props} style={{ transform: 'translate(1px, 2px)' }}>
+    <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24" fill="none" role="img" color="currentColor" {...props} style={{ transform: 'translate(1px, 2px)' }}>
         <path d="M12 14C13.1046 14 14 13.1046 14 12C14 10.8954 13.1046 10 12 10C10.8954 10 10 10.8954 10 12C10 13.1046 10.8954 14 12 14Z" stroke="currentColor" strokeWidth="1.5" strokeLinejoin="round"></path>
         <path d="M20 18C21.1046 18 22 17.1046 22 16C22 14.8954 21.1046 14 20 14C18.8954 14 18 14.8954 18 16C18 17.1046 18.8954 18 20 18Z" stroke="currentColor" strokeWidth="1.5" strokeLinejoin="round"></path>
         <path d="M11 22C12.1046 22 13 21.1046 13 20C13 18.8954 12.1046 18 11 18C9.89543 18 9 18.8954 9 20C9 21.1046 9.89543 22 11 22Z" stroke="currentColor" strokeWidth="1.5" strokeLinejoin="round"></path>
@@ -42,7 +42,7 @@ const ConstellationIcon = (props: React.SVGProps<SVGSVGElement>) => (
 );
 
 const CelestialAlmanacIcon = (props: React.SVGProps<SVGSVGElement>) => (
-    <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" color="currentColor" {...props}>
+    <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24" fill="none" color="currentColor" {...props}>
       <path fillRule="evenodd" clipRule="evenodd" d="M18 1.25C19.5188 1.25 20.75 2.48122 20.75 4V4.23047C20.75 5.5687 20.1855 6.84489 19.1953 7.74512L15.7441 10.8818C15.4292 11.1681 15.25 11.5744 15.25 12C15.25 12.4256 15.4292 12.8319 15.7441 13.1182L19.1953 16.2549C20.1855 17.1551 20.75 18.4313 20.75 19.7695V20C20.75 21.5188 19.5188 22.75 18 22.75H6C4.48122 22.75 3.25 21.5188 3.25 20V19.7695C3.25 18.4313 3.81451 17.1551 4.80469 16.2549L8.25586 13.1182C8.57077 12.8319 8.75 12.4256 8.75 12C8.75 11.5744 8.57077 11.1681 8.25586 10.8818L4.80469 7.74512C3.81451 6.84489 3.25 5.5687 3.25 4.23047V4C3.25 2.48122 4.48122 1.25 6 1.25H18Z" fill="currentColor"/>
       <path d="M16.5 19.5001V17.0001H14C13.4477 17.0001 13 16.5523 13 16.0001C13 15.4478 13.4477 15.0001 14 15.0001H16.5V12.5001C16.5 11.9478 16.9477 11.5001 17.5 11.5001C18.0523 11.5001 18.5 11.9478 18.5 12.5001V15.0001H21C21.5523 15.0001 22 15.4478 22 16.0001C22 16.5523 21.5523 17.0001 21 17.0001H18.5V19.5001C18.5 20.0523 18.0523 20.5001 17.5 20.5001C16.9477 20.5001 16.5 20.0523 16.5 19.5001Z" fill="none" stroke="var(--bg-primary)" strokeWidth="2.5"/>
       <path d="M16.5 19.5001V17.0001H14C13.4477 17.0001 13 16.5523 13 16.0001C13 15.4478 13.4477 15.0001 14 15.0001H16.5V12.5001C16.5 11.9478 16.9477 11.5001 17.5 11.5001C18.0523 11.5001 18.5 11.9478 18.5 12.5001V15.0001H21C21.5523 15.0001 22 15.4478 22 16.0001C22 16.5523 21.5523 17.0001 21 17.0001H18.5V19.5001C18.5 20.0523 18.0523 20.5001 17.5 20.5001C16.9477 20.5001 16.5 20.0523 16.5 19.5001Z" fill="currentColor"/>
@@ -66,8 +66,16 @@ const orbitalContainerVariants: Variants = {
 const itemTransition: Transition = { type: 'spring', stiffness: 400, damping: 20 };
 
 const OrbitalNavItem = ({ item, angle, radius, isActive, onClick }: { item: typeof navItems[0], angle: number, radius: string, isActive: boolean, onClick: () => void }) => {
-    const x = `calc(${radius} * ${Math.cos(angle)})`;
-    const y = `calc(${radius} * ${Math.sin(angle)})`;
+    // THE DEFINITIVE FIX:
+    // Round the results of Math.cos and Math.sin to a high precision. This converts
+    // very small floating-point numbers (like 6.12e-17 for cos(PI/2)) into a clean 0.
+    // This prevents potential issues in Framer Motion's animation engine when an
+    // initial value is 0 and the target is a string expression that also evaluates to 0.
+    const cosAngle = Math.round(Math.cos(angle) * 1e10) / 1e10;
+    const sinAngle = Math.round(Math.sin(angle) * 1e10) / 1e10;
+
+    const x = `calc(${radius} * ${cosAngle})`;
+    const y = `calc(${radius} * ${sinAngle})`;
 
     const itemVariants: Variants = {
         hidden: { scale: 0, x: 0, y: 0, opacity: 0 },
@@ -99,7 +107,7 @@ const OrbitalNavItem = ({ item, angle, radius, isActive, onClick }: { item: type
 };
 
 const AnimatedPreviewIcon = () => (
-    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
+    <svg width="24" height="24" viewBox="0 0 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
         <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
         <motion.circle 
             cx="12" cy="12" r="3"
@@ -125,7 +133,7 @@ const EditorPreviewButton = () => {
             href={liveUrl}
             target="_blank"
             className={`${editorStyles.iconButton} no-underline`}
-            title="Preview Live Page"
+            title="معاينة الصفحة الحية"
             initial="rest"
             whileHover="hover"
             whileTap="hover"
@@ -139,7 +147,7 @@ const EditorPreviewButton = () => {
         <motion.button
             className={editorStyles.iconButton}
             disabled
-            title="Document is not published"
+            title="المستند غير منشور"
         >
             <PreviewIcon />
         </motion.button>
@@ -154,8 +162,6 @@ const Navbar = () => {
     const [loadSearch, setLoadSearch] = useState(false);
     const pathname = usePathname();
 
-    const isEditorDashboard = pathname === '/studio';
-
     useBodyClass('mobile-menu-open', isMobileMenuOpen);
 
     const openSearch = () => {
@@ -184,11 +190,6 @@ const Navbar = () => {
                         </nav>
                         <div className={styles.navControls}>
                             {isEditorActive && <EditorPreviewButton />}
-                            {isEditorDashboard && (
-                                <Link href="/studio" className="no-underline" title="Return to Studio Dashboard">
-                                    <StudioIcon style={{ color: 'var(--text-primary)', width: 24, height: 24 }} />
-                                </Link>
-                            )}
                             <ThemeToggle />
                             <UserProfile />
                             <button className={styles.navSearch} onClick={openSearch} aria-label="فتح البحث">
@@ -199,7 +200,7 @@ const Navbar = () => {
 
                     <div className={styles.mobileView}>
                         <div className={styles.mobileNavGroupLeft}>
-                            <button className={styles.hamburgerButton} onClick={toggleMobileMenu} aria-label="Toggle menu">
+                            <button className={styles.hamburgerButton} onClick={toggleMobileMenu} aria-label="تبديل القائمة">
                                 <HamburgerIcon isOpen={isMobileMenuOpen} />
                             </button>
                             {isEditorActive && (
@@ -208,11 +209,6 @@ const Navbar = () => {
                                     onQualityChange={setBlockUploadQuality}
                                     isMobile={true}
                                 />
-                            )}
-                            {isEditorDashboard && (
-                                <Link href="/studio" className="no-underline" title="Return to Studio Dashboard">
-                                   <StudioIcon style={{ color: 'var(--text-primary)', width: 22, height: 22 }} />
-                               </Link>
                             )}
                              <button className={styles.navSearch} onClick={openSearch} aria-label="فتح البحث">
                                 <SearchIcon />
diff --git a/components/PageTransitionWrapper.tsx b/components/PageTransitionWrapper.tsx
new file mode 100644
index 0000000..26ac3d2
--- /dev/null
+++ b/components/PageTransitionWrapper.tsx
@@ -0,0 +1,24 @@
+// components/PageTransitionWrapper.tsx
+'use client';
+
+import { motion, AnimatePresence } from 'framer-motion';
+import { usePathname } from 'next/navigation';
+import React from 'react';
+
+export default function PageTransitionWrapper({ children }: { children: React.ReactNode }) {
+  const pathname = usePathname();
+
+  return (
+    <AnimatePresence mode="popLayout" initial={false}>
+      <motion.div
+        key={pathname}
+        initial={{ opacity: 0 }}
+        animate={{ opacity: 1 }}
+        exit={{ opacity: 0 }} // Add a simple fade-out exit for smoother transitions
+        transition={{ duration: 0.3, ease: 'easeInOut' }}
+      >
+        {children}
+      </motion.div>
+    </AnimatePresence>
+  );
+}
\ No newline at end of file
diff --git a/components/PaginatedCarousel.module.css b/components/PaginatedCarousel.module.css
index 076fe0a..69bf9e9 100644
--- a/components/PaginatedCarousel.module.css
+++ b/components/PaginatedCarousel.module.css
@@ -1,49 +1,48 @@
 /* components/PaginatedCarousel.module.css */
-.paginatedCarouselContainer {
-  position: relative;
-}
-.paginatedCarouselContent {
-  margin-bottom: 2rem;
-  min-height: 420px;
+
+.paginatedContainer {
+    display: flex;
+    flex-direction: column;
+    height: 100%;
 }
-/* New CSS to enforce 2-column grid inside the carousel */
-.twoColumnGrid {
-  display: grid;
-  grid-template-columns: repeat(2, 1fr);
-  gap: 3rem;
-  grid-auto-rows: 1fr;
+
+.paginatedContent {
+    /* flex-grow: 1; <-- This property was pushing the controls to the bottom, it has been removed. */
+    position: relative;
+    min-height: 380px; /* Adjust based on item height to prevent layout shift */
 }
-@media (max-width: 768px) {
-  .twoColumnGrid {
-    grid-template-columns: 1fr;
-  }
+
+.itemList {
+    display: flex;
+    flex-direction: column;
 }
-/* End New CSS */
+
 .paginationControls {
-  display: flex;
-  justify-content: center;
-  align-items: center;
-  gap: 1rem;
+    display: flex;
+    justify-content: center;
+    align-items: center;
+    gap: 1rem;
+    padding-top: 1rem; /* Reduced top padding to bring controls closer to content */
+    padding-bottom: 1.5rem; /* Added bottom padding for spacing from elements below */
 }
+
 .paginationDot {
-  width: 10px;
-  height: 10px;
-  border-radius: 50%;
-  background-color: var(--border-color);
-  border: none;
-  cursor: pointer;
-  padding: 0;
-  transition: all 0.3s ease;
+    width: 10px;
+    height: 10px;
+    border-radius: 50%;
+    background-color: var(--border-color);
+    border: none;
+    cursor: pointer;
+    padding: 0;
+    transition: all 0.3s ease;
 }
+
 .paginationDot:hover {
-  background-color: var(--text-secondary);
+    background-color: var(--text-secondary);
 }
-.paginationDot.active {
-  background-color: var(--accent);
-  transform: scale(1.2);
-}
-
-
-
-
 
+.paginationDot.active {
+    background-color: var(--accent);
+    transform: scale(1.2);
+    box-shadow: 0 0 8px color-mix(in srgb, var(--accent) 50%, transparent);
+}
\ No newline at end of file
diff --git a/components/PaginatedCarousel.tsx b/components/PaginatedCarousel.tsx
index bc8643f..fe325ff 100644
--- a/components/PaginatedCarousel.tsx
+++ b/components/PaginatedCarousel.tsx
@@ -1,18 +1,72 @@
 // components/PaginatedCarousel.tsx
 'use client';
 
-import { useState, useEffect, useRef } from 'react';
+import React, { useState, useEffect, useRef, memo } from 'react';
 import { motion, AnimatePresence } from 'framer-motion';
-import ArticleCard from './ArticleCard';
-import styles from './PaginatedCarousel.module.css'; // <-- IMPORT MODULE
+import Image from 'next/image';
+import { CardProps } from '@/types';
+import CreatorCredit from '@/components/CreatorCredit';
+import { Calendar03Icon } from '@/components/icons/index';
+import styles from './PaginatedCarousel.module.css';
+import feedStyles from './homepage/feed/Feed.module.css';
+import { useRouter } from 'next/navigation';
+import { useLayoutIdStore } from '@/lib/layoutIdStore';
+
+const LatestArticleListItem = memo(({ article }: { article: CardProps }) => {
+    const router = useRouter();
+    const setPrefix = useLayoutIdStore((state) => state.setPrefix);
+    const layoutIdPrefix = "homepage-latest-articles";
+    const linkPath = `/articles/${article.slug}`;
+
+    const handleClick = (e: React.MouseEvent<HTMLAnchorElement>) => {
+        if (e.ctrlKey || e.metaKey) return;
+        if ((e.target as HTMLElement).closest('a[href^="/creators"]')) return;
+        e.preventDefault();
+        setPrefix(layoutIdPrefix);
+        router.push(linkPath, { scroll: false });
+    };
+
+    return (
+        <motion.a
+            href={linkPath}
+            onClick={handleClick}
+            layoutId={`${layoutIdPrefix}-card-container-${article.legacyId}`} 
+            className={`${feedStyles.latestArticleItem} no-underline`}
+        >
+            <motion.div layoutId={`${layoutIdPrefix}-card-image-${article.legacyId}`} className={feedStyles.latestArticleThumbnail}>
+                <Image 
+                    src={article.imageUrl} 
+                    alt={article.title} 
+                    fill 
+                    sizes="120px" 
+                    placeholder="blur" 
+                    blurDataURL={article.blurDataURL} 
+                    style={{ objectFit: 'cover' }} 
+                />
+            </motion.div>
+            <div className={feedStyles.latestArticleInfo}>
+                <motion.h4 layoutId={`${layoutIdPrefix}-card-title-${article.legacyId}`} className={feedStyles.latestArticleTitle}>{article.title}</motion.h4>
+                <div className={feedStyles.latestArticleMeta}>
+                    <CreatorCredit label="بقلم" creators={article.authors} />
+                    {article.date && (
+                        <div className={feedStyles.latestArticleDate}>
+                            <Calendar03Icon style={{ width: '16px', height: '16px', color: 'var(--accent)' }} />
+                            <span>{article.date}</span>
+                        </div>
+                    )}
+                </div>
+            </div>
+        </motion.a>
+    );
+});
+LatestArticleListItem.displayName = "LatestArticleListItem";
 
 type PaginatedCarouselProps = {
-    items: any[];
-    itemsPerPage: number;
-    layoutIdPrefix: string;
+    items: CardProps[];
+    itemsPerPage?: number;
 };
 
-export default function PaginatedCarousel({ items, itemsPerPage, layoutIdPrefix }: PaginatedCarouselProps) {
+export default function PaginatedCarousel({ items, itemsPerPage = 3 }: PaginatedCarouselProps) {
     const [currentPage, setCurrentPage] = useState(0);
     const [isHovered, setIsHovered] = useState(false);
     const timeoutRef = useRef<NodeJS.Timeout | null>(null);
@@ -22,8 +76,11 @@ export default function PaginatedCarousel({ items, itemsPerPage, layoutIdPrefix
 
     useEffect(() => {
         resetTimeout();
-        if (!isHovered) {
-            timeoutRef.current = setTimeout( () => setCurrentPage((prevPage) => (prevPage + 1) % totalPages), 5000 );
+        if (!isHovered && totalPages > 1) {
+            timeoutRef.current = setTimeout(
+                () => setCurrentPage((prevPage) => (prevPage + 1) % totalPages),
+                3500
+            );
         }
         return () => resetTimeout();
     }, [currentPage, isHovered, totalPages]);
@@ -33,41 +90,42 @@ export default function PaginatedCarousel({ items, itemsPerPage, layoutIdPrefix
     const currentItems = items.slice(startIndex, endIndex);
 
     return (
-        <div className={styles.paginatedCarouselContainer} onMouseEnter={() => setIsHovered(true)} onMouseLeave={() => setIsHovered(false)}>
-            <div className={styles.paginatedCarouselContent}>
+        <div 
+            className={styles.paginatedContainer}
+            onMouseEnter={() => setIsHovered(true)} 
+            onMouseLeave={() => setIsHovered(false)}
+        >
+            <div className={styles.paginatedContent}>
                 <AnimatePresence mode="wait">
                     <motion.div
                         key={currentPage}
-                        className={styles.twoColumnGrid} // <-- APPLIED NEW CLASS
-                        initial={{ opacity: 0, x: 50 }}
+                        initial={{ opacity: 0, x: 30 }}
                         animate={{ opacity: 1, x: 0 }}
-                        exit={{ opacity: 0, x: -50 }}
-                        transition={{ duration: 0.35, ease: 'easeInOut' }}
-                        style={{ transformStyle: 'preserve-3d' }}
+                        exit={{ opacity: 0, x: -30 }}
+                        transition={{ duration: 0.4, ease: 'easeInOut' }}
+                        className={styles.itemList}
                     >
-                        {currentItems.map((item) => (
-                            <ArticleCard key={item.id} article={item} isArticle={item.type === 'article'} layoutIdPrefix={layoutIdPrefix} />
+                        {currentItems.map((item, index) => (
+                            <React.Fragment key={item.id}>
+                                <LatestArticleListItem article={item} />
+                                {index < currentItems.length - 1 && <div className={feedStyles.listDivider} />}
+                            </React.Fragment>
                         ))}
                     </motion.div>
                 </AnimatePresence>
             </div>
-            <div className={styles.paginationControls}>
-                {Array.from({ length: totalPages }).map((_, index) => (
-                    <motion.button
-                        key={index}
-                        className={`${styles.paginationDot} ${currentPage === index ? styles.active : ''}`}
-                        onClick={() => setCurrentPage(index)}
-                        aria-label={`Go to page ${index + 1}`}
-                        whileHover={{ scale: 1.2 }}
-                        whileTap={{ scale: 0.9 }}
-                    />
-                ))}
-            </div>
+            {totalPages > 1 && (
+                <div className={styles.paginationControls}>
+                    {Array.from({ length: totalPages }).map((_, index) => (
+                        <button
+                            key={index}
+                            className={`${styles.paginationDot} ${currentPage === index ? styles.active : ''}`}
+                            onClick={() => setCurrentPage(index)}
+                            aria-label={`Go to page ${index + 1}`}
+                        />
+                    ))}
+                </div>
+            )}
         </div>
     );
-}
-
-
-
-
-
+}
\ No newline at end of file
diff --git a/components/PasswordChangeForm.tsx b/components/PasswordChangeForm.tsx
index 91b726b..4ab564e 100644
--- a/components/PasswordChangeForm.tsx
+++ b/components/PasswordChangeForm.tsx
@@ -78,7 +78,7 @@ export default function PasswordChangeForm() {
                     onChange={(e) => setConfirmPassword(e.target.value)}
                     placeholder=" "
                 />
-                <label className="profile-form-label" htmlFor="confirmPassword">تأكيد كلمة السر الجديدة</label>
+                <label className="profile-form-label" htmlFor="confirmPassword">تأكيد الجديدة</label>
             </div>
             <motion.button 
                 type="submit" 
diff --git a/components/ProfileEditForm.tsx b/components/ProfileEditForm.tsx
index 74d366f..801b3ce 100644
--- a/components/ProfileEditForm.tsx
+++ b/components/ProfileEditForm.tsx
@@ -107,10 +107,10 @@ export default function ProfileEditForm({ user }: { user: User}) {
                     if (!profileResult.success) throw new Error(profileResult.message);
                 }
                 await updateSession();
-                toast.success('تم تحديث الملف الشخصي بنجاح!');
+                toast.success('حُدِّثَ الملف بنجاح!');
                 setAvatarFile(null);
             } catch (error: any) {
-                toast.error(error.message || 'Failed to update profile.');
+                toast.error(error.message || 'أخفق تحديث الملف.');
             }
         });
     }
@@ -128,7 +128,7 @@ export default function ProfileEditForm({ user }: { user: User}) {
                             <div className={avatarStyles.avatarUploadPrompt}><UploadIcon /><span>تغيير</span></div>
                             <Image src={avatarPreview} alt="Avatar preview" width={80} height={80} className={avatarStyles.profileAvatarPreview} />
                         </button>
-                        <p className={avatarStyles.formDescription}>انقر لرفع صورة جديدة (الحد الأقصى 4.5 ميجابايت).</p>
+                        <p className={avatarStyles.formDescription}>انقر لرفع صورة جديدة (أقصاه 4.5 ميجابايت).</p>
                         <input ref={inputFileRef} type="file" name="avatar_source" onChange={handleFileChange} accept="image/png, image/jpeg, image/webp" style={{ display: 'none' }} disabled={isSaving} />
                     </div>
                 </div>
@@ -154,29 +154,57 @@ export default function ProfileEditForm({ user }: { user: User}) {
                     </div>
                     <div className={`profile-form-group ${hasContent(instagramHandle)}`}>
                         <input id="instagramHandle" name="instagramHandle" value={instagramHandle} onChange={(e) => setInstagramHandle(e.target.value)} className="profile-input" placeholder=" "/>
-                        <label htmlFor="instagramHandle" className="profile-form-label">حساب انستغرام</label>
+                        <label htmlFor="instagramHandle" className="profile-form-label">حساب إنستغرام</label>
                     </div>
                 </div>
 
                 <div style={{ display: 'flex', flexDirection: 'column', gap: '1.5rem', background: 'var(--bg-primary)', padding: '1.5rem', borderRadius: '8px', border: '1px solid var(--border-color)'}}>
                     <div style={{display: 'flex', justifyContent: 'space-between', alignItems: 'center'}}>
-                        <label htmlFor="agePublic" style={{fontFamily: 'var(--font-ui)', fontWeight: 500}}>إظهار العمر للعامة</label>
+                        <label htmlFor="agePublic" style={{fontFamily: 'var(--font-ui)', fontWeight: 500}}>إظهار العمر علنًا</label>
                         <ToggleSwitch name="agePublic" checked={agePublic} onChange={setAgePublic} />
                     </div>
                     <div style={{display: 'flex', justifyContent: 'space-between', alignItems: 'center'}}>
-                        <label htmlFor="countryPublic" style={{fontFamily: 'var(--font-ui)', fontWeight: 500}}>إظهار البلد للعامة</label>
+                        <label htmlFor="countryPublic" style={{fontFamily: 'var(--font-ui)', fontWeight: 500}}>إظهار البلد علنًا</label>
                         <ToggleSwitch name="countryPublic" checked={countryPublic} onChange={setCountryPublic} />
                     </div>
                 </div>
 
-                <motion.button type="submit" className="primary-button" disabled={isSaveDisabled} animate={{ width: isSaving ? '48px' : '100%', height: '48px', borderRadius: isSaving ? '50%' : '5px', }} transition={{ type: 'spring', stiffness: 400, damping: 25 }}>
+                <motion.button
+                    type="submit"
+                    className="primary-button"
+                    disabled={isSaveDisabled}
+                    style={{
+                        display: 'flex',
+                        alignItems: 'center',
+                        justifyContent: 'center',
+                        overflow: 'hidden'
+                    }}
+                    animate={{
+                        width: isSaving ? '48px' : '100%',
+                        height: '48px',
+                        borderRadius: isSaving ? '50%' : '5px',
+                        paddingLeft: isSaving ? '0rem' : '2.4rem',
+                        paddingRight: isSaving ? '0rem' : '2.4rem',
+                    }}
+                    transition={{ type: 'spring', stiffness: 400, damping: 25 }}
+                >
                     <AnimatePresence mode="wait">
-                        {isSaving ? ( <ButtonLoader key="loader" /> ) : ( <motion.span key="text" initial={{ opacity: 0 }} animate={{ opacity: 1 }} exit={{ opacity: 0 }}>حفظ التغييرات</motion.span> )}
+                        {isSaving ? (
+                            <ButtonLoader key="loader" />
+                        ) : (
+                            <motion.span
+                                key="text"
+                                initial={{ opacity: 0 }}
+                                animate={{ opacity: 1 }}
+                                exit={{ opacity: 0 }}
+                                style={{ whiteSpace: 'nowrap' }}
+                            >
+                                حفظ التغييرات
+                            </motion.span>
+                        )}
                     </AnimatePresence>
                 </motion.button>
             </form>
         </>
     );
-}
-
-
+}
\ No newline at end of file
diff --git a/components/ReadingHud.module.css b/components/ReadingHud.module.css
index 59cd0b2..62f5d38 100644
--- a/components/ReadingHud.module.css
+++ b/components/ReadingHud.module.css
@@ -10,7 +10,8 @@
   height: 300px;
   z-index: 100;
 }
-@media (max-width: 1200px) {
+
+@media (max-width: 1024px) {
   .readingHud {
     display: none;
   }
@@ -39,30 +40,45 @@
   right: 50%;
   width: 1px;
   height: 100%;
-  transform: translateX(50%);
+  margin-right: -5px; /* THE FIX: Offset the markers container by half the marker width (10px/2) to center it */
 }
 
 .marker {
   position: absolute;
   right: 50%;
-  transform: translateX(50%);
-  width: 10px;
-  height: 10px;
-  background-color: var(--border-color);
+  width: 10px; 
+  height: 10px; 
   border: 2px solid var(--bg-primary);
   border-radius: 50%;
   cursor: pointer;
-  transition: all 0.3s ease;
+  padding: 0;
 }
-.marker:hover {
-  background-color: var(--accent);
-  transform: translateX(50%) scale(1.5);
+
+/* New element for the visual dot and its animated state */
+.markerDot {
+    width: 100%;
+    height: 100%;
+    border-radius: 50%;
+    background-color: var(--border-color);
+    /* --- THE FIX: CSS-driven animation logic --- */
+    transition: transform 0.15s ease-out, background-color 0.15s ease-out, box-shadow 0.15s ease-out;
+    will-change: transform, background-color, box-shadow;
+    transform: scale(1);
 }
-.marker.active {
-  background-color: var(--accent);
-  transform: translateX(50%) scale(1.8);
-  box-shadow: 0 0 12px 2px color-mix(in srgb, var(--accent) 70%, transparent);
+
+.marker.active .markerDot {
+    background-color: var(--accent);
+    box-shadow: 0 0 12px 2px color-mix(in srgb, var(--accent) 70%, transparent);
+    transform: scale(1.8);
+}
+
+.marker:hover .markerDot {
+    background-color: var(--accent);
+    transform: scale(2.2);
+    z-index: 2; /* Ensure hover state is visually on top of active state */
 }
+
+/* This is the part with the glow and hover text */
 .marker::after {
   content: attr(data-title);
   position: absolute;
@@ -79,7 +95,7 @@
   white-space: nowrap;
   opacity: 0;
   pointer-events: none;
-  transition: opacity 0.3s ease, transform 0.3s ease, right 0.3s ease;
+  transition: opacity 0.15s ease-out, transform 0.15s ease-out, left 0.15s ease-out;
   box-shadow: 0 4px 15px rgba(0,0,0,0.1);
   border: 1px solid var(--border-color);
 }
@@ -89,10 +105,37 @@
   left: 25px;
 }
 
+/* --- NEW: Mobile Version --- */
+.readingHudMobile {
+  position: fixed;
+  top: var(--nav-height-scrolled);
+  left: 0;
+  right: 0;
+  height: 3px;
+  z-index: 100;
+  pointer-events: none;
+}
 
+.mobileTrack {
+  width: 100%;
+  height: 100%;
+  background-color: color-mix(in srgb, var(--border-color) 50%, transparent);
+  position: relative;
+}
 
+.mobileProgress {
+  position: absolute;
+  top: 0;
+  bottom: 0;
+  right: 0; /* RTL support */
+  width: 100%;
+  background-color: var(--accent);
+  transform-origin: right; /* RTL support */
+  box-shadow: 0 0 10px 0 var(--accent);
+}
 
-
-
-
-
+@media (min-width: 1025px) {
+  .readingHudMobile {
+    display: none;
+  }
+}
\ No newline at end of file
diff --git a/components/ReadingHud.tsx b/components/ReadingHud.tsx
index f5533b9..be50c91 100644
--- a/components/ReadingHud.tsx
+++ b/components/ReadingHud.tsx
@@ -2,8 +2,8 @@
 'use client';
 
 import { useState, useEffect, useRef } from 'react';
-import { motion, useScroll, useSpring, AnimatePresence } from 'framer-motion';
-import styles from './ReadingHud.module.css'; // <-- IMPORTED
+import { motion, useScroll, useSpring, AnimatePresence, MotionValue, useTransform } from 'framer-motion';
+import styles from './ReadingHud.module.css';
 
 type Heading = {
     id: string;
@@ -11,55 +11,80 @@ type Heading = {
     top: number;
 };
 
-export default function ReadingHud({ contentContainerRef, headings }: { contentContainerRef: React.RefObject<HTMLDivElement | null>, headings: Heading[] }) {
+// We don't need a custom hook; useScroll with a null target handles window scroll.
+export default function ReadingHud({ 
+    contentContainerRef, 
+    headings,
+    isMobile 
+}: { 
+    contentContainerRef: React.RefObject<HTMLDivElement | null>, 
+    headings: Heading[],
+    isMobile: boolean
+}) {
     const [activeHeadings, setActiveHeadings] = useState<Set<string>>(new Set());
-    const [isVisible, setIsVisible] = useState(false);
-    const scrollableHeightRef = useRef(0);
-    const { scrollYProgress } = useScroll({ target: contentContainerRef, offset: ['start start', 'end end'] });
+    const [showHud, setShowHud] = useState(false);
+    
+    const { scrollYProgress } = useScroll({ offset: ['start start', 'end end'] });
+    
     const springyProgress = useSpring(scrollYProgress, { stiffness: 200, damping: 40, restDelta: 0.001 });
+    const progressValue = useTransform(scrollYProgress, (p) => p); // Raw progress MotionValue
 
     useEffect(() => {
-        const contentElement = contentContainerRef.current;
-        if (!contentElement || headings.length === 0) {
-            setIsVisible(false);
-            return;
-        }
-
-        const newScrollableHeight = contentElement.scrollHeight - window.innerHeight;
-        scrollableHeightRef.current = Math.max(1, newScrollableHeight);
-
-        const visibilityObserver = new IntersectionObserver(([entry]) => setIsVisible(entry.isIntersecting), { rootMargin: "0px 0px -40% 0px" });
-        visibilityObserver.observe(contentElement);
+        const unsubscribe = progressValue.on('change', (latestProgress) => {
+            
+            const documentScrollTop = document.documentElement.scrollTop || document.body.scrollTop;
+            const documentScrollHeight = document.documentElement.scrollHeight - document.documentElement.clientHeight;
+            
+            setShowHud(documentScrollTop > 100 && latestProgress < 0.99);
 
-        const unsubscribeFromScroll = scrollYProgress.on("change", (latestProgress) => {
+            if (headings.length === 0 || documentScrollHeight <= 0) return;
+            
             const currentlyActive = new Set<string>();
-            headings.forEach(heading => {
-                const headingProgressPosition = heading.top / scrollableHeightRef.current;
+
+            for (let i = 0; i < headings.length; i++) {
+                const heading = headings[i];
+                const headingProgressPosition = heading.top / documentScrollHeight;
                 if (latestProgress >= headingProgressPosition) {
                     currentlyActive.add(heading.id);
                 }
-            });
+            }
+            
             setActiveHeadings(currentlyActive);
         });
 
-        return () => {
-            visibilityObserver.disconnect();
-            unsubscribeFromScroll();
-        };
-    }, [contentContainerRef, headings, scrollYProgress]);
+        return () => unsubscribe();
+    }, [headings, progressValue, contentContainerRef]); 
 
     const handleMarkerClick = (headingId: string) => {
-        const headingElement = document.getElementById(headingId);
-        if (!headingElement) return;
-        const navbarOffset = 80;
-        const elementTop = headingElement.getBoundingClientRect().top + window.scrollY;
-        const targetScrollPosition = elementTop - navbarOffset;
-        window.scrollTo({ top: targetScrollPosition, behavior: 'smooth' });
+        const targetScrollPosition = headings.find(h => h.id === headingId)?.top;
+
+        if (targetScrollPosition !== undefined) {
+             window.scrollTo({ top: targetScrollPosition, behavior: 'smooth' });
+        }
     };
 
+    if (isMobile) {
+        return (
+            <AnimatePresence>
+                {showHud && (
+                    <motion.aside
+                        className={styles.readingHudMobile}
+                        initial={{ opacity: 0 }}
+                        animate={{ opacity: 1 }}
+                        exit={{ opacity: 0 }}
+                    >
+                        <div className={styles.mobileTrack}>
+                            <motion.div className={styles.mobileProgress} style={{ scaleX: springyProgress }} /> 
+                        </div>
+                    </motion.aside>
+                )}
+            </AnimatePresence>
+        );
+    }
+
     return (
         <AnimatePresence>
-            {isVisible && headings.length > 0 && (
+            {showHud && headings.length > 0 && (
                 <motion.aside
                     className={styles.readingHud}
                     initial={{ opacity: 0, x: 20 }}
@@ -73,15 +98,25 @@ export default function ReadingHud({ contentContainerRef, headings }: { contentC
                     <div className={styles.markers}>
                         {headings.map((h) => {
                             const isActive = activeHeadings.has(h.id);
+                            
+                            const documentScrollHeight = document.documentElement.scrollHeight - document.documentElement.clientHeight;
+                            if (documentScrollHeight <= 0) return null;
+                            
+                            const topPercentage = (h.top / documentScrollHeight) * 100;
+                            
                             return (
                                 <button
                                     key={h.id}
                                     className={`${styles.marker} ${isActive ? styles.active : ''}`}
-                                    style={{ top: `${(h.top / scrollableHeightRef.current) * 100}%` }}
+                                    style={{ 
+                                        top: `${topPercentage}%`,
+                                    }}
                                     onClick={() => handleMarkerClick(h.id)}
                                     data-title={h.title}
                                     aria-label={`Scroll to ${h.title}`}
-                                />
+                                >
+                                    <div className={styles.markerDot} />
+                                </button>
                             )
                         })}
                     </div>
@@ -89,6 +124,4 @@ export default function ReadingHud({ contentContainerRef, headings }: { contentC
             )}
         </AnimatePresence>
     );
-};
-
-
+};
\ No newline at end of file
diff --git a/components/ReleaseCard.tsx b/components/ReleaseCard.tsx
index 01529cf..51297ea 100644
--- a/components/ReleaseCard.tsx
+++ b/components/ReleaseCard.tsx
@@ -16,7 +16,7 @@ import XboxIcon from '@/components/icons/platforms/XboxIcon';
 import SwitchIcon from '@/components/icons/platforms/SwitchIcon';
 
 const PlatformIcons: Record<string, React.FC<React.SVGProps<SVGSVGElement>>> = {
-    'PC': PCIcon, 'PS5': PS5Icon, 'Xbox': XboxIcon, 'Switch': SwitchIcon,
+    'PC': PCIcon, 'PlayStation 5': PS5Icon, 'Xbox': XboxIcon, 'Switch': SwitchIcon,
 };
 
 const CheckIcon = (props: React.SVGProps<SVGSVGElement>) => ( <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" {...props}><path fillRule="evenodd" d="M16.704 4.153a.75.75 0 01.143 1.052l-8 10.5a.75.75 0 01-1.127.075l-4.5-4.5a.75.75 0 011.06-1.06l3.894 3.893 7.48-9.817a.75.75 0 011.052-.143z" clipRule="evenodd" /></svg> );
diff --git a/components/ScoreBox.tsx b/components/ScoreBox.tsx
index cd87005..bf6ed87 100644
--- a/components/ScoreBox.tsx
+++ b/components/ScoreBox.tsx
@@ -10,12 +10,12 @@ import styles from './ScoreBox.module.css';
 const containerVariants = { hidden: { opacity: 0 }, visible: { opacity: 1, transition: { staggerChildren: 0.25, delayChildren: 0.2 }, }, };
 const itemVariants = { hidden: { opacity: 0, y: 20 }, visible: { opacity: 1, y: 0, transition: { duration: 0.5, ease: 'easeOut' as const } }, };
 
-const ScoreBoxComponent = ({ review }: { review: any }) => {
+const ScoreBoxComponent = ({ review, className }: { review: any, className?: string }) => {
     const ref = useRef(null);
     const isInView = useInView(ref, { once: true, amount: 0.5 });
 
     return (
-        <motion.div ref={ref} className={styles.scoreBox} initial="hidden" animate={isInView ? "visible" : "hidden"} variants={containerVariants}>
+        <motion.div ref={ref} className={`${styles.scoreBox} ${className || ''}`} initial="hidden" animate={isInView ? "visible" : "hidden"} variants={containerVariants}>
             <svg className={styles.scoreBoxBorder} width="100%" height="100%">
                 <motion.rect x="1" y="1" width="calc(100% - 2px)" height="calc(100% - 2px)" rx="12" stroke="var(--accent)" strokeWidth="2" fill="transparent" initial={{ pathLength: 0 }} animate={{ pathLength: isInView ? 1 : 0 }} transition={{ duration: 1, ease: 'easeInOut' }} />
             </svg>
@@ -29,7 +29,7 @@ const ScoreBoxComponent = ({ review }: { review: any }) => {
                     <ul>{review.pros.map((pro: string, index: number) => (<li key={`pro-${index}`}>{pro} <CheckIcon style={{flexShrink:0,width:'3.5rem',height:'3.5rem',marginTop:'-0.3rem',color:'#16A34A'}} /></li>))}</ul>
                 </motion.div>
                 <motion.div variants={itemVariants}>
-                    <h4>المآخذ</h4>
+                    <h4>المساوئ</h4>
                     <ul>{review.cons.map((con: string, index: number) => (<li key={`con-${index}`}>{con} <CancelIcon style={{flexShrink:0,width:'1.8rem',height:'1.8rem',marginTop:'0.6rem',color:'#DC2626'}} /></li>))}</ul>
                 </motion.div>
             </div>
@@ -37,6 +37,4 @@ const ScoreBoxComponent = ({ review }: { review: any }) => {
     );
 };
 
-export default memo(ScoreBoxComponent);
-
-
+export default memo(ScoreBoxComponent);
\ No newline at end of file
diff --git a/components/Search.tsx b/components/Search.tsx
index 7eb7ecd..f4a8612 100644
--- a/components/Search.tsx
+++ b/components/Search.tsx
@@ -75,11 +75,11 @@ export default function Search({ isOpen, onClose }: { isOpen: boolean, onClose:
             {isOpen && (
                 <motion.div className={styles.searchOverlay} onClick={onClose} variants={overlayVariants} initial="hidden" animate="visible" exit="hidden" style={{ zIndex: 2000 }} >
                     <motion.div className={styles.searchContainer} onClick={(e) => e.stopPropagation()} variants={containerVariants} initial="hidden" animate="visible" exit="hidden" >
-                        <button className={styles.searchCloseButton} onClick={onClose} aria-label="Close search"><CrossIcon /></button>
+                        <button className={styles.searchCloseButton} onClick={onClose} aria-label="إغلاق البحث"><CrossIcon /></button>
                         <input ref={inputRef} type="search" className={styles.searchInput} placeholder="استنطاق الأرشيف" value={query} onChange={(e) => setQuery(e.target.value)} />
                         <div className={styles.searchResultsList}>
                             <AnimatePresence mode="wait">
-                                {isInitialPrompt && (<motion.p key="prompt" initial={{ opacity: 0 }} animate={{ opacity: 1 }} exit={{ opacity: 0 }} className={styles.searchInitialPrompt}>خُطَّ حروفك لاستنطاق السجلات.</motion.p> )}
+                                {isInitialPrompt && (<motion.p key="prompt" initial={{ opacity: 0 }} animate={{ opacity: 1 }} exit={{ opacity: 0 }} className={styles.searchInitialPrompt}>خُطَّ ما في نفسِكَ تُجِبْكَ السجلات.</motion.p> )}
                                 {isSearching && (<motion.div key="loading" initial={{ opacity: 0 }} animate={{ opacity: 1 }} exit={{ opacity: 0 }} style={{ display: 'flex', justifyContent: 'center', padding: '4rem' }}><div className="spinner" style={{ width: '50px', height: '50px', borderTopColor: 'var(--accent)' }} /></motion.div> )}
                                 {hasContent && (
                                     <motion.ul key="results" variants={listVariants} initial="hidden" animate="visible" exit="hidden" >
@@ -102,7 +102,7 @@ export default function Search({ isOpen, onClose }: { isOpen: boolean, onClose:
                                         ))}
                                     </motion.ul>
                                 )}
-                                {!isSearching && query.length >= 3 && results.length === 0 && (<motion.div key="no-results" initial={{ opacity: 0 }} animate={{ opacity: 1 }} exit={{ opacity: 0 }} style={{ color: 'var(--text-secondary)', marginTop: '3rem', textAlign: 'center', fontSize: '2.4rem' }}><p>لا أثر في السجلات لـ &quot;{query}&quot;.</p></motion.div>)}
+                                {!isSearching && query.length >= 3 && results.length === 0 && (<motion.div key="no-results" initial={{ opacity: 0 }} animate={{ opacity: 1 }} exit={{ opacity: 0 }} style={{ color: 'var(--text-secondary)', marginTop: '3rem', textAlign: 'center', fontSize: '2.4rem' }}><p>لا أثرَ في السجلاتِ لـ &quot;{query}&quot;.</p></motion.div>)}
                             </AnimatePresence>
                         </div>
                     </motion.div>
diff --git a/components/SignInModal.module.css b/components/SignInModal.module.css
index b7ff26b..6ef26d5 100644
--- a/components/SignInModal.module.css
+++ b/components/SignInModal.module.css
@@ -62,9 +62,11 @@
   width: 24px;
   height: 24px;
   z-index: 20;
+  transition: color 0.2s ease-out, transform 0.2s ease-out;
 }
 .authBackButton:hover {
   color: var(--text-primary);
+  transform: translateX(2px);
 }
 .formHeader {
   text-align: center;
@@ -78,22 +80,52 @@
 .credentialsForm {
   display: flex;
   flex-direction: column;
-  gap: 1.5rem;
+  gap: 2.5rem; /* Increased gap to accommodate labels */
   width: 100%;
 }
+
+/* --- THE DEFINITIVE FIX: FLOATING LABEL STYLES --- */
+.authFormGroup {
+  position: relative;
+}
+.authFormLabel {
+  position: absolute;
+  right: 1.5rem;
+  left: auto;
+  top: 1.2rem;
+  font-family: var(--font-main);
+  font-size: 1.4rem;
+  color: var(--text-secondary);
+  pointer-events: none;
+  transition: all 0.2s ease-out;
+}
+.authInput:focus ~ .authFormLabel,
+.authInput:not(:placeholder-shown) ~ .authFormLabel {
+  top: -2.4rem; /* Move label up */
+  right: 0;
+  font-size: 1.4rem;
+  font-weight: 600;
+  color: var(--accent);
+}
 .authInput {
   width: 100%;
+  height: 4.8rem;
   background-color: var(--bg-primary);
   border: 1px solid var(--border-color);
   border-radius: 8px;
   padding: 1.2rem 1.5rem;
-  font-size: 1.5rem;
+  font-size: 1.6rem;
   color: var(--text-primary);
+  transition: border-color 0.3s ease, box-shadow 0.3s ease;
+  text-align: right;
 }
 .authInput:focus {
   outline: none;
   border-color: var(--accent);
+  box-shadow: 0 0 0 3px color-mix(in srgb, var(--accent) 20%, transparent);
 }
+/* --- END FLOATING LABEL STYLES --- */
+
 .authSubmitButton {
   background-color: var(--accent);
   color: #fff;
@@ -103,7 +135,13 @@
   font-weight: 700;
   font-size: 1.6rem;
   cursor: pointer;
-  margin-top: 0.5rem;
+  margin-top: 1rem;
+  box-shadow: 0 0 15px color-mix(in srgb, var(--accent) 30%, transparent);
+  transition: transform 0.2s ease-out, box-shadow 0.2s ease-out;
+}
+.authSubmitButton:hover:not(:disabled) {
+  transform: scale(1.05);
+  box-shadow: 0 0 25px color-mix(in srgb, var(--accent) 50%, transparent);
 }
 [data-theme="dark"] .authSubmitButton {
   color: var(--bg-primary);
@@ -115,6 +153,7 @@
   color: var(--text-secondary);
 }
 .linkButton {
+  position: relative;
   background: none;
   border: none;
   padding: 0;
@@ -123,7 +162,24 @@
   color: var(--accent);
   font-weight: 600;
   cursor: pointer;
-  text-decoration: underline;
+  text-decoration: none;
+}
+
+.linkButton::after {
+  content: '';
+  position: absolute;
+  width: 100%;
+  transform: scaleX(0);
+  height: 2px;
+  bottom: -2px;
+  right: 0;
+  background-color: var(--accent);
+  transform-origin: bottom right;
+  transition: transform 0.3s ease-out;
+}
+
+.linkButton:hover::after {
+  transform: scaleX(1);
 }
 
 .authMessage {
@@ -136,6 +192,4 @@
 }
 .authMessage.success {
   color: #16A34A;
-}
-
-
+}
\ No newline at end of file
diff --git a/components/SignInModal.tsx b/components/SignInModal.tsx
index f3a79db..501bb41 100644
--- a/components/SignInModal.tsx
+++ b/components/SignInModal.tsx
@@ -19,96 +19,109 @@ const GoogleIcon = dynamic(() => import('@/components/icons/GoogleIcon'));
 const XIcon = dynamic(() => import('@/components/icons/XIcon'));
 const EternalGamesIcon = dynamic(() => import('@/components/icons/EternalGamesIcon'));
 
-const CredentialsForm = ({ onBack, onAuthSuccess, onForgotPassword, callbackUrl }: { onBack: () => void, onAuthSuccess: () => void, onForgotPassword: () => void, callbackUrl: string }) => {
-    const [view, setView] = useState<'signin' | 'signup'>('signin');
+const formContentVariants = {
+    hidden: { opacity: 0, transition: { duration: 0.15, ease: 'easeOut' as const } },
+    visible: { opacity: 1, transition: { delay: 0.25, duration: 0.3, ease: 'easeIn' as const } },
+    exit: { opacity: 0, transition: { duration: 0.15, ease: 'easeOut' as const } }
+};
+
+const satelliteVariants = {
+    hidden: (direction: number) => ({
+        y: 80, x: direction * 20, scale: 0, opacity: 0, rotate: 360,
+        transition: { duration: 0.4, ease: 'easeIn' as const }
+    }),
+    visible: {
+        y: 0, x: 0, scale: 1, opacity: 1, rotate: 0,
+        transition: { type: 'spring' as const, stiffness: 300, damping: 20, delay: 0.3 }
+    }
+};
+
+// --- START: Refactored Form Components ---
+
+const SignInForm = ({ onSwitchToSignUp, onForgotPassword, onAuthSuccess, onBack, callbackUrl }: { onSwitchToSignUp: () => void, onForgotPassword: () => void, onAuthSuccess: () => void, onBack: () => void, callbackUrl: string }) => {
     const [isPending, startTransition] = useTransition();
     const [message, setMessage] = useState<{ type: 'error' | 'success'; text: string } | null>(null);
     const router = useRouter();
-
     const [email, setEmail] = useState('');
     const [password, setPassword] = useState('');
-    
+
     const handleSignIn = (event: React.FormEvent<HTMLFormElement>) => {
         event.preventDefault();
         setMessage(null);
         const formData = new FormData(event.currentTarget);
         
         startTransition(async () => {
-            const result = await signIn('credentials', {
-                redirect: false,
-                ...Object.fromEntries(formData),
-            });
-
-            if (result?.error) {
-                setMessage({ type: 'error', text: result.error });
-            } else if (result?.url) {
-                router.push(result.url);
-                onAuthSuccess();
-            } else {
-                 setMessage({ type: 'error', text: 'طرأ خطأ غير متوقع.' });
-            }
+            const result = await signIn('credentials', { redirect: false, ...Object.fromEntries(formData) });
+            if (result?.error) setMessage({ type: 'error', text: result.error });
+            else if (result?.url) { router.push(result.url); onAuthSuccess(); } 
+            else setMessage({ type: 'error', text: 'طرأ خطبٌ ما.' });
         });
     };
-    
+
+    return (
+        <motion.div className={styles.authCredentialsContent} variants={formContentVariants} initial="hidden" animate="visible" exit="hidden">
+            <button onClick={onBack} className={styles.authBackButton}><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" style={{transform: 'scaleX(-1)'}}><path fillRule="evenodd" d="M12.79 5.23a.75.75 0 01-.02 1.06L8.832 10l3.938 3.71a.75.75 0 11-1.04 1.08l-4.5-4.25a.75.75 0 010-1.08l4.5-4.25a.75.75 0 011.06.02z" clipRule="evenodd" /></svg></button>
+            <div className={styles.formHeader}><h2 className={styles.formTitle}>الدخول بالبريد الإلكتروني</h2></div>
+            <form onSubmit={handleSignIn} className={styles.credentialsForm}>
+                <input type="hidden" name="returnTo" value={callbackUrl} />
+                <div className={styles.authFormGroup}>
+                    <input id="signin-email" type="email" name="email" required className={styles.authInput} autoFocus value={email} onChange={e => setEmail(e.target.value)} placeholder=" " />
+                    <label htmlFor="signin-email" className={styles.authFormLabel}>البريد</label>
+                </div>
+                <div className={styles.authFormGroup}>
+                    <input id="signin-password" type="password" name="password" required className={styles.authInput} value={password} onChange={e => setPassword(e.target.value)} placeholder=" " />
+                    <label htmlFor="signin-password" className={styles.authFormLabel}>كلمة السر</label>
+                </div>
+                <motion.button type="submit" className={styles.authSubmitButton} disabled={isPending} style={{ display: 'flex', alignItems: 'center', justifyContent: 'center', overflow: 'hidden' }} animate={{ width: isPending ? '48px' : '100%', borderRadius: isPending ? '50%' : '8px' }} transition={{ type: 'spring', stiffness: 400, damping: 25 }}>
+                    <AnimatePresence mode="wait">{isPending ? <ButtonLoader key="loader" /> : <motion.span key="text" initial={{opacity:0}} animate={{opacity:1}} exit={{opacity:0}}>تسجيل الدخول</motion.span>}</AnimatePresence>
+                </motion.button>
+            </form>
+            {message && <p className={`${styles.authMessage} ${styles.error}`}>{message.text}</p>}
+            <p className={styles.authViewSwitcher}>جديدٌ في رحابنا؟ <button type="button" onClick={() => {onSwitchToSignUp(); setMessage(null);}} className={styles.linkButton}>أنشئ حسابًا</button></p>
+            <button type="button" onClick={onForgotPassword} className={styles.linkButton} style={{textAlign: 'center', fontSize: '1.4rem', color: 'var(--text-secondary)', display: 'block', margin: '1rem auto 0'}}>أنسيت كلمة السر؟</button>
+        </motion.div>
+    );
+};
+
+const SignUpForm = ({ onSwitchToSignIn, onAuthSuccess, onBack, callbackUrl }: { onSwitchToSignIn: () => void, onAuthSuccess: () => void, onBack: () => void, callbackUrl: string }) => {
+    const [isPending, startTransition] = useTransition();
+    const [message, setMessage] = useState<{ type: 'error' | 'success'; text: string } | null>(null);
+    const router = useRouter();
+    const [email, setEmail] = useState('');
+    const [password, setPassword] = useState('');
+
     const handleSignUp = (event: React.FormEvent<HTMLFormElement>) => {
         event.preventDefault();
         setMessage(null);
-        
         const formData = new FormData(event.currentTarget);
-
         startTransition(async () => {
-            const result = await signIn('signup', {
-                redirect: false,
-                ...Object.fromEntries(formData),
-            });
-
-            if (result?.error) {
-                setMessage({ type: 'error', text: result.error });
-            } else if (result?.url) {
-                router.push(result.url);
-                onAuthSuccess();
-            } else {
-                setMessage({ type: 'error', text: 'An unexpected error occurred during sign up.' });
-            }
+            const result = await signIn('signup', { redirect: false, ...Object.fromEntries(formData) });
+            if (result?.error) setMessage({ type: 'error', text: result.error });
+            else if (result?.url) { router.push(result.url); onAuthSuccess(); } 
+            else setMessage({ type: 'error', text: 'طرأ خطبٌ ما.' });
         });
     };
-
+    
     return (
-        <motion.div className={styles.authCredentialsContent} initial={{ opacity: 0 }} animate={{ opacity: 1, transition: { delay: 0.25, duration: 0.3 } }} exit={{ opacity: 0, transition: { duration: 0.15 } }}>
-            <motion.button onClick={onBack} className={styles.authBackButton} whileHover={{ x: 2 }} >
-                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" style={{transform: 'scaleX(-1)'}}><path fillRule="evenodd" d="M12.79 5.23a.75.75 0 01-.02 1.06L8.832 10l3.938 3.71a.75.75 0 11-1.04 1.08l-4.5-4.25a.75.75 0 010-1.08l4.5-4.25a.75.75 0 011.06.02z" clipRule="evenodd" /></svg>
-            </motion.button>
-            <div className={styles.formHeader}><h2 className={styles.formTitle}>{view === 'signup' ? 'إنشاء حساب' : 'Sign In with Email'}</h2></div>
-            
-            {view === 'signin' ? (
-                <form onSubmit={handleSignIn} className={styles.credentialsForm}>
-                    <input type="hidden" name="returnTo" value={callbackUrl} />
-                    <input type="email" name="email" placeholder="البريد الإلكتروني" required className={styles.authInput} autoFocus value={email} onChange={e => setEmail(e.target.value)} />
-                    <input type="password" name="password" placeholder="كلمة السر" required className={styles.authInput} value={password} onChange={e => setPassword(e.target.value)} />
-                    <motion.button type="submit" className={styles.authSubmitButton} disabled={isPending} animate={{ width: isPending ? '48px' : '100%', borderRadius: isPending ? '50%' : '8px' }} transition={{ type: 'spring', stiffness: 400, damping: 25 }}>
-                        <AnimatePresence mode="wait">{isPending ? <ButtonLoader key="loader" /> : <motion.span key="text" initial={{opacity:0}} animate={{opacity:1}} exit={{opacity:0}}>ولوج</motion.span>}</AnimatePresence>
-                    </motion.button>
-                </form>
-            ) : (
-                <form onSubmit={handleSignUp} className={styles.credentialsForm}>
-                    <input type="hidden" name="returnTo" value={callbackUrl} />
-                    <input type="email" name="email" placeholder="البريد الإلكتروني" required value={email} onChange={e => setEmail(e.target.value)} className={styles.authInput} />
-                    <input type="password" name="password" placeholder="كلمة السر (8 أحرف على الأقل)" required value={password} onChange={e => setPassword(e.target.value)} className={styles.authInput} />
-                    <motion.button type="submit" className={styles.authSubmitButton} disabled={isPending} animate={{ width: isPending ? '48px' : '100%', borderRadius: isPending ? '50%' : '8px' }} transition={{ type: 'spring', stiffness: 400, damping: 25 }}>
-                        <AnimatePresence mode="wait">{isPending ? <ButtonLoader key="loader" /> : <motion.span key="text" initial={{opacity:0}} animate={{opacity:1}} exit={{opacity:0}}>أنشئ حسابًا</motion.span>}</AnimatePresence>
-                    </motion.button>
-                </form>
-            )}
-
-            {message && <p className={`${styles.authMessage} ${message.type === 'error' ? styles.error : styles.success}`}>{message.text}</p>}
-            <p className={styles.authViewSwitcher}>
-                {view === 'signup' ? (
-                    <>لديك حساب بالفعل؟ <button type="button" onClick={() => {setView('signin'); setMessage(null);}} className={styles.linkButton}>ولوج</button></>
-                ) : (
-                    <>جديدٌ في EternalGames؟ <button type="button" onClick={() => {setView('signup'); setMessage(null);}} className={styles.linkButton}>أنشئ حسابًا</button></>
-                )}
-            </p>
-            {view === 'signin' && <button type="button" onClick={onForgotPassword} className={styles.linkButton} style={{textAlign: 'center', fontSize: '1.4rem', color: 'var(--text-secondary)', display: 'block', margin: '1rem auto 0'}}>هل نسيت كلمة السر؟</button>}
+        <motion.div className={styles.authCredentialsContent} variants={formContentVariants} initial="hidden" animate="visible" exit="hidden">
+            <button onClick={onBack} className={styles.authBackButton}><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" style={{transform: 'scaleX(-1)'}}><path fillRule="evenodd" d="M12.79 5.23a.75.75 0 01-.02 1.06L8.832 10l3.938 3.71a.75.75 0 11-1.04 1.08l-4.5-4.25a.75.75 0 010-1.08l4.5-4.25a.75.75 0 011.06.02z" clipRule="evenodd" /></svg></button>
+            <div className={styles.formHeader}><h2 className={styles.formTitle}>إنشاء حساب</h2></div>
+             <form onSubmit={handleSignUp} className={styles.credentialsForm}>
+                <input type="hidden" name="returnTo" value={callbackUrl} />
+                <div className={styles.authFormGroup}>
+                    <input id="signup-email" type="email" name="email" required value={email} onChange={e => setEmail(e.target.value)} className={styles.authInput} placeholder=" " />
+                    <label htmlFor="signup-email" className={styles.authFormLabel}>البريد</label>
+                </div>
+                <div className={styles.authFormGroup}>
+                    <input id="signup-password" type="password" name="password" required value={password} onChange={e => setPassword(e.target.value)} className={styles.authInput} placeholder=" " />
+                    <label htmlFor="signup-password" className={styles.authFormLabel}>كلمة السر (8 حروف على الأقل)</label>
+                </div>
+                <motion.button type="submit" className={styles.authSubmitButton} disabled={isPending} style={{ display: 'flex', alignItems: 'center', justifyContent: 'center', overflow: 'hidden' }} animate={{ width: isPending ? '48px' : '100%', borderRadius: isPending ? '50%' : '8px' }} transition={{ type: 'spring', stiffness: 400, damping: 25 }}>
+                    <AnimatePresence mode="wait">{isPending ? <ButtonLoader key="loader" /> : <motion.span key="text" initial={{opacity:0}} animate={{opacity:1}} exit={{opacity:0}}>أنشئ حسابًا</motion.span>}</AnimatePresence>
+                </motion.button>
+            </form>
+            {message && <p className={`${styles.authMessage} ${styles.error}`}>{message.text}</p>}
+            <p className={styles.authViewSwitcher}>لديك حساب؟ <button type="button" onClick={() => {onSwitchToSignIn(); setMessage(null);}} className={styles.linkButton}>تسجيل الدخول</button></p>
         </motion.div>
     );
 };
@@ -123,21 +136,20 @@ const ForgotPasswordForm = ({ onBack }: { onBack: () => void }) => {
         setMessage(null);
         startTransition(async () => {
             const result = await requestPasswordReset(email);
-            if(result.success) {
-                setMessage({type: 'success', text: result.message});
-            } else {
-                setMessage({type: 'error', text: result.message});
-            }
+            setMessage({type: result.success ? 'success' : 'error', text: result.message});
         });
     };
 
     return (
-        <motion.div className={styles.authCredentialsContent} initial={{ opacity: 0 }} animate={{ opacity: 1, transition: { delay: 0.25, duration: 0.3 } }} exit={{ opacity: 0, transition: { duration: 0.15 } }}>
-            <motion.button onClick={onBack} className={styles.authBackButton} whileHover={{ x: 2 }}><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" style={{transform: 'scaleX(-1)'}}><path fillRule="evenodd" d="M12.79 5.23a.75.75 0 01-.02 1.06L8.832 10l3.938 3.71a.75.75 0 11-1.04 1.08l-4.5-4.25a.75.75 0 010-1.08l4.5-4.25a.75.75 0 011.06.02z" clipRule="evenodd" /></svg></motion.button>
-            <div className={styles.formHeader}><h2 className={styles.formTitle}>إعادة تعيين كلمة السر</h2><p style={{color: 'var(--text-secondary)', fontSize: '1.5rem'}}>أدخل بريدك لتلقي رابط إعادة التعيين.</p></div>
+        <motion.div className={styles.authCredentialsContent} variants={formContentVariants} initial="hidden" animate="visible" exit="hidden">
+            <button onClick={onBack} className={styles.authBackButton}><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" style={{transform: 'scaleX(-1)'}}><path fillRule="evenodd" d="M12.79 5.23a.75.75 0 01-.02 1.06L8.832 10l3.938 3.71a.75.75 0 11-1.04 1.08l-4.5-4.25a.75.75 0 010-1.08l4.5-4.25a.75.75 0 011.06.02z" clipRule="evenodd" /></svg></button>
+            <div className={styles.formHeader}><h2 className={styles.formTitle}>إعادة تعيين كلمة السر</h2><p style={{color: 'var(--text-secondary)', fontSize: '1.5rem'}}>أدخل بريدك ليصلك رابط التعيين.</p></div>
             <form onSubmit={handleSubmit} className={styles.credentialsForm}>
-                <input type="email" name="email" placeholder="البريد الإلكتروني" required className={styles.authInput} autoFocus value={email} onChange={(e) => setEmail(e.target.value)} />
-                <motion.button type="submit" className={styles.authSubmitButton} disabled={isPending} animate={{ width: isPending ? '48px' : '100%', height: '48px', borderRadius: isPending ? '50%' : '8px' }} transition={{ type: 'spring', stiffness: 400, damping: 25 }}>
+                <div className={styles.authFormGroup}>
+                    <input id="reset-email" type="email" name="email" required className={styles.authInput} autoFocus value={email} onChange={(e) => setEmail(e.target.value)} placeholder=" " />
+                    <label htmlFor="reset-email" className={styles.authFormLabel}>البريد</label>
+                </div>
+                <motion.button type="submit" className={styles.authSubmitButton} disabled={isPending} style={{ display: 'flex', alignItems: 'center', justifyContent: 'center', overflow: 'hidden' }} animate={{ width: isPending ? '48px' : '100%', height: '48px', borderRadius: isPending ? '50%' : '8px' }} transition={{ type: 'spring', stiffness: 400, damping: 25 }}>
                     <AnimatePresence mode="wait">{isPending ? <ButtonLoader key="loader" /> : <motion.span key="text" initial={{opacity:0}} animate={{opacity:1}} exit={{opacity:0}}>إرسال الرابط</motion.span>}</AnimatePresence>
                 </motion.button>
             </form>
@@ -146,9 +158,17 @@ const ForgotPasswordForm = ({ onBack }: { onBack: () => void }) => {
     );
 };
 
+// --- END: Refactored Form Components ---
+
+const authProviders = [
+    { id: 'github', Icon: GitHubIcon, label: 'GitHub' },
+    { id: 'google', Icon: GoogleIcon, label: 'Google' },
+    { id: 'twitter', Icon: XIcon, label: 'X/Twitter' },
+];
+
 export default function SignInModal() {
     const { isSignInModalOpen, setSignInModalOpen } = useUserStore();
-    const [view, setView] = useState<'orbs' | 'credentials' | 'forgotPassword'>('orbs');
+    const [view, setView] = useState<'orbs' | 'signin' | 'signup' | 'forgotPassword'>('orbs');
     const [isMounted, setIsMounted] = useState(false);
     const [loadingProvider, setLoadingProvider] = useState<string | null>(null);
     const pathname = usePathname();
@@ -166,54 +186,63 @@ export default function SignInModal() {
         signIn(provider, { callbackUrl: pathname });
     };
 
-    const renderContent = () => {
-        switch(view) {
-            case 'credentials':
-                return <CredentialsForm onBack={() => setView('orbs')} onAuthSuccess={handleClose} onForgotPassword={() => setView('forgotPassword')} callbackUrl={pathname} />;
-            case 'forgotPassword':
-                return <ForgotPasswordForm onBack={() => setView('credentials')} />;
-            case 'orbs':
-            default:
-                return (
-                    <motion.div key="center-orb" style={{ zIndex: loadingProvider ? 0 : 'auto' }}>
-                        <AuthOrb Icon={EternalGamesIcon} onClick={() => setView('credentials')} ariaLabel="الولوج بالبريد" isLarge isDisabled={!!loadingProvider} />
-                    </motion.div>
-                );
-        }
-    }
-
     const modalContent = (
         <AnimatePresence>
             {isSignInModalOpen && (
                 <motion.div className={modalStyles.modalOverlay} onClick={handleClose} initial={{ opacity: 0 }} animate={{ opacity: 1 }} exit={{ opacity: 0 }}>
                     <motion.div className={styles.authModalPanelContainer} onClick={(e) => e.stopPropagation()} initial="hidden" animate="visible" >
-                        <AnimatePresence>
-                            {view === 'orbs' && (
-                                <div className={styles.authSatelliteContainer}>
-                                    <motion.div className={styles.authOrbRowTop}>
-                                        <AuthOrb Icon={GitHubIcon} onClick={() => handleProviderSignIn('github')} ariaLabel="الولوج عبر GitHub" isLoading={loadingProvider === 'github'} isDisabled={!!loadingProvider} />
-                                        <AuthOrb Icon={GoogleIcon} onClick={() => handleProviderSignIn('google')} ariaLabel="الولوج عبر Google" isLoading={loadingProvider === 'google'} isDisabled={!!loadingProvider} />
-                                        <AuthOrb Icon={XIcon} onClick={() => handleProviderSignIn('twitter')} ariaLabel="الولوج عبر X/Twitter" isLoading={loadingProvider === 'twitter'} isDisabled={!!loadingProvider} />
+                        <div className={styles.authSatelliteContainer}>
+                            <div className={styles.authOrbRowTop}>
+                                <AnimatePresence>
+                                    {view === 'orbs' && authProviders.map((provider, i) => {
+                                        const direction = i - 1;
+                                        return (
+                                            <motion.div key={provider.id} custom={direction} variants={satelliteVariants} initial="hidden" animate="visible" exit="hidden">
+                                                <AuthOrb Icon={provider.Icon} onClick={() => handleProviderSignIn(provider.id)} ariaLabel={`الدخول عبر ${provider.label}`} isLoading={loadingProvider === provider.id} isDisabled={!!loadingProvider} />
+                                            </motion.div>
+                                        );
+                                    })}
+                                </AnimatePresence>
+                            </div>
+                            <AnimatePresence>
+                                {view === 'orbs' && (
+                                    <motion.p className={styles.authFooterText} initial={{ opacity: 0 }} animate={{ opacity: 1, transition: { delay: 0.2 } }} exit={{ opacity: 0, transition: { duration: 0.2 } }}>
+                                        انضم إلى EternalGames عبر مزود خدمة أو تابع بالبريد.
+                                    </motion.p>
+                                )}
+                            </AnimatePresence>
+                        </div>
+                        
+                        <div className={styles.authMorphWrapper} style={{ zIndex: 10 }}>
+                            <AnimatePresence mode="popLayout" initial={false}>
+                                {view === 'orbs' && (
+                                    <motion.div key="orbs" layoutId="auth-panel" style={{ zIndex: loadingProvider ? 0 : 'auto' }}>
+                                        <AuthOrb Icon={EternalGamesIcon} onClick={() => setView('signin')} ariaLabel="الدخول بالبريد" isLarge isDisabled={!!loadingProvider} />
                                     </motion.div>
-                                    <motion.p className={styles.authFooterText}>انضم إلى EternalGames عبر مزود خدمة أو تابع بالبريد.</motion.p>
-                                </div>
-                            )}
-                        </AnimatePresence>
-                        <motion.div layoutId="auth-panel" className={styles.authMorphWrapper} transition={{ type: 'spring', stiffness: 500, damping: 30, mass: 0.7 }}>
-                            <AnimatePresence mode="wait" initial={false}>
-                                <div key={view} className={view !== 'orbs' ? styles.authCredentialsPanel : ''}>
-                                    {renderContent()}
-                                </div>
+                                )}
+                                {view === 'signin' && (
+                                    <motion.div key="signin" layoutId="auth-panel" className={styles.authCredentialsPanel}>
+                                        <SignInForm onSwitchToSignUp={() => setView('signup')} onForgotPassword={() => setView('forgotPassword')} onAuthSuccess={handleClose} onBack={() => setView('orbs')} callbackUrl={pathname} />
+                                    </motion.div>
+                                )}
+                                {view === 'signup' && (
+                                    <motion.div key="signup" layoutId="auth-panel" className={styles.authCredentialsPanel}>
+                                        <SignUpForm onSwitchToSignIn={() => setView('signin')} onAuthSuccess={handleClose} onBack={() => setView('orbs')} callbackUrl={pathname} />
+                                    </motion.div>
+                                )}
+                                {view === 'forgotPassword' && (
+                                    <motion.div key="forgot-password" layoutId="auth-panel" className={styles.authCredentialsPanel}>
+                                        <ForgotPasswordForm onBack={() => setView('signin')} />
+                                    </motion.div>
+                                )}
                             </AnimatePresence>
-                        </motion.div>
+                        </div>
                     </motion.div>
                 </motion.div>
             )}
         </AnimatePresence>
     );
 
-    if (!isMounted) { return null; }
+    if (!isMounted) return null;
     return createPortal(modalContent, document.body);
-}
-
-
+}
\ No newline at end of file
diff --git a/components/StudioBar.tsx b/components/StudioBar.tsx
index 6b83b69..bbeeafa 100644
--- a/components/StudioBar.tsx
+++ b/components/StudioBar.tsx
@@ -45,7 +45,7 @@ export default function StudioBar() {
                     {editPath && (
                         <Link href={editPath} className={styles.studioBarButton}>
                             <EditIcon />
-                            <span>Edit Page</span>
+                            <span>تعديل الصفحة</span>
                         </Link>
                     )}
                 </div>
diff --git a/components/ThemeToggle.tsx b/components/ThemeToggle.tsx
index 829ac70..9148e48 100644
--- a/components/ThemeToggle.tsx
+++ b/components/ThemeToggle.tsx
@@ -22,8 +22,8 @@ export const ThemeToggle = () => {
         <motion.button
             className={styles.themeToggleButton} // <-- UPDATED CLASS
             onClick={() => setTheme(isDark ? 'light' : 'dark')}
-            aria-label={isDark ? 'Activate light mode' : 'Activate dark mode'}
-            title={isDark ? 'Activate light mode' : 'Activate dark mode'}
+            aria-label={isDark ? 'تفعيل الوضع النهاري' : 'تفعيل الوضع الليلي'}
+            title={isDark ? 'تفعيل الوضع النهاري' : 'تفعيل الوضع الليلي'}
             whileHover={{ scale: 1.2, rotate: 90 }}
             whileTap={{ scale: 0.9, rotate: -90 }}
             transition={{ type: "spring", stiffness: 400, damping: 15 }}
diff --git a/components/TimelineCard.tsx b/components/TimelineCard.tsx
index 7d422e7..13670c9 100644
--- a/components/TimelineCard.tsx
+++ b/components/TimelineCard.tsx
@@ -17,17 +17,15 @@ import SwitchIcon from '@/components/icons/platforms/SwitchIcon';
 
 const PlatformIcons: Record<string, React.FC<React.SVGProps<SVGSVGElement>>> = {
     'PC': PCIcon,
-    'PS5': PS5Icon,
+    'PlayStation 5': PS5Icon,
     'Xbox': XboxIcon,
     'Switch': SwitchIcon,
 };
 
 const CheckIcon = (props: React.SVGProps<SVGSVGElement>) => ( <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" {...props}><path fillRule="evenodd" d="M16.704 4.153a.75.75 0 01.143 1.052l-8 10.5a.75.75 0 01-1.127.075l-4.5-4.5a.75.75 0 011.06-1.06l3.894 3.893 7.48-9.817a.75.75 0 011.052-.143z" clipRule="evenodd" /></svg> );
 
-const TimelineCardComponent = ({ release }: { release: SanityGameRelease }) => {
+const TimelineCardComponent = ({ release }: { release: SanityGameRelease & { game?: { slug?: string } } }) => {
     const { livingCardRef, livingCardAnimation } = useLivingCard();
-
-    // --- ENHANCEMENT: Glare effect logic from ChronoCard.tsx ---
     const mouseX = useMotionValue(0.5);
     const mouseY = useMotionValue(0.5);
     const smoothMouseX = useSpring(mouseX, { damping: 20, stiffness: 150, mass: 0.7 });
@@ -48,7 +46,6 @@ const TimelineCardComponent = ({ release }: { release: SanityGameRelease }) => {
         mouseX.set(0.5);
         mouseY.set(0.5);
     };
-    // --- END ENHANCEMENT ---
 
     const arabicMonths = ["يناير", "فبراير", "مارس", "أبريل", "مايو", "يونيو", "يوليو", "أغسطس", "سبتمبر", "أكتوبر", "نوفمبر", "ديسمبر"];
     const englishMonths = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
@@ -57,6 +54,9 @@ const TimelineCardComponent = ({ release }: { release: SanityGameRelease }) => {
     const monthIndex = date.getUTCMonth();
     const formattedDate = `${day} ${arabicMonths[monthIndex]} - ${englishMonths[monthIndex]}`;
 
+    // THE DEFINITIVE FIX: Use the game slug if available, otherwise default to a non-existent path.
+    const linkPath = release.game?.slug ? `/games/${release.game.slug}` : '/';
+
     return (
         <motion.div 
             ref={livingCardRef} 
@@ -66,14 +66,10 @@ const TimelineCardComponent = ({ release }: { release: SanityGameRelease }) => {
             className={styles.livingCardWrapper} 
             style={livingCardAnimation.style}
         >
-            <Link href={`/games/${release.slug}`} className={`${styles.timelineCard} no-underline`} style={{transformStyle: 'preserve-3d'}}>
-                {/* --- ENHANCEMENT: Glare element --- */}
+            <Link href={linkPath} className={`${styles.timelineCard} no-underline`} style={{transformStyle: 'preserve-3d'}}>
                 <motion.div
                     className={styles.livingCardGlare}
-                    style={{
-                        '--mouse-x': glareX,
-                        '--mouse-y': glareY,
-                    } as any}
+                    style={{ '--mouse-x': glareX, '--mouse-y': glareY } as any}
                 />
                 
                 <div className={styles.imageContainer} style={{ transform: 'translateZ(20px)' }}>
@@ -102,6 +98,4 @@ const TimelineCardComponent = ({ release }: { release: SanityGameRelease }) => {
     );
 }
 
-export default memo(TimelineCardComponent);
-
-
+export default memo(TimelineCardComponent);
\ No newline at end of file
diff --git a/components/UserProfile.module.css b/components/UserProfile.module.css
index 4873495..a4431cc 100644
--- a/components/UserProfile.module.css
+++ b/components/UserProfile.module.css
@@ -155,7 +155,7 @@
   font-family: var(--font-main), sans-serif;
   font-weight: 500;
   cursor: pointer;
-  transition: opacity 0.2s ease, transform 0.2s ease;
+  transition: opacity 0.2s ease, transform 0.2s ease-out;
 }
 
 [data-theme="dark"] .signInButton {
@@ -164,6 +164,5 @@
 
 .signInButton:hover {
   opacity: 0.85;
-}
-
-
+  transform: scale(1.05);
+}
\ No newline at end of file
diff --git a/components/UserProfile.tsx b/components/UserProfile.tsx
index db21d8f..a7d337b 100644
--- a/components/UserProfile.tsx
+++ b/components/UserProfile.tsx
@@ -4,14 +4,13 @@
 import { useSession, signOut } from 'next-auth/react';
 import Image from 'next/image';
 import Link from 'next/link';
-import { useState, useEffect, useRef, lazy, Suspense } from 'react';
+import { useState, useEffect, useRef } from 'react';
 import { motion, AnimatePresence } from 'framer-motion';
 import { useUserStore } from '@/lib/store';
 import { UserCircleIcon, UserSettings01Icon, AllBookmarkIcon, Logout03Icon } from '@/components/icons/index';
+import SignInModal from './SignInModal';
 import styles from './UserProfile.module.css';
 
-const SignInModal = lazy(() => import('./SignInModal'));
-
 const UserProfile = () => {
     const { data: session, status } = useSession();
     const [isDropdownOpen, setIsDropdownOpen] = useState(false);
@@ -91,7 +90,7 @@ const UserProfile = () => {
                             <div className={styles.userDropdownDivider} />
                             <button onClick={() => signOut()} className={`${styles.userDropdownItem} ${styles.signout}`}>
                                 <Logout03Icon className={styles.dropdownItemIcon} />
-                                <span>خروج</span>
+                                <span>تسجيل الخروج</span>
                             </button>
                         </motion.div>
                     )}
@@ -102,19 +101,15 @@ const UserProfile = () => {
 
     return (
         <>
-            <motion.button
+            <button
                 onClick={() => setSignInModalOpen(true)}
                 className={styles.signInButton}
-                whileHover={{ scale: 1.05 }}
-                transition={{ type: "spring", stiffness: 700, damping: 30 }}
-            >ولوج</motion.button>
-            <Suspense fallback={null}>
-                <SignInModal />
-            </Suspense>
+            >
+                تسجيل الدخول
+            </button>
+            <SignInModal />
         </>
     );
 };
 
-export default UserProfile;
-
-
+export default UserProfile;
\ No newline at end of file
diff --git a/components/VanguardReviews/VanguardReviews.module.css b/components/VanguardReviews/VanguardReviews.module.css
index 39b59c6..cc95ffa 100644
--- a/components/VanguardReviews/VanguardReviews.module.css
+++ b/components/VanguardReviews/VanguardReviews.module.css
@@ -11,13 +11,8 @@
     --center-width: 400px;
     --side-width: 280px;
     background-color: var(--bg-secondary);
-    width: 100vw;
-    position: relative;
-    left: 50%;
-    right: 50%;
-    margin-left: -50vw;
-    margin-right: -50vw;
-    overflow-x: clip;
+    width: 100%;
+    overflow-x: clip; /* THE DEFINITIVE FIX */
 }
 
 .spotlightGlow {
@@ -35,7 +30,6 @@
 .cardSlot {
     position: absolute;
     transition: transform 0.7s cubic-bezier(0.22, 1, 0.36, 1), opacity 0.5s ease-out, left 0.7s cubic-bezier(0.22, 1, 0.36, 1);
-    /* --- DEFINITIVE FIX: Set base size here --- */
     width: var(--center-width);
     height: 500px;
 }
@@ -61,14 +55,15 @@
     overflow: visible;
     height: 100%;
     border: 1px solid var(--border-color);
-    box-shadow: 0 20px 40px -15px rgba(0,0,0,0.5);
+    box-shadow: 0 15px 30px -10px rgba(0,0,0,0.3);
     color: #fff;
     position: relative;
-    transition: border-color 0.3s ease-out;
+    transition: border-color 0.3s ease-out, box-shadow 0.3s ease-out;
 }
 
 .cardSlot:hover .vanguardCard {
     border-color: var(--accent);
+    box-shadow: 0 0 30px -8px color-mix(in srgb, var(--accent) 60%, transparent);
 }
 
 .cardImageContainer {
diff --git a/components/VanguardReviews/VanguardReviews.tsx b/components/VanguardReviews/VanguardReviews.tsx
index 9630aa6..bf3780f 100644
--- a/components/VanguardReviews/VanguardReviews.tsx
+++ b/components/VanguardReviews/VanguardReviews.tsx
@@ -25,20 +25,12 @@ const creatorBubbleItemVariants = {
 const ArrowIcon = () => <svg width="20" height="20" viewBox="0 0 24" fill="none" stroke="currentColor" strokeWidth="2.5"><line x1="22" y1="12" x2="2" y2="12"></line><polyline points="15 5 22 12 15 19"></polyline></svg>;
 
 const CreatorBubble = ({ label, creator }: { label: string, creator: SanityAuthor }) => {
-    // This onClick handler is now only for stopping propagation if absolutely necessary,
-    // but the structural fix makes it primarily a safety measure.
-    const handleBubbleClick = (e: React.MouseEvent) => {
-        e.stopPropagation();
-    };
-    
+    const handleBubbleClick = (e: React.MouseEvent) => { e.stopPropagation(); };
     const profileSlug = creator.username || (creator.slug as any)?.current || creator.name?.toLowerCase().replace(/\s+/g, '-');
     const hasPublicProfile = !!profileSlug;
     
     const bubbleContent = (
-        <motion.div 
-            className={styles.creatorBubble} 
-            whileHover={{ scale: 1.1, x: -10, transition: { type: 'spring', stiffness: 400, damping: 15 } }}
-        >
+        <motion.div className={styles.creatorBubble} whileHover={{ scale: 1.1, x: -10, transition: { type: 'spring', stiffness: 400, damping: 15 } }}>
             <span className={styles.creatorLabel}>{label}</span>
             <span className={styles.creatorName}>{creator.name}</span>
             <div className={styles.creatorArrow}><ArrowIcon /></div>
@@ -48,11 +40,7 @@ const CreatorBubble = ({ label, creator }: { label: string, creator: SanityAutho
     return (
         <motion.div variants={creatorBubbleItemVariants}>
             {hasPublicProfile ? (
-                <Link
-                    href={`/creators/${profileSlug}`}
-                    onClick={handleBubbleClick}
-                    className="no-underline"
-                >
+                <Link href={`/creators/${profileSlug}`} onClick={handleBubbleClick} className="no-underline">
                     {bubbleContent}
                 </Link>
             ) : (
@@ -64,7 +52,7 @@ const CreatorBubble = ({ label, creator }: { label: string, creator: SanityAutho
     );
 };
 
-const VanguardCard = memo(({ review, isCenter, isInView, isPriority, isMobile, isHovered }: { review: CardProps, isCenter: boolean, isInView: boolean, isPriority: boolean, isMobile: boolean, isHovered: boolean }) => {
+const VanguardCard = memo(({ review, isCenter, isInView, isPriority, isMobile, isHovered, isInteractive }: { review: CardProps, isCenter: boolean, isInView: boolean, isPriority: boolean, isMobile: boolean, isHovered: boolean, isInteractive: boolean }) => {
     const { livingCardRef, livingCardAnimation } = useLivingCard();
     const router = useRouter(); const setPrefix = useLayoutIdStore((state) => state.setPrefix);
     const layoutIdPrefix = "vanguard-reviews";
@@ -78,23 +66,62 @@ const VanguardCard = memo(({ review, isCenter, isInView, isPriority, isMobile, i
             return () => controls.stop();
         }
     }, [isInView, review.score]);
-    const handleClick = (e: React.MouseEvent) => { e.preventDefault(); setPrefix(layoutIdPrefix); router.push(`/reviews/${review.slug}`, { scroll: false }); };
+
+    const linkPath = `/reviews/${review.slug}`;
+    const handleClick = (e: React.MouseEvent<HTMLAnchorElement>) => {
+        if (e.ctrlKey || e.metaKey) return; // Allow opening in new tab
+        if ((e.target as HTMLElement).closest('a[href^="/creators"]')) return;
+        e.preventDefault();
+        setPrefix(layoutIdPrefix);
+        router.push(linkPath, { scroll: false });
+    };
     
     const imageUrl = review.mainImageRef 
         ? urlFor(review.mainImageRef).width(isCenter ? 800 : 560).height(isCenter ? 1000 : 700).fit('crop').auto('format').url()
         : review.imageUrl;
 
     const showCredits = isCenter || isHovered;
+    
+    // Conditionally apply hover handlers only when interactive
+    const livingCardHandlers = isInteractive ? {
+        onMouseMove: livingCardAnimation.onMouseMove,
+        onMouseEnter: livingCardAnimation.onHoverStart,
+        onMouseLeave: livingCardAnimation.onHoverEnd,
+    } : {};
 
-    // THE DEFINITIVE FIX:
-    // The CreatorBubbleContainer is moved OUTSIDE the main <Link> component.
-    // They are now siblings, which produces valid HTML and fixes the unclickable link issue.
     return (
-        <motion.div ref={livingCardRef} onMouseMove={livingCardAnimation.onMouseMove} onMouseEnter={livingCardAnimation.onHoverStart} onMouseLeave={livingCardAnimation.onHoverEnd} className={styles.cardWrapper} style={{...livingCardAnimation.style, transformStyle: 'preserve-3d'}}>
-            <Link href={`/reviews/${review.slug}`} onClick={handleClick} className="no-underline" style={{ display: 'block', height: '100%', cursor: 'pointer' }}>
-                <div className={styles.vanguardCard}>
+        <div className={styles.cardWrapper}>
+            <a 
+                href={linkPath}
+                onClick={handleClick}
+                className="no-underline"
+                style={{ display: 'block', height: '100%', cursor: 'pointer' }}
+            >
+                <motion.div
+                    ref={livingCardRef}
+                    {...livingCardHandlers}
+                    style={{ ...livingCardAnimation.style, transformStyle: 'preserve-3d', height: '100%' }}
+                    layoutId={`${layoutIdPrefix}-card-container-${review.legacyId}`} 
+                    className={styles.vanguardCard}
+                >
+                    <AnimatePresence>
+                        {showCredits && (
+                            <motion.div
+                                className={styles.creatorBubbleContainer}
+                                variants={creatorBubbleContainerVariants}
+                                initial="hidden"
+                                animate="visible"
+                                exit="hidden"
+                                style={{ pointerEvents: 'auto', transform: 'translateZ(50px)' }}
+                            >
+                                {review.authors.map(author => <CreatorBubble key={author._id} label="بقلم" creator={author} />)}
+                                {review.designers?.map(designer => <CreatorBubble key={designer._id} label="تصميم" creator={designer} />)}
+                            </motion.div>
+                        )}
+                    </AnimatePresence>
+
                     {typeof review.score === 'number' && (<div className={styles.vanguardScoreBadge}><p ref={scoreRef} style={{ margin: 0 }}>0.0</p></div>)}
-                    <div className={styles.cardImageContainer}>
+                    <motion.div layoutId={`${layoutIdPrefix}-card-image-${review.legacyId}`} className={styles.cardImageContainer}>
                         <Image 
                             src={imageUrl} 
                             alt={review.title} 
@@ -105,29 +132,14 @@ const VanguardCard = memo(({ review, isCenter, isInView, isPriority, isMobile, i
                             blurDataURL={review.blurDataURL} 
                             priority={isPriority}
                         />
-                    </div>
+                    </motion.div>
                     <motion.div className={styles.cardContent} animate={{ background: isCenter ? 'linear-gradient(to top, rgba(0,0,0,0.6) 0%, transparent 50%)' : 'linear-gradient(to top, rgba(0,0,0,0.9) 0%, transparent 60%)' }} transition={{ duration: 0.5, ease: 'circOut' }}>
-                        <h3>{review.title}</h3>
+                        <motion.h3 layoutId={`${layoutIdPrefix}-card-title-${review.legacyId}`}>{review.title}</motion.h3>
                         {review.date && <p className={styles.cardDate}>{review.date.split(' - ')[0]}</p>}
                     </motion.div>
-                </div>
-            </Link>
-            <AnimatePresence>
-                {showCredits && (
-                    <motion.div
-                        className={styles.creatorBubbleContainer}
-                        variants={creatorBubbleContainerVariants}
-                        initial="hidden"
-                        animate="visible"
-                        exit="hidden"
-                        style={{ pointerEvents: 'auto' }}
-                    >
-                        {review.authors.map(author => <CreatorBubble key={author._id} label="بقلم" creator={author} />)}
-                        {review.designers?.map(designer => <CreatorBubble key={designer._id} label="تصميم" creator={designer} />)}
-                    </motion.div>
-                )}
-            </AnimatePresence>
-        </motion.div>
+                </motion.div>
+            </a>
+        </div>
     );
 });
 VanguardCard.displayName = "VanguardCard";
@@ -165,6 +177,7 @@ export default function VanguardReviews({ reviews }: { reviews: CardProps[] }) {
     const containerRef = useRef(null);
     const hasAnimatedIn = useInView(containerRef, { once: true, amount: 0.1 });
     const isCurrentlyInView = useInView(containerRef, { amount: 0.4 });
+    const [initialAnimHasRun, setInitialAnimHasRun] = useState(false);
 
     const {
         currentIndex,
@@ -175,6 +188,13 @@ export default function VanguardReviews({ reviews }: { reviews: CardProps[] }) {
         isMobile
     } = useVanguardCarousel(reviews.length, isCurrentlyInView);
 
+    useEffect(() => {
+        if (hasAnimatedIn && !initialAnimHasRun) {
+            const timer = setTimeout(() => setInitialAnimHasRun(true), 800); // Animation is 0.7s, add a buffer
+            return () => clearTimeout(timer);
+        }
+    }, [hasAnimatedIn, initialAnimHasRun]);
+
     const handleDragEnd = (event: MouseEvent | TouchEvent | PointerEvent, info: PanInfo) => {
         const swipeThreshold = 50;
         if (info.offset.x < -swipeThreshold) {
@@ -186,6 +206,15 @@ export default function VanguardReviews({ reviews }: { reviews: CardProps[] }) {
 
     if (reviews.length === 0) return null;
 
+    const centerCardState = getCardState(currentIndex, reviews[currentIndex].id);
+    const centerStyle = centerCardState.style;
+    const initialAnimationConfig = {
+        ...centerStyle,
+        opacity: 0,
+        transform: centerStyle.transform ? centerStyle.transform.replace(/scale\([0-9.]+\)/, 'scale(0.8)') : 'scale(0.8)',
+    };
+
+
     return (
         <div 
             ref={containerRef} 
@@ -202,17 +231,22 @@ export default function VanguardReviews({ reviews }: { reviews: CardProps[] }) {
                 onDragEnd={handleDragEnd}
             >
                 {reviews.map((review, reviewIndex) => {
-                    const { style, isCenter, isVisible } = getCardState(reviewIndex, review.id);
+                    const { style, isCenter } = getCardState(reviewIndex, review.id);
                     const isHovered = hoveredId === review.id;
                     
                     return (
                         <motion.div 
                             key={review.id} 
                             className={styles.cardSlot} 
-                            onMouseEnter={() => setHoveredId(review.id)} 
-                            onMouseLeave={() => setHoveredId(null)}
+                            onMouseEnter={() => initialAnimHasRun && setHoveredId(review.id)} 
+                            onMouseLeave={() => initialAnimHasRun && setHoveredId(null)}
+                            initial={!initialAnimHasRun ? initialAnimationConfig : false}
                             animate={style}
-                            transition={{ ease: [0.4, 0, 0.2, 1], duration: 0.5 }}
+                            transition={{
+                                ease: [0.4, 0, 0.2, 1],
+                                duration: 0.7,
+                                delay: !initialAnimHasRun ? (isCenter ? 0 : 0.2) : 0,
+                            }}
                         >
                             <VanguardCard 
                                 review={review} 
@@ -221,6 +255,7 @@ export default function VanguardReviews({ reviews }: { reviews: CardProps[] }) {
                                 isPriority={isCenter}
                                 isMobile={isMobile}
                                 isHovered={isHovered}
+                                isInteractive={initialAnimHasRun}
                             />
                         </motion.div>
                     );
@@ -230,6 +265,4 @@ export default function VanguardReviews({ reviews }: { reviews: CardProps[] }) {
             {hasAnimatedIn && <KineticNavigator reviews={reviews} currentIndex={currentIndex} navigateToIndex={navigateToIndex} />}
         </div>
     );
-}
-
-
+}
\ No newline at end of file
diff --git a/components/comments/CommentItem.tsx b/components/comments/CommentItem.tsx
index e7da5be..1d76554 100644
--- a/components/comments/CommentItem.tsx
+++ b/components/comments/CommentItem.tsx
@@ -13,9 +13,9 @@ import TimeStamp from './TimeStamp';
 import ActionButton from '../ActionButton';
 import styles from './Comments.module.css';
 
-const ReplyIcon = () => ( <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"> <polyline points="9 14 4 9 9 4"></polyline><path d="M20 20v-7a4 4 0 0 0-4-4H4"></path> </svg> );
-const EditIcon = () => <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></svg>;
-const DeleteIcon = () => <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg>;
+const ReplyIcon = () => ( <svg width="20" height="20" viewBox="0 0 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"> <polyline points="9 14 4 9 9 4"></polyline><path d="M20 20v-7a4 4 0 0 0-4-4H4"></path> </svg> );
+const EditIcon = () => <svg width="16" height="16" viewBox="0 0 24" fill="none" stroke="currentColor" strokeWidth="2.5"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></svg>;
+const DeleteIcon = () => <svg width="16" height="16" viewBox="0 0 24" fill="none" stroke="currentColor" strokeWidth="2.5"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg>;
 const animationVariants = { initial: { opacity: 0, y: -10 }, animate: { opacity: 1, y: 0 }, exit: { opacity: 0, y: 10 } };
 
 export default function CommentItem({ comment, session, slug, onVoteUpdate, onPostReply, onDeleteSuccess, onUpdateSuccess }: {
@@ -60,7 +60,7 @@ export default function CommentItem({ comment, session, slug, onVoteUpdate, onPo
         });
     };
     
-    const DeletedState = () => ( <div className={`${styles.commentItem} ${styles.deleted}`}> <div className={styles.commentAuthorInfo}> <div className={styles.deletedAvatar} /> <div> <p className={`${styles.commentAuthorLink} ${styles.deleted}`}>حُذِفَ التعليق</p> <TimeStamp date={comment.createdAt} /> </div> </div> </div> );
+    const DeletedState = () => ( <div className={`${styles.commentItem} ${styles.deleted}`}> <div className={styles.commentAuthorInfo}> <div className={styles.deletedAvatar} /> <div> <p className={`${styles.commentAuthorLink} ${styles.deleted}`}>طُمِسَ التعليق</p> <TimeStamp date={comment.createdAt} /> </div> </div> </div> );
 
     if (comment.isDeleted) { return ( <> <DeletedState /> {replyCount > 0 && ( <div className={styles.commentRepliesList}> {(replies || []).map((reply: any) => ( <CommentItem key={reply.id} comment={reply} session={session} slug={slug} onVoteUpdate={onVoteUpdate} onPostReply={onPostReply} onDeleteSuccess={onDeleteSuccess} onUpdateSuccess={onUpdateSuccess} /> ))} </div> )} </> ); }
 
@@ -85,14 +85,12 @@ export default function CommentItem({ comment, session, slug, onVoteUpdate, onPo
     {!comment.isOptimistic && (
         <>
             <CommentVoteButtons commentId={comment.id} initialVotes={comment.votes} onVoteUpdate={onVoteUpdate} /> 
-            {replyCount > 0 && (<button onClick={handleToggleReplies} className={`outline-button ${styles.viewRepliesButton}`} disabled={isLoadingReplies}>{isLoadingReplies ? 'جار التحميل...' : areRepliesVisible ? 'إخفاء الردود' : `عرض ${replyCount} ${replyCount > 1 ? 'ردود' : 'رد'}`}</button>)} 
+            {replyCount > 0 && (<button onClick={handleToggleReplies} className={`outline-button ${styles.viewRepliesButton}`} disabled={isLoadingReplies}>{isLoadingReplies ? 'جارٍ التحميل...' : areRepliesVisible ? 'إخفاء الردود' : `عرض ${replyCount} ${replyCount > 1 ? 'ردود' : 'رد'}`}</button>)} 
             {isAuthor && ( <div className={styles.commentAuthorActions}>
                 <ActionButton onClick={() => setIsEditing(true)} aria-label="Edit" disabled={isPending}><EditIcon /></ActionButton>
                 <ActionButton onClick={() => setShowDeleteModal(true)} aria-label="Delete" disabled={isPending}><DeleteIcon /></ActionButton>
             </div> )}
         </>
     )}
-    </div> </motion.div> ) : ( <motion.div key="edit" variants={animationVariants} initial="initial" animate="animate" exit="exit" className={styles.commentEditForm}> <textarea defaultValue={comment.content} onChange={(e) => setEditText(e.target.value)} className="profile-input" disabled={isPending} autoFocus /> <div className={styles.commentEditActions}> <button onClick={handleUpdate} className="primary-button" disabled={isPending || editText.trim() === ''}>حفظ</button> <button onClick={() => setIsEditing(false)} className="outline-button" disabled={isPending}>إلغاء</button> </div> </motion.div> )} </AnimatePresence> <AnimatePresence> {isReplying && ( <motion.div className={styles.commentReplyFormContainer} variants={animationVariants} initial="initial" animate="animate" exit="exit"> <CommentForm slug={slug} session={session} parentId={comment.id} onPostComment={onPostReply} onReplySuccess={() => setIsReplying(false)} /> </motion.div> )} </AnimatePresence> {areRepliesVisible && ( <div className={styles.commentRepliesList}> {isLoadingReplies && <div className="spinner" />} {!isLoadingReplies && (replies).map((reply: any) => ( <CommentItem key={reply.id} comment={reply} session={session} slug={slug} onVoteUpdate={onVoteUpdate} onPostReply={onPostReply} onDeleteSuccess={onDeleteSuccess} onUpdateSuccess={onUpdateSuccess} /> ))} </div> )} </motion.div> <ConfirmationModal isOpen={showDeleteModal} onClose={() => setShowDeleteModal(false)} onConfirm={handleDeleteConfirm} title="حذف التعليق" message="هل أنت متيقن؟" /> </> );
-}
-
-
+    </div> </motion.div> ) : ( <motion.div key="edit" variants={animationVariants} initial="initial" animate="animate" exit="exit" className={styles.commentEditForm}> <textarea defaultValue={comment.content} onChange={(e) => setEditText(e.target.value)} className="profile-input" disabled={isPending} autoFocus /> <div className={styles.commentEditActions}> <button onClick={handleUpdate} className="primary-button" disabled={isPending || editText.trim() === ''}>حفظ</button> <button onClick={() => setIsEditing(false)} className="outline-button" disabled={isPending}>إلغاء</button> </div> </motion.div> )} </AnimatePresence> <AnimatePresence> {isReplying && ( <motion.div className={styles.commentReplyFormContainer} variants={animationVariants} initial="initial" animate="animate" exit="exit"> <CommentForm slug={slug} session={session} parentId={comment.id} onPostComment={onPostReply} onReplySuccess={() => setIsReplying(false)} /> </motion.div> )} </AnimatePresence> {areRepliesVisible && ( <div className={styles.commentRepliesList}> {isLoadingReplies && <div className="spinner" />} {!isLoadingReplies && (replies).map((reply: any) => ( <CommentItem key={reply.id} comment={reply} session={session} slug={slug} onVoteUpdate={onVoteUpdate} onPostReply={onPostReply} onDeleteSuccess={onDeleteSuccess} onUpdateSuccess={onUpdateSuccess} /> ))} </div> )} </motion.div> <ConfirmationModal isOpen={showDeleteModal} onClose={() => setShowDeleteModal(false)} onConfirm={handleDeleteConfirm} title="حذف التعليق" message="أمتأكدٌ من الحذف؟" /> </> );
+}
\ No newline at end of file
diff --git a/components/comments/CommentList.tsx b/components/comments/CommentList.tsx
index 5553c1e..5f0d0fe 100644
--- a/components/comments/CommentList.tsx
+++ b/components/comments/CommentList.tsx
@@ -32,9 +32,4 @@ export default function CommentList({ comments, session, slug, onVoteUpdate, onP
             ))}
         </div>
     )
-}
-
-
-
-
-
+}
\ No newline at end of file
diff --git a/components/comments/CommentSection.tsx b/components/comments/CommentSection.tsx
index fedc09d..9864533 100644
--- a/components/comments/CommentSection.tsx
+++ b/components/comments/CommentSection.tsx
@@ -1,7 +1,7 @@
 // components/comments/CommentSection.tsx
 'use client';
 
-import { useState, useOptimistic } from 'react';
+import { useState, useOptimistic, useEffect } from 'react';
 import { useSession } from 'next-auth/react';
 import type { Session } from 'next-auth';
 import { postReplyOrComment } from '@/app/actions/commentActions';
@@ -23,15 +23,34 @@ const addReplyToState = (comments: any[], parentId: string, reply: any): any[] =
     });
 };
 
-export default function CommentSection({ slug, initialComments }: {
-    slug: string;
-    initialComments: any[];
-}) {
+export default function CommentSection({ slug }: { slug: string; }) {
     const { data: session } = useSession();
-    // THE DEFINITIVE FIX: Cast the session object via `unknown` to the augmented type.
     const typedSession = session as unknown as Session | null;
 
-    const [comments, setComments] = useState(initialComments);
+    // MODIFIED: State now manages comments, loading, and errors.
+    const [comments, setComments] = useState<any[]>([]);
+    const [isLoading, setIsLoading] = useState(true);
+    const [error, setError] = useState<string | null>(null);
+
+    // MODIFIED: Fetch comments on the client side.
+    useEffect(() => {
+        const fetchComments = async () => {
+            setIsLoading(true);
+            setError(null);
+            try {
+                const response = await fetch(`/api/comments/${slug}`);
+                if (!response.ok) throw new Error('Failed to fetch comments');
+                const data = await response.json();
+                setComments(data);
+            } catch (err) {
+                setError('Could not load comments.');
+                console.error(err);
+            } finally {
+                setIsLoading(false);
+            }
+        };
+        fetchComments();
+    }, [slug]);
 
     const [optimisticComments, addOptimisticComment] = useOptimistic(
         comments,
@@ -44,7 +63,6 @@ export default function CommentSection({ slug, initialComments }: {
     );
 
     const handlePostComment = async (content: string, parentId?: string) => {
-        // Use the correctly typed session object
         if (!typedSession?.user?.id) return;
 
         const optimisticComment = {
@@ -53,7 +71,7 @@ export default function CommentSection({ slug, initialComments }: {
             parentId,
             createdAt: new Date().toISOString(),
             author: typedSession.user,
-            authorId: typedSession.user.id, // This is now type-safe
+            authorId: typedSession.user.id,
             votes: [],
             replies: [],
             _count: { replies: 0 },
@@ -133,19 +151,21 @@ export default function CommentSection({ slug, initialComments }: {
                 <SignInPrompt />
             )}
             
-            <div> 
-                <CommentList
-                    comments={optimisticComments}
-                    session={typedSession}
-                    slug={slug}
-                    onVoteUpdate={handleVoteUpdate}
-                    onPostReply={handlePostComment}
-                    onDeleteSuccess={handleDeleteSuccess}
-                    onUpdateSuccess={handleUpdateSuccess}
-                />
+            <div>
+                {isLoading && <div className="spinner" style={{ margin: '4rem auto' }} />}
+                {error && <p style={{ textAlign: 'center', color: 'var(--text-secondary)' }}>{error}</p>}
+                {!isLoading && !error && (
+                    <CommentList
+                        comments={optimisticComments}
+                        session={typedSession}
+                        slug={slug}
+                        onVoteUpdate={handleVoteUpdate}
+                        onPostReply={handlePostComment}
+                        onDeleteSuccess={handleDeleteSuccess}
+                        onUpdateSuccess={handleUpdateSuccess}
+                    />
+                )}
             </div>
         </div>
     );
-}
-
-
+}
\ No newline at end of file
diff --git a/components/comments/SignInPrompt.tsx b/components/comments/SignInPrompt.tsx
index 1d1144a..175cd75 100644
--- a/components/comments/SignInPrompt.tsx
+++ b/components/comments/SignInPrompt.tsx
@@ -11,13 +11,13 @@ export default function SignInPrompt() {
     return (
         <div className={styles.signInPrompt}>
             <h3>شارك في النقاش</h3>
-            <p>لترك بصمتك في النقاش، قم بتسجيل الدخول.</p>
+            <p>لتترك تعليقًا، سجِّل دخولك.</p>
             <motion.button
                 onClick={() => setSignInModalOpen(true)}
                 className={styles.signInButton} // <-- UPDATED CLASS
                 whileHover={{ scale: 1.05 }}
                 transition={{ type: "spring", stiffness: 400, damping: 15 }}
-            >ولوج</motion.button>
+            >تسجيل الدخول</motion.button>
         </div>
     );
 }
diff --git a/components/comments/TimeStamp.tsx b/components/comments/TimeStamp.tsx
index 2f507c2..e888908 100644
--- a/components/comments/TimeStamp.tsx
+++ b/components/comments/TimeStamp.tsx
@@ -6,11 +6,11 @@ useEffect(() => {
 const updateDisplayTime = () => {
 const seconds = Math.floor((new Date().getTime() - new Date(date).getTime()) / 1000);
 if (seconds < 5) { setDisplayTime("للتو"); return; }
-if (seconds < 60) { setDisplayTime(`منذ ${Math.floor(seconds)} ث`); return; }
+if (seconds < 60) { setDisplayTime(`منذ ${Math.floor(seconds)} ثوانٍ`); return; }
 const minutes = seconds / 60;
-if (minutes < 60) { setDisplayTime(`منذ ${Math.floor(minutes)} د`); return; }
+if (minutes < 60) { setDisplayTime(`منذ ${Math.floor(minutes)} دقائق`); return; }
 const hours = minutes / 60;
-if (hours < 24) { setDisplayTime(`منذ ${Math.floor(hours)} س`); return; }
+if (hours < 24) { setDisplayTime(`منذ ${Math.floor(hours)} ساعات`); return; }
 setDisplayTime(new Date(date).toLocaleDateString(undefined, { month: 'short', day: 'numeric' }));
 };
 updateDisplayTime();
diff --git a/components/constellation/ConstellationControlPanel.tsx b/components/constellation/ConstellationControlPanel.tsx
index 6efac60..417641e 100644
--- a/components/constellation/ConstellationControlPanel.tsx
+++ b/components/constellation/ConstellationControlPanel.tsx
@@ -5,7 +5,7 @@ import { motion } from 'framer-motion';
 import { useTheme } from 'next-themes';
 import styles from './ConstellationControlPanel.module.css';
 
-export type Preset = 'أداء' | 'متوازن' | 'فائق';
+export type Preset = 'أداء' | 'مُتَّزِن' | 'فائق';
 export type ConstellationSettings = {
     activePreset: Preset | 'custom';
     starCountMultiplier: number;
@@ -55,7 +55,7 @@ export default function ConstellationControlPanel({ settings, setSettings, onClo
                 <motion.div className={styles.section} variants={itemVariants}>
                     <label className={styles.label}>إعدادات الجودة</label>
                     <div className={styles.presetButtons}>
-                        {(['أداء', 'متوازن', 'فائق'] as Preset[]).map(p => (
+                        {(['أداء', 'مُتَّزِن', 'فائق'] as Preset[]).map(p => (
                             <motion.button key={p} className={`${styles.presetButton} ${settings.activePreset === p ? styles.active : ''}`} onClick={() => onPresetChange(p)} whileTap={{ scale: 0.95 }}>
                                 {p}
                             </motion.button>
@@ -71,7 +71,7 @@ export default function ConstellationControlPanel({ settings, setSettings, onClo
                 </motion.div>
 
                 <motion.div className={styles.section} variants={itemVariants} style={{ opacity: isLightMode ? 0.5 : 1 }}>
-                    <label className={styles.label} htmlFor="bloom-intensity">Bloom Intensity {isLightMode && "(Disabled)"}</label>
+                    <label className={styles.label} htmlFor="bloom-intensity">كثافة التوهج {isLightMode && "(معطل)"}</label>
                     <input id="bloom-intensity" type="range" min="0" max="2.5" step="0.1" value={settings.bloomIntensity} onChange={(e) => handleValueChange('bloomIntensity', parseFloat(e.target.value))} disabled={isLightMode} className={styles.rangeInput} />
                 </motion.div>
 
@@ -83,7 +83,7 @@ export default function ConstellationControlPanel({ settings, setSettings, onClo
                 </motion.div>
 
                 <motion.div className={styles.section} variants={itemVariants}>
-                    <label className={styles.label}>إظهار المدارات دائمًا</label>
+                    <label className={styles.label}>إظهار المدارات دومًا</label>
                     <button className={`${styles.toggle} ${settings.alwaysShowOrbits ? styles.active : ''}`} onClick={() => handleValueChange('alwaysShowOrbits', !settings.alwaysShowOrbits)}>
                         <motion.div className={styles.toggleHandle} layout transition={{ type: 'spring', stiffness: 500, damping: 25 }} />
                     </button>
diff --git a/components/constellation/StarPreviewCard.tsx b/components/constellation/StarPreviewCard.tsx
index db03ba1..a68acee 100644
--- a/components/constellation/StarPreviewCard.tsx
+++ b/components/constellation/StarPreviewCard.tsx
@@ -3,14 +3,15 @@
 import React from 'react';
 import { motion } from 'framer-motion';
 import Image from 'next/image';
-import Link from 'next/link';
+import { useRouter } from 'next/navigation';
+import { useLayoutIdStore } from '@/lib/layoutIdStore';
 import { urlFor } from '@/sanity/lib/image';
 import { SanityContentObject, StarData, ScreenPosition } from './config';
 
 interface StarPreviewCardProps {
-starData: StarData;
-position: ScreenPosition;
-onClose: () => void;
+    starData: StarData;
+    position: ScreenPosition;
+    onClose: () => void;
 }
 
 const typeMap: Record<'review' | 'article' | 'news', string> = {
@@ -20,77 +21,86 @@ const typeMap: Record<'review' | 'article' | 'news', string> = {
 }
 
 export const StarPreviewCard = ({ starData, position, onClose }: StarPreviewCardProps) => {
+    const router = useRouter();
+    const setPrefix = useLayoutIdStore((state) => state.setPrefix);
+    const layoutIdPrefix = "constellation-preview";
+    
     const { content } = starData;
     const getLinkPath = (item: SanityContentObject) => {
         switch (item._type) {
-        case 'review': return `/reviews/${item.slug}`;
-        case 'article': return `/articles/${item.slug}`;
-        case 'news': return `/news/${item.slug}`;
-        default: return '/';
+            case 'review': return `/reviews/${item.slug}`;
+            case 'article': return `/articles/${item.slug}`;
+            case 'news': return `/news/${item.slug}`;
+            default: return '/';
         }
     };
     
     const imageUrl = content.mainImage?.asset ? urlFor(content.mainImage).width(600).height(338).fit('crop').auto('format').url() : null;
     const blurDataURL = content.mainImage?.blurDataURL;
     const contentType = typeMap[content._type] || 'محتوى';
+    const linkPath = getLinkPath(content);
     const formattedDate = content.publishedAt 
         ? new Date(content.publishedAt).toLocaleDateString('ar-EG', { year: 'numeric', month: 'short', day: 'numeric' })
         : '';
 
+    const handleClick = (e: React.MouseEvent) => {
+        e.stopPropagation();
+        setPrefix(layoutIdPrefix);
+        router.push(linkPath, { scroll: false });
+        onClose();
+    };
+
     return (
         <motion.div
-        onClick={(e) => e.stopPropagation()}
-        initial={{ opacity: 0, scale: 0.9 }} animate={{ opacity: 1, scale: 1 }} exit={{ opacity: 0, scale: 0.9 }}
-        transition={{ type: 'spring', damping: 25, stiffness: 300 }}
-        style={{
-        position: 'fixed', top: position.top, left: position.left,
-        width: '300px',
-        background: 'var(--bg-secondary)', border: '1px solid var(--border-color)', borderRadius: '12px',
-        boxShadow: '0 10px 30px rgba(0,0,0,0.3)', overflow: 'hidden', zIndex: 10001,
-        transform: position.placement === 'below'
-        ? 'translate(-50%, 20px)'
-        : 'translate(-50%, calc(-100% - 20px))',
-        transformOrigin: position.placement === 'below' ? 'top center' : 'bottom center',
-        }}
-        >
-        <motion.button
-        onClick={onClose} whileHover={{ scale: 1.2, rotate: 90 }} whileTap={{ scale: 0.9 }}
-        style={{
-        position: 'absolute', top: '10px', right: '10px', zIndex: 2, width: '32px', height: '32px',
-        borderRadius: '50%', border: 'none', background: 'rgba(0,0,0,0.3)', color: 'white',
-        display: 'flex', alignItems: 'center', justifyContent: 'center', cursor: 'pointer', backdropFilter: 'blur(4px)'
-        }} aria-label="إغلاق المعاينة"
+            layoutId={`${layoutIdPrefix}-card-container-${content.legacyId}`}
+            onClick={handleClick}
+            initial={{ opacity: 0, scale: 0.9 }} animate={{ opacity: 1, scale: 1 }} exit={{ opacity: 0, scale: 0.9 }}
+            transition={{ type: 'spring', damping: 25, stiffness: 300 }}
+            style={{
+                position: 'fixed', top: position.top, left: position.left,
+                width: '300px',
+                background: 'var(--bg-secondary)', border: '1px solid var(--border-color)', borderRadius: '12px',
+                boxShadow: '0 10px 30px rgba(0,0,0,0.3)', overflow: 'hidden', zIndex: 10001,
+                transform: position.placement === 'below'
+                ? 'translate(-50%, 20px)'
+                : 'translate(-50%, calc(-100% - 20px))',
+                transformOrigin: position.placement === 'below' ? 'top center' : 'bottom center',
+                cursor: 'pointer',
+            }}
         >
-        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3" strokeLinecap="round" strokeLinejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
-        </motion.button>
+            <motion.button
+                onClick={(e) => { e.stopPropagation(); onClose(); }} 
+                whileHover={{ scale: 1.2, rotate: 90 }} whileTap={{ scale: 0.9 }}
+                style={{
+                    position: 'absolute', top: '10px', right: '10px', zIndex: 2, width: '32px', height: '32px',
+                    borderRadius: '50%', border: 'none', background: 'rgba(0,0,0,0.3)', color: 'white',
+                    display: 'flex', alignItems: 'center', justifyContent: 'center', cursor: 'pointer', backdropFilter: 'blur(4px)'
+                }} aria-label="إغلاق"
+            >
+                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3" strokeLinecap="round" strokeLinejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
+            </motion.button>
 
-        <div style={{ position: 'relative', width: '100%', height: '150px' }}>
-            {imageUrl ? ( 
-                <Image 
-                    src={imageUrl} 
-                    alt={content.title} 
-                    fill 
-                    sizes="300px"
-                    style={{ objectFit: 'cover' }} 
-                    placeholder={blurDataURL ? 'blur' : 'empty'}
-                    blurDataURL={blurDataURL || ''}
-                /> 
-            ) : ( <div style={{ width: '100%', height: '100%', backgroundColor: 'var(--border-color)' }} /> )}
-        </div>
+            <motion.div layoutId={`${layoutIdPrefix}-card-image-${content.legacyId}`} style={{ position: 'relative', width: '100%', height: '150px' }}>
+                {imageUrl ? ( 
+                    <Image 
+                        src={imageUrl} alt={content.title} fill sizes="300px"
+                        style={{ objectFit: 'cover' }} 
+                        placeholder={blurDataURL ? 'blur' : 'empty'}
+                        blurDataURL={blurDataURL || ''}
+                    /> 
+                ) : ( <div style={{ width: '100%', height: '100%', backgroundColor: 'var(--border-color)' }} /> )}
+            </motion.div>
 
-        <div style={{ padding: '1.5rem', textAlign: 'right' }}>
-            <div style={{display: 'flex', justifyContent: 'space-between', alignItems: 'baseline', marginBottom: '0.5rem'}}>
-                <p style={{ textTransform: 'capitalize', color: 'var(--accent)', fontFamily: 'var(--font-main)', fontSize: '1.3rem', margin: 0 }}>{contentType}</p>
-                {formattedDate && <p style={{color: 'var(--text-secondary)', fontSize: '1.2rem', margin: 0}}>{formattedDate}</p>}
+            <div style={{ padding: '1.5rem', textAlign: 'right' }}>
+                <div style={{display: 'flex', justifyContent: 'space-between', alignItems: 'baseline', marginBottom: '0.5rem'}}>
+                    <p style={{ textTransform: 'capitalize', color: 'var(--accent)', fontFamily: 'var(--font-main)', fontSize: '1.3rem', margin: 0 }}>{contentType}</p>
+                    {formattedDate && <p style={{color: 'var(--text-secondary)', fontSize: '1.2rem', margin: 0}}>{formattedDate}</p>}
+                </div>
+                <motion.h3 layoutId={`${layoutIdPrefix}-card-title-${content.legacyId}`} style={{ margin: '0 0 1.5rem 0', fontSize: '1.7rem' }}>{content.title}</motion.h3>
+                <div className="primary-button no-underline" style={{ display: 'block', textAlign: 'center', pointerEvents: 'none' }}>
+                    عرض كامل الـ{contentType}
+                </div>
             </div>
-            <h3 style={{ margin: '0 0 1.5rem 0', fontSize: '1.7rem' }}>{content.title}</h3>
-            <Link href={getLinkPath(content)} onClick={onClose} className="primary-button no-underline" style={{ display: 'block', textAlign: 'center' }}>
-                عرض كامل الـ{contentType}
-            </Link>
-        </div>
-
         </motion.div>
     );
-};
-
-
+};
\ No newline at end of file
diff --git a/components/constellation/index.tsx b/components/constellation/index.tsx
index 946a63a..bf206e0 100644
--- a/components/constellation/index.tsx
+++ b/components/constellation/index.tsx
@@ -74,12 +74,12 @@ export default function Constellation() {
 
     const PRESETS: Record<Preset, ConstellationSettings> = useMemo(() => ({
         'أداء': { activePreset: 'أداء', starCountMultiplier: 0.2, bloomIntensity: 0, alwaysShowOrbits: false, flawlessPathThickness: 1.5 },
-        'متوازن': { activePreset: 'متوازن', starCountMultiplier: 1.0, bloomIntensity: 0.9, alwaysShowOrbits: false, flawlessPathThickness: 2 },
+        'مُتَّزِن': { activePreset: 'مُتَّزِن', starCountMultiplier: 1.0, bloomIntensity: 0.9, alwaysShowOrbits: false, flawlessPathThickness: 2 },
         'فائق': { activePreset: 'فائق', starCountMultiplier: 1.5, bloomIntensity: 1.5, alwaysShowOrbits: false, flawlessPathThickness: 2.5 },
     }), []);
 
-    const [settings, setSettings] = useState<ConstellationSettings>(PRESETS['متوازن']);
-    const userIntentBloom = useRef(PRESETS['متوازن'].bloomIntensity);
+    const [settings, setSettings] = useState<ConstellationSettings>(PRESETS['مُتَّزِن']);
+    const userIntentBloom = useRef(PRESETS['مُتَّزِن'].bloomIntensity);
 
     useEffect(() => {
         if (resolvedTheme === 'light') {
diff --git a/components/content/ContentPageClient.tsx b/components/content/ContentPageClient.tsx
index 35f0e6a..d2bfbdb 100644
--- a/components/content/ContentPageClient.tsx
+++ b/components/content/ContentPageClient.tsx
@@ -1,7 +1,7 @@
 // components/content/ContentPageClient.tsx
 'use client';
 
-import { useEffect, useState, useRef } from 'react';
+import { useEffect, useState, useRef, useCallback } from 'react';
 import Image from 'next/image';
 import { motion } from 'framer-motion';
 import { useLayoutIdStore } from '@/lib/layoutIdStore';
@@ -18,16 +18,17 @@ import ContentActionBar from '@/components/ContentActionBar';
 import TagLinks from '@/components/TagLinks';
 import ReadingHud from '@/components/ReadingHud';
 import { ContentBlock } from '@/components/ContentBlock';
-import CreatorCredit from '@/components/CreatorCredit';
 import { SparklesIcon } from '@/components/icons/index';
+import CreatorCredit from '@/components/CreatorCredit';
 import styles from './ContentPage.module.css';
 import { CardProps } from '@/types';
+import { translateTag } from '@/lib/translations';
 
 type ContentItem = (SanityReview | SanityArticle | SanityNews) & { relatedContent?: any[] };
 type ContentType = 'reviews' | 'articles' | 'news';
 
 export type Heading = { id: string; title: string; top: number; };
-const contentVariants = { hidden: { opacity: 0 }, visible: { opacity: 1, transition: { delay: 0.3, duration: 0.5 } } };
+const contentVariants = { hidden: { opacity: 0 }, visible: { opacity: 1, transition: { delay: 0.4, duration: 0.5 } } };
 const adaptReviewForScoreBox = (review: any) => ({ score: review.score, verdict: review.verdict, pros: review.pros, cons: review.cons });
 
 export default function ContentPageClient({ item, type, children }: {
@@ -35,47 +36,104 @@ export default function ContentPageClient({ item, type, children }: {
     type: ContentType;
     children: React.ReactNode;
 }) {
-    const defaultPrefix = type === 'reviews' ? 'reviews' : `${type}-grid`;
-    const layoutIdPrefix = useLayoutIdStore((state) => state.prefix) || defaultPrefix;
+    // THE DEFINITIVE FIX (PART 1):
+    // The component now exclusively uses the prefix from the store.
+    // There is no fallback or default prefix, ensuring animations only trigger
+    // when explicitly initiated by a source component click.
+    const { prefix: layoutIdPrefix, setPrefix } = useLayoutIdStore();
+
     const [headings, setHeadings] = useState<Heading[]>([]);
     const [isMobile, setIsMobile] = useState(false);
-    const contentContainerRef = useRef<HTMLDivElement>(null);
-
+    
+    const articleBodyRef = useRef<HTMLDivElement>(null); 
+    const scrollTrackerRef = useRef<HTMLDivElement>(null); 
+    const [isLayoutStable, setIsLayoutStable] = useState(false); 
+    
     const isReview = type === 'reviews';
     const isNews = type === 'news';
     
+    const measureHeadings = useCallback(() => {
+        const contentElement = articleBodyRef.current;
+        const trackerElement = scrollTrackerRef.current;
+        if (!contentElement || !trackerElement) return;
+
+        const navbarOffset = 90;
+        const documentScrollTop = document.documentElement.scrollTop || document.body.scrollTop;
+        const seenIds = new Set<string>();
+        
+        let newHeadings: Heading[] = [];
+
+        const headingElements = Array.from(contentElement.querySelectorAll('h2'));
+        headingElements.forEach((h, index) => {
+            let id = h.id;
+            if (!id || seenIds.has(id)) { 
+                id = `${h.textContent?.trim().slice(0, 20).replace(/\s+/g, '-') || 'heading'}-${index}`;
+            }
+            seenIds.add(id);
+            h.id = id;
+            
+            const topPosition = h.getBoundingClientRect().top + documentScrollTop;
+            const scrollToPosition = topPosition - navbarOffset;
+            
+            newHeadings.push({ id: id, title: h.textContent || '', top: Math.max(0, scrollToPosition) });
+        });
+
+        if (isReview) {
+             const scoreBoxElement = contentElement.querySelector('.score-box-container');
+             if (scoreBoxElement) {
+                 const topPosition = scoreBoxElement.getBoundingClientRect().top + documentScrollTop;
+                 const scoreBoxScrollPosition = topPosition - navbarOffset;
+                 
+                 newHeadings.push({ 
+                     id: 'verdict-summary', 
+                     title: 'الخلاصة', 
+                     top: Math.max(0, scoreBoxScrollPosition) 
+                 });
+             }
+        }
+        
+        if (newHeadings.length > 0) {
+            setHeadings(newHeadings);
+        }
+
+    }, [isReview]);
+
+    useEffect(() => {
+        // THE DEFINITIVE FIX (PART 2):
+        // This effect runs when the component unmounts. It resets the prefix in the
+        // global store to 'default', ensuring no stale prefix is carried over to
+        // subsequent, unrelated navigations.
+        return () => {
+            setPrefix('default');
+        };
+    }, [setPrefix]);
+
     useEffect(() => {
-        const checkMobile = () => setIsMobile(window.innerWidth <= 768);
+        const checkMobile = () => setIsMobile(window.innerWidth <= 1024);
         checkMobile();
-        window.addEventListener('resize', checkMobile);
-        return () => window.removeEventListener('resize', checkMobile);
-    }, []);
+        const handleResize = () => {
+            checkMobile();
+            if (isLayoutStable) measureHeadings();
+        }
+        window.addEventListener('resize', handleResize);
+        return () => window.removeEventListener('resize', handleResize);
+    }, [isLayoutStable, measureHeadings]);
 
     useEffect(() => { window.scrollTo(0, 0); }, []);
 
     useEffect(() => {
-        const contentElement = contentContainerRef.current; if (!contentElement) return;
-        const measureHeadings = () => {
-            const containerRect = contentElement.getBoundingClientRect();
-            const headingElements = Array.from(contentElement.querySelectorAll('h2'));
-            const navbarOffset = 90;
-            const seenIds = new Set<string>();
-            const newHeadings = headingElements.map((h, index) => {
-                let id = h.id;
-                if (seenIds.has(id)) { id = `${id}-${index}`; }
-                seenIds.add(id);
-                h.id = id;
-                const headingRect = h.getBoundingClientRect();
-                const relativeTop = (headingRect.top - containerRect.top);
-                return { id: id, title: h.textContent || '', top: Math.max(0, relativeTop - navbarOffset) };
-            });
-            setHeadings(newHeadings);
-        };
-        const imagePromises = Array.from(contentElement.querySelectorAll('img')).filter(img => !img.complete).map(img => new Promise(resolve => { img.onload = resolve; img.onerror = resolve; }));
-        Promise.all(imagePromises).then(measureHeadings);
-        if (imagePromises.length === 0) measureHeadings();
+        const timeout = setTimeout(() => setIsLayoutStable(true), 1500); 
+        return () => clearTimeout(timeout);
     }, [item]);
 
+    useEffect(() => {
+        if (isLayoutStable) {
+            requestAnimationFrame(() => {
+                measureHeadings();
+            });
+        }
+    }, [isLayoutStable, measureHeadings]); 
+
     if (!item) return null;
 
     const relatedContent = (item as any).relatedReviews || (item as any).relatedArticles || (item as any).relatedNews || [];
@@ -99,11 +157,22 @@ export default function ContentPageClient({ item, type, children }: {
     const isLongGameTitle = (item as any).game?.title?.length > GAME_TITLE_THRESHOLD;
     const shouldShiftLayout = isMobile && isLongGameTitle;
 
+    const springTransition = { type: 'spring' as const, stiffness: 200, damping: 35 };
+
     return (
         <>
-            <motion.div initial="hidden" animate="visible" variants={contentVariants}><ReadingHud contentContainerRef={contentContainerRef} headings={headings} /></motion.div>
-            <motion.div initial={{ opacity: 0 }} animate={{ opacity: 1 }} transition={{ duration: 0.5 }}>
-                <motion.div layoutId={`${layoutIdPrefix}-card-image-${item.legacyId}`} className={styles.heroImage}>
+            <ReadingHud 
+                contentContainerRef={scrollTrackerRef}
+                headings={headings} 
+                isMobile={isMobile} 
+            />
+
+            <motion.div
+                layoutId={`${layoutIdPrefix}-card-container-${item.legacyId}`}
+                transition={springTransition}
+                style={{ backgroundColor: 'var(--bg-primary)' }}
+            >
+                <motion.div layoutId={`${layoutIdPrefix}-card-image-${item.legacyId}`} className={styles.heroImage} transition={springTransition}>
                     <Image 
                         loader={sanityLoader} 
                         src={heroImageUrl} 
@@ -117,51 +186,60 @@ export default function ContentPageClient({ item, type, children }: {
                     />
                 </motion.div>
 
-                <motion.div initial="hidden" animate="visible" variants={contentVariants} className="container page-container" style={{ paddingTop: '0' }}>
-                    <div className={styles.contentLayout}>
-                        <main>
-                            <div className={`${styles.headerContainer} ${shouldShiftLayout ? styles.shiftedLayout : ''}`}>
-                                {(item as any).game?.title && <GameLink gameName={(item as any).game.title} gameSlug={(item as any).game.slug} />}
-                                <div className={styles.titleWrapper}>
-                                    {isNews && <p className="news-card-category" style={{ textAlign: 'right', margin: '0' }}>{(item as SanityNews).category}</p>}
-                                    <motion.h1 layoutId={`${layoutIdPrefix}-card-title-${item.legacyId}`} className="page-title" style={{ textAlign: 'right', margin: isNews ? '0.5rem 0 0 0' : 0 }}>{item.title}</motion.h1>
+                <div className="container page-container" style={{ paddingTop: '0' }}>
+                    <motion.div initial="hidden" animate="visible" variants={contentVariants} >
+                        <div className={styles.contentLayout}>
+                            <main ref={scrollTrackerRef}>
+                                <div className={`${styles.headerContainer} ${shouldShiftLayout ? styles.shiftedLayout : ''}`}>
+                                    {(item as any).game?.title && <GameLink gameName={(item as any).game.title} gameSlug={(item as any).game.slug} />}
+                                    <div className={styles.titleWrapper}>
+                                        {isNews && <p className="news-card-category" style={{ textAlign: 'right', margin: '0' }}>{translateTag((item as any).category?.title)}</p>}
+                                        <motion.h1 layoutId={`${layoutIdPrefix}-card-title-${item.legacyId}`} className="page-title" style={{ textAlign: 'right', margin: isNews ? '0.5rem 0 0 0' : 0 }} transition={springTransition}>{item.title}</motion.h1>
+                                    </div>
                                 </div>
-                            </div>
 
-                            <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start', marginBottom: '3rem' }}>
-                                <div style={{ display: 'flex', flexDirection: 'column', alignItems: 'flex-start', gap: '1rem', fontSize: '1.5rem' }}>
-                                    <CreatorCredit label="بقلم" creators={primaryCreators} />
-                                    <CreatorCredit label="تصميم" creators={item.designers} />
-                                    <p style={{ margin: 0, fontSize: '1.4rem', color: 'var(--text-secondary)' }}>نُشر في {formattedDate}</p>
+                                <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start', marginBottom: '3rem' }}>
+                                    <div style={{ display: 'flex', flexDirection: 'column', alignItems: 'flex-start', gap: '1rem', fontSize: '1.5rem' }}>
+                                        <CreatorCredit label="بقلم" creators={primaryCreators} />
+                                        <CreatorCredit label="تصميم" creators={item.designers} />
+                                        <p style={{ margin: 0, fontSize: '1.4rem', color: 'var(--text-secondary)' }}>نُشر في {formattedDate}</p>
+                                    </div>
+                                    <ContentActionBar contentId={item.legacyId} contentType={contentTypeForActionBar} contentSlug={item.slug} />
                                 </div>
-                                <ContentActionBar contentId={item.legacyId} contentType={contentTypeForActionBar} contentSlug={item.slug} />
-                            </div>
-
-                            <div ref={contentContainerRef} className="article-body">
-                                <PortableTextComponent content={item.content || []} />
-                                {isReview && <ScoreBox review={adaptReviewForScoreBox(item)} />}
-                            </div>
-                            <div style={{ marginTop: '4rem', paddingTop: '2rem', borderTop: '1px solid var(--border-color)' }}>
-                                <TagLinks tags={(item.tags || []).map(t => t.title)} />
-                            </div>
-                        </main>
-                        <aside className={styles.sidebar}>
-                            <ContentBlock title="قد يروق لك" Icon={SparklesIcon}>
-                                <div className={styles.relatedGrid}>
-                                    {adaptedRelatedContent.map(related => (
-                                        <ArticleCard key={related?.id} article={related} layoutIdPrefix={`related-${type}`} />
-                                    ))}
+
+                                <div ref={articleBodyRef} className="article-body">
+                                    <PortableTextComponent content={item.content || []} />
+                                    {isReview && <ScoreBox review={adaptReviewForScoreBox(item)} className="score-box-container" />}
                                 </div>
-                            </ContentBlock>
-                        </aside>
-                    </div>
-                </motion.div>
-                <div className="container" style={{ paddingBottom: '6rem' }}>
-                    <ContentBlock title="حديث المجتمع">{children}</ContentBlock>
+                                <div style={{ marginTop: '4rem', paddingTop: '2rem', borderTop: '1px solid var(--border-color)' }}>
+                                    <TagLinks tags={(item.tags || []).map(t => t.title)} />
+                                </div>
+                            </main>
+                            <aside className={styles.sidebar}>
+                                <ContentBlock title="قد يروق لك" Icon={SparklesIcon}>
+                                    <motion.div 
+                                        className={styles.relatedGrid}
+                                        variants={{ visible: { transition: { staggerChildren: 0.1 } } }}
+                                        initial="hidden"
+                                        animate="visible"
+                                        exit="hidden"
+                                    >
+                                        {adaptedRelatedContent.map(related => (
+                                            <motion.div key={related.id} variants={{ hidden: { opacity: 0, y: 20 }, visible: { opacity: 1, y: 0 } }}>
+                                                <ArticleCard article={related} layoutIdPrefix={`related-${type}`} />
+                                            </motion.div>
+                                        ))}
+                                    </motion.div>
+                                </ContentBlock>
+                            </aside>
+                        </div>
+                    </motion.div>
                 </div>
             </motion.div>
+            
+            <motion.div initial="hidden" animate="visible" variants={contentVariants} className="container" style={{ paddingBottom: '6rem' }}>
+                <ContentBlock title="حديث المجتمع">{children}</ContentBlock>
+            </motion.div>
         </>
     );
-}
-
-
+}
\ No newline at end of file
diff --git a/components/homepage/HomepageFeeds.tsx b/components/homepage/HomepageFeeds.tsx
index b17a6fa..81a391e 100644
--- a/components/homepage/HomepageFeeds.tsx
+++ b/components/homepage/HomepageFeeds.tsx
@@ -13,11 +13,12 @@ import { useLivingCard } from "@/hooks/useLivingCard";
 import { CardProps } from "@/types";
 import { ContentBlock } from "../ContentBlock";
 import { ArticleIcon, NewsIcon } from "@/components/icons/index";
-import PaginatedLatestArticles from "./PaginatedLatestArticles";
+import PaginatedLatestArticles from "../PaginatedCarousel";
 import KineticSpotlightNews from "./kinetic-news/KineticSpotlightNews";
 import NewsfeedStream from "./kinetic-news/NewsfeedStream";
 import gridStyles from './HomepageFeeds.module.css';
 import feedStyles from './feed/Feed.module.css';
+import { useLayoutIdStore } from "@/lib/layoutIdStore";
 
 // --- Specific Card Renderers ---
 
@@ -25,18 +26,49 @@ const TopArticleCard = memo(({ article }: { article: CardProps }) => {
     const { livingCardRef, livingCardAnimation } = useLivingCard();
     const [isHovered, setIsHovered] = useState(false);
     const router = useRouter();
-    const handleClick = (e: React.MouseEvent) => {
-        if ((e.target as HTMLElement).closest('a')) return;
-        router.push(`/articles/${article.slug}`);
+    const setPrefix = useLayoutIdStore((state) => state.setPrefix);
+    const layoutIdPrefix = "homepage-top-articles";
+    const linkPath = `/articles/${article.slug}`;
+
+    const handleClick = (e: React.MouseEvent<HTMLAnchorElement>) => {
+        if (e.ctrlKey || e.metaKey) return; // Allow new tab
+        if ((e.target as HTMLElement).closest('a[href^="/creators"]')) return;
+        e.preventDefault();
+        setPrefix(layoutIdPrefix);
+        router.push(linkPath, { scroll: false });
     };
+
     return (
-        <motion.div ref={livingCardRef} style={livingCardAnimation.style} onMouseMove={livingCardAnimation.onMouseMove} onMouseEnter={() => { livingCardAnimation.onHoverStart(); setIsHovered(true); }} onMouseLeave={() => { livingCardAnimation.onHoverEnd(); setIsHovered(false); }} onClick={handleClick} className={feedStyles.topArticleCard}>
-            <AnimatePresence>{isHovered && <KineticGlyphs />}</AnimatePresence>
-            <div className={feedStyles.topArticleImage}><Image src={article.imageUrl} alt={article.title} fill sizes="(max-width: 768px) 45vw, 30vw" placeholder="blur" blurDataURL={article.blurDataURL} style={{ objectFit: 'cover' }} /></div>
-            <div className={feedStyles.topArticleContent}>
-                <h3 className={feedStyles.topArticleTitle}>{article.title}</h3>
-                <div className={feedStyles.topArticleMeta}><CreatorCredit label="بقلم" creators={article.authors} small /></div>
-            </div>
+        <motion.div 
+            layout /* THE FIX: Added layout prop for height equalization */
+            ref={livingCardRef} 
+            style={{...livingCardAnimation.style, height: '100%'}} 
+            onMouseMove={livingCardAnimation.onMouseMove} 
+            onMouseEnter={() => { livingCardAnimation.onHoverStart(); setIsHovered(true); }} 
+            onMouseLeave={() => { livingCardAnimation.onHoverEnd(); setIsHovered(false); }} 
+        >
+            <a
+                href={linkPath}
+                onClick={handleClick}
+                className={`${feedStyles.topArticleCard} no-underline`}
+            >
+                {/* Glyphs are now siblings to the clipping container */}
+                <AnimatePresence>{isHovered && <KineticGlyphs />}</AnimatePresence>
+                
+                {/* New inner container for clipping */}
+                <motion.div 
+                    layoutId={`${layoutIdPrefix}-card-container-${article.legacyId}`} 
+                    className={feedStyles.topArticleCardInner}
+                >
+                    <motion.div layoutId={`${layoutIdPrefix}-card-image-${article.legacyId}`} className={feedStyles.topArticleImage}>
+                        <Image src={article.imageUrl} alt={article.title} fill sizes="(max-width: 768px) 45vw, 30vw" placeholder="blur" blurDataURL={article.blurDataURL} style={{ objectFit: 'cover' }} />
+                    </motion.div>
+                    <div className={feedStyles.topArticleContent}>
+                        <motion.h3 layoutId={`${layoutIdPrefix}-card-title-${article.legacyId}`} className={feedStyles.topArticleTitle}>{article.title}</motion.h3>
+                        <div className={feedStyles.topArticleMeta}><CreatorCredit label="بقلم" creators={article.authors} small /></div>
+                    </div>
+                </motion.div>
+            </a>
         </motion.div>
     );
 });
@@ -58,7 +90,7 @@ export default function HomepageFeeds({ topArticles, latestArticles, pinnedNews,
     return (
         <div className={gridStyles.feedsGrid} ref={containerRef}>
             <motion.div style={{ y: articlesY }}>
-                <ContentBlock title="ديوان الفن" Icon={ArticleIcon}>
+                <ContentBlock title="أحدث المقالات" Icon={ArticleIcon}>
                     <Feed
                         topSectionLabel="الأكثر رواجًا"
                         latestSectionLabel="الأحدث"
@@ -77,19 +109,17 @@ export default function HomepageFeeds({ topArticles, latestArticles, pinnedNews,
                     <Feed
                         topSectionLabel="الأكثر رواجًا"
                         latestSectionLabel="الأحدث"
-                        topItems={pinnedNews} // Pass empty array as items will be handled by topSectionContent
+                        topItems={pinnedNews}
                         viewAllLink="/news"
                         viewAllText="عرض كل الأخبار"
                         topItemsContainerClassName={feedStyles.pinnedNewsList}
-                        renderTopItem={() => null} // Render nothing here
-                        topSectionContent={<KineticSpotlightNews items={pinnedNews} />} // Pass the new component here
-                        latestSectionContent={<NewsfeedStream items={newsList} />} // Pass the new component here
+                        renderTopItem={() => null}
+                        topSectionContent={<KineticSpotlightNews items={pinnedNews} />}
+                        latestSectionContent={<NewsfeedStream items={newsList} />}
                         enableTopSectionHoverEffect={true}
                     />
                 </ContentBlock>
             </motion.div>
         </div>
     );
-}
-
-
+}
\ No newline at end of file
diff --git a/components/homepage/PaginatedLatestArticles.module.css b/components/homepage/PaginatedLatestArticles.module.css
index f822a8b..de8d044 100644
--- a/components/homepage/PaginatedLatestArticles.module.css
+++ b/components/homepage/PaginatedLatestArticles.module.css
@@ -7,7 +7,7 @@
 }
 
 .paginatedContent {
-    flex-grow: 1;
+    /* flex-grow: 1; <-- This property was pushing the controls to the bottom, it has been removed. */
     position: relative;
     min-height: 380px; /* Adjust based on item height to prevent layout shift */
 }
@@ -22,7 +22,8 @@
     justify-content: center;
     align-items: center;
     gap: 1rem;
-    padding-top: 1.5rem;
+    padding-top: 1rem; /* Reduced top padding to bring controls closer to content */
+    padding-bottom: 1.5rem; /* Added bottom padding for spacing from elements below */
 }
 
 .paginationDot {
@@ -44,6 +45,4 @@
     background-color: var(--accent);
     transform: scale(1.2);
     box-shadow: 0 0 8px color-mix(in srgb, var(--accent) 50%, transparent);
-}
-
-
+}
\ No newline at end of file
diff --git a/components/homepage/PaginatedLatestArticles.tsx b/components/homepage/PaginatedLatestArticles.tsx
index 3b9377f..37d7427 100644
--- a/components/homepage/PaginatedLatestArticles.tsx
+++ b/components/homepage/PaginatedLatestArticles.tsx
@@ -4,37 +4,48 @@
 import React, { useState, useEffect, useRef, memo } from 'react';
 import { motion, AnimatePresence } from 'framer-motion';
 import Image from 'next/image';
-import Link from 'next/link';
 import { CardProps } from '@/types';
 import CreatorCredit from '@/components/CreatorCredit';
 import { Calendar03Icon } from '@/components/icons/index';
 import styles from './PaginatedLatestArticles.module.css';
 import feedStyles from './feed/Feed.module.css';
+import { useRouter } from 'next/navigation';
+import { useLayoutIdStore } from '@/lib/layoutIdStore';
 
 const LatestArticleListItem = memo(({ article }: { article: CardProps }) => {
-    // This component is the source of the hydration error.
-    // The main container is now a <div> instead of a <Link>.
-    // The image and title are wrapped in their own separate <Link>s.
-    // This resolves the nested <a> tag issue caused by CreatorCredit rendering its own link.
+    const router = useRouter();
+    const setPrefix = useLayoutIdStore((state) => state.setPrefix);
+    const layoutIdPrefix = "homepage-latest-articles";
+    const linkPath = `/articles/${article.slug}`;
+
+    const handleClick = (e: React.MouseEvent<HTMLAnchorElement>) => {
+        if (e.ctrlKey || e.metaKey) return;
+        if ((e.target as HTMLElement).closest('a[href^="/creators"]')) return;
+        e.preventDefault();
+        setPrefix(layoutIdPrefix);
+        router.push(linkPath, { scroll: false });
+    };
+
     return (
-        <div className={feedStyles.latestArticleItem}>
-            <Link href={`/articles/${article.slug}`} className="no-underline" style={{ display: 'block' }}>
-                <div className={feedStyles.latestArticleThumbnail}>
-                    <Image 
-                        src={article.imageUrl} 
-                        alt={article.title} 
-                        fill 
-                        sizes="120px" 
-                        placeholder="blur" 
-                        blurDataURL={article.blurDataURL} 
-                        style={{ objectFit: 'cover' }} 
-                    />
-                </div>
-            </Link>
+        <motion.a
+            href={linkPath}
+            onClick={handleClick}
+            layoutId={`${layoutIdPrefix}-card-container-${article.legacyId}`} 
+            className={`${feedStyles.latestArticleItem} no-underline`}
+        >
+            <motion.div layoutId={`${layoutIdPrefix}-card-image-${article.legacyId}`} className={feedStyles.latestArticleThumbnail}>
+                <Image 
+                    src={article.imageUrl} 
+                    alt={article.title} 
+                    fill 
+                    sizes="120px" 
+                    placeholder="blur" 
+                    blurDataURL={article.blurDataURL} 
+                    style={{ objectFit: 'cover' }} 
+                />
+            </motion.div>
             <div className={feedStyles.latestArticleInfo}>
-                <Link href={`/articles/${article.slug}`} className="no-underline">
-                    <h4 className={feedStyles.latestArticleTitle}>{article.title}</h4>
-                </Link>
+                <motion.h4 layoutId={`${layoutIdPrefix}-card-title-${article.legacyId}`} className={feedStyles.latestArticleTitle}>{article.title}</motion.h4>
                 <div className={feedStyles.latestArticleMeta}>
                     <CreatorCredit label="بقلم" creators={article.authors} />
                     {article.date && (
@@ -45,7 +56,7 @@ const LatestArticleListItem = memo(({ article }: { article: CardProps }) => {
                     )}
                 </div>
             </div>
-        </div>
+        </motion.a>
     );
 });
 LatestArticleListItem.displayName = "LatestArticleListItem";
@@ -68,7 +79,7 @@ export default function PaginatedLatestArticles({ items, itemsPerPage = 3 }: Pag
         if (!isHovered && totalPages > 1) {
             timeoutRef.current = setTimeout(
                 () => setCurrentPage((prevPage) => (prevPage + 1) % totalPages),
-                5000
+                3500
             );
         }
         return () => resetTimeout();
@@ -106,19 +117,15 @@ export default function PaginatedLatestArticles({ items, itemsPerPage = 3 }: Pag
             {totalPages > 1 && (
                 <div className={styles.paginationControls}>
                     {Array.from({ length: totalPages }).map((_, index) => (
-                        <motion.button
+                        <button
                             key={index}
                             className={`${styles.paginationDot} ${currentPage === index ? styles.active : ''}`}
                             onClick={() => setCurrentPage(index)}
                             aria-label={`Go to page ${index + 1}`}
-                            whileHover={{ scale: 1.2 }}
-                            whileTap={{ scale: 0.9 }}
                         />
                     ))}
                 </div>
             )}
         </div>
     );
-}
-
-
+}
\ No newline at end of file
diff --git a/components/homepage/feed/Feed.module.css b/components/homepage/feed/Feed.module.css
index f0c998c..abe0570 100644
--- a/components/homepage/feed/Feed.module.css
+++ b/components/homepage/feed/Feed.module.css
@@ -74,9 +74,15 @@
 
 .viewAllLink {
     display: flex;
+    /* THE FIX: Set direction to RTL to ensure text is on the right */
+    direction: rtl; 
+    /* THE FIX: Reverse the display order of icon/text so the icon is on the left */
+    flex-direction: row-reverse;
+    /* THE FIX: Adjust gap for better spacing */
+    gap: 0.5rem; 
+    
     align-items: center;
     justify-content: center;
-    gap: 0.75rem;
     text-align: center;
     padding: 1.25rem;
     margin-top: auto;
@@ -87,6 +93,23 @@
     transition: background-color 0.2s ease, color 0.2s ease;
     position: relative;
     z-index: 2;
+    
+    /* THE FIX: Apply text style to the span */
+}
+
+.viewAllLink span {
+    font-size: 1.8rem; /* Set a specific size for the text to be prominent */
+}
+
+.viewAllLink svg {
+    /* Set icon size */
+    width: 2.2rem;
+    height: 2.2rem;
+    color: var(--accent); /* Ensure color from the start */
+    
+    /* The main arrow is now the correct way. We apply the transform only on hover/specific state */
+    transform: scaleX(-1); /* To make it point to the left/outside */
+    transition: transform 0.2s ease, color 0.2s ease;
 }
 
 .viewAllLink:hover {
@@ -94,11 +117,25 @@
     color: var(--accent);
 }
 
+.viewAllLink:hover svg {
+    /* On hover, move the arrow */
+    transform: translateX(4px) scaleX(-1); 
+    color: var(--accent);
+}
+
+.topItemsContainer {
+    display: block;
+    width: 100%;
+    order: 2; 
+    margin-top: 1.5rem;
+}
+
 /* --- Article Feed Specifics --- */
 .topArticlesGrid {
     display: grid;
     grid-template-columns: 1fr 1fr;
     gap: 2.5rem;
+    grid-auto-rows: 1fr; /* THE FIX: Ensure equal height */
 }
 
 .topArticleCard {
@@ -113,6 +150,7 @@
     will-change: transform;
     cursor: pointer;
     transform: translateZ(0px);
+    height: 100%; /* THE FIX: Ensure card fills its row's height */
 }
 
 .topArticleImage {
@@ -154,6 +192,14 @@
     color: var(--text-secondary);
 }
 
+/* New inner container for clipping to have height 100% for the effect */
+.topArticleCardInner {
+    height: 100%; /* THE FIX: Ensure inner motion.div fills all space */
+    display: flex;
+    flex-direction: column;
+}
+
+/* --- List Item Fix: Ensure list item is a block element for proper layout */
 .latestArticleItem {
     display: grid;
     grid-template-columns: 120px 1fr;
@@ -161,8 +207,13 @@
     align-items: center;
     position: relative;
     padding: 1.5rem 0;
+    border-radius: 8px; /* Added for hover effect */
+    cursor: pointer;
+    /* NEW: Use flex-grow for vertical space distribution */
+    flex-grow: 1; 
 }
 
+
 .latestArticleThumbnail {
     width: 120px;
     height: 75px;
@@ -171,10 +222,9 @@
     position: relative;
     border: 1px solid var(--border-color);
     transition: border-color 0.3s ease;
-    cursor: pointer;
 }
 
-.latestArticleItem a:hover .latestArticleThumbnail {
+.latestArticleItem:hover .latestArticleThumbnail {
     border-color: var(--accent);
 }
 
@@ -182,7 +232,7 @@
     transition: transform 0.3s ease-out;
 }
 
-.latestArticleItem a:hover .latestArticleThumbnail img {
+.latestArticleItem:hover .latestArticleThumbnail img {
     transform: scale(1.05);
 }
 
@@ -201,7 +251,7 @@
     display: inline-block; /* Required for the underline effect */
 }
 
-.latestArticleInfo a:hover .latestArticleTitle {
+.latestArticleItem:hover .latestArticleTitle {
     color: var(--accent);
 }
 
@@ -219,7 +269,7 @@
     filter: drop-shadow(0 0 4px var(--accent));
 }
 
-.latestArticleInfo a:hover .latestArticleTitle::after {
+.latestArticleItem:hover .latestArticleTitle::after {
     transform: scaleX(1);
 }
 
@@ -261,6 +311,7 @@
     margin: -0.5rem;
     border-radius: 8px;
     transition: background-color 0.2s ease;
+    min-height: 80px; /* NEW: Enforce consistent height */
 }
 
 .pinnedNewsItem:hover {
@@ -299,6 +350,12 @@
     color: var(--text-primary);
     margin: 0;
     transition: color 0.2s ease;
+    /* NEW: Handle text overflow for consistency */
+    display: -webkit-box;
+    -webkit-line-clamp: 2;
+    -webkit-box-orient: vertical;  
+    overflow: hidden;
+    text-overflow: ellipsis;
 }
 
 .pinnedNewsItem:hover .pinnedNewsTitle {
@@ -336,6 +393,7 @@
     border-radius: 8px;
     margin: 0 -1rem;
     transition: background-color 0.2s ease;
+    cursor: pointer;
 }
 
 .newsListItem:hover {
@@ -395,6 +453,4 @@
         padding-left: 1.5rem; /* THE FIX: Reduce horizontal padding */
         padding-right: 1.5rem; /* THE FIX: Reduce horizontal padding */
     }
-}
-
-
+}
\ No newline at end of file
diff --git a/components/homepage/feed/Feed.tsx b/components/homepage/feed/Feed.tsx
index 9dd31b2..42220f6 100644
--- a/components/homepage/feed/Feed.tsx
+++ b/components/homepage/feed/Feed.tsx
@@ -7,7 +7,8 @@ import { CardProps } from '@/types';
 import KineticGlyphs from '@/components/effects/KineticGlyphs';
 import styles from './Feed.module.css';
 
-const ArrowIcon = () => <svg width="16" height="16" viewBox="0 0 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round" style={{ transform: 'scaleX(-1)' }}><polyline points="15 18 9 12 15 6"></polyline></svg>;
+// THE FIX: Simplified ArrowIcon - it now points right (in LTR terms)
+const ArrowIcon = () => <svg width="16" height="16" viewBox="0 0 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round"><polyline points="9 18 15 12 9 6"></polyline></svg>;
 
 interface FeedProps {
     topSectionLabel: string;
@@ -62,17 +63,21 @@ export default function Feed({
                 >
                     <AnimatePresence>{isTopSectionHovered && enableTopSectionHoverEffect && <KineticGlyphs />}</AnimatePresence>
                     <span className={styles.sectionLabel}>{topSectionLabel}</span>
-                    <div className={`${styles.topItemsContainer} ${topItemsContainerClassName}`} style={{ perspective: '800px' }}>
+                    <motion.div 
+                        layout /* THE FIX: Added layout prop here */
+                        className={`${styles.topItemsContainer} ${topItemsContainerClassName}`} 
+                        style={{ perspective: '800px' }}
+                    >
                         {topSectionContent ? (
                             <motion.div variants={kineticCardVariant}>{topSectionContent}</motion.div>
                         ) : (
                             topItems.map((item, index) => (
-                                <motion.div key={item.id} variants={kineticCardVariant}>
+                                <motion.div key={item.id} variants={kineticCardVariant} style={{ height: '100%' }}>
                                     {renderTopItem(item, index)}
                                 </motion.div>
                             ))
                         )}
-                    </div>
+                    </motion.div>
                 </div>
             )}
 
@@ -99,8 +104,9 @@ export default function Feed({
             
             <motion.div variants={kineticCardVariant}>
                 <Link href={viewAllLink} className={`${styles.viewAllLink} no-underline`}>
-                    <span>{viewAllText}</span>
+                    {/* THE FIX: Reordered the elements to put the icon first in LTR order (which translates to the left in RTL) */}
                     <ArrowIcon />
+                    <span>{viewAllText}</span>
                 </Link>
             </motion.div>
         </div>
diff --git a/components/homepage/kinetic-news/KineticSpotlightNews.module.css b/components/homepage/kinetic-news/KineticSpotlightNews.module.css
index 5586209..4920366 100644
--- a/components/homepage/kinetic-news/KineticSpotlightNews.module.css
+++ b/components/homepage/kinetic-news/KineticSpotlightNews.module.css
@@ -7,20 +7,21 @@
 
 .spotlightItem {
     position: relative;
-    overflow: hidden; /* Ensures highlight bar corners are clipped */
+    /* overflow: hidden; <-- This was preventing the highlight from showing, removed. */
 }
 
 .kineticHighlightBar {
     position: absolute;
-    top: 0;
-    bottom: 0;
+    top: 8;
+    bottom: 8;
     right: 0; /* Aligned to the right for RTL */
     left: auto;
-    width: 3px;
-    background-color: var(--accent);
-    box-shadow: 0 0 10px 1px var(--accent);
-    filter: blur(1px);
-    border-radius: 3px;
-}
-
-
+    width: 4px; /* INCREASED */
+    background: 
+        linear-gradient(
+            var(--accent), 
+            color-mix(in srgb, var(--accent) 60%, #00ffff)
+        ); /* ADDED GRADIENT */
+    box-shadow: 0 0 12px 8px var(--accent); /* INCREASED */
+    border-radius: 4px;
+}
\ No newline at end of file
diff --git a/components/homepage/kinetic-news/KineticSpotlightNews.tsx b/components/homepage/kinetic-news/KineticSpotlightNews.tsx
index 614d5fe..7c267d0 100644
--- a/components/homepage/kinetic-news/KineticSpotlightNews.tsx
+++ b/components/homepage/kinetic-news/KineticSpotlightNews.tsx
@@ -3,32 +3,44 @@
 
 import React, { useState, useEffect, memo } from 'react';
 import { motion, AnimatePresence } from 'framer-motion';
-import Link from 'next/link';
 import Image from 'next/image';
 import { CardProps } from '@/types';
 import { Calendar03Icon } from '@/components/icons/index';
 import { translateTag } from '@/lib/translations';
 import styles from './KineticSpotlightNews.module.css';
 import feedStyles from '../feed/Feed.module.css';
+import { useRouter } from 'next/navigation';
+import { useLayoutIdStore } from '@/lib/layoutIdStore';
 
 const PinnedNewsCard = memo(({ item, isActive }: { item: CardProps, isActive: boolean }) => {
     const primaryTag = item.tags && item.tags.length > 0 ? translateTag(item.tags[0].title) : 'أخبار';
+    const router = useRouter();
+    const setPrefix = useLayoutIdStore((state) => state.setPrefix);
+    const layoutIdPrefix = "homepage-pinned-news";
+    const linkPath = `/news/${item.slug}`;
+
+    const handleClick = (e: React.MouseEvent<HTMLAnchorElement>) => {
+        if (e.ctrlKey || e.metaKey) return; // Allow new tab
+        e.preventDefault();
+        setPrefix(layoutIdPrefix);
+        router.push(linkPath, { scroll: false });
+    };
 
     return (
-        <Link href={`/news/${item.slug}`} className={`${feedStyles.pinnedNewsItem} ${styles.spotlightItem} no-underline`}>
-            <AnimatePresence>
-                {isActive && (
-                    <motion.div
-                        className={styles.kineticHighlightBar}
-                        layoutId="kinetic-spotlight-highlight-bar"
-                        initial={{ opacity: 0 }}
-                        animate={{ opacity: 1 }}
-                        exit={{ opacity: 0 }}
-                        transition={{ type: 'spring', stiffness: 500, damping: 30 }}
-                    />
-                )}
-            </AnimatePresence>
-            <div className={feedStyles.pinnedNewsThumbnail}>
+        <motion.a
+            href={linkPath}
+            onClick={handleClick}
+            layoutId={`${layoutIdPrefix}-card-container-${item.legacyId}`}
+            className={`${feedStyles.pinnedNewsItem} ${styles.spotlightItem} no-underline`}
+        >
+            {isActive && (
+                <motion.div
+                    className={styles.kineticHighlightBar}
+                    layoutId="kinetic-spotlight-highlight-bar"
+                    transition={{ type: 'spring', stiffness: 400, damping: 35 }}
+                />
+            )}
+            <motion.div layoutId={`${layoutIdPrefix}-card-image-${item.legacyId}`} className={feedStyles.pinnedNewsThumbnail}>
                 <Image 
                     src={item.imageUrl} 
                     alt={item.title} 
@@ -38,9 +50,9 @@ const PinnedNewsCard = memo(({ item, isActive }: { item: CardProps, isActive: bo
                     blurDataURL={item.blurDataURL} 
                     style={{ objectFit: 'cover' }} 
                 />
-            </div>
+            </motion.div>
             <div className={feedStyles.pinnedNewsInfo}>
-                <h4 className={feedStyles.pinnedNewsTitle}>{item.title}</h4>
+                <motion.h4 layoutId={`${layoutIdPrefix}-card-title-${item.legacyId}`} className={feedStyles.pinnedNewsTitle}>{item.title}</motion.h4>
                 {item.date && (
                     <div className={feedStyles.pinnedNewsDate}>
                         <Calendar03Icon style={{width: '14px', height: '14px', color: 'var(--accent)'}} />
@@ -49,7 +61,7 @@ const PinnedNewsCard = memo(({ item, isActive }: { item: CardProps, isActive: bo
                 )}
                 <p className={feedStyles.pinnedNewsCategory}>{primaryTag}</p>
             </div>
-        </Link>
+        </motion.a>
     );
 });
 PinnedNewsCard.displayName = 'PinnedNewsCard';
diff --git a/components/homepage/kinetic-news/NewsfeedStream.tsx b/components/homepage/kinetic-news/NewsfeedStream.tsx
index 2b039f3..d586d67 100644
--- a/components/homepage/kinetic-news/NewsfeedStream.tsx
+++ b/components/homepage/kinetic-news/NewsfeedStream.tsx
@@ -3,41 +3,62 @@
 
 import React, { useState, useEffect, useRef, memo } from 'react';
 import { motion, AnimatePresence } from 'framer-motion';
-import Link from 'next/link';
-import Image from 'next/image';
 import { CardProps } from '@/types';
 import { Calendar03Icon } from '@/components/icons/index';
 import { translateTag } from '@/lib/translations';
 import styles from './NewsfeedStream.module.css';
 import feedStyles from '../feed/Feed.module.css';
+import { useRouter } from 'next/navigation';
+import { useLayoutIdStore } from '@/lib/layoutIdStore';
+import Image from 'next/image';
 
 const LatestNewsListItem = memo(({ item }: { item: CardProps }) => {
     const primaryTag = item.tags && item.tags.length > 0 ? translateTag(item.tags[0].title) : 'أخبار';
+    const router = useRouter();
+    const setPrefix = useLayoutIdStore((state) => state.setPrefix);
+    const layoutIdPrefix = "homepage-news-stream";
+    const linkPath = `/news/${item.slug}`;
+    
+    const handleClick = (e: React.MouseEvent<HTMLAnchorElement>) => {
+        if (e.ctrlKey || e.metaKey) return; // Allow new tab
+        e.preventDefault();
+        setPrefix(layoutIdPrefix);
+        router.push(linkPath, { scroll: false });
+    };
 
     return (
-        <Link href={`/news/${item.slug}`} className={`${feedStyles.newsListItem} no-underline`}>
-            <div className={feedStyles.newsListThumbnail}>
-                <Image 
-                    src={item.imageUrl} 
-                    alt={item.title} 
-                    fill 
-                    sizes="60px" 
-                    placeholder="blur" 
-                    blurDataURL={item.blurDataURL} 
-                    style={{ objectFit: 'cover' }} 
-                />
-            </div>
-            <div className={feedStyles.newsListInfo}>
-                <p className={feedStyles.newsListCategory}>{primaryTag}</p>
-                <h5 className={feedStyles.newsListTitle}>{item.title}</h5>
-                {item.date && (
-                    <div style={{ margin: '0.25rem 0 0', fontSize: '1.2rem', color: 'var(--text-secondary)', display: 'flex', alignItems: 'center', gap: '0.5rem' }}>
-                        <Calendar03Icon style={{width: '14px', height: '14px', color: 'var(--accent)'}} />
-                        <span>{item.date.split(' - ')[0]}</span>
-                    </div>
-                )}
-            </div>
-        </Link>
+        <a
+            href={linkPath}
+            onClick={handleClick}
+            className={`${feedStyles.newsListItem} no-underline`}
+        >
+            <motion.div 
+                layoutId={`${layoutIdPrefix}-card-container-${item.legacyId}`}
+                style={{ display: 'contents' }} /* This allows the grid layout to apply directly to children */
+            >
+                <motion.div layoutId={`${layoutIdPrefix}-card-image-${item.legacyId}`} className={feedStyles.newsListThumbnail}>
+                    <Image 
+                        src={item.imageUrl} 
+                        alt={item.title} 
+                        fill 
+                        sizes="60px" 
+                        placeholder="blur" 
+                        blurDataURL={item.blurDataURL} 
+                        style={{ objectFit: 'cover' }} 
+                    />
+                </motion.div>
+                <div className={feedStyles.newsListInfo}>
+                    <p className={feedStyles.newsListCategory}>{primaryTag}</p>
+                    <motion.h5 layoutId={`${layoutIdPrefix}-card-title-${item.legacyId}`} className={feedStyles.newsListTitle}>{item.title}</motion.h5>
+                    {item.date && (
+                        <div style={{ margin: '0.25rem 0 0', fontSize: '1.2rem', color: 'var(--text-secondary)', display: 'flex', alignItems: 'center', gap: '0.5rem' }}>
+                            <Calendar03Icon style={{width: '14px', height: '14px', color: 'var(--accent)'}} />
+                            <span>{item.date.split(' - ')[0]}</span>
+                        </div>
+                    )}
+                </div>
+            </motion.div>
+        </a>
     );
 });
 LatestNewsListItem.displayName = "LatestNewsListItem";
@@ -48,7 +69,7 @@ export default function NewsfeedStream({ items }: { items: CardProps[] }) {
     const intervalRef = useRef<NodeJS.Timeout | null>(null);
 
     useEffect(() => {
-        if (!isHovered && items.length > 5) { // Only cycle if there are enough items
+        if (!isHovered && items.length > 5) {
             intervalRef.current = setInterval(() => {
                 setListItems(prevItems => {
                     const newItems = [...prevItems];
@@ -74,7 +95,7 @@ export default function NewsfeedStream({ items }: { items: CardProps[] }) {
             onMouseLeave={() => setIsHovered(false)}
         >
             <AnimatePresence initial={false}>
-                {listItems.slice(0, 5).map((item, index) => ( // Display a fixed number of items
+                {listItems.slice(0, 5).map((item, index) => (
                     <motion.div
                         key={item.id}
                         layout
diff --git a/components/news/NewsGrid.module.css b/components/news/NewsGrid.module.css
new file mode 100644
index 0000000..305ef05
--- /dev/null
+++ b/components/news/NewsGrid.module.css
@@ -0,0 +1,15 @@
+/* components/news/NewsGrid.module.css */
+
+.newsGrid {
+    display: grid;
+    grid-template-columns: repeat(2, 1fr);
+    gap: 3rem;
+    grid-auto-rows: 1fr;
+}
+
+@media (max-width: 768px) {
+    .newsGrid {
+        grid-template-columns: 1fr;
+        gap: 2rem;
+    }
+}
\ No newline at end of file
diff --git a/components/news/NewsGrid.tsx b/components/news/NewsGrid.tsx
index 8ae17b8..49d10d6 100644
--- a/components/news/NewsGrid.tsx
+++ b/components/news/NewsGrid.tsx
@@ -5,58 +5,22 @@ import { motion, AnimatePresence } from 'framer-motion';
 import NewsGridCard from './NewsGridCard';
 import { CardProps } from '@/types';
 import React from 'react'; 
+import styles from './NewsGrid.module.css';
 
-const gridContainerVariants = {
-    visible: { transition: { staggerChildren: 0.05 } },
-};
-
-const kineticCardVariant = {
-    hidden: { 
-        opacity: 0, 
-        y: 60, 
-        rotateX: -20,
-        skewY: 5,
-        clipPath: "inset(100% 0% 0% 0%)"
-    },
-    visible: { 
-        opacity: 1, 
-        y: 0, 
-        rotateX: 0,
-        skewY: 0,
-        clipPath: "inset(0% 0% 0% 0%)",
-        transition: { 
-            duration: 0.8, 
-            ease: [0.22, 1, 0.36, 1] as const,
-            y: { type: 'spring', stiffness: 120, damping: 20 }
-        }
-    },
-    exit: { 
-        opacity: 0, 
-        scale: 0.8 
-    }
-};
-
-export default function NewsGrid({ news, isLoading }: { news: CardProps[], isLoading: boolean }) {
+export default function NewsGrid({ news }: { news: CardProps[] }) {
     return (
         <motion.div 
             layout 
-            className="content-grid" 
-            variants={gridContainerVariants} 
-            initial="hidden" 
-            animate="visible"
-            style={{ 
-                opacity: isLoading && news.length === 0 ? 0.5 : 1, 
-                transition: 'opacity 0.3s',
-                transformStyle: 'preserve-3d', 
-                perspective: '1200px'
-            }}
+            className={styles.newsGrid}
         >
             <AnimatePresence mode="popLayout">
                 {news.map((item, index) => (
                     <motion.div
-                        key={item.id}
+                        key={item.legacyId}
                         layout
-                        variants={kineticCardVariant}
+                        initial={{ opacity: 0 }}
+                        animate={{ opacity: 1 }}
+                        exit={{ opacity: 0, scale: 0.8 }}
                         transition={{ 
                             type: 'spring' as const, 
                             stiffness: 400, 
@@ -64,7 +28,11 @@ export default function NewsGrid({ news, isLoading }: { news: CardProps[], isLoa
                         }}
                         style={{ height: '100%', willChange: 'transform, opacity' }}
                     >
-                        <NewsGridCard item={item} isPriority={index < 3} />
+                        <NewsGridCard 
+                            item={item} 
+                            isPriority={index < 4}
+                            layoutIdPrefix="news-grid"
+                        />
                     </motion.div>
                 ))}
             </AnimatePresence>
diff --git a/components/news/NewsGridCard.module.css b/components/news/NewsGridCard.module.css
index 6a461d2..e843da2 100644
--- a/components/news/NewsGridCard.module.css
+++ b/components/news/NewsGridCard.module.css
@@ -61,6 +61,8 @@
 .cardInfo {
     text-align: right;
     transform: translateZ(20px);
+    /* NEW: Prevent child from overflowing */
+    overflow: hidden;
 }
 
 /* ENHANCEMENT: Styles for Tactile Tag Interaction */
@@ -100,8 +102,9 @@
     font-weight: 600;
     margin: 0;
     position: relative;
-    display: inline-block;
+    /* display: inline-block; <-- REMOVED: This was causing the overflow issue. */
     transition: color 0.2s ease;
+    overflow-wrap: break-word; /* ADDED: Ensures long strings without spaces can wrap. */
 }
 
 .cardTitle::after {
@@ -159,6 +162,4 @@
         padding: 0.75rem 1rem;
         font-size: 1.2rem;
     }
-}
-
-
+}
\ No newline at end of file
diff --git a/components/news/NewsGridCard.tsx b/components/news/NewsGridCard.tsx
index 13dbb55..d33bc19 100644
--- a/components/news/NewsGridCard.tsx
+++ b/components/news/NewsGridCard.tsx
@@ -2,7 +2,6 @@
 'use client';
 
 import React, { memo } from 'react';
-import Link from 'next/link';
 import Image from 'next/image';
 import { motion } from 'framer-motion';
 import { useRouter } from 'next/navigation';
@@ -13,13 +12,15 @@ import { sanityLoader } from '@/lib/sanity.loader';
 import { Calendar03Icon } from '@/components/icons';
 import styles from './NewsGridCard.module.css';
 import CreatorCredit from '../CreatorCredit';
+import { translateTag } from '@/lib/translations';
 
 type NewsGridCardProps = {
     item: CardProps;
     isPriority?: boolean;
+    layoutIdPrefix: string;
 };
 
-const NewsGridCardComponent = ({ item, isPriority = false }: NewsGridCardProps) => {
+const NewsGridCardComponent = ({ item, isPriority = false, layoutIdPrefix }: NewsGridCardProps) => {
     const router = useRouter();
     const setPrefix = useLayoutIdStore((state) => state.setPrefix); 
     const { livingCardRef, livingCardAnimation } = useLivingCard();
@@ -27,8 +28,11 @@ const NewsGridCardComponent = ({ item, isPriority = false }: NewsGridCardProps)
     const linkPath = `/news/${item.slug}`;
     
     const handleClick = (e: React.MouseEvent) => {
+        if ((e.target as HTMLElement).closest('a, button, [role="button"]')) {
+            return;
+        }
         e.preventDefault();
-        setPrefix('news-grid');
+        setPrefix(layoutIdPrefix);
         router.push(linkPath, { scroll: false });
     };
 
@@ -45,22 +49,23 @@ const NewsGridCardComponent = ({ item, isPriority = false }: NewsGridCardProps)
             onMouseMove={livingCardAnimation.onMouseMove}
             onMouseEnter={() => { livingCardAnimation.onHoverStart(); handleMouseEnter(); }}
             onMouseLeave={livingCardAnimation.onHoverEnd}
+            onClick={handleClick}
             className={styles.cardContainer}
             style={livingCardAnimation.style}
         >
             <motion.div
-                layoutId={`news-grid-card-container-${item.id}`}
+                layoutId={`${layoutIdPrefix}-card-container-${item.legacyId}`}
                 className={styles.newsCard}
                 initial={{ opacity: 0, y: 50, scale: 0.95 }}
                 animate={{ opacity: 1, y: 0, scale: 1 }}
                 exit={{ opacity: 0, scale: 0.95 }}
                 transition={{ type: 'spring', stiffness: 200, damping: 25 }}
             >
-                <Link href={linkPath} onClick={handleClick} className={`${styles.cardLink} no-underline`}>
+                <div className={`${styles.cardLink} no-underline`}>
                     <div className={styles.imageContentWrapper}>
                         <motion.div 
                             className={styles.imageContainer} 
-                            layoutId={`news-grid-card-image-${item.id}`}
+                            layoutId={`${layoutIdPrefix}-card-image-${item.legacyId}`}
                         >
                             <Image 
                                 loader={sanityLoader}
@@ -77,9 +82,12 @@ const NewsGridCardComponent = ({ item, isPriority = false }: NewsGridCardProps)
                             />
                         </motion.div>
                         <div className={styles.cardInfo}>
+                            {item.category && (
+                                <p className={styles.cardCategory}>{translateTag(item.category)}</p>
+                            )}
                             <motion.h3 
                                 className={styles.cardTitle}
-                                layoutId={`news-grid-card-title-${item.id}`}
+                                layoutId={`${layoutIdPrefix}-card-title-${item.legacyId}`}
                             >
                                 {item.title}
                             </motion.h3>
@@ -95,7 +103,7 @@ const NewsGridCardComponent = ({ item, isPriority = false }: NewsGridCardProps)
                             </div>
                         )}
                     </div>
-                </Link>
+                </div>
             </motion.div>
         </motion.div>
     );
diff --git a/components/news/NewsHero.module.css b/components/news/NewsHero.module.css
index 6cf9d95..8e1049c 100644
--- a/components/news/NewsHero.module.css
+++ b/components/news/NewsHero.module.css
@@ -10,6 +10,7 @@
     flex-direction: column;
     justify-content: flex-end;
     color: #fff;
+    padding-top: var(--nav-height-scrolled);
 }
 
 .heroBackground {
@@ -107,7 +108,13 @@
     border-radius: 50%;
     background-color: rgba(255, 255, 255, 0.4);
     cursor: pointer;
-    transition: background-color 0.2s ease, transform 0.2s ease;
+    transition: background-color 0.2s ease, transform 0.2s ease-out;
+    border: none;
+    padding: 0;
+}
+
+.progressDot:hover {
+    transform: scale(1.6);
 }
 
 .progressDot.active {
diff --git a/components/news/NewsHero.tsx b/components/news/NewsHero.tsx
index 8be22f5..9f4cd14 100644
--- a/components/news/NewsHero.tsx
+++ b/components/news/NewsHero.tsx
@@ -10,15 +10,13 @@ import styles from './NewsHero.module.css';
 import { Calendar03Icon } from '@/components/icons';
 import CreatorCredit from '@/components/CreatorCredit';
 import { translateTag } from '@/lib/translations';
+import { useLayoutIdStore } from '@/lib/layoutIdStore';
+import { useRouter } from 'next/navigation';
 
 const transition = { type: 'spring' as const, stiffness: 400, damping: 50 };
 
 const titleContainerVariants = {
-    animate: {
-        transition: {
-            staggerChildren: 0.08,
-        },
-    },
+    animate: { transition: { staggerChildren: 0.08 } },
 };
 
 const wordVariants = {
@@ -26,8 +24,16 @@ const wordVariants = {
     animate: { opacity: 1, y: 0, transition: { ...transition, duration: 0.8 } },
 };
 
-const AnimatedStory = memo(({ item, isActive }: { item: CardProps; isActive: boolean }) => {
+const AnimatedStory = memo(({ item, isActive, layoutIdPrefix }: { item: CardProps; isActive: boolean, layoutIdPrefix: string }) => {
     const primaryTag = item.tags && item.tags.length > 0 ? translateTag(item.tags[0].title) : 'أخبار';
+    const setPrefix = useLayoutIdStore((state) => state.setPrefix);
+    const router = useRouter();
+
+    const handleClick = (e: React.MouseEvent) => {
+        e.preventDefault();
+        setPrefix(layoutIdPrefix);
+        router.push(`/news/${item.slug}`, { scroll: false });
+    };
 
     return (
         <AnimatePresence>
@@ -39,13 +45,15 @@ const AnimatedStory = memo(({ item, isActive }: { item: CardProps; isActive: boo
                     animate={{ opacity: 1 }}
                     exit={{ opacity: 0 }}
                     transition={{ duration: 0.5 }}
+                    onClick={handleClick}
+                    style={{ cursor: 'pointer' }}
                 >
                     <div className={styles.textContent}>
                         <p className={styles.storyCategory}>{primaryTag}</p>
-                        <Link href={`/news/${item.slug}`} className={`${styles.storyLink} no-underline`}>
+                        <div className={`${styles.storyLink} no-underline`}>
                             <motion.h1 
                                 className={styles.storyTitle} 
-                                layoutId={`news-hero-title-${item.id}`}
+                                layoutId={`${layoutIdPrefix}-card-title-${item.legacyId}`}
                                 variants={titleContainerVariants}
                                 initial="initial"
                                 animate="animate"
@@ -56,7 +64,7 @@ const AnimatedStory = memo(({ item, isActive }: { item: CardProps; isActive: boo
                                     </motion.span>
                                 ))}
                             </motion.h1>
-                        </Link>
+                        </div>
                         <div className={styles.storyMeta}>
                             <CreatorCredit label="بواسطة" creators={item.authors} small disableLink />
                             <span className={styles.storyMetaDate}>
@@ -72,11 +80,12 @@ const AnimatedStory = memo(({ item, isActive }: { item: CardProps; isActive: boo
 AnimatedStory.displayName = "AnimatedStory";
 
 
-const HeroBackground = memo(({ imageUrl, alt }: { imageUrl: string; alt: string; }) => {
+const HeroBackground = memo(({ imageUrl, alt, layoutId }: { imageUrl: string; alt: string; layoutId: string }) => {
     return (
         <motion.div 
             key={imageUrl} 
             className={styles.heroBackground} 
+            layoutId={layoutId}
             initial={{ opacity: 0, scale: 1.1 }}
             animate={{ opacity: 1, scale: 1 }}
             exit={{ opacity: 0, scale: 1.1 }}
@@ -87,10 +96,7 @@ const HeroBackground = memo(({ imageUrl, alt }: { imageUrl: string; alt: string;
                 alt={alt}
                 fill
                 priority
-                style={{ 
-                    objectFit: 'cover', 
-                    filter: 'grayscale(10%) brightness(0.7)',
-                }}
+                style={{ objectFit: 'cover', filter: 'grayscale(10%) brightness(0.7)'}}
                 sizes="100vw"
             />
         </motion.div>
@@ -107,44 +113,43 @@ export default function NewsHero({ newsItems }: { newsItems: CardProps[] }) {
         if (isPaused || newsItems.length <= 1) return;
         const interval = setInterval(() => {
             setActiveIndex((prevIndex) => (prevIndex + 1) % newsItems.length);
-        }, 6000);
+        }, 4000);
         return () => clearInterval(interval);
     }, [isPaused, newsItems.length]);
     
     if (newsItems.length === 0) return null;
 
     const activeItem = newsItems[activeIndex];
+    const layoutIdPrefix = "news-hero";
 
     return (
-        <div 
+        <motion.div 
+            layoutId={`${layoutIdPrefix}-card-container-${activeItem.legacyId}`}
             className={styles.heroContainer}
             onMouseEnter={() => setIsPaused(true)}
             onMouseLeave={() => setIsPaused(false)}
         >
             <AnimatePresence>
-                 <HeroBackground key={activeItem.id} imageUrl={activeItem.imageUrl} alt={activeItem.title} />
+                 <HeroBackground key={activeItem.id} imageUrl={activeItem.imageUrl} alt={activeItem.title} layoutId={`${layoutIdPrefix}-card-image-${activeItem.legacyId}`} />
             </AnimatePresence>
             
             <div className={styles.heroOverlay} />
 
             <div className={`container ${styles.heroContentWrapper}`}>
                 <AnimatePresence mode="wait">
-                    <AnimatedStory key={activeItem.id} item={activeItem} isActive={true} />
+                    <AnimatedStory key={activeItem.id} item={activeItem} isActive={true} layoutIdPrefix={layoutIdPrefix} />
                 </AnimatePresence>
             </div>
 
             <div className={styles.controlsContainer}>
                 {newsItems.map((item, index) => (
-                    <motion.div
+                    <button
                         key={item.id}
                         className={`${styles.progressDot} ${activeIndex === index ? styles.active : ''}`}
                         onClick={() => setActiveIndex(index)}
-                        whileHover={{ scale: 1.6 }}
-                        whileTap={{ scale: 0.8 }}
-                        transition={transition}
                     />
                 ))}
             </div>
-        </div>
+        </motion.div>
     );
 }
\ No newline at end of file
diff --git a/components/skeletons/CardSkeleton.module.css b/components/skeletons/CardSkeleton.module.css
new file mode 100644
index 0000000..22304a3
--- /dev/null
+++ b/components/skeletons/CardSkeleton.module.css
@@ -0,0 +1,68 @@
+/* components/skeletons/CardSkeleton.module.css */
+@keyframes pulse-skeleton {
+    0%, 100% {
+        background-color: var(--border-color);
+    }
+    50% {
+        background-color: color-mix(in srgb, var(--border-color) 60%, var(--bg-secondary));
+    }
+}
+
+.cardSkeleton {
+    background-color: var(--bg-secondary);
+    border-radius: 8px;
+    overflow: hidden;
+    height: 100%;
+    border: 1px solid var(--border-color);
+    display: flex;
+    flex-direction: column;
+}
+
+.imageSkeleton {
+    width: 100%;
+    aspect-ratio: 16 / 9;
+    animation: pulse-skeleton 1.5s cubic-bezier(0.4, 0, 0.6, 1) infinite;
+}
+
+.contentSkeleton {
+    padding: 2rem;
+    display: flex;
+    flex-direction: column;
+    flex-grow: 1;
+    gap: 1.2rem;
+}
+
+.line {
+    height: 1.6rem;
+    border-radius: 4px;
+    animation: pulse-skeleton 1.5s cubic-bezier(0.4, 0, 0.6, 1) infinite;
+}
+
+.line.title {
+    height: 2rem;
+    width: 80%;
+    margin-bottom: 0.5rem;
+}
+
+.line.meta {
+    width: 60%;
+}
+
+.line.metaShort {
+    width: 40%;
+}
+
+.tagArea {
+    margin-top: auto;
+    padding-top: 1rem;
+    border-top: 1px solid var(--border-color);
+    display: flex;
+    gap: 0.8rem;
+}
+
+.tag {
+    height: 2.4rem;
+    width: 70px;
+    border-radius: 999px;
+    animation: pulse-skeleton 1.5s cubic-bezier(0.4, 0, 0.6, 1) infinite;
+}
\ No newline at end of file
diff --git a/components/skeletons/CardSkeleton.tsx b/components/skeletons/CardSkeleton.tsx
new file mode 100644
index 0000000..3e62f0e
--- /dev/null
+++ b/components/skeletons/CardSkeleton.tsx
@@ -0,0 +1,19 @@
+// components/skeletons/CardSkeleton.tsx
+import styles from './CardSkeleton.module.css';
+
+export default function CardSkeleton() {
+    return (
+        <div className={styles.cardSkeleton}>
+            <div className={styles.imageSkeleton}></div>
+            <div className={styles.contentSkeleton}>
+                <div className={`${styles.line} ${styles.title}`}></div>
+                <div className={`${styles.line} ${styles.meta}`}></div>
+                <div className={`${styles.line} ${styles.metaShort}`}></div>
+                <div className={styles.tagArea}>
+                    <div className={styles.tag}></div>
+                    <div className={styles.tag}></div>
+                </div>
+            </div>
+        </div>
+    );
+}
\ No newline at end of file
diff --git a/components/skeletons/GridPageSkeleton.tsx b/components/skeletons/GridPageSkeleton.tsx
new file mode 100644
index 0000000..318f6a6
--- /dev/null
+++ b/components/skeletons/GridPageSkeleton.tsx
@@ -0,0 +1,12 @@
+// components/skeletons/GridPageSkeleton.tsx
+import CardSkeleton from "./CardSkeleton";
+
+export default function GridPageSkeleton({ count = 12 }: { count?: number }) {
+    return (
+        <div className="content-grid" style={{ paddingTop: '4rem', paddingBottom: '6rem' }}>
+            {Array.from({ length: count }).map((_, index) => (
+                <CardSkeleton key={index} />
+            ))}
+        </div>
+    );
+}
\ No newline at end of file
diff --git a/components/ui/ButtonLoader.tsx b/components/ui/ButtonLoader.tsx
index e6c98a5..722fe6f 100644
--- a/components/ui/ButtonLoader.tsx
+++ b/components/ui/ButtonLoader.tsx
@@ -1,47 +1,63 @@
+// components/ui/ButtonLoader.tsx
 'use client';
 
 import { motion } from 'framer-motion';
 
+// SVG paths for the left and right loops of the infinity symbol
+const leftLoopPath = "M 50 50 C 50 25, 25 25, 25 50 C 25 75, 50 75, 50 50";
+const rightLoopPath = "M 50 50 C 50 25, 75 25, 75 50 C 75 75, 50 75, 50 50";
+
+// Shared transition for a seamless, continuous loop
+const transition = {
+  duration: 1.5,
+  ease: "easeInOut" as const,
+  repeat: Infinity,
+  repeatType: "loop" as const,
+};
+
+/**
+ * The "Glyph Deconstruction" loader.
+ * Animates the two halves of an infinity symbol, breaking them apart,
+ * orbiting them, and reassembling them in a fluid loop.
+ */
 export default function ButtonLoader() {
-return (
-<motion.svg
-className="stateful-button-loader"
-viewBox="0 0 50 50"
-initial={{ opacity: 0 }}
-animate={{ opacity: 1 }}
-exit={{ opacity: 0 }}
->
-<motion.circle cx="25" cy="25" r="20" fill="none" strokeWidth="4" />
-</motion.svg>
-);
-}
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
+  return (
+    <motion.svg
+      viewBox="0 0 100 100"
+      width="24"
+      height="24"
+      initial={{ opacity: 0 }}
+      animate={{ opacity: 1 }}
+      exit={{ opacity: 0 }}
+      style={{
+        stroke: "currentColor",
+        strokeWidth: 8,
+        fill: "none",
+        strokeLinecap: "round",
+        strokeLinejoin: "round",
+        overflow: "visible", // Prevents clipping during rotation
+      }}
+    >
+      {/* Left loop of the infinity symbol */}
+      <motion.path
+        d={leftLoopPath}
+        style={{ transformOrigin: "25px 50px" }} // Set rotation center to the loop's center
+        animate={{
+          rotate: [0, -180, -360],
+          x: [0, -15, 0],
+        }}
+        transition={transition}
+      />
+      {/* Right loop of the infinity symbol */}
+      <motion.path
+        d={rightLoopPath}
+        style={{ transformOrigin: "75px 50px" }} // Set rotation center to the loop's center
+        animate={{
+          rotate: [0, 180, 360],
+          x: [0, 15, 0],
+        }}
+        transition={transition}
+      />
+    </motion.svg>
+  );
+}
\ No newline at end of file
diff --git a/components/ui/ScrollToTopButton.module.css b/components/ui/ScrollToTopButton.module.css
index 4e996b2..37da860 100644
--- a/components/ui/ScrollToTopButton.module.css
+++ b/components/ui/ScrollToTopButton.module.css
@@ -21,6 +21,4 @@
 
 [data-theme="dark"] .scrollToTopButton {
     color: var(--bg-primary);
-}
-
-
+}
\ No newline at end of file
diff --git a/components/ui/ScrollToTopButton.tsx b/components/ui/ScrollToTopButton.tsx
index da46ed9..5637af7 100644
--- a/components/ui/ScrollToTopButton.tsx
+++ b/components/ui/ScrollToTopButton.tsx
@@ -6,7 +6,7 @@ import { useScrolled } from '@/hooks/useScrolled';
 import styles from './ScrollToTopButton.module.css';
 
 const ArrowUpIcon = () => (
-    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3" strokeLinecap="round" strokeLinejoin="round">
+    <svg width="24" height="24" viewBox="0 0 24" fill="none" stroke="currentColor" strokeWidth="3" strokeLinecap="round" strokeLinejoin="round">
         <line x1="12" y1="19" x2="12" y2="5"></line>
         <polyline points="5 12 12 5 19 12"></polyline>
     </svg>
@@ -41,6 +41,4 @@ export default function ScrollToTopButton() {
             )}
         </AnimatePresence>
     );
-}
-
-
+}
\ No newline at end of file
diff --git a/gather_text.py b/gather_text.py
new file mode 100644
index 0000000..126899e
--- /dev/null
+++ b/gather_text.py
@@ -0,0 +1,208 @@
+import os
+import re
+from pathlib import Path
+
+# --- CONFIGURATION ---
+
+# Directories to explicitly scan.
+SCAN_DIRS = [Path("app"), Path("components"), Path("hooks")]
+
+# Names of directories to ignore. This is now a simple set of strings for correct comparison.
+IGNORE_DIR_NAMES = {
+    ".git",
+    "node_modules",
+    ".next",
+}
+
+# File extensions to scan for text.
+SCAN_EXTENSIONS = {'.tsx', '.ts'}
+
+# Regular expressions designed to find potential user-facing text.
+REGEX_PATTERNS = [
+    # 1. High-confidence: Text inside JSX tags: > Hello World <
+    re.compile(r'>\s*([^<>{`=;]+)\s*<'),
+
+    # 2. High-confidence: Text in common UI attributes.
+    re.compile(r'(?:placeholder|title|alt|aria-label|label|message|description)\s*=\s*["\']([^"\']+)["\']'),
+
+    # 3. Medium-confidence: Text in template literals.
+    re.compile(r'`([^`]+)`'),
+    
+    # 4. Low-confidence: General string literals that will be heavily filtered.
+    re.compile(r'["\']([^"\']+)["\']'),
+]
+
+
+def is_user_facing(text: str) -> bool:
+    """
+    Applies a set of aggressive heuristics to determine if a string is likely user-facing text
+    rather than code, a class name, a path, or other non-UI string.
+
+    Args:
+        text (str): The string to analyze.
+
+    Returns:
+        bool: True if the string is likely user-facing text, False otherwise.
+    """
+    cleaned_text = text.strip()
+
+    # --- REJECTION RULES (ORDERED BY SPECIFICITY) ---
+
+    # Rule 1: Reject empty or very short, non-Arabic strings.
+    if len(cleaned_text) < 2:
+        return False
+
+    # Rule 2: Reject common programming operators and syntax.
+    if re.search(r'==|!=|=>|\|\||&&|\?\?|\?:|\+\+|--|=>|={|};', cleaned_text):
+        return False
+        
+    # Rule 3: Reject if it contains unbalanced or code-like brackets/parentheses.
+    if cleaned_text.count('(') != cleaned_text.count(')') or \
+       cleaned_text.count('[') != cleaned_text.count(']') or \
+       cleaned_text.count('{') != cleaned_text.count('}'):
+        return False
+    if re.search(r'[(){}\[\]]', cleaned_text) and ' ' not in cleaned_text:
+        return False
+
+    # Rule 4: Reject if it looks like a URL, file path, CSS selector, or contains HTML/XML tags.
+    if re.search(r'[/{.#:\[\]<>]', cleaned_text) and ' ' not in cleaned_text:
+        return False
+    if '<' in cleaned_text and '>' in cleaned_text:
+        return False
+        
+    # Rule 5: Reject if it's a file extension or looks like one.
+    if re.fullmatch(r'\.?\w+\.(png|jpg|jpeg|svg|gif|webp|css|module)', cleaned_text, re.IGNORECASE):
+        return False
+
+    # Rule 6: Reject if it looks like camelCase, PascalCase, kebab-case, or snake_case code.
+    if ' ' not in cleaned_text and not re.fullmatch(r'[\u0600-\u06FF]+', cleaned_text):
+        if re.match(r'^[a-z]+(?:[A-Z][a-z0-9]*)+$', cleaned_text) or \
+           re.match(r'^[A-Z][a-z0-9]+(?:[A-Z][a-z0-9]*)*$', cleaned_text) or \
+           re.match(r'^[a-z]+(?:-[a-z0-9]+)+$', cleaned_text) or \
+           re.match(r'^[a-z_]+(?:_[a-z0-9]+)+$', cleaned_text, re.IGNORECASE):
+            return False
+            
+    # Rule 7: Reject common code-related keywords and CSS properties.
+    code_keywords = {
+        'div', 'span', 'true', 'false', 'null', 'undefined', 'button', 'submit', 'text', 'password', 'email', 
+        'search', 'checkbox', 'radio', 'hidden', 'string', 'number', 'boolean', 'object', 'function', 
+        'class', 'id', 'key', 'const', 'let', 'var', 'import', 'export', 'from', 'as', 'type', 'interface',
+        'public', 'private', 'protected', 'async', 'await', 'return', 'props', 'state', 'ref',
+        'width', 'height', 'color', 'background', 'margin', 'padding', 'border', 'display', 'position', 'left', 'right', 'top', 'bottom',
+        'grid', 'flex', 'auto', 'block', 'inline-block', 'justify-content', 'align-items'
+    }
+    if cleaned_text.lower() in code_keywords:
+        return False
+        
+    # Rule 8: The string must contain at least one letter (English or Arabic).
+    if not re.search(r'[a-zA-Z\u0600-\u06FF]', cleaned_text):
+        return False
+        
+    # Rule 9: Reject strings that are just special characters or numbers.
+    if re.fullmatch(r'[^a-zA-Z\u0600-\u06FF\s]+', cleaned_text):
+        return False
+
+    # Rule 10: Reject if it contains variable placeholders like ${...}
+    if re.search(r'\$\{.+?\}', cleaned_text):
+        return False
+        
+    # Rule 11: Reject if it looks like a CSS unit.
+    if re.fullmatch(r'-?\d+(\.\d+)?(px|rem|em|%|vh|vw|s|ms|deg)', cleaned_text, re.IGNORECASE):
+        return False
+        
+    # Rule 12: Reject if it looks like SVG path data.
+    if re.match(r'^[MmLlHhVvCcSsQqTtAaZz][\d\s.,-e]+$', cleaned_text.strip()):
+        return False
+        
+    # --- ACCEPTANCE RULES ---
+    
+    # Rule 13: A string with multiple words is highly likely to be user-facing text.
+    if ' ' in cleaned_text:
+        return True
+        
+    # Rule 14: A single word that is entirely Arabic is likely user-facing.
+    if re.fullmatch(r'[\u0600-\u06FF]+', cleaned_text):
+        return True
+        
+    # Final check: For single English words, be very strict.
+    if not cleaned_text[0].isalnum() or not cleaned_text[-1].isalnum():
+        return False
+    if re.fullmatch(r'[A-Z][a-z]+', cleaned_text):
+        return True
+    if re.fullmatch(r'[a-z]+', cleaned_text):
+        return False
+
+    return True
+
+
+def extract_text_from_file(file_path: Path) -> set[str]:
+    """
+    Reads a file, applies all regex patterns, and returns a set of unique strings.
+    """
+    try:
+        with open(file_path, 'r', encoding='utf-8', errors='ignore') as f:
+            content = f.read()
+    except Exception as e:
+        print(f"  [Warning] Could not read file {file_path}: {e}")
+        return set()
+
+    found_texts = set()
+    for pattern in REGEX_PATTERNS:
+        matches = pattern.findall(content)
+        for match in matches:
+            text = re.sub(r'\$\{[^}]+\}', '', match)
+            text = re.sub(r'\s+', ' ', text).strip()
+            if text:
+                found_texts.add(text)
+    return found_texts
+
+
+def main():
+    """
+    Main function to traverse specified project directories, extract text from
+    target file types, filter it, and save the result.
+    """
+    project_root = Path.cwd()
+    print(f"Scanning for user-facing text in specified directories: {', '.join(map(str, SCAN_DIRS))}\n")
+
+    all_raw_texts = set()
+
+    for scan_dir in SCAN_DIRS:
+        target_path = project_root / scan_dir
+        if not target_path.is_dir():
+            print(f"  [Warning] Directory '{scan_dir}' not found. Skipping.")
+            continue
+
+        for root, dirs, files in os.walk(target_path, topdown=True):
+            # THE DEFINITIVE FIX: Prune ignored directories using a simple string comparison.
+            # This corrects the NameError and the faulty logic.
+            dirs[:] = [d for d in dirs if d not in IGNORE_DIR_NAMES]
+
+            for file in files:
+                file_path = Path(root) / file
+                if file_path.suffix in SCAN_EXTENSIONS:
+                    relative_path = file_path.relative_to(project_root)
+                    print(f"  -> Processing: {relative_path}")
+                    extracted = extract_text_from_file(file_path)
+                    all_raw_texts.update(extracted)
+
+    print("\nFiltering extracted strings with corrected, stricter heuristics...")
+    user_facing_texts = sorted([text for text in all_raw_texts if is_user_facing(text)])
+
+    output_filename = 'user_facing_texts.txt'
+    try:
+        with open(output_filename, 'w', encoding='utf-8') as f:
+            f.write("# --- User-Facing Texts Extracted from EternalGames Project (Corrected) ---\n")
+            f.write(f"# --- Scanned Directories: {', '.join(map(str, SCAN_DIRS))} ---\n\n")
+            for text in user_facing_texts:
+                f.write(text + '\n')
+    except Exception as e:
+        print(f"\n[ERROR] Could not write to output file: {e}")
+        return
+
+    print(f"\n✅ Success! Found {len(user_facing_texts)} unique user-facing text strings.")
+    print(f"   Results have been saved to '{output_filename}'")
+
+
+if __name__ == "__main__":
+    main()
\ No newline at end of file
diff --git a/hooks/useEditorImageUpload.ts b/hooks/useEditorImageUpload.ts
deleted file mode 100644
index 002d1d5..0000000
--- a/hooks/useEditorImageUpload.ts
+++ /dev/null
@@ -1,60 +0,0 @@
-// hooks/useEditorImageUpload.ts
-'use client';
-
-import { useCallback } from 'react';
-import { useToast } from '@/lib/toastStore';
-import { optimizeImageForUpload } from '@/lib/image-optimizer';
-import { clientAssetUploader } from '@/lib/sanity.client';
-import { Editor } from '@tiptap/react';
-
-const formatFileSize = (bytes: number): string => {
-    if (bytes < 1024) return `${bytes} B`;
-    const kb = bytes / 1024;
-    if (kb < 1024) return `${kb.toFixed(1)} KB`;
-    const mb = kb / 1024;
-    return `${mb.toFixed(2)} MB`;
-};
-
-type UseEditorImageUploadProps = {
-    editor: Editor;
-    updateAttributes: (attributes: Record<string, any>) => void;
-};
-
-export function useEditorImageUpload({ editor, updateAttributes }: UseEditorImageUploadProps) {
-    const toast = useToast();
-
-    const handleUpload = useCallback(async (file: File, slot: 1 | 2 | 3 | 4 | 'left' | 'right') => {
-        try {
-            toast.info('جار تحسين الصورة للرفع...', 'left');
-            const quality = editor.storage.uploadQuality || '1080p';
-            const { file: optimizedFile, finalQuality } = await optimizeImageForUpload(file, quality);
-
-            toast.info(`جار رفع الصورة (${formatFileSize(optimizedFile.size)} @ ${Math.round(finalQuality * 100)}%)...`, 'left');
-
-            const asset = await clientAssetUploader.assets.upload('image', optimizedFile, {
-                filename: optimizedFile.name,
-                contentType: optimizedFile.type,
-            });
-
-            if (asset?._id && asset?.url) {
-                const isSide = slot === 'left' || slot === 'right';
-                const srcKey = isSide ? (slot === 'left' ? 'src1' : 'src2') : `src${slot}`;
-                const assetIdKey = isSide ? (slot === 'left' ? 'assetId1' : 'assetId2') : `assetId${slot}`;
-
-                updateAttributes({
-                    [srcKey]: asset.url,
-                    [assetIdKey]: asset._id,
-                });
-                toast.success('تم رفع الصورة بنجاح.', 'left');
-            } else {
-                throw new Error('فشل الرفع');
-            }
-        } catch (error: any) {
-            toast.error(error.message || 'فشل معالجة الصورة.', 'left');
-        }
-    }, [editor.storage.uploadQuality, toast, updateAttributes]);
-
-    return handleUpload;
-}
-
-
diff --git a/hooks/useVanguardCarousel.ts b/hooks/useVanguardCarousel.ts
index 67f5da5..a982a15 100644
--- a/hooks/useVanguardCarousel.ts
+++ b/hooks/useVanguardCarousel.ts
@@ -4,8 +4,10 @@
 import { useState, useEffect, useRef, useCallback } from 'react';
 
 const VANGUARD_SLOTS = 5;
-export const ANIMATION_COOLDOWN = 450;
-const AUTO_NAVIGATE_INTERVAL = 3000;
+// THE DEFINITIVE FIX: The cooldown is now synchronized with the component's 0.7s animation duration.
+// This prevents new navigation actions from being dispatched while an animation is still in progress.
+export const ANIMATION_COOLDOWN = 700;
+const AUTO_NAVIGATE_INTERVAL = 2000;
 const MOBILE_BREAKPOINT = 1024;
 const CENTER_SLOT_INDEX = 2;
 
@@ -90,19 +92,17 @@ export function useVanguardCarousel(itemCount: number, isCurrentlyInView: boolea
         let transform = '';
 
         if (isMobile) {
-            // THE DEFINITIVE FIX: Animate only the transform property for mobile to match desktop's smoothness.
-            // All cards are positioned relative to the center (left: 50%) and then translated.
             style.left = '50%';
-            const offsetVw = 35;
-            const baseTranslateX = '-50%'; // To center the card itself
+            const offsetPx = 140; 
+            const baseTranslateX = '-50%';
 
             switch (slotIndex) {
                 case 0: // Far Left
-                    transform = `translateX(calc(${baseTranslateX} - ${offsetVw * 1.8}vw)) scale(0.75)`;
+                    transform = `translateX(calc(${baseTranslateX} - ${offsetPx * 1.6}px)) scale(0.75)`;
                     style.zIndex = 0;
                     break;
                 case 1: // Near Left
-                    transform = `translateX(calc(${baseTranslateX} - ${offsetVw}vw)) scale(0.8)`;
+                    transform = `translateX(calc(${baseTranslateX} - ${offsetPx * 0.9}px)) scale(0.8)`;
                     style.zIndex = 1;
                     break;
                 case 2: // Center
@@ -110,11 +110,11 @@ export function useVanguardCarousel(itemCount: number, isCurrentlyInView: boolea
                     style.zIndex = 2;
                     break;
                 case 3: // Near Right
-                    transform = `translateX(calc(${baseTranslateX} + ${offsetVw}vw)) scale(0.8)`;
+                    transform = `translateX(calc(${baseTranslateX} + ${offsetPx * 0.9}px)) scale(0.8)`;
                     style.zIndex = 1;
                     break;
                 case 4: // Far Right
-                    transform = `translateX(calc(${baseTranslateX} + ${offsetVw * 1.8}vw)) scale(0.75)`;
+                    transform = `translateX(calc(${baseTranslateX} + ${offsetPx * 1.6}px)) scale(0.75)`;
                     style.zIndex = 0;
                     break;
             }
@@ -156,6 +156,4 @@ export function useVanguardCarousel(itemCount: number, isCurrentlyInView: boolea
         getCardState,
         isMobile,
     };
-}
-
-
+}
\ No newline at end of file
diff --git a/lib/adapters.ts b/lib/adapters.ts
index 9809c17..3937c09 100644
--- a/lib/adapters.ts
+++ b/lib/adapters.ts
@@ -5,7 +5,14 @@ import { CardProps } from '@/types';
 const arabicMonths = ["يناير", "فبراير", "مارس", "أبريل", "مايو", "يونيو", "يوليو", "أغسطس", "سبتمبر", "أكتوبر", "نوفمبر", "ديسمبر"];
 
 export const adaptToCardProps = (item: any): CardProps | null => {
-    if (!item) return null;
+    // THE DEFINITIVE FIX:
+    // If an item from Sanity is missing a `legacyId` or the item itself is null,
+    // it is considered corrupt data. We return `null` immediately. This prevents
+    // items with `undefined` IDs from reaching the UI, which was the root cause of
+    // both the disappearing cards (layoutId collision) and phantom bookmarks (state key collision).
+    if (!item || item.legacyId === null || item.legacyId === undefined) {
+        return null;
+    }
 
     const imageAsset = item.mainImage?.asset || item.mainImageRef;
     let imageUrl = null;
@@ -57,6 +64,7 @@ export const adaptToCardProps = (item: any): CardProps | null => {
         score: item.score,
         tags: (item.tags || []).map((t: any) => ({ title: t.title, slug: t.slug })).filter(Boolean),
         blurDataURL: blurDataURL,
+        category: item.category?.title, // ADDED: Map the category title
         verdict: item.verdict || '',
         pros: item.pros || [],
         cons: item.cons || [],
diff --git a/lib/badges.tsx b/lib/badges.tsx
index 4780ec4..348e056 100644
--- a/lib/badges.tsx
+++ b/lib/badges.tsx
@@ -24,13 +24,13 @@ const TopContributorIcon = ({ className = '' }) => <svg className={className} xm
 export const BADGES: Record<BadgeId, Badge> = {
     DIRECTOR: { id: 'DIRECTOR', name: 'مدير', description: 'يشرف على مشروع EternalGames.', Icon: DirectorIcon },
     REVIEWER: { id: 'REVIEWER', name: 'مُراجع', description: 'صوت موثوق لمراجعات الألعاب.', Icon: ReviewerIcon },
-    AUTHOR: { id: 'AUTHOR', name: 'كاتب', description: 'يكتب المقالات والمواضيع المميزة.', Icon: AuthorIcon },
-    REPORTER: { id: 'REPORTER', name: 'مراسل', description: 'يغطي آخر أخبار الصناعة.', Icon: ReporterIcon },
-    DESIGNER: { id: 'DESIGNER', name: 'مصمم', description: 'يساهم في التصميم البصري للمحتوى.', Icon: DesignerIcon },
-    FOUNDER: { id: 'FOUNDER', name: 'مؤسس', description: 'انضم إلى EternalGames في الشهر الأول من إطلاقه.', Icon: FounderIcon },
-    FIRST_COMMENT: { id: 'FIRST_COMMENT', name: 'مبادر', description: 'نشر أول تعليق له.', Icon: FirstCommentIcon },
-    ENGAGED_COMMENTER: { id: 'ENGAGED_COMMENTER', name: 'مساهم', description: 'نشر أكثر من 10 تعليقات.', Icon: EngagedCommenterIcon },
-    TOP_CONTRIBUTOR: { id: 'TOP_CONTRIBUTOR', name: 'عمود المجتمع', description: 'نشر أكثر من 50 تعليقًا.', Icon: TopContributorIcon },
+    AUTHOR: { id: 'AUTHOR', name: 'كاتب', description: 'يخطُّ المقالات والمواضيع.', Icon: AuthorIcon },
+    REPORTER: { id: 'REPORTER', name: 'مراسل', description: 'يقتفي أثر أخبار الصناعة.', Icon: ReporterIcon },
+    DESIGNER: { id: 'DESIGNER', name: 'مصمم', description: 'يضفي رونقًا على المحتوى.', Icon: DesignerIcon },
+    FOUNDER: { id: 'FOUNDER', name: 'مؤسس', description: 'التحق بركب EternalGames في شهره الأول.', Icon: FounderIcon },
+    FIRST_COMMENT: { id: 'FIRST_COMMENT', name: 'مبادر', description: 'خطَّ أول تعليقٍ له.', Icon: FirstCommentIcon },
+    ENGAGED_COMMENTER: { id: 'ENGAGED_COMMENTER', name: 'مساهم', description: 'جاوزت تعليقاته العشرة.', Icon: EngagedCommenterIcon },
+    TOP_CONTRIBUTOR: { id: 'TOP_CONTRIBUTOR', name: 'عمود المجتمع', description: 'جاوز الخمسين تعليقًا.', Icon: TopContributorIcon },
 };
 
 export function getBadgesForUser(user: { createdAt: Date; _count: { comments: number }, roles: string[] }): Badge[] {
diff --git a/lib/sanity.client.ts b/lib/sanity.client.ts
index f98871b..ef0af14 100644
--- a/lib/sanity.client.ts
+++ b/lib/sanity.client.ts
@@ -1,29 +1,11 @@
 // lib/sanity.client.ts
 
-import { createClient } from '@sanity/client'
-
-export const projectId = process.env.NEXT_PUBLIC_SANITY_PROJECT_ID
-export const dataset = process.env.NEXT_PUBLIC_SANITY_DATASET
-export const apiVersion = process.env.NEXT_PUBLIC_SANITY_API_VERSION
+import { createClient } from 'next-sanity'
+import { apiVersion, dataset, projectId } from '@/lib/sanity.env'
 
 export const client = createClient({
     projectId,
     dataset,
     apiVersion,
-    useCdn: false,
-    token: process.env.SANITY_API_READ_TOKEN,
-})
-
-export const clientAssetUploader = createClient({
-    projectId,
-    dataset,
-    apiVersion,
-    useCdn: false,
-    // THE FIX: Use the NEXT_PUBLIC_ prefixed variable
-    token: process.env.NEXT_PUBLIC_SANITY_API_WRITE_TOKEN,
-})
-
-
-
-
-
+    useCdn: true,
+});
\ No newline at end of file
diff --git a/lib/sanity.env.ts b/lib/sanity.env.ts
new file mode 100644
index 0000000..7fb7fb1
--- /dev/null
+++ b/lib/sanity.env.ts
@@ -0,0 +1,20 @@
+// lib/sanity.env.ts
+
+function assertValue<T>(v: T | undefined, errorMessage: string): T {
+    if (v === undefined) {
+        throw new Error(errorMessage)
+    }
+    return v
+}
+
+export const apiVersion = process.env.SANITY_API_VERSION || '2025-09-28'
+
+export const dataset = assertValue(
+    process.env.SANITY_DATASET,
+    'Missing environment variable: SANITY_DATASET'
+)
+
+export const projectId = assertValue(
+    process.env.SANITY_PROJECT_ID,
+    'Missing environment variable: SANITY_PROJECT_ID'
+)
\ No newline at end of file
diff --git a/lib/sanity.queries.ts b/lib/sanity.queries.ts
index 1ccb57c..e3ff80b 100644
--- a/lib/sanity.queries.ts
+++ b/lib/sanity.queries.ts
@@ -4,7 +4,7 @@ import { groq } from 'next-sanity'
 
 // --- Base Fields & Projections (Optimized) ---
 const mainImageFields = groq`asset, "url": asset->url, "blurDataURL": asset->metadata.lqip, alt`
-const creatorFields = groq`_id, name, prismaUserId, image, bio, "username": *[_type=="user" && id==^.prismaUserId][0].username`
+const creatorFields = groq`_id, name, prismaUserId, image, bio`
 const gameFields = groq`_id, title, "slug": slug.current`
 const tagFields = groq`_id, title, "slug": slug.current`
 const publishedFilter = groq`defined(publishedAt) && publishedAt < now()`
@@ -15,8 +15,7 @@ _id, _type, legacyId, title, "slug": slug.current, "mainImage": mainImage{${main
 "authors": authors[]->{${creatorFields}},
 "reporters": reporters[]->{${creatorFields}},
 "designers": designers[]->{${creatorFields}}, 
-"publishedAt": publishedAt, "game": game->{_id, title, "slug": slug.current}, "tags": tags[]->{${tagFields}}
-`
+"publishedAt": publishedAt, "game": game->{_id, title, "slug": slug.current}, "tags": tags[]->{${tagFields}}, "category": category->{title, "slug": slug.current}`
 const cardListProjection = groq`
 _id, _type, legacyId, title, "slug": slug.current, 
 "mainImageRef": mainImage.asset, 
@@ -24,7 +23,7 @@ score,
 "authors": authors[]->{${creatorFields}},
 "reporters": reporters[]->{${creatorFields}},
 "designers": designers[]->{${creatorFields}},
-"publishedAt": publishedAt, "game": game->{_id, title, "slug": slug.current}, "tags": tags[]->{${tagFields}}
+"publishedAt": publishedAt, "game": game->{_id, title, "slug": slug.current}, "tags": tags[]->{${tagFields}}, "category": category->{title, "slug": slug.current}
 `
 
 // --- API Projections ---
@@ -35,7 +34,7 @@ score,
 "authors": authors[]->{${creatorFields}},
 "reporters": reporters[]->{${creatorFields}},
 "designers": designers[]->{${creatorFields}},
-"publishedAt": publishedAt, "game": game->{_id, title, "slug": slug.current}, "tags": tags[]->{${tagFields}}
+"publishedAt": publishedAt, "game": game->{_id, title, "slug": slug.current}, "tags": tags[]->{${tagFields}}, "category": category->{title, "slug": slug.current}
 `
 
 // --- News Hub Specific Queries ---
@@ -135,14 +134,14 @@ export const paginatedArticlesQuery = (
 }
 
 // --- List Page Queries ---
-export const vanguardReviewsQuery = groq`*[_type == "review" && ${publishedFilter} && defined(mainImage.asset)] | order(score desc, publishedAt desc)[0...10] { ${cardProjection} }`
+export const vanguardReviewsQuery = groq`*[_type == "review" && ${publishedFilter} && defined(mainImage.asset)] | order(publishedAt desc)[0...10] { ${cardProjection} }`
 export const featuredHeroReviewQuery = groq`*[_type == "review" && ${publishedFilter} && defined(mainImage.asset)] | order(score desc, publishedAt desc)[0] { ${cardProjection} }`
 export const featuredShowcaseArticlesQuery = groq`*[_type == "article" && ${publishedFilter} && defined(mainImage.asset)] | order(publishedAt desc)[0...7] { ${cardProjection} }`
 export const allReviewsListQuery = groq`*[_type == "review" && ${publishedFilter}] | order(publishedAt desc) [0...20] { ${cardListProjection} }`
 export const allArticlesListQuery = groq`*[_type == "article" && ${publishedFilter}] | order(publishedAt desc) [0...20] { ${cardListProjection} }`
 export const allContentByCreatorListQuery = groq`*[_type in ["review", "article", "news"] && ${publishedFilter} && references($creatorIds)] | order(publishedAt desc) { ${cardListProjection} }`
 export const allContentByGameListQuery = groq`*[_type in ["review", "article", "news"] && ${publishedFilter} && game->slug.current == $slug] | order(publishedAt desc) { ${cardListProjection} }`
-export const allContentByTagListQuery = groq`*[_type in ["review", "article", "news"] && ${publishedFilter} && $slug in tags[]->slug.current] | order(publishedAt desc) { ${cardListProjection} }`
+export const allContentByTagListQuery = groq`*[_type in ["review", "article", "news"] && ${publishedFilter} && ($slug in tags[]->slug.current || category->slug.current == $slug)] | order(publishedAt desc) { ${cardListProjection} }`
 
 // --- Detail Page Queries ---
 const contentProjection = groq`content[]{ ..., _type == "image" => { "asset": asset->{ _id, url, "lqip": metadata.lqip, "metadata": metadata } }, _type == "imageCompare" => { "image1": image1{..., asset->{_id, url}}, "image2": image2{..., asset->{_id, url}} }, _type == "twoImageGrid" => { "image1": image1{..., asset->{_id, url}}, "image2": image2{..., asset->{_id, url}} }, _type == "fourImageGrid" => { "image1": image1{..., asset->{_id, url}}, "image2": image2{..., asset->{_id, url}}, "image3": image3{..., asset->{_id, url}}, "image4": image4{..., asset->{_id, url}} } }`
@@ -156,13 +155,13 @@ export const reviewBySlugQuery = groq`*[_type == "review" && slug.current == $sl
 }`
 export const articleBySlugQuery = groq`*[_type == "article" && slug.current == $slug && ${publishedFilter}][0] {
   ..., "authors": authors[]->{${creatorFields}}, "designers": designers[]->{${creatorFields}},
-  "game": game->{${gameFields}}, "mainImage": mainImage{${mainImageFields}}, "tags": tags[]->{_id, title},
+  "game": game->{${gameFields}}, "mainImage": mainImage{${mainImageFields}}, "tags": tags[]->{_id, title, "slug": slug.current},
   "relatedArticles": relatedArticles[${publishedFilter}]->${relatedContentProjection},
   ${contentProjection}
 }`
 export const newsBySlugQuery = groq`*[_type == "news" && slug.current == $slug && ${publishedFilter}][0] {
   ..., "reporters": reporters[]->{${creatorFields}}, "designers": designers[]->{${creatorFields}},
-  "game": game->{${gameFields}}, "mainImage": mainImage{${mainImageFields}}, "tags": tags[]->{_id, title},
+  "game": game->{${gameFields}}, "mainImage": mainImage{${mainImageFields}}, "category": category->{_id, title, "slug": slug.current},
   "relatedNews": relatedNews[${publishedFilter}]->${relatedContentProjection},
   ${contentProjection}
 }`
@@ -185,11 +184,15 @@ export const searchQuery = groq`*[_type in ["review", "article", "news"] && ${pu
   "gameTitle": game->title, "tags": tags[]->{title}
 }`
 export const contentByIdsQuery = groq`*[_type in ["review", "article", "news"] && legacyId in $ids && ${publishedFilter}] { ${cardProjection} }`
-export const allReleasesQuery = groq`*[_type == "gameRelease" && defined(releaseDate)] | order(releaseDate asc) { _id, legacyId, title, "slug": slug.current, releaseDate, platforms, synopsis, "mainImage": mainImage{${mainImageFields}}, }`
+export const allReleasesQuery = groq`*[_type == "gameRelease" && defined(releaseDate)] | order(releaseDate asc) { 
+  _id, legacyId, title, "slug": slug.current, releaseDate, platforms, synopsis, "mainImage": mainImage{${mainImageFields}},
+  "game": game->{ "slug": slug.current }
+}`
 
 // --- Studio Editor Queries ---
 export const allGamesForStudioQuery = groq`*[_type == "game"] | order(title asc){_id, title, "slug": slug.current}`;
-export const allTagsForStudioQuery = groq`*[_type == "tag"] | order(title asc){_id, title}`;
+// THE DEFINITIVE FIX: The category field is now fetched for all tags.
+export const allTagsForStudioQuery = groq`*[_type == "tag"] | order(title asc){_id, title, category}`;
 export const allCreatorsForStudioQuery = groq`*[_type in ["reviewer", "author", "reporter", "designer"]] | order(name asc){_id, name, _type, prismaUserId}`;
 
 export const editorDocumentQuery = groq`*[_id == $id || _id == 'drafts.' + $id] | order(_updatedAt desc)[0]{
@@ -199,6 +202,7 @@ export const editorDocumentQuery = groq`*[_id == $id || _id == 'drafts.' + $id]
   "designers": designers[]->{_id, name, prismaUserId},
   "game": game->{_id, title},
   "tags": tags[]->{_id, title},
+  "category": category->{_id, title},
   "mainImage": mainImage.asset->{
     "_ref": _id,
     "url": url,
diff --git a/lib/sanity.server.ts b/lib/sanity.server.ts
index b51fba3..93ce791 100644
--- a/lib/sanity.server.ts
+++ b/lib/sanity.server.ts
@@ -1,42 +1,12 @@
-import { createClient } from '@sanity/client'
-import { apiVersion, dataset, projectId } from '@/lib/sanity.client'
-
-// This is a server-only client for performing mutations.
-// It uses a write-enabled token and should never be exposed to the client.
-export const sanityWriteClient = createClient({
-projectId,
-dataset,
-apiVersion,
-useCdn: false, // Writes should always go directly to the API
-token: process.env.SANITY_API_WRITE_TOKEN, // Use a dedicated write token
-});
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
+// lib/sanity.server.ts
 
+import { createClient } from 'next-sanity'
+import { apiVersion, dataset, projectId } from '@/lib/sanity.env'
 
+export const sanityWriteClient = createClient({
+    projectId,
+    dataset,
+    apiVersion,
+    useCdn: false,
+    token: process.env.SANITY_API_WRITE_TOKEN!,
+});
\ No newline at end of file
diff --git a/lib/store.ts b/lib/store.ts
index c1576c9..3f56eeb 100644
--- a/lib/store.ts
+++ b/lib/store.ts
@@ -54,7 +54,7 @@ export const useUserStore = create<UserState & UserActions>()(
                         if (!result.success) throw new Error(result.error);
                     } catch (error) {
                         // THE FIX: Call the raw store's action directly
-                        useToastStore.getState().addToast('فشل حفظ العلامة المرجعية.', 'error');
+                        useToastStore.getState().addToast('فشل الحفظ.', 'error');
                         set({ bookmarks: originalBookmarks });
                     }
                 }, 500);
@@ -78,7 +78,7 @@ export const useUserStore = create<UserState & UserActions>()(
                         if (!result.success) throw new Error(result.error);
                     } catch (error) {
                         // THE FIX: Call the raw store's action directly
-                        useToastStore.getState().addToast('فشل تسجيل الإعجاب.', 'error');
+                        useToastStore.getState().addToast('أخفق تسجيل الإعجاب.', 'error');
                         set({ likes: originalLikes });
                     }
                 }, 500);
diff --git a/lib/translations.ts b/lib/translations.ts
index f8f22d8..5837827 100644
--- a/lib/translations.ts
+++ b/lib/translations.ts
@@ -35,7 +35,7 @@ const TAG_TRANSLATIONS: Record<string, string> = {
     "Classic": "كلاسيكي",
     "Indie": "ألعاب مستقلة",
 
-    // === News-Specific Tags ===
+    // === News-Specific Tags (Now also used for Category) ===
     "Acquisition": "استحواذ",
     "Sales": "أرقام المبيعات",
     "Game Announcement": "الكشف عن لعبة",
@@ -58,17 +58,6 @@ const TAG_TRANSLATIONS: Record<string, string> = {
     "Story": "قصة",
 };
 
-/**
- * Translates an English tag title to Arabic.
- * If no translation is found, it returns the original English title.
- * @param tagTitle The English tag title from Sanity.
- * @returns The translated Arabic string or the original string.
- */
 export const translateTag = (tagTitle: string): string => {
     return TAG_TRANSLATIONS[tagTitle] || tagTitle;
-};
-
-
-
-
-
+};
\ No newline at end of file
diff --git a/next-env.d.ts b/next-env.d.ts
index 9edff1c..c4b7818 100644
--- a/next-env.d.ts
+++ b/next-env.d.ts
@@ -1,6 +1,6 @@
 /// <reference types="next" />
 /// <reference types="next/image-types/global" />
-import "./.next/types/routes.d.ts";
+import "./.next/dev/types/routes.d.ts";
 
 // NOTE: This file should not be edited
 // see https://nextjs.org/docs/app/api-reference/config/typescript for more information.
diff --git a/next.config.ts b/next.config.ts
index 0837043..b23eb1d 100644
--- a/next.config.ts
+++ b/next.config.ts
@@ -1,38 +1,16 @@
-// next.config.ts
-
 /** @type {import('next').NextConfig} */
 const nextConfig = {
     reactStrictMode: true,
 
-    env: {
-        NEXT_PUBLIC_SANITY_PROJECT_ID: '0zany1dm',
-        NEXT_PUBLIC_SANITY_DATASET: 'production',
-        NEXT_PUBLIC_SANITY_API_VERSION: '2025-09-30',
-    },
     images: {
         remotePatterns: [
-            // Sanity CMS
-            {
-                protocol: 'https',
-                hostname: 'cdn.sanity.io',
-            },
-            // Vercel Blob Storage (for user avatars) - WILDCARD ADDED
-            {
-                protocol: 'https',
-                hostname: '*.public.blob.vercel-storage.com',
-            },
-            // Google OAuth Avatars
-            {
-                protocol: 'https',
-                hostname: 'lh3.googleusercontent.com',
-            },
-            // GitHub OAuth Avatars
-            {
-                protocol: 'https',
-                hostname: 'avatars.githubusercontent.com',
-            },
+            { protocol: 'https', hostname: 'cdn.sanity.io' },
+            { protocol: 'https', hostname: '*.public.blob.vercel-storage.com' },
+            { protocol: 'https', hostname: 'lh3.googleusercontent.com' },
+            { protocol: 'https', hostname: 'avatars.githubusercontent.com' },
         ],
     },
+
     experimental: {
         serverActions: {
             bodySizeLimit: '10mb',
@@ -41,5 +19,3 @@ const nextConfig = {
 };
 
 export default nextConfig;
-
-
diff --git a/prisma/schema.prisma b/prisma/schema.prisma
index 2a4427f..2bc59e0 100644
--- a/prisma/schema.prisma
+++ b/prisma/schema.prisma
@@ -28,7 +28,7 @@ model Account {
   scope             String?
   id_token          String?
   session_state     String?
-  user              User    @relation(fields: [userId], references: [id], onDelete: Cascade)
+  user              User    @relation(fields: [userId], references: [id], onحذف: Cascade)
 
   @@unique([provider, providerAccountId])
 }
@@ -38,7 +38,7 @@ model Session {
   sessionToken String   @unique
   userId       String
   expires      DateTime
-  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
+  user         User     @relation(fields: [userId], references: [id], onحذف: Cascade)
 }
 
 model User {
@@ -80,7 +80,7 @@ model PasswordResetToken {
   token   String   @unique
   expires DateTime
   userId  String
-  user    User     @relation(fields: [userId], references: [id], onDelete: Cascade)
+  user    User     @relation(fields: [userId], references: [id], onحذف: Cascade)
 }
 
 model Engagement {
@@ -90,7 +90,7 @@ model Engagement {
   userId      String
   contentId   Int
   contentType String
-  user        User           @relation(fields: [userId], references: [id], onDelete: Cascade)
+  user        User           @relation(fields: [userId], references: [id], onحذف: Cascade)
 
   @@unique([userId, contentId, contentType, type])
 }
@@ -101,7 +101,7 @@ model Share {
   userId      String
   contentId   Int
   contentType String
-  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
+  user        User     @relation(fields: [userId], references: [id], onحذف: Cascade)
 }
 
 model Comment {
@@ -110,11 +110,11 @@ model Comment {
   updatedAt   DateTime      @updatedAt
   content     String
   contentSlug String
-  isDeleted   Boolean       @default(false)
+  isحذفd   Boolean       @default(false)
   authorId    String
   parentId    String?
-  author      User          @relation(fields: [authorId], references: [id], onDelete: Cascade)
-  parent      Comment?      @relation("CommentReplies", fields: [parentId], references: [id], onDelete: NoAction, onUpdate: NoAction)
+  author      User          @relation(fields: [authorId], references: [id], onحذف: Cascade)
+  parent      Comment?      @relation("CommentReplies", fields: [parentId], references: [id], onحذف: NoAction, onUpdate: NoAction)
   replies     Comment[]     @relation("CommentReplies")
   votes       CommentVote[]
 }
@@ -125,8 +125,8 @@ model CommentVote {
   type      VoteType
   userId    String
   commentId String
-  comment   Comment  @relation(fields: [commentId], references: [id], onDelete: Cascade)
-  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
+  comment   Comment  @relation(fields: [commentId], references: [id], onحذف: Cascade)
+  user      User     @relation(fields: [userId], references: [id], onحذف: Cascade)
 
   @@unique([userId, commentId])
 }
diff --git a/sanity/.env b/sanity/.env
index f1efac7..9c8fb1e 100644
--- a/sanity/.env
+++ b/sanity/.env
@@ -1,7 +1,2 @@
 SANITY_STUDIO_PROJECT_ID="0zany1dm"
-SANITY_STUDIO_DATASET="production"
-
-
-
-
-
+SANITY_STUDIO_DATASET="production"
\ No newline at end of file
diff --git a/sanity/.sanity/runtime/app.js b/sanity/.sanity/runtime/app.js
new file mode 100644
index 0000000..db6ca18
--- /dev/null
+++ b/sanity/.sanity/runtime/app.js
@@ -0,0 +1,11 @@
+
+// This file is auto-generated on 'sanity dev'
+// Modifications to this file are automatically discarded
+import studioConfig from "..\\..\\sanity.config.ts"
+import {renderStudio} from "sanity"
+
+renderStudio(
+  document.getElementById("sanity"),
+  studioConfig,
+  {reactStrictMode: false, basePath: "/"}
+)
diff --git a/sanity/.sanity/runtime/index.html b/sanity/.sanity/runtime/index.html
new file mode 100644
index 0000000..534232f
--- /dev/null
+++ b/sanity/.sanity/runtime/index.html
@@ -0,0 +1,253 @@
+<!DOCTYPE html><html lang="en">
+<!--
+This file is auto-generated from "sanity dev".
+Modifications to this file are automatically discarded.
+-->
+<head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, viewport-fit=cover"/><meta name="robots" content="noindex"/><meta name="referrer" content="same-origin"/><link rel="icon" href="/static/favicon.ico" sizes="any"/><link rel="icon" href="/static/favicon.svg" type="image/svg+xml"/><link rel="apple-touch-icon" href="/static/apple-touch-icon.png"/><link rel="manifest" href="/static/manifest.webmanifest"/><title>Sanity Studio</title><script>
+;(function () {
+  // The error channel is provided so that error handling can be delegated to a view component.
+  // If there is a subscriber to the error channel at the time the error happens, the error will be pushed to the subscriber instead of handled here.
+  var errorChannel = (function () {
+    var subscribers = Object.create(null)
+    var nextId = 0
+    function subscribe(subscriber) {
+      var id = nextId++
+      subscribers[id] = subscriber
+      return function unsubscribe() {
+        delete subscribers[id]
+      }
+    }
+
+    function publish(event) {
+      for (var id in subscribers) {
+        if (Object.hasOwn(subscribers, id)) {
+          subscribers[id](event)
+        }
+      }
+    }
+    return {
+      subscribers,
+      publish,
+      subscribe
+    }
+  })()
+
+  // NOTE: Store the error channel instance in the global scope so that the Studio application can
+  // access it and subscribe to errors.
+  window.__sanityErrorChannel = {
+    subscribe: errorChannel.subscribe
+  }
+
+  function _handleError(event) {
+    // If there are error channel subscribers, then we assume they will own error rendering,
+    // and we defer to them (no console error).
+    if (Object.keys(errorChannel.subscribers).length > 0) {
+      errorChannel.publish(event)
+    } else {
+      _renderErrorOverlay(event)
+    }
+  }
+
+  var ERROR_BOX_STYLE = [
+    'background: #fff',
+    'border-radius: 6px',
+    'box-sizing: border-box',
+    'color: #121923',
+    'flex: 1',
+    "font-family: -apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,'Helvetica Neue','Liberation Sans',Helvetica,Arial,system-ui,sans-serif",
+    'font-size: 16px',
+    'line-height: 21px',
+    'margin: 0 auto',
+    'max-width: 960px',
+    'max-height: 90dvh',
+    'overflow: auto',
+    'padding: 20px',
+    'width: 100%',
+  ].join(';')
+
+  var ERROR_CODE_STYLE = [
+    'color: #972E2A',
+    "font-family: -apple-system-ui-monospace, 'SF Mono', Menlo, Monaco, Consolas, monospace",
+    'font-size: 13px',
+    'line-height: 17px',
+    'margin: 0',
+  ].join(';')
+
+  function _renderErrorOverlay(event) {
+    var errorElement = document.querySelector('#__sanityError') || document.createElement('div')
+    var error = event.error
+    var colno = event.colno
+    var lineno = event.lineno
+    var filename = event.filename
+
+    errorElement.id = '__sanityError'
+    errorElement.innerHTML = [
+      '<div style="' + ERROR_BOX_STYLE + '">',
+      '<div style="font-weight: 700;">Uncaught error: ' + error.message + '</div>',
+      '<div style="color: #515E72; font-size: 13px; line-height: 17px; margin: 10px 0;">' +
+        filename +
+        ':' +
+        lineno +
+        ':' +
+        colno +
+        '</div>',
+      '<pre style="' + ERROR_CODE_STYLE + '">' + error.stack + '</pre>',
+      '</div>',
+    ].join('')
+
+    errorElement.style.position = 'fixed'
+    errorElement.style.zIndex = 1000000
+    errorElement.style.top = 0
+    errorElement.style.left = 0
+    errorElement.style.right = 0
+    errorElement.style.bottom = 0
+    errorElement.style.padding = '20px'
+    errorElement.style.background = 'rgba(16,17,18,0.66)'
+    errorElement.style.display = 'flex'
+    errorElement.style.alignItems = 'center'
+    errorElement.style.justifyContent = 'center'
+
+    document.body.appendChild(errorElement)
+  }
+
+  // Error listener
+  window.addEventListener('error', (event) => {
+    _handleError({
+      type: 'error',
+      error: event.error,
+      lineno: event.lineno,
+      colno: event.colno,
+      filename: event.filename
+    })
+  })
+
+  // Error listener
+  window.addEventListener('unhandledrejection', (event) => {
+    _handleError({
+      type: 'rejection',
+      error: event.reason
+    })
+  })
+})()
+</script><style>
+  @font-face {
+    font-family: Inter;
+    font-style: normal;
+    font-weight: 400;
+    font-display: swap;
+    src: url("https://studio-static.sanity.io/Inter-Regular.woff2") format("woff2");
+  }
+  @font-face {
+    font-family: Inter;
+    font-style: italic;
+    font-weight: 400;
+    font-display: swap;
+    src: url("https://studio-static.sanity.io/Inter-Italic.woff2") format("woff2");
+  }
+  @font-face {
+    font-family: Inter;
+    font-style: normal;
+    font-weight: 500;
+    font-display: swap;
+    src: url("https://studio-static.sanity.io/Inter-Medium.woff2") format("woff2");
+  }
+  @font-face {
+    font-family: Inter;
+    font-style: italic;
+    font-weight: 500;
+    font-display: swap;
+    src: url("https://studio-static.sanity.io/Inter-MediumItalic.woff2") format("woff2");
+  }
+  @font-face {
+    font-family: Inter;
+    font-style: normal;
+    font-weight: 600;
+    font-display: swap;
+    src: url("https://studio-static.sanity.io/Inter-SemiBold.woff2") format("woff2");
+  }
+  @font-face {
+    font-family: Inter;
+    font-style: italic;
+    font-weight: 600;
+    font-display: swap;
+    src: url("https://studio-static.sanity.io/Inter-SemiBoldItalic.woff2") format("woff2");
+  }
+  @font-face {
+    font-family: Inter;
+    font-style: normal;
+    font-weight: 700;
+    font-display: swap;
+    src: url("https://studio-static.sanity.io/Inter-Bold.woff2") format("woff2");
+  }
+  @font-face {
+    font-family: Inter;
+    font-style: italic;
+    font-weight: 700;
+    font-display: swap;
+    src: url("https://studio-static.sanity.io/Inter-BoldItalic.woff2") format("woff2");
+  }
+  @font-face {
+    font-family: Inter;
+    font-style: normal;
+    font-weight: 800;
+    font-display: swap;
+    src: url("https://studio-static.sanity.io/Inter-ExtraBold.woff2") format("woff2");
+  }
+  @font-face {
+    font-family: Inter;
+    font-style: italic;
+    font-weight: 800;
+    font-display: swap;
+    src: url("https://studio-static.sanity.io/Inter-ExtraBoldItalic.woff2") format("woff2");
+  }
+  @font-face {
+    font-family: Inter;
+    font-style: normal;
+    font-weight: 900;
+    font-display: swap;
+    src: url("https://studio-static.sanity.io/Inter-Black.woff2") format("woff2");
+  }
+  @font-face {
+    font-family: Inter;
+    font-style: italic;
+    font-weight: 900;
+    font-display: swap;
+    src: url("https://studio-static.sanity.io/Inter-BlackItalic.woff2") format("woff2");
+  }
+  html {
+    @media (prefers-color-scheme: dark) {
+      background-color: #13141b;
+    }
+    @media (prefers-color-scheme: light) {
+      background-color: #ffffff;
+    }
+  }
+  html,
+  body,
+  #sanity {
+    height: 100%;
+  }
+  body {
+    margin: 0;
+    -webkit-font-smoothing: antialiased;
+  }
+</style><script src="https://core.sanity-cdn.com/bridge.js" async type="module" data-sanity-core></script>
+</head><body><div id="sanity"></div><script type="module" src="/.sanity\runtime\app.js"></script><noscript><div class="sanity-app-no-js__root"><div class="sanity-app-no-js__content"><style type="text/css">
+.sanity-app-no-js__root {
+  position: absolute;
+  top: 0;
+  right: 0;
+  left: 0;
+  bottom: 0;
+  background: #fff;
+}
+
+.sanity-app-no-js__content {
+  position: absolute;
+  top: 50%;
+  left: 50%;
+  transform: translate(-50%, -50%);
+  text-align: center;
+  font-family: helvetica, arial, sans-serif;
+}
+</style><h1>JavaScript disabled</h1><p>Please <a href="https://www.enable-javascript.com/">enable JavaScript</a> in your browser and reload the page to proceed.</p></div></div></noscript></body></html>
\ No newline at end of file
diff --git a/sanity/data/initial-categories.ndjson b/sanity/data/initial-categories.ndjson
new file mode 100644
index 0000000..7fedf91
--- /dev/null
+++ b/sanity/data/initial-categories.ndjson
@@ -0,0 +1,18 @@
+{"_id":"news-category-acquisition","_type":"tag","title":"Acquisition","category":"News","slug":{"_type":"slug","current":"acquisition"}}
+{"_id":"news-category-sales","_type":"tag","title":"Sales","category":"News","slug":{"_type":"slug","current":"sales"}}
+{"_id":"news-category-game-announcement","_type":"tag","title":"Game Announcement","category":"News","slug":{"_type":"slug","current":"game-announcement"}}
+{"_id":"news-category-industry-news","_type":"tag","title":"Industry News","category":"News","slug":{"_type":"slug","current":"industry-news"}}
+{"_id":"news-category-financials","_type":"tag","title":"Financials","category":"News","slug":{"_type":"slug","current":"financials"}}
+{"_id":"news-category-technology","_type":"tag","title":"Technology","category":"News","slug":{"_type":"slug","current":"technology"}}
+{"_id":"news-category-esports","_type":"tag","title":"Esports","category":"News","slug":{"_type":"slug","current":"esports"}}
+{"_id":"news-category-game-update","_type":"tag","title":"Game Update","category":"News","slug":{"_type":"slug","current":"game-update"}}
+{"_id":"news-category-layoffs","_type":"tag","title":"Layoffs","category":"News","slug":{"_type":"slug","current":"layoffs"}}
+{"_id":"news-category-game-size","_type":"tag","title":"Game Size","category":"News","slug":{"_type":"slug","current":"game-size"}}
+{"_id":"news-category-release-date","_type":"tag","title":"Release Date","category":"News","slug":{"_type":"slug","current":"release-date"}}
+{"_id":"news-category-age-ratings","_type":"tag","title":"Age Ratings","category":"News","slug":{"_type":"slug","current":"age-ratings"}}
+{"_id":"article-category-opinion","_type":"tag","title":"Opinion","category":"Article","slug":{"_type":"slug","current":"opinion"}}
+{"_id":"article-category-guide","_type":"tag","title":"Guide","category":"Article","slug":{"_type":"slug","current":"guide"}}
+{"_id":"article-category-everything-you-need-to-know","_type":"tag","title":"Everything You Need to Know","category":"Article","slug":{"_type":"slug","current":"everything-you-need-to-know"}}
+{"_id":"article-category-analysis","_type":"tag","title":"Analysis","category":"Article","slug":{"_type":"slug","current":"analysis"}}
+{"_id":"article-category-biography","_type":"tag","title":"Biography","category":"Article","slug":{"_type":"slug","current":"biography"}}
+{"_id":"article-category-story","_type":"tag","title":"Story","category":"Article","slug":{"_type":"slug","current":"story"}}
\ No newline at end of file
diff --git a/sanity/env.ts b/sanity/env.ts
index 8fa1f49..6c042dd 100644
--- a/sanity/env.ts
+++ b/sanity/env.ts
@@ -1,50 +1,20 @@
 export const apiVersion =
-process.env.NEXT_PUBLIC_SANITY_API_VERSION || '2025-09-28'
+  process.env.NEXT_PUBLIC_SANITY_API_VERSION || '2025-09-28'
 
 export const dataset = assertValue(
-process.env.NEXT_PUBLIC_SANITY_DATASET,
-'Missing environment variable: NEXT_PUBLIC_SANITY_DATASET'
+  process.env.NEXT_PUBLIC_SANITY_DATASET || process.env.SANITY_STUDIO_DATASET,
+  'Missing environment variable: NEXT_PUBLIC_SANITY_DATASET or SANITY_STUDIO_DATASET'
 )
 
 export const projectId = assertValue(
-process.env.NEXT_PUBLIC_SANITY_PROJECT_ID,
-'Missing environment variable: NEXT_PUBLIC_SANITY_PROJECT_ID'
+  process.env.NEXT_PUBLIC_SANITY_PROJECT_ID || process.env.SANITY_STUDIO_PROJECT_ID,
+  'Missing environment variable: NEXT_PUBLIC_SANITY_PROJECT_ID or SANITY_STUDIO_PROJECT_ID'
 )
 
 function assertValue<T>(v: T | undefined, errorMessage: string): T {
-if (v === undefined) {
-throw new Error(errorMessage)
-}
-
-return v
-}
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
+  if (v === undefined) {
+    throw new Error(errorMessage)
+  }
 
+  return v
+}
\ No newline at end of file
diff --git a/sanity/lib/client.ts b/sanity/lib/client.ts
index 7952582..335cfa3 100644
--- a/sanity/lib/client.ts
+++ b/sanity/lib/client.ts
@@ -7,34 +7,4 @@ projectId,
 dataset,
 apiVersion,
 useCdn: true, // Set to false if statically generating pages, using ISR or tag-based revalidation
-})
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
+})
\ No newline at end of file
diff --git a/sanity/sanity.config.ts b/sanity/sanity.config.ts
index 5164846..487c28e 100644
--- a/sanity/sanity.config.ts
+++ b/sanity/sanity.config.ts
@@ -2,10 +2,7 @@ import {defineConfig} from 'sanity'
 import {structureTool} from 'sanity/structure'
 import {visionTool} from '@sanity/vision'
 import {schemaTypes} from './schemaTypes'
-
-const projectId = '0zany1dm'
-const dataset = 'production'
-const apiVersion = '2025-10-29'
+import {apiVersion, dataset, projectId} from './env' // CORRECTED: Import from env
 
 export default defineConfig({
   basePath: '/studio',
@@ -18,6 +15,4 @@ export default defineConfig({
     structureTool(),
     visionTool({defaultApiVersion: apiVersion}),
   ],
-})
-
-
+})
\ No newline at end of file
diff --git a/sanity/schemaTypes/articleType.ts b/sanity/schemaTypes/articleType.ts
index 5fd0884..a4ddb0a 100644
--- a/sanity/schemaTypes/articleType.ts
+++ b/sanity/schemaTypes/articleType.ts
@@ -11,7 +11,17 @@ defineField({name: 'game', title: 'Game', type: 'reference', to: {type: 'game'},
 defineField({name: 'authors', title: 'Authors', type: 'array', of: [{type: 'reference', to: {type: 'author'}}], validation: (Rule) => Rule.required().min(1)}),
 defineField({name: 'designers', title: 'Designers (Optional)', type: 'array', of: [{type: 'reference', to: {type: 'designer'}}]}),
 defineField({name: 'mainImage', title: 'Main image', type: 'image', options: {hotspot: true}, validation: (Rule) => Rule.required()}),
-defineField({name: 'tags', title: 'Tags', type: 'array', of: [{type: 'reference', to: {type: 'tag'}, options: { filter: 'category in ["Game", "Article"]' }}]}),
+// THE DEFINITIVE FIX: This is now a single reference for the primary category.
+defineField({
+    name: 'category',
+    title: 'Category',
+    type: 'reference',
+    to: [{type: 'tag'}],
+    options: { filter: 'category == "Article"' },
+    validation: (Rule) => Rule.required()
+}),
+// The multi-select 'tags' field is now for general game tags.
+defineField({name: 'tags', title: 'Tags', type: 'array', of: [{type: 'reference', to: {type: 'tag'}, options: { filter: 'category == "Game"' }}]}),
 defineField({name: 'publishedAt', title: 'Published at', type: 'datetime'}),
 defineField({name: 'content', title: 'Content', type: 'blockContent'}),
 defineField({name: 'legacyId', title: 'Legacy ID', type: 'number', readOnly: true}),
@@ -20,6 +30,4 @@ defineField({name: 'relatedArticles', title: 'Related Articles', type: 'array',
 preview: {
 select: {title: 'title', media: 'mainImage'},
 },
-})
-
-
+})
\ No newline at end of file
diff --git a/sanity/schemaTypes/gameReleaseType.ts b/sanity/schemaTypes/gameReleaseType.ts
index 84365a1..a7146e9 100644
--- a/sanity/schemaTypes/gameReleaseType.ts
+++ b/sanity/schemaTypes/gameReleaseType.ts
@@ -7,15 +7,16 @@ type: 'document',
 fields: [
 defineField({name: 'title', title: 'Title', type: 'string', validation: (Rule) => Rule.required()}),
 defineField({name: 'slug', title: 'Slug', type: 'slug', options: {source: 'title', maxLength: 96}, validation: (Rule) => Rule.required()}),
+defineField({name: 'game', title: 'Game', type: 'reference', to: {type: 'game'}, validation: (Rule) => Rule.required()}),
 defineField({name: 'releaseDate', title: 'Release Date', type: 'date', validation: (Rule) => Rule.required()}),
-defineField({name: 'platforms', title: 'Platforms', type: 'array', of: [{type: 'string'}], options: {list: ['PC', 'PS5', 'Xbox', 'Switch']}}),
+defineField({name: 'platforms', title: 'Platforms', type: 'array', of: [{type: 'string'}], options: {list: ['PC', 'PlayStation 5', 'Xbox', 'Switch']}}),
 defineField({name: 'mainImage', title: 'Main Image', type: 'image', options: {hotspot: true}, validation: (Rule) => Rule.required()}),
 defineField({name: 'synopsis', title: 'Synopsis', type: 'text', validation: (Rule) => Rule.required()}),
+defineField({name: 'tags', title: 'Tags', type: 'array', of: [{type: 'reference', to: {type: 'tag'}, options: { filter: 'category == "Game"' }}]}),
+defineField({name: 'designers', title: 'Designers (Optional)', type: 'array', of: [{type: 'reference', to: {type: 'designer'}}]}),
 defineField({name: 'legacyId', title: 'Legacy ID', type: 'number', readOnly: true}),
 ],
 preview: {
 select: {title: 'title', subtitle: 'releaseDate', media: 'mainImage'},
 },
-})
-
-
+})
\ No newline at end of file
diff --git a/sanity/schemaTypes/newsType.ts b/sanity/schemaTypes/newsType.ts
index 753434a..a6619ef 100644
--- a/sanity/schemaTypes/newsType.ts
+++ b/sanity/schemaTypes/newsType.ts
@@ -9,15 +9,29 @@ export default defineType({
         defineField({name: 'slug', title: 'Slug', type: 'slug', options: {source: 'title', maxLength: 96}, validation: (Rule) => Rule.required()}),
         defineField({name: 'reporters', title: 'Reporters', type: 'array', of: [{type: 'reference', to: {type: 'reporter'}}], validation: (Rule) => Rule.required().min(1)}),
         defineField({name: 'designers', title: 'Designers (Optional)', type: 'array', of: [{type: 'reference', to: {type: 'designer'}}]}),
+        // THE DEFINITIVE FIX: Changed from a static string list to a single reference to a categorized tag.
+        defineField({
+            name: 'category',
+            title: 'Category',
+            type: 'reference',
+            to: {type: 'tag'},
+            options: {
+                filter: 'category == "News"'
+            },
+            validation: (Rule) => Rule.required()
+        }),
         defineField({name: 'game', title: 'Game (Optional)', type: 'reference', to: {type: 'game'}}),
         defineField({name: 'mainImage', title: 'Main image', type: 'image', options: {hotspot: true}, validation: (Rule) => Rule.required()}),
-        defineField({name: 'tags', title: 'Tags', type: 'array', of: [{type: 'reference', to: {type: 'tag'}, options: { filter: 'category == "News"' }}]}),
         defineField({name: 'publishedAt', title: 'Published at', type: 'datetime'}),
         defineField({name: 'content', title: 'Content', type: 'blockContent'}),
         defineField({name: 'relatedNews', title: 'Related News', type: 'array', of: [{type: 'reference', to: {type: 'news'}}]}),
         defineField({name: 'legacyId', title: 'Legacy ID', type: 'number', readOnly: true}),
     ],
     preview: {
-        select: {title: 'title', media: 'mainImage'},
+        select: {title: 'title', media: 'mainImage', category: 'category.title'},
+        prepare(selection) {
+            const { category } = selection
+            return {...selection, subtitle: category}
+        }
     },
 })
\ No newline at end of file
diff --git a/sanity/schemaTypes/reviewType.ts b/sanity/schemaTypes/reviewType.ts
index 5c42011..86937bf 100644
--- a/sanity/schemaTypes/reviewType.ts
+++ b/sanity/schemaTypes/reviewType.ts
@@ -28,6 +28,4 @@ const {author} = selection
 return {...selection, subtitle: author && `by ${author}`}
 },
 },
-})
-
-
+})
\ No newline at end of file
diff --git a/sanity/schemaTypes/tagType.ts b/sanity/schemaTypes/tagType.ts
index 620cf3b..1a89ca3 100644
--- a/sanity/schemaTypes/tagType.ts
+++ b/sanity/schemaTypes/tagType.ts
@@ -25,9 +25,9 @@ export default defineType({
             type: 'string',
             options: {
                 list: [
-                    { title: 'Game (For Reviews & Articles)', value: 'Game' },
-                    { title: 'News (For News only)', value: 'News' },
-                    { title: 'Article (For Articles only)', value: 'Article' }
+                    { title: 'Game Tag (For Reviews & Releases)', value: 'Game' },
+                    { title: 'Article Category (For Articles)', value: 'Article' },
+                    { title: 'News Category (For News)', value: 'News' }
                 ],
                 layout: 'radio'
             },
@@ -35,6 +35,4 @@ export default defineType({
             initialValue: 'Game'
         }),
     ],
-})
-
-
+})
\ No newline at end of file
diff --git a/sanity/scripts/backfillLegacyIds.ts b/sanity/scripts/backfillLegacyIds.ts
new file mode 100644
index 0000000..a795d7e
--- /dev/null
+++ b/sanity/scripts/backfillLegacyIds.ts
@@ -0,0 +1,93 @@
+// This is a standalone script to be executed with tsx or ts-node.
+// It loads environment variables from the root .env file.
+import 'dotenv/config';
+import { createClient } from '@sanity/client';
+
+// --- Script Configuration ---
+const projectId = process.env.SANITY_PROJECT_ID;
+const dataset = process.env.SANITY_DATASET;
+const token = process.env.SANITY_API_WRITE_TOKEN;
+const apiVersion = '2025-09-28';
+const DOC_TYPES = ['review', 'article', 'news', 'gameRelease'];
+
+// --- Validation ---
+if (!projectId || !dataset || !token) {
+  console.error('Error: Missing SANITY_PROJECT_ID, SANITY_DATASET, or SANITY_API_WRITE_TOKEN in your root .env file.');
+  process.exit(1);
+}
+
+// --- Create a dedicated, authenticated Sanity client for this script ---
+const client = createClient({
+  projectId,
+  dataset,
+  token,
+  apiVersion,
+  useCdn: false, // Always use fresh data for a script
+});
+
+async function backfillLegacyIds() {
+  console.log('Starting comprehensive backfill process for legacyIds...');
+
+  // 1. Fetch ALL documents of the relevant types to identify duplicates and find the max ID.
+  const query = `*[_type in $types] {_id, _type, title, legacyId}`;
+  const allDocs = await client.fetch<{ _id: string, _type: string, title: string, legacyId: number | null }[]>(query, { types: DOC_TYPES });
+
+  if (allDocs.length === 0) {
+    console.log('No documents found to process.');
+    return;
+  }
+
+  // 2. Find the true highest legacyId and identify all documents that need patching.
+  const seenIds = new Set<number>();
+  const docsToPatch: { _id: string, _type: string, title: string }[] = [];
+  let maxId = 0;
+
+  for (const doc of allDocs) {
+    if (doc.legacyId !== null && doc.legacyId !== undefined) {
+      if (seenIds.has(doc.legacyId)) {
+        // This is a duplicate ID, mark for patching.
+        docsToPatch.push(doc);
+      } else {
+        // This is the first time we've seen this ID, it's valid for now.
+        seenIds.add(doc.legacyId);
+        if (doc.legacyId > maxId) {
+          maxId = doc.legacyId;
+        }
+      }
+    } else {
+      // The ID is missing entirely, mark for patching.
+      docsToPatch.push(doc);
+    }
+  }
+
+  if (docsToPatch.length === 0) {
+    console.log('All documents have unique legacyIds. No action needed.');
+    return;
+  }
+
+  console.log(`Current highest unique legacyId found: ${maxId}`);
+  console.log(`Found ${docsToPatch.length} documents with missing or duplicate legacyIds. Starting patching process...`);
+
+  // 3. Create a transaction to patch all corrupt documents.
+  let currentIdCounter = maxId;
+  const transaction = client.transaction();
+
+  docsToPatch.forEach(doc => {
+    currentIdCounter++;
+    console.log(`  - Assigning NEW legacyId: ${currentIdCounter} to document [${doc._type}] "${doc.title}" (${doc._id})`);
+    transaction.patch(doc._id, { set: { legacyId: currentIdCounter } });
+  });
+
+  // 4. Commit the transaction.
+  try {
+    const result = await transaction.commit();
+    console.log(`Successfully patched ${result.results.length} documents.`);
+    console.log('Backfill complete. Your data is now consistent.');
+  } catch (error) {
+    console.error('An error occurred while committing the transaction:', error);
+    console.error('No documents were حُدِّثت. Please try again or check your Sanity token permissions.');
+  }
+}
+
+// Execute the function
+backfillLegacyIds();
\ No newline at end of file
diff --git a/types/index.ts b/types/index.ts
index 17bbd12..ef2a8e4 100644
--- a/types/index.ts
+++ b/types/index.ts
@@ -19,6 +19,7 @@ export type CardProps = {
     score?: number;
     tags: { title: string, slug: string }[]; // Changed to object array
     blurDataURL: string;
+    category?: string; // ADDED: For news/article categories
     verdict?: string;
     pros?: any[];
     cons?: any[];
diff --git a/types/sanity.ts b/types/sanity.ts
index fb5ec6b..2fa9d5d 100644
--- a/types/sanity.ts
+++ b/types/sanity.ts
@@ -97,7 +97,7 @@ export interface SanityGameRelease {
     title: string;
     slug: string;
     releaseDate: string;
-    platforms: ('PC' | 'PS5' | 'Xbox' | 'Switch')[];
+    platforms: ('PC' | 'PlayStation 5' | 'Xbox' | 'Switch')[];
     synopsis: string;
     mainImage: SanityImage; // THE FIX
 }
